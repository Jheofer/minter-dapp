if (!window.Granify || !window.Granify.enabled || typeof window.Granify !== 'function') {
  GRANIFY_CONFIG = {"SHOP_ID":"qivBM","version":242,"custom_script":"v21_fix_vacation_mode_error","use_iframe":false,"use_cookies":true,"cookie_fallback":false,"cookies_domain":"etsy.com","local_jquery":false,"analytics_tracker":[],"metrics_enabled":true,"session_tracking_type":"page","external_groups":false,"shop_type":"javascript","ssd_cart_item_info_properties":["product_id","sku","number_of_reviews","ratings","in_stock","title","price","regular_price","image","savings","carters","promotion_end_timestamp","promotion_percentage_discount","promotion_minimum_type","free_shipping_minimum_type","free_shipping_min_total_money","free_shipping_end","url","shop_name"],"full_url_for_tpv_regex":false,"default_locale":"en","pageTypeRegex":[{"regex":"^\\/(?:[a-z]{2}\\/?)?(\\?.*)?$","pageType":"home"},{"regex":"\\/listing\\/[0-9]+\\/(?!similar).*","pageType":"product"},{"regex":"\\/listing\\/[0-9]+\\/(?=similar).*","pageType":"other"},{"regex":"\\/market\\/[a-zA-Z0-9_]+.*","pageType":"search"},{"regex":"\\/cart\\/[0-9]+\\/review.*","pageType":"checkout"},{"regex":"\\/cart\\/thanks\\/[0-9]+.*","pageType":"receipt"},{"regex":"\\/cart(\\/?\\?|\\/|$)+.*","pageType":"cart"},{"regex":"\\/featured(\\?.*|$)+","pageType":"guide"},{"regex":"\\/(signin|join).*","pageType":"login"},{"regex":"\\/(your\\/|conversations|messages|people|redeem).*","pageType":"account"},{"regex":"\\/(sell|about|team|careers|press|impact|legal|affiliates|prototypes).*","pageType":"info"},{"regex":"\\/giftcards.*","pageType":"other"},{"regex":"\\/search.*","pageType":"search"},{"regex":"\\/(blog).*","pageType":"blog"},{"regex":"(\\/([a-zA-Z-]+[0-9]*)+)+","pageType":"collection"}],"customInstall":{"trackPageView":true,"trackProduct":false,"setCurrentProduct":false,"trackCart":false,"trackWishList":false,"trackOrder":false,"eventGroupNotification":false,"eventMessageNotification":false,"assignGroup":false},"group_table":{"Baseline":"1","Granify":"2","GranifyV2":"25","BaselineV2":"26"},"serverGaStores":[],"matchingHost":"//matching.granify.com","assetHost":"//cdn.granify.com","env":"production","rb_version":"2022-08-14 15:59:25 UTC","vendorApisEnabled":[],"displayAck":false,"customValues":{}};

  !function(t){var e={};function r(n){if(e[n])return e[n].exports;var a=e[n]={i:n,l:!1,exports:{}};return t[n].call(a.exports,a,a.exports,r),a.l=!0,a.exports}r.m=t,r.c=e,r.d=function(t,e,n){r.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:n})},r.r=function(t){"undefined"!==typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},r.t=function(t,e){if(1&e&&(t=r(t)),8&e)return t;if(4&e&&"object"===typeof t&&t&&t.__esModule)return t;var n=Object.create(null);if(r.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var a in t)r.d(n,a,function(e){return t[e]}.bind(null,a));return n},r.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return r.d(e,"a",e),e},r.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},r.p="//granify:3000/packs/",r(r.s=70)}([function(t,e,r){t.exports=r(14)},function(t,e){Granify=Granify||{},Granify.constants={EVENT_URL_CHANGE:"URLChange",EVENT_UPDATED_CART:"UpdatedCart",EVENT_ADD_TO_CART:"AddToCart",EVENT_REMOVE_FROM_CART:"RemoveFromCart",EVENT_UPDATED_WISHLIST:"UpdatedWishList",EVENT_MESSAGE_SHOWN:"message:shown",EVENT_MESSAGE_ACKNOWLEDGED:"message:acknowledged",EVENT_MESSAGE_NOT_SHOWN:"message:notShown",EVENT_MESSAGE_SHOW:"message:show",EVENT_MESSAGE_HIDE:"message:hide",EVENT_GROUP_ASSIGNED:"groupAssigned",EVENT_NON_CACHED_MATCH_REQUEST_COMPLETE:"nonCachedMatchRequestComplete",EVENT_TOOL_PAIRS_ASSIGNED:"toolPairsAssigned",NEW_SESSION_INITIALIZED:"newSessionInitialized",PRODUCT_PAGE_CHANGE:"ProductPageChange",PRODUCT_SELECTION_CHANGE:"ProductSelectionChange",PAGE_TYPE_CHANGE_NEEDED:"PageTypeChangeNeeded",PAGE_TYPE_CHANGE:"pagetype:change",RESTRICTED_STATE:"restricted_state",RESTRICTED_STATE_ENTERED:"restrictedstate:entered",CURRENT_PRODUCT_CHANGE:"currentproduct:change",SERIALIZED_CAMPAIGN_HISTORY:"serializedCampaignHistory",LATEST_TRACK_CART:"latestTrackCart",METRIC_MESSAGE_SHOW:"message_show",METRIC_MESSAGE_HIDE:"message_hide",OFFER_EVENT:"offerEventTriggered",OFFER_EVENT_CLICK_UNMINIMIZE:"click_unminimize",OFFER_EVENT_CLICK_MINIMIZE:"click_minimize",OFFER_EVENT_CLICK_CLOSE:"click_close",OFFER_EVENT_CLICK_TOGGLE:"click_toggle",OFFER_EVENT_CLICK_INTERACT:"click_interact",OFFER_EVENT_CTA_VIEW_PRODUCT:"cta_view_product",OFFER_EVENT_CTA_ADD_TO_CART:"cta_add_to_cart",OFFER_EVENT_CTA_CHECKOUT:"cta_checkout",OFFER_EVENT_CTA:"cta",OFFER_EVENT_ADD_TO_CART:"add_to_cart",OFFER_EVENT_AUTO_CLOSE:"auto_close",OFFER_EVENT_VIEW_PRODUCT:"view_product",OFFER_EVENT_ACKNOWLEDGED:"widget_acknowledged",OFFER_EVENT_PRODUCT_SHOWN:"product_shown",OFFER_EVENT_COUPON_SHOWN:"coupon_shown",SITE_EVENT:"siteEventTriggered",SITE_EVENT_TYPE_COUNT:"count",SITE_EVENT_TYPE_TIME:"time",SITE_EVENT_TYPE_DATA:"data",SITE_EVENT_TYPE_DATA_ARRAY:"data_array",SITE_EVENT_SIGNEDUP:"signedUp",SITE_EVENT_SHOWEDLIGHTBOX:"showedLightbox",SITE_EVENT_SHOWIGNORED:"showIgnored",SITE_EVENT_DISMISSEDLIGHTBOX:"dismissedLightbox",SITE_EVENT_SEARCH_TERMS:"searchTerms",SITE_EVENT_SORT_SUFFIX:"_sort",DEFAULT_CUSTOM_INSTALL_PAGE_TYPE:"other",STORED_SESSION_TOOL_PAIRS:"toolPairsSessionStorage",PLATFORM_MATCHING_GROUP:21,GRANIFY_VENDOR:"granify",VENDORS_ENABLED:["fourCite"],HYBRID_APP_SHOP_TYPE:"hybrid"}},function(t,e,r){var n=r(65),a=r(66);"string"===typeof(a=a.__esModule?a.default:a)&&(a=[[t.i,a,""]]);var i={insert:"head",singleton:!1};n(a,i);t.exports=a.locals||{}},function(t,e){Granify.LogPreQueue=[];var r={debug:{name:"debug",color:"#52bcf9",func:"debug"},info:{name:"info",color:"#52bcf9",func:"log"},warning:{name:"warning",color:"#efe33e",func:"warn"},error:{name:"error",color:"#ed8540",func:"error"},critical:{name:"critical",color:"#ef3939",func:"error"}};Granify._logLevels=r,Granify.logError=function(t,e){Granify.LogPreQueue.push({name:t,context:e,sendOnce:!1,level:r.error})},Granify.logErrorOnce=function(t,e){Granify.LogPreQueue.push({name:t,context:e,sendOnce:!0,level:r.error})},Granify.logWarning=function(t,e){Granify.LogPreQueue.push({name:t,context:e,sendOnce:!1,level:r.warning})},Granify.logWarningOnce=function(t,e){Granify.LogPreQueue.push({name:t,context:e,sendOnce:!0,level:r.warning})},Granify.logCritical=function(t,e){Granify.LogPreQueue.push({name:t,context:e,sendOnce:!1,level:r.critical})},Granify.logCriticalOnce=function(t,e){Granify.LogPreQueue.push({name:t,context:e,sendOnce:!0,level:r.critical})}},function(t,e){Granify.addGranifyListener=function(t,e,r){t.addEventListener?t.addEventListener(e,r,!0):t.attachEvent("on"+e,r)},Granify.removeGranifyListener=function(t,e,r){t.removeEventListener?t.removeEventListener(e,r,!0):t.detachEvent("on"+e,r)}},function(t,e){(function(){var t=this,e=void 0,r=function(t,e){var r=e||0,n=c;return n[t[r++]]+n[t[r++]]+n[t[r++]]+n[t[r++]]+"-"+n[t[r++]]+n[t[r++]]+"-"+n[t[r++]]+n[t[r++]]+"-"+n[t[r++]]+n[t[r++]]+"-"+n[t[r++]]+n[t[r++]]+n[t[r++]]+n[t[r++]]+n[t[r++]]+n[t[r++]]},n=function(t,n,a){var i=n&&a||0;"string"===typeof t&&(n="binary"===t?new s(16):null,t=null);var o=(t=t||{}).random||(t.rng||e)();if(o[6]=15&o[6]|64,o[8]=63&o[8]|128,n)for(var c=0;c<16;)n[i+c]=o[c],c++;return n||r(o)};if("function"===typeof t.require)try{var a=t.require("crypto").randomBytes;e=a&&function(){return a(16)}}catch(p){}if(!e&&window.crypto&&window.crypto.getRandomValues){var i=new Uint8Array(16);e=function(){return window.crypto.getRandomValues(i),i}}if(!e){var o=new Array(16);e=function(){for(var t=0,e=void 0;t<16;)0===(3&t)&&(e=4294967296*Math.random()),o[t]=e>>>(3&t)<<3&255,t++;return o}}for(var s="function"===typeof t.Buffer?t.Buffer:Array,c=[],u={},f=0;f<256;)c[f]=(f+256).toString(16).substr(1),u[c[f]]=f,f++;var l=e(),y=(l[0],l[1],l[2],l[3],l[4],l[5],l[6],l[7],n);y.v1=function(t,n,a){var i,o,s,c=n&&a||0,u=n||[],f=null!=(t=null!=t?t:{}).node?t.node:s,l=null!=t.clockseq?t.clockseq:i;null!=f&&null!=l||(o=e(),null==f&&(f=s=[1|o[0],o[1],o[2],o[3],o[4],o[5]]));null==l&&(l=i=16383&(o[6]<<8|o[7]));var y=null!=t.msecs?t.msecs:(new Date).getTime(),d=null!=t.nsecs?t.nsecs:h+1,p=y-g+(d-h)/1e4;if(p<0&&null==t.clockseq&&(l=l+1&16383),(p<0||y>g)&&null==t.nsecs&&(d=0),d>=1e4)throw new Error("uuid.v1(): Can't create more than 10M uuids/sec");var g=y,h=d;i=l;var m=(1e4*(268435455&(y+=122192928e5))+d)%4294967296;u[c++]=m>>>24&255,u[c++]=m>>>16&255,u[c++]=m>>>8&255,u[c++]=255&m;var G=y/4294967296*1e4&268435455;u[c++]=G>>>8&255,u[c++]=255&G,u[c++]=G>>>24&15|16,u[c++]=G>>>16&255,u[c++]=l>>>8|128,u[c++]=255&l;for(var _=0;_<6;)u[c+_]=f[_],_++;return n||r(u)},y.v4=n,y.parse=function(t,e,r){var n=e&&r||0,a=0;for(e=e||[],t.toLowerCase().replace(/[0-9a-f]{2}/g,(function(t){a<16&&(e[n+a++]=u[t])}));a<16;)e[n+a++]=0;return e},y.unparse=r,y.BufferClass=s;var d=t.uuid;y.noConflict=function(){return t.uuid=d,y},t.uuid=y}).call(Granify)},function(t,e){Granify.uuidv5=function(){"use strict";var t=/^(?:[0-9a-f]{8}-[0-9a-f]{4}-[1-5][0-9a-f]{3}-[89ab][0-9a-f]{3}-[0-9a-f]{12}|00000000-0000-0000-0000-000000000000)$/i;function e(e){return"string"==typeof e&&t.test(e)}for(var r=[],n=0;n<256;++n)r.push((n+256).toString(16).substr(1));function a(t,e,r,n){switch(t){case 0:return e&r^~e&n;case 1:return e^r^n;case 2:return e&r^e&n^r&n;case 3:return e^r^n}}function i(t,e){return t<<e|t>>>32-e}return function(t,n,a){function i(t,n,i,o){if("string"==typeof t&&(t=function(t){t=unescape(encodeURIComponent(t));for(var e=[],r=0;r<t.length;++r)e.push(t.charCodeAt(r));return e}(t)),"string"==typeof n&&(n=function(t){if(!e(t))throw TypeError("Invalid UUID");var r,n=new Uint8Array(16);return n[0]=(r=parseInt(t.slice(0,8),16))>>>24,n[1]=r>>>16&255,n[2]=r>>>8&255,n[3]=255&r,n[4]=(r=parseInt(t.slice(9,13),16))>>>8,n[5]=255&r,n[6]=(r=parseInt(t.slice(14,18),16))>>>8,n[7]=255&r,n[8]=(r=parseInt(t.slice(19,23),16))>>>8,n[9]=255&r,n[10]=(r=parseInt(t.slice(24,36),16))/1099511627776&255,n[11]=r/4294967296&255,n[12]=r>>>24&255,n[13]=r>>>16&255,n[14]=r>>>8&255,n[15]=255&r,n}(n)),16!==n.length)throw TypeError("Namespace must be array-like (16 iterable integer values, 0-255)");var s=new Uint8Array(16+t.length);if(s.set(n),s.set(t,n.length),(s=a(s))[6]=15&s[6]|80,s[8]=63&s[8]|128,i){o=o||0;for(var c=0;c<16;++c)i[o+c]=s[c];return i}return function(t){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,a=(r[t[n+0]]+r[t[n+1]]+r[t[n+2]]+r[t[n+3]]+"-"+r[t[n+4]]+r[t[n+5]]+"-"+r[t[n+6]]+r[t[n+7]]+"-"+r[t[n+8]]+r[t[n+9]]+"-"+r[t[n+10]]+r[t[n+11]]+r[t[n+12]]+r[t[n+13]]+r[t[n+14]]+r[t[n+15]]).toLowerCase();if(!e(a))throw TypeError("Stringified UUID is invalid");return a}(s)}try{i.name="v5"}catch(t){}return i.DNS="6ba7b810-9dad-11d1-80b4-00c04fd430c8",i.URL="6ba7b811-9dad-11d1-80b4-00c04fd430c8",i}(0,0,(function(t){var e=[1518500249,1859775393,2400959708,3395469782],r=[1732584193,4023233417,2562383102,271733878,3285377520];if("string"==typeof t){var n=unescape(encodeURIComponent(t));t=[];for(var o=0;o<n.length;++o)t.push(n.charCodeAt(o))}else Array.isArray(t)||(t=Array.prototype.slice.call(t));t.push(128);for(var s=t.length/4+2,c=Math.ceil(s/16),u=new Array(c),f=0;f<c;++f){for(var l=new Uint32Array(16),y=0;y<16;++y)l[y]=t[64*f+4*y]<<24|t[64*f+4*y+1]<<16|t[64*f+4*y+2]<<8|t[64*f+4*y+3];u[f]=l}u[c-1][14]=8*(t.length-1)/Math.pow(2,32),u[c-1][14]=Math.floor(u[c-1][14]),u[c-1][15]=8*(t.length-1)&4294967295;for(var d=0;d<c;++d){for(var p=new Uint32Array(80),g=0;g<16;++g)p[g]=u[d][g];for(var h=16;h<80;++h)p[h]=i(p[h-3]^p[h-8]^p[h-14]^p[h-16],1);for(var m=r[0],G=r[1],_=r[2],v=r[3],b=r[4],E=0;E<80;++E){var w=Math.floor(E/20),S=i(m,5)+a(w,G,_,v)+b+e[w]+p[E]>>>0;b=v,v=_,_=i(G,30)>>>0,G=m,m=S}r[0]=r[0]+m>>>0,r[1]=r[1]+G>>>0,r[2]=r[2]+_>>>0,r[3]=r[3]+v>>>0,r[4]=r[4]+b>>>0}return[r[0]>>24&255,r[0]>>16&255,r[0]>>8&255,255&r[0],r[1]>>24&255,r[1]>>16&255,r[1]>>8&255,255&r[1],r[2]>>24&255,r[2]>>16&255,r[2]>>8&255,255&r[2],r[3]>>24&255,r[3]>>16&255,r[3]>>8&255,255&r[3],r[4]>>24&255,r[4]>>16&255,r[4]>>8&255,255&r[4]]}))}()},function(t,e){(function(){var t,e="granify\\.[A-z_\\-0-9:]*\\."+GRANIFY_CONFIG.migration_id,r=new RegExp("(?:^|[; ])"+e+"=[^;]*","g"),n=new RegExp(e);"undefined"!==typeof GRANIFY_CONFIG.migration_id&&GRANIFY_CONFIG.migration_id!==GRANIFY_CONFIG.SHOP_ID&&(function(){var e="";Granify.cookies_domain?e="domain="+Granify.cookies_domain+";":GRANIFY_CONFIG.cookies_domain&&GRANIFY_CONFIG.cookies_domain.trim().length>0&&"localhost"!=GRANIFY_CONFIG.cookies_domain&&(e="domain=."+GRANIFY_CONFIG.cookies_domain.trim()+";");try{for(var n,a=document.cookie;null!==(n=r.exec(a));){var i=n[0];t=Granify.itExists(GRANIFY_CONFIG.maximum_cookie_length_in_milliseconds)?GRANIFY_CONFIG.maximum_cookie_length_in_milliseconds:15768e7;var o=new Date(+new Date+t).toGMTString();i.indexOf("session")>-1&&(o=new Date((new Date).setTime((new Date).getTime()+18e5)).toGMTString());var s=i+";expires="+(new Date).toGMTString()+";"+e+"path=/;SameSite=None;Secure",c=(i=i.replace("."+GRANIFY_CONFIG.migration_id,"."+GRANIFY_CONFIG.SHOP_ID))+";expires="+o+";"+e+"path=/;SameSite=None;Secure";document.cookie=s,document.cookie=c}}catch(u){console.log("Could not convert Granify cookies to new shop ID"),console.log(u.message)}}(),function(){try{for(var t=[],e=0;e<window.localStorage.length;e++)null!==n.exec(localStorage.key(e))&&t.push(localStorage.key(e));for(var r=0;r<t.length;r++){var a=window.localStorage.getItem(t[r]),i=t[r],o=new RegExp(GRANIFY_CONFIG.migration_id,"g");i=i.replace(o,GRANIFY_CONFIG.SHOP_ID),localStorage.removeItem(t[r]),localStorage.setItem(i,a)}}catch(s){console.log("Could not convert Granify localStorage to new shop ID"),console.log(s.message)}}())}).call(this)},function(t,e){(function(t,e){"use strict";var r="model",n="name",a="type",i="vendor",o="version",s="mobile",c="tablet",u={extend:function(t,e){var r={};for(var n in t)e[n]&&e[n].length%2===0?r[n]=e[n].concat(t[n]):r[n]=t[n];return r},has:function(t,e){return"string"===typeof t&&-1!==e.toLowerCase().indexOf(t.toLowerCase())},lowerize:function(t){return t.toLowerCase()},major:function(t){return"string"===typeof t?t.replace(/[^\d\.]/g,"").split(".")[0]:e},trim:function(t){return t.replace(/^[\s\uFEFF\xA0]+|[\s\uFEFF\xA0]+$/g,"")}},f={rgx:function(t,r){for(var n,a,i,o,s,c,u=0;u<r.length&&!s;){var f=r[u],l=r[u+1];for(n=a=0;n<f.length&&!s;)if(s=f[n++].exec(t))for(i=0;i<l.length;i++)c=s[++a],"object"===typeof(o=l[i])&&o.length>0?2==o.length?"function"==typeof o[1]?this[o[0]]=o[1].call(this,c):this[o[0]]=o[1]:3==o.length?"function"!==typeof o[1]||o[1].exec&&o[1].test?this[o[0]]=c?c.replace(o[1],o[2]):e:this[o[0]]=c?o[1].call(this,c,o[2]):e:4==o.length&&(this[o[0]]=c?o[3].call(this,c.replace(o[1],o[2])):e):this[o]=c||e;u+=2}},str:function(t,r){for(var n in r)if("object"===typeof r[n]&&r[n].length>0){for(var a=0;a<r[n].length;a++)if(u.has(r[n][a],t))return"?"===n?e:n}else if(u.has(r[n],t))return"?"===n?e:n;return t}},l={browser:{oldsafari:{version:{"1.0":"/8",1.2:"/1",1.3:"/3","2.0":"/412","2.0.2":"/416","2.0.3":"/417","2.0.4":"/419","?":"/"}}},device:{amazon:{model:{"Fire Phone":["SD","KF"]}},sprint:{model:{"Evo Shift 4G":"7373KT"},vendor:{HTC:"APA",Sprint:"Sprint"}}},os:{windows:{version:{ME:"4.90","NT 3.11":"NT3.51","NT 4.0":"NT4.0",2e3:"NT 5.0",XP:["NT 5.1","NT 5.2"],Vista:"NT 6.0",7:"NT 6.1",8:"NT 6.2",8.1:"NT 6.3",10:["NT 6.4","NT 10.0"],RT:"ARM"}}}},y={browser:[[/(opera\smini)\/([\w\.-]+)/i,/(opera\s[mobiletab]+).+version\/([\w\.-]+)/i,/(opera).+version\/([\w\.]+)/i,/(opera)[\/\s]+([\w\.]+)/i],[n,o],[/(opios)[\/\s]+([\w\.]+)/i],[[n,"Opera Mini"],o],[/\s(opr)\/([\w\.]+)/i],[[n,"Opera"],o],[/(kindle)\/([\w\.]+)/i,/(lunascape|maxthon|netfront|jasmine|blazer)[\/\s]?([\w\.]+)*/i,/(avant\s|iemobile|slim|baidu)(?:browser)?[\/\s]?([\w\.]*)/i,/(?:ms|\()(ie)\s([\w\.]+)/i,/(rekonq)\/([\w\.]+)*/i,/(chromium|flock|rockmelt|midori|epiphany|silk|skyfire|ovibrowser|bolt|iron|vivaldi|iridium|phantomjs|bowser|quark)\/([\w\.-]+)/i],[n,o],[/(trident).+rv[:\s]([\w\.]+).+like\sgecko/i],[[n,"IE"],o],[/(edge)\/((\d+)?[\w\.]+)/i],[n,o],[/(yabrowser)\/([\w\.]+)/i],[[n,"Yandex"],o],[/(puffin)\/([\w\.]+)/i],[[n,"Puffin"],o],[/((?:[\s\/])uc?\s?browser|(?:juc.+)ucweb)[\/\s]?([\w\.]+)/i],[[n,"UCBrowser"],o],[/(comodo_dragon)\/([\w\.]+)/i],[[n,/_/g," "],o],[/(micromessenger)\/([\w\.]+)/i],[[n,"WeChat"],o],[/(QQ)\/([\d\.]+)/i],[n,o],[/m?(qqbrowser)[\/\s]?([\w\.]+)/i],[n,o],[/xiaomi\/miuibrowser\/([\w\.]+)/i],[o,[n,"MIUI Browser"]],[/;fbav\/([\w\.]+);/i],[o,[n,"Facebook"]],[/headlesschrome(?:\/([\w\.]+)|\s)/i],[o,[n,"Chrome Headless"]],[/\swv\).+(chrome)\/([\w\.]+)/i],[[n,/(.+)/,"$1 WebView"],o],[/((?:oculus|samsung)browser)\/([\w\.]+)/i],[[n,/(.+(?:g|us))(.+)/,"$1 $2"],o],[/android.+version\/([\w\.]+)\s+(?:mobile\s?safari|safari)*/i],[o,[n,"Android Browser"]],[/(chrome|omniweb|arora|[tizenoka]{5}\s?browser)\/v?([\w\.]+)/i],[n,o],[/(dolfin)\/([\w\.]+)/i],[[n,"Dolphin"],o],[/((?:android.+)crmo|crios)\/([\w\.]+)/i],[[n,"Chrome"],o],[/(coast)\/([\w\.]+)/i],[[n,"Opera Coast"],o],[/fxios\/([\w\.-]+)/i],[o,[n,"Firefox"]],[/version\/([\w\.]+).+?mobile\/\w+\s(safari)/i],[o,[n,"Mobile Safari"]],[/version\/([\w\.]+).+?(mobile\s?safari|safari)/i],[o,n],[/webkit.+?(gsa)\/([\w\.]+).+?(mobile\s?safari|safari)(\/[\w\.]+)/i],[[n,"GSA"],o],[/webkit.+?(mobile\s?safari|safari)(\/[\w\.]+)/i],[n,[o,f.str,l.browser.oldsafari.version]],[/(konqueror)\/([\w\.]+)/i,/(webkit|khtml)\/([\w\.]+)/i],[n,o],[/(navigator|netscape)\/([\w\.-]+)/i],[[n,"Netscape"],o],[/(swiftfox)/i,/(icedragon|iceweasel|camino|chimera|fennec|maemo\sbrowser|minimo|conkeror)[\/\s]?([\w\.\+]+)/i,/(firefox|seamonkey|k-meleon|icecat|iceape|firebird|phoenix|palemoon|basilisk|waterfox)\/([\w\.-]+)$/i,/(mozilla)\/([\w\.]+).+rv\:.+gecko\/\d+/i,/(polaris|lynx|dillo|icab|doris|amaya|w3m|netsurf|sleipnir)[\/\s]?([\w\.]+)/i,/(links)\s\(([\w\.]+)/i,/(gobrowser)\/?([\w\.]+)*/i,/(ice\s?browser)\/v?([\w\._]+)/i,/(mosaic)[\/\s]([\w\.]+)/i],[n,o]],cpu:[[/(?:(amd|x(?:(?:86|64)[_-])?|wow|win)64)[;\)]/i],[["architecture","amd64"]],[/(ia32(?=;))/i],[["architecture",u.lowerize]],[/((?:i[346]|x)86)[;\)]/i],[["architecture","ia32"]],[/windows\s(ce|mobile);\sppc;/i],[["architecture","arm"]],[/((?:ppc|powerpc)(?:64)?)(?:\smac|;|\))/i],[["architecture",/ower/,"",u.lowerize]],[/(sun4\w)[;\)]/i],[["architecture","sparc"]],[/((?:avr32|ia64(?=;))|68k(?=\))|arm(?:64|(?=v\d+;))|(?=atmel\s)avr|(?:irix|mips|sparc)(?:64)?(?=;)|pa-risc)/i],[["architecture",u.lowerize]]],device:[[/\((ipad|playbook);[\w\s\);-]+(rim|apple)/i],[r,i,[a,c]],[/applecoremedia\/[\w\.]+ \((ipad)/],[r,[i,"Apple"],[a,c]],[/(apple\s{0,1}tv)/i],[[r,"Apple TV"],[i,"Apple"]],[/(archos)\s(gamepad2?)/i,/(hp).+(touchpad)/i,/(hp).+(tablet)/i,/(kindle)\/([\w\.]+)/i,/\s(nook)[\w\s]+build\/(\w+)/i,/(dell)\s(strea[kpr\s\d]*[\dko])/i],[i,r,[a,c]],[/(kf[A-z]+)\sbuild\/[\w\.]+.*silk\//i],[r,[i,"Amazon"],[a,c]],[/(sd|kf)[0349hijorstuw]+\sbuild\/[\w\.]+.*silk\//i],[[r,f.str,l.device.amazon.model],[i,"Amazon"],[a,s]],[/\((ip[honed|\s\w*]+);.+(apple)/i],[r,i,[a,s]],[/\((ip[honed|\s\w*]+);/i],[r,[i,"Apple"],[a,s]],[/(blackberry)[\s-]?(\w+)/i,/(blackberry|benq|palm(?=\-)|sonyericsson|acer|asus|dell|meizu|motorola|polytron)[\s_-]?([\w-]+)*/i,/(hp)\s([\w\s]+\w)/i,/(asus)-?(\w+)/i],[i,r,[a,s]],[/\(bb10;\s(\w+)/i],[r,[i,"BlackBerry"],[a,s]],[/android.+(transfo[prime\s]{4,10}\s\w+|eeepc|slider\s\w+|nexus 7|padfone)/i],[r,[i,"Asus"],[a,c]],[/(sony)\s(tablet\s[ps])\sbuild\//i,/(sony)?(?:sgp.+)\sbuild\//i],[[i,"Sony"],[r,"Xperia Tablet"],[a,c]],[/android.+\s([c-g]\d{4}|so[-l]\w+)\sbuild\//i],[r,[i,"Sony"],[a,s]],[/\s(ouya)\s/i,/(nintendo)\s([wids3u]+)/i],[i,r,[a,"console"]],[/android.+;\s(shield)\sbuild/i],[r,[i,"Nvidia"],[a,"console"]],[/(playstation\s[34portablevi]+)/i],[r,[i,"Sony"],[a,"console"]],[/(sprint\s(\w+))/i],[[i,f.str,l.device.sprint.vendor],[r,f.str,l.device.sprint.model],[a,s]],[/(lenovo)\s?(S(?:5000|6000)+(?:[-][\w+]))/i],[i,r,[a,c]],[/(htc)[;_\s-]+([\w\s]+(?=\))|\w+)*/i,/(zte)-(\w+)*/i,/(alcatel|geeksphone|lenovo|nexian|panasonic|(?=;\s)sony)[_\s-]?([\w-]+)*/i],[i,[r,/_/g," "],[a,s]],[/(nexus\s9)/i],[r,[i,"HTC"],[a,c]],[/d\/huawei([\w\s-]+)[;\)]/i,/(nexus\s6p)/i],[r,[i,"Huawei"],[a,s]],[/(microsoft);\s(lumia[\s\w]+)/i],[i,r,[a,s]],[/[\s\(;](xbox(?:\sone)?)[\s\);]/i],[r,[i,"Microsoft"],[a,"console"]],[/(kin\.[onetw]{3})/i],[[r,/\./g," "],[i,"Microsoft"],[a,s]],[/\s(milestone|droid(?:[2-4x]|\s(?:bionic|x2|pro|razr))?(:?\s4g)?)[\w\s]+build\//i,/mot[\s-]?(\w+)*/i,/(XT\d{3,4}) build\//i,/(nexus\s6)/i],[r,[i,"Motorola"],[a,s]],[/android.+\s(mz60\d|xoom[\s2]{0,2})\sbuild\//i],[r,[i,"Motorola"],[a,c]],[/hbbtv\/\d+\.\d+\.\d+\s+\([\w\s]*;\s*(\w[^;]*);([^;]*)/i],[[i,u.trim],[r,u.trim],[a,"smarttv"]],[/hbbtv.+maple;(\d+)/i],[[r,/^/,"SmartTV"],[i,"Samsung"],[a,"smarttv"]],[/\(dtv[\);].+(aquos)/i],[r,[i,"Sharp"],[a,"smarttv"]],[/android.+((sch-i[89]0\d|shw-m380s|gt-p\d{4}|gt-n\d+|sgh-t8[56]9|nexus 10))/i,/((SM-T\w+))/i],[[i,"Samsung"],r,[a,c]],[/smart-tv.+(samsung)/i],[i,[a,"smarttv"],r],[/((s[cgp]h-\w+|gt-\w+|galaxy\snexus|sm-\w[\w\d]+))/i,/(sam[sung]*)[\s-]*(\w+-?[\w-]*)*/i,/sec-((sgh\w+))/i],[[i,"Samsung"],r,[a,s]],[/sie-(\w+)*/i],[r,[i,"Siemens"],[a,s]],[/(maemo|nokia).*(n900|lumia\s\d+)/i,/(nokia)[\s_-]?([\w-]+)*/i],[[i,"Nokia"],r,[a,s]],[/android\s3\.[\s\w;-]{10}(a\d{3})/i],[r,[i,"Acer"],[a,c]],[/android.+([vl]k\-?\d{3})\s+build/i],[r,[i,"LG"],[a,c]],[/android\s3\.[\s\w;-]{10}(lg?)-([06cv9]{3,4})/i],[[i,"LG"],r,[a,c]],[/(lg) netcast\.tv/i],[i,r,[a,"smarttv"]],[/(nexus\s[45])/i,/lg[e;\s\/-]+(\w+)*/i,/android.+lg(\-?[\d\w]+)\s+build/i],[r,[i,"LG"],[a,s]],[/android.+(ideatab[a-z0-9\-\s]+)/i],[r,[i,"Lenovo"],[a,c]],[/linux;.+((jolla));/i],[i,r,[a,s]],[/((pebble))app\/[\d\.]+\s/i],[i,r,[a,"wearable"]],[/android.+;\s(oppo)\s?([\w\s]+)\sbuild/i],[i,r,[a,s]],[/crkey/i],[[r,"Chromecast"],[i,"Google"]],[/android.+;\s(glass)\s\d/i],[r,[i,"Google"],[a,"wearable"]],[/android.+;\s(pixel c)\s/i],[r,[i,"Google"],[a,c]],[/android.+;\s(pixel xl|pixel)\s/i],[r,[i,"Google"],[a,s]],[/android.+(\w+)\s+build\/hm\1/i,/android.+(hm[\s\-_]*note?[\s_]*(?:\d\w)?)\s+build/i,/android.+(mi[\s\-_]*(?:one|one[\s_]plus|note lte)?[\s_]*(?:\d\w?)?[\s_]*(?:plus)?)\s+build/i,/android.+(redmi[\s\-_]*(?:note)?(?:[\s_]*[\w\s]+)?)\s+build/i],[[r,/_/g," "],[i,"Xiaomi"],[a,s]],[/android.+(mi[\s\-_]*(?:pad)(?:[\s_]*[\w\s]+)?)\s+build/i],[[r,/_/g," "],[i,"Xiaomi"],[a,c]],[/android.+;\s(m[1-5]\snote)\sbuild/i],[r,[i,"Meizu"],[a,c]],[/android.+a000(1)\s+build/i,/android.+oneplus\s(a\d{4})\s+build/i],[r,[i,"OnePlus"],[a,s]],[/android.+[;\/]\s*(RCT[\d\w]+)\s+build/i],[r,[i,"RCA"],[a,c]],[/android.+[;\/]\s*(Venue[\d\s]*)\s+build/i],[r,[i,"Dell"],[a,c]],[/android.+[;\/]\s*(Q[T|M][\d\w]+)\s+build/i],[r,[i,"Verizon"],[a,c]],[/android.+[;\/]\s+(Barnes[&\s]+Noble\s+|BN[RT])(V?.*)\s+build/i],[[i,"Barnes & Noble"],r,[a,c]],[/android.+[;\/]\s+(TM\d{3}.*\b)\s+build/i],[r,[i,"NuVision"],[a,c]],[/android.+[;\/]\s*(zte)?.+(k\d{2})\s+build/i],[[i,"ZTE"],r,[a,c]],[/android.+[;\/]\s*(gen\d{3})\s+build.*49h/i],[r,[i,"Swiss"],[a,s]],[/android.+[;\/]\s*(zur\d{3})\s+build/i],[r,[i,"Swiss"],[a,c]],[/android.+[;\/]\s*((Zeki)?TB.*\b)\s+build/i],[r,[i,"Zeki"],[a,c]],[/(android).+[;\/]\s+([YR]\d{2}x?.*)\s+build/i,/android.+[;\/]\s+(Dragon[\-\s]+Touch\s+|DT)(.+)\s+build/i],[[i,"Dragon Touch"],r,[a,c]],[/android.+[;\/]\s*(NS-?.+)\s+build/i],[r,[i,"Insignia"],[a,c]],[/android.+[;\/]\s*((NX|Next)-?.+)\s+build/i],[r,[i,"NextBook"],[a,c]],[/android.+[;\/]\s*(Xtreme\_?)?(V(1[045]|2[015]|30|40|60|7[05]|90))\s+build/i],[[i,"Voice"],r,[a,s]],[/android.+[;\/]\s*(LVTEL\-?)?(V1[12])\s+build/i],[[i,"LvTel"],r,[a,s]],[/android.+[;\/]\s*(V(100MD|700NA|7011|917G).*\b)\s+build/i],[r,[i,"Envizen"],[a,c]],[/android.+[;\/]\s*(Le[\s\-]+Pan)[\s\-]+(.*\b)\s+build/i],[i,r,[a,c]],[/android.+[;\/]\s*(Trio[\s\-]*.*)\s+build/i],[r,[i,"MachSpeed"],[a,c]],[/android.+[;\/]\s*(Trinity)[\-\s]*(T\d{3})\s+build/i],[i,r,[a,c]],[/android.+[;\/]\s*TU_(1491)\s+build/i],[r,[i,"Rotor"],[a,c]],[/android.+(KS(.+))\s+build/i],[r,[i,"Amazon"],[a,c]],[/android.+(Gigaset)[\s\-]+(Q.+)\s+build/i],[i,r,[a,c]],[/\s(tablet|tab)[;\/]/i,/\s(mobile)(?:[;\/]|\ssafari)/i],[[a,u.lowerize],i,r],[/(android.+)[;\/].+build/i],[r,[i,"Generic"]]],engine:[[/windows.+\sedge\/([\w\.]+)/i],[o,[n,"EdgeHTML"]],[/(presto)\/([\w\.]+)/i,/(webkit|trident|netfront|netsurf|amaya|lynx|w3m)\/([\w\.]+)/i,/(khtml|tasman|links)[\/\s]\(?([\w\.]+)/i,/(icab)[\/\s]([23]\.[\d\.]+)/i],[n,o],[/rv\:([\w\.]+).*(gecko)/i],[o,n]],os:[[/microsoft\s(windows)\s(vista|xp)/i],[n,o],[/(windows)\snt\s6\.2;\s(arm)/i,/(windows\sphone(?:\sos)*)[\s\/]?([\d\.\s]+\w)*/i,/(windows\smobile|windows)[\s\/]?([ntce\d\.\s]+\w)/i],[n,[o,f.str,l.os.windows.version]],[/(win(?=3|9|n)|win\s9x\s)([nt\d\.]+)/i],[[n,"Windows"],[o,f.str,l.os.windows.version]],[/\((bb)(10);/i],[[n,"BlackBerry"],o],[/(blackberry)\w*\/?([\w\.]+)*/i,/(tizen)[\/\s]([\w\.]+)/i,/(android|webos|palm\sos|qnx|bada|rim\stablet\sos|meego|contiki)[\/\s-]?([\w\.]+)*/i,/linux;.+(sailfish);/i],[n,o],[/(symbian\s?os|symbos|s60(?=;))[\/\s-]?([\w\.]+)*/i],[[n,"Symbian"],o],[/\((series40);/i],[n],[/mozilla.+\(mobile;.+gecko.+firefox/i],[[n,"Firefox OS"],o],[/(nintendo|playstation)\s([wids34portablevu]+)/i,/(mint)[\/\s\(]?(\w+)*/i,/(mageia|vectorlinux)[;\s]/i,/(joli|[kxln]?ubuntu|debian|[open]*suse|gentoo|(?=\s)arch|slackware|fedora|mandriva|centos|pclinuxos|redhat|zenwalk|linpus)[\/\s-]?(?!chrom)([\w\.-]+)*/i,/(hurd|linux)\s?([\w\.]+)*/i,/(gnu)\s?([\w\.]+)*/i],[n,o],[/(cros)\s[\w]+\s([\w\.]+\w)/i],[[n,"Chromium OS"],o],[/(sunos)\s?([\w\.]+\d)*/i],[[n,"Solaris"],o],[/\s([frentopc-]{0,4}bsd|dragonfly)\s?([\w\.]+)*/i],[n,o],[/(haiku)\s(\w+)/i],[n,o],[/cfnetwork\/.+darwin/i,/ip[honead]+(?:.*os\s([\w]+)\slike\smac|;\sopera)/i],[[o,/_/g,"."],[n,"iOS"]],[/(mac\sos\sx)\s?([\w\s\.]+\w)*/i,/(macintosh|mac(?=_powerpc)\s)/i],[[n,"Mac OS"],[o,/_/g,"."]],[/((?:open)?solaris)[\/\s-]?([\w\.]+)*/i,/(aix)\s((\d)(?=\.|\)|\s)[\w\.]*)*/i,/(plan\s9|minix|beos|os\/2|amigaos|morphos|risc\sos|openvms)/i,/(unix)\s?([\w\.]+)*/i],[n,o]]},d=function r(n,a){if("object"===typeof n&&(a=n,n=e),!(this instanceof r))return new r(n,a).getResult();var i=n||(t&&t.navigator&&t.navigator.userAgent?t.navigator.userAgent:""),o=a?u.extend(y,a):y;return this.getBrowser=function(){var t={name:e,version:e};return f.rgx.call(t,i,o.browser),t.major=u.major(t.version),t},this.getCPU=function(){var t={architecture:e};return f.rgx.call(t,i,o.cpu),t},this.getDevice=function(){var t={vendor:e,model:e,type:e};return f.rgx.call(t,i,o.device),t},this.getEngine=function(){var t={name:e,version:e};return f.rgx.call(t,i,o.engine),t},this.getOS=function(){var t={name:e,version:e};return f.rgx.call(t,i,o.os),t},this.getResult=function(){return{ua:this.getUA(),browser:this.getBrowser(),engine:this.getEngine(),os:this.getOS(),device:this.getDevice(),cpu:this.getCPU()}},this.getUA=function(){return i},this.setUA=function(t){return i=t,this},this};d.VERSION="0.7.17",d.BROWSER={NAME:n,MAJOR:"major",VERSION:o},d.CPU={ARCHITECTURE:"architecture"},d.DEVICE={MODEL:r,VENDOR:i,TYPE:a,CONSOLE:"console",MOBILE:s,SMARTTV:"smarttv",TABLET:c,WEARABLE:"wearable",EMBEDDED:"embedded"},d.ENGINE={NAME:n,VERSION:o},d.OS={NAME:n,VERSION:o},this.ua=(new d).getResult()}).call(Granify,window)},function(t,e,r){(function(t,e){(function(){"use strict";function n(t){return"function"===typeof t}var a,i,o=Array.isArray?Array.isArray:function(t){return"[object Array]"===Object.prototype.toString.call(t)},s=0,c=function(t,e){v[s]=t,v[s+1]=e,2===(s+=2)&&(i?i(b):g())};var u="undefined"!==typeof window?window:void 0,f=u||{},l=f.MutationObserver||f.WebKitMutationObserver,y="undefined"===typeof self&&"undefined"!==typeof t&&"[object process]"==={}.toString.call(t),d="undefined"!==typeof Uint8ClampedArray&&"undefined"!==typeof importScripts&&"undefined"!==typeof MessageChannel;function p(){return function(){setTimeout(b,1)}}var g,h,m,G,_,v=new Array(1e3);function b(){for(var t=0;t<s;t+=2){(0,v[t])(v[t+1]),v[t]=void 0,v[t+1]=void 0}s=0}y?g=function(){t.nextTick(b)}:l?(m=0,G=new l(b),_=document.createTextNode(""),G.observe(_,{characterData:!0}),g=function(){_.data=m=++m%2}):d?((h=new MessageChannel).port1.onmessage=b,g=function(){h.port2.postMessage(0)}):g=void 0===u?function(){try{var t=r(!function(){var t=new Error("Cannot find module 'vertx'");throw t.code="MODULE_NOT_FOUND",t}());return a=t.runOnLoop||t.runOnContext,function(){a(b)}}catch(e){return p()}}():p();var E=function(t,e){var r=this,n=new this.constructor(A);void 0===n[S]&&U(n);var a=r._state;if(a){var i=arguments[a-1];c((function(){j(a,n,i,r._result)}))}else N(r,n,t,e);return n};var w=function(t){if(t&&"object"===typeof t&&t.constructor===this)return t;var e=new this(A);return C(e,t),e},S=Math.random().toString(36).substring(16);function A(){}var k=new x;function O(t){try{return t.then}catch(e){return k.error=e,k}}function T(t,e,r){e.constructor===t.constructor&&r===E&&constructor.resolve===w?function(t,e){1===e._state?D(t,e._result):2===e._state?P(t,e._result):N(e,void 0,(function(e){C(t,e)}),(function(e){P(t,e)}))}(t,e):r===k?P(t,k.error):void 0===r?D(t,e):n(r)?function(t,e,r){c((function(t){var n=!1,a=function(t,e,r,n){try{t.call(e,r,n)}catch(a){return a}}(r,e,(function(r){n||(n=!0,e!==r?C(t,r):D(t,r))}),(function(e){n||(n=!0,P(t,e))}),t._label);!n&&a&&(n=!0,P(t,a))}),t)}(t,e,r):D(t,e)}function C(t,e){var r;t===e?P(t,new TypeError("You cannot resolve a promise with itself")):"function"===typeof(r=e)||"object"===typeof r&&null!==r?T(t,e,O(e)):D(t,e)}function I(t){t._onerror&&t._onerror(t._result),R(t)}function D(t,e){void 0===t._state&&(t._result=e,t._state=1,0!==t._subscribers.length&&c(R,t))}function P(t,e){void 0===t._state&&(t._state=2,t._result=e,c(I,t))}function N(t,e,r,n){var a=t._subscribers,i=a.length;t._onerror=null,a[i]=e,a[i+1]=r,a[i+2]=n,0===i&&t._state&&c(R,t)}function R(t){var e=t._subscribers,r=t._state;if(0!==e.length){for(var n,a,i=t._result,o=0;o<e.length;o+=3)n=e[o],a=e[o+r],n?j(r,n,a,i):a(i);t._subscribers.length=0}}function x(){this.error=null}var L=new x;function j(t,e,r,a){var i,o,s,c,u=n(r);if(u){if((i=function(t,e){try{return t(e)}catch(r){return L.error=r,L}}(r,a))===L?(c=!0,o=i.error,i=null):s=!0,e===i)return void P(e,new TypeError("A promises callback cannot return that same promise."))}else i=a,s=!0;void 0!==e._state||(u&&s?C(e,i):c?P(e,o):1===t?D(e,i):2===t&&P(e,i))}var F=0;function U(t){t[S]=F++,t._state=void 0,t._result=void 0,t._subscribers=[]}var M=function(t){return new Y(this,t).promise};var B=function(t){var e=this;return o(t)?new e((function(r,n){for(var a=t.length,i=0;i<a;i++)e.resolve(t[i]).then(r,n)})):new e((function(t,e){e(new TypeError("You must pass an array to race."))}))};var H=function(t){var e=new this(A);return P(e,t),e};var V=W;function W(t){this[S]=F++,this._result=this._state=void 0,this._subscribers=[],A!==t&&("function"!==typeof t&&function(){throw new TypeError("You must pass a resolver function as the first argument to the promise constructor")}(),this instanceof W?function(t,e){try{e((function(e){C(t,e)}),(function(e){P(t,e)}))}catch(r){P(t,r)}}(this,t):function(){throw new TypeError("Failed to construct 'Promise': Please use the 'new' operator, this object constructor cannot be called as a function.")}())}W.all=M,W.race=B,W.resolve=w,W.reject=H,W._setScheduler=function(t){i=t},W._setAsap=function(t){c=t},W._asap=c,W.prototype={constructor:W,then:E,catch:function(t){return this.then(null,t)}};var Y=q;function q(t,e){this._instanceConstructor=t,this.promise=new t(A),this.promise[S]||U(this.promise),o(e)?(this._input=e,this.length=e.length,this._remaining=e.length,this._result=new Array(this.length),0===this.length?D(this.promise,this._result):(this.length=this.length||0,this._enumerate(),0===this._remaining&&D(this.promise,this._result))):P(this.promise,new Error("Array Methods must be provided an Array"))}q.prototype._enumerate=function(){for(var t=this.length,e=this._input,r=0;void 0===this._state&&r<t;r++)this._eachEntry(e[r],r)},q.prototype._eachEntry=function(t,e){var r=this._instanceConstructor,n=r.resolve;if(n===w){var a=O(t);if(a===E&&void 0!==t._state)this._settledAt(t._state,e,t._result);else if("function"!==typeof a)this._remaining--,this._result[e]=t;else if(r===V){var i=new r(A);T(i,t,a),this._willSettleAt(i,e)}else this._willSettleAt(new r((function(e){e(t)})),e)}else this._willSettleAt(n(t),e)},q.prototype._settledAt=function(t,e,r){var n=this.promise;void 0===n._state&&(this._remaining--,2===t?P(n,r):this._result[e]=r),0===this._remaining&&D(n,this._result)},q.prototype._willSettleAt=function(t,e){var r=this;N(t,void 0,(function(t){r._settledAt(1,e,t)}),(function(t){r._settledAt(2,e,t)}))};var z=function(t){return function(){var r;if("undefined"!==typeof e)r=e;else if("undefined"!==typeof self)r=self;else try{r=Function("return this")()}catch(a){throw new Error("polyfill of Granify promise failed because global object is unavailable in this environment")}var n=r.Promise;!n||"[object Promise]"!==Object.prototype.toString.call(n.resolve())||n.cast?"undefined"!==typeof t&&(t.Promise=V):"undefined"!==typeof t&&(t.Promise=n)}}(this);V.Promise=V,V.polyfill=z,"undefined"!==typeof this&&(this.Promise=V),z()}).call(Granify)}).call(this,r(10),r(11))},function(t,e){var r,n,a=t.exports={};function i(){throw new Error("setTimeout has not been defined")}function o(){throw new Error("clearTimeout has not been defined")}function s(t){if(r===setTimeout)return setTimeout(t,0);if((r===i||!r)&&setTimeout)return r=setTimeout,setTimeout(t,0);try{return r(t,0)}catch(e){try{return r.call(null,t,0)}catch(e){return r.call(this,t,0)}}}!function(){try{r="function"===typeof setTimeout?setTimeout:i}catch(t){r=i}try{n="function"===typeof clearTimeout?clearTimeout:o}catch(t){n=o}}();var c,u=[],f=!1,l=-1;function y(){f&&c&&(f=!1,c.length?u=c.concat(u):l=-1,u.length&&d())}function d(){if(!f){var t=s(y);f=!0;for(var e=u.length;e;){for(c=u,u=[];++l<e;)c&&c[l].run();l=-1,e=u.length}c=null,f=!1,function(t){if(n===clearTimeout)return clearTimeout(t);if((n===o||!n)&&clearTimeout)return n=clearTimeout,clearTimeout(t);try{n(t)}catch(e){try{return n.call(null,t)}catch(e){return n.call(this,t)}}}(t)}}function p(t,e){this.fun=t,this.array=e}function g(){}a.nextTick=function(t){var e=new Array(arguments.length-1);if(arguments.length>1)for(var r=1;r<arguments.length;r++)e[r-1]=arguments[r];u.push(new p(t,e)),1!==u.length||f||s(d)},p.prototype.run=function(){this.fun.apply(null,this.array)},a.title="browser",a.browser=!0,a.env={},a.argv=[],a.version="",a.versions={},a.on=g,a.addListener=g,a.once=g,a.off=g,a.removeListener=g,a.removeAllListeners=g,a.emit=g,a.prependListener=g,a.prependOnceListener=g,a.listeners=function(t){return[]},a.binding=function(t){throw new Error("process.binding is not supported")},a.cwd=function(){return"/"},a.chdir=function(t){throw new Error("process.chdir is not supported")},a.umask=function(){return 0}},function(t,e){function r(t){return(r="function"===typeof Symbol&&"symbol"===typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"===typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}var n;n=function(){return this}();try{n=n||new Function("return this")()}catch(a){"object"===("undefined"===typeof window?"undefined":r(window))&&(n=window)}t.exports=n},function(t,e){function r(){return Granify.cookies_domain?"domain=".concat(Granify.cookies_domain,";"):""}function n(t,e){var n=[t,"expires=".concat(e),"".concat(r(),"path=/")];return Granify.canUseSameSiteNone()&&n.push("SameSite=None"),"https:"===location.protocol&&n.push("Secure"),n.join(";")}function a(t){return GRANIFY_CONFIG.maximum_cookie_length_in_milliseconds?GRANIFY_CONFIG.maximum_cookie_length_in_milliseconds:t}Granify=Granify||{},Granify.canUseSameSiteNone=function(){return!("Mobile Safari"===Granify.ua.browser.name&&"iOS"===Granify.ua.os.name&&Number(Granify.ua.browser.major)<=12||"Safari"===Granify.ua.browser.name&&"Mac OS"===Granify.ua.os.name&&Number(Granify.ua.os.version.split(/(.+)\./)[1])<=10.14||"https:"!==location.protocol)},Granify.setCookie=function(t,e){var i,o=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,s=15768e7,c=r(),u=a(s);o=null!==(i=o)&&void 0!==i?i:new Date(+new Date+u).toGMTString(),document.cookie="".concat(t,"=;expires=Thu, 01 Jan 1970 00:00:00 GMT;").concat(c,"path=/");var f=n("".concat(t,"=").concat(e),o);document.cookie=f},Granify.getExpiry=a},function(t,e){Granify=Granify||{},Granify.StateAlreadyImported=!1,Granify.StorageMethodDetermined=!1;function r(){var t=Granify.getExpiry(6307e7);return new Date(+new Date+t)}function n(){return new Date(+new Date+36e5)}function a(){var t=arguments.length>0&&void 0!==arguments[0]&&arguments[0];try{if(window.Granify_State.uuid&&!t){Granify.UUID=window.Granify_State.uuid;var e=JSON.stringify({expires:+r(),data:window.Granify_State.uuid});window.localStorage.setItem("granify.uuid",e)}if(window.Granify_State.trackedProducts){var a=i(),o="granify.track_product.".concat(GRANIFY_CONFIG.SHOP_ID),s=JSON.stringify({data:a.productHash,expires:+r()});window.localStorage.setItem(o,s);var c="granify.track_product_window.".concat(GRANIFY_CONFIG.SHOP_ID),u=JSON.stringify({data:a.idArray,expires:+r()});window.localStorage.setItem(c,u)}if(window.Granify_State.forceMatchingCampaign&&Number(window.Granify_State.forceMatchingCampaign)){var f="granify.force_matching_cid.".concat(GRANIFY_CONFIG.SHOP_ID),l=JSON.stringify({data:window.Granify_State.forceMatchingCampaign,expires:+n()});window.localStorage.setItem(f,l)}}catch(y){Granify.logCriticalOnce("Failed to import external state",{error:y,state:window.Granify_State})}}function i(){return window.Granify_State.trackedProducts.items.reduce((function(t,e){return(e=Object.assign({},e,e.customProperties||{})).customProperties&&delete e.customProperties,t.productHash[e.sku||e.id||e.product_id]=e,t.idArray.push(e.sku||e.id||e.product_id),t}),{productHash:{},idArray:[]})}Granify.determineStorageMethod=function(){if(!Granify.StorageMethodDetermined){Granify.use_iframe=GRANIFY_CONFIG.use_iframe,Granify.use_local_storage=!GRANIFY_CONFIG.use_cookies,Granify.use_cookies=GRANIFY_CONFIG.use_cookies,Granify.localStorageWorking=!0,void 0!==GRANIFY_CONFIG.cookie_fallback?Granify.cookie_fallback=GRANIFY_CONFIG.cookie_fallback:Granify.cookie_fallback=Granify.use_cookies;try{window.localStorage.setItem("granify_localStorage_test","1"),"1"!==window.localStorage.getItem("granify_localStorage_test")&&(Granify.localStorageWorking=!1,window.localStorage.removeItem("granify_localStorage_test"))}catch(e){Granify.localStorageWorking=!1}if(!Granify.localStorageWorking)if(Granify.use_local_storage)Granify.use_local_storage=!1;else if(Granify.use_cookies&&!Granify.cookie_fallback){if(-1===document.cookie.indexOf("granify.localstorage_disabled")){Granify._stack=Granify._stack||[],Granify._stack.push(["error"].concat(new Error("Local Storage not enabled and no cookie fallback, disabling Granify matching"),"Initializer.js Detect Storage Method"));var t=new Date((new Date).getTime()+18e5).toGMTString();Granify.setCookie("granify.localstorage_disabled",!0,t)}Granify.use_cookies=!1}Granify.StorageMethodDetermined=!0}},Granify.importState=function(){Granify.StateAlreadyImported||window.Granify_State&&(Granify.determineStorageMethod(),Granify.use_cookies?function(){window.Granify_State.uuid&&(Granify.UUID=window.Granify_State.uuid,Granify.setCookie("granify.uuid",window.Granify_State.uuid));window.Granify_State.forceMatchingCampaign&&Number(window.Granify_State.forceMatchingCampaign)&&Granify.setCookie("granify.force_matching_cid.".concat(GRANIFY_CONFIG.SHOP_ID),window.Granify_State.forceMatchingCampaign,n().toGMTString());Granify.use_local_storage?a(!0):Granify.cookie_fallback}():Granify.use_iframe?function(){window.Granify_State.uuid&&(Granify.UUID=window.Granify_State.uuid,Granify.setSharedData(Granify.storage.UUID,window.Granify_State.uuid,+r()));if(window.Granify_State.trackedProducts){var t=i();Granify.setSharedData(Granify.storage.TRACK_PRODUCT,t.productHash),Granify.setSharedData(Granify.storage.TRACK_PRODUCT_ROLLING_WINDOW,t.idArray)}window.Granify_State.forceMatchingCampaign&&Number(window.Granify_State.forceMatchingCampaign)&&Granify.setSharedData(Granify.storage.FORCE_MATCHING,window.Granify_State.forceMatchingCampaign,+n())}():Granify.use_local_storage&&a(),Granify.StateAlreadyImported=!0,Granify.readyToStart&&Granify.start())}},function(t,e,r){var n=function(t){"use strict";var e=Object.prototype,r=e.hasOwnProperty,n="function"===typeof Symbol?Symbol:{},a=n.iterator||"@@iterator",i=n.asyncIterator||"@@asyncIterator",o=n.toStringTag||"@@toStringTag";function s(t,e,r){return Object.defineProperty(t,e,{value:r,enumerable:!0,configurable:!0,writable:!0}),t[e]}try{s({},"")}catch(k){s=function(t,e,r){return t[e]=r}}function c(t,e,r,n){var a=e&&e.prototype instanceof l?e:l,i=Object.create(a.prototype),o=new w(n||[]);return i._invoke=function(t,e,r){var n="suspendedStart";return function(a,i){if("executing"===n)throw new Error("Generator is already running");if("completed"===n){if("throw"===a)throw i;return A()}for(r.method=a,r.arg=i;;){var o=r.delegate;if(o){var s=v(o,r);if(s){if(s===f)continue;return s}}if("next"===r.method)r.sent=r._sent=r.arg;else if("throw"===r.method){if("suspendedStart"===n)throw n="completed",r.arg;r.dispatchException(r.arg)}else"return"===r.method&&r.abrupt("return",r.arg);n="executing";var c=u(t,e,r);if("normal"===c.type){if(n=r.done?"completed":"suspendedYield",c.arg===f)continue;return{value:c.arg,done:r.done}}"throw"===c.type&&(n="completed",r.method="throw",r.arg=c.arg)}}}(t,r,o),i}function u(t,e,r){try{return{type:"normal",arg:t.call(e,r)}}catch(k){return{type:"throw",arg:k}}}t.wrap=c;var f={};function l(){}function y(){}function d(){}var p={};p[a]=function(){return this};var g=Object.getPrototypeOf,h=g&&g(g(S([])));h&&h!==e&&r.call(h,a)&&(p=h);var m=d.prototype=l.prototype=Object.create(p);function G(t){["next","throw","return"].forEach((function(e){s(t,e,(function(t){return this._invoke(e,t)}))}))}function _(t,e){var n;this._invoke=function(a,i){function o(){return new e((function(n,o){!function n(a,i,o,s){var c=u(t[a],t,i);if("throw"!==c.type){var f=c.arg,l=f.value;return l&&"object"===typeof l&&r.call(l,"__await")?e.resolve(l.__await).then((function(t){n("next",t,o,s)}),(function(t){n("throw",t,o,s)})):e.resolve(l).then((function(t){f.value=t,o(f)}),(function(t){return n("throw",t,o,s)}))}s(c.arg)}(a,i,n,o)}))}return n=n?n.then(o,o):o()}}function v(t,e){var r=t.iterator[e.method];if(void 0===r){if(e.delegate=null,"throw"===e.method){if(t.iterator.return&&(e.method="return",e.arg=void 0,v(t,e),"throw"===e.method))return f;e.method="throw",e.arg=new TypeError("The iterator does not provide a 'throw' method")}return f}var n=u(r,t.iterator,e.arg);if("throw"===n.type)return e.method="throw",e.arg=n.arg,e.delegate=null,f;var a=n.arg;return a?a.done?(e[t.resultName]=a.value,e.next=t.nextLoc,"return"!==e.method&&(e.method="next",e.arg=void 0),e.delegate=null,f):a:(e.method="throw",e.arg=new TypeError("iterator result is not an object"),e.delegate=null,f)}function b(t){var e={tryLoc:t[0]};1 in t&&(e.catchLoc=t[1]),2 in t&&(e.finallyLoc=t[2],e.afterLoc=t[3]),this.tryEntries.push(e)}function E(t){var e=t.completion||{};e.type="normal",delete e.arg,t.completion=e}function w(t){this.tryEntries=[{tryLoc:"root"}],t.forEach(b,this),this.reset(!0)}function S(t){if(t){var e=t[a];if(e)return e.call(t);if("function"===typeof t.next)return t;if(!isNaN(t.length)){var n=-1,i=function e(){for(;++n<t.length;)if(r.call(t,n))return e.value=t[n],e.done=!1,e;return e.value=void 0,e.done=!0,e};return i.next=i}}return{next:A}}function A(){return{value:void 0,done:!0}}return y.prototype=m.constructor=d,d.constructor=y,y.displayName=s(d,o,"GeneratorFunction"),t.isGeneratorFunction=function(t){var e="function"===typeof t&&t.constructor;return!!e&&(e===y||"GeneratorFunction"===(e.displayName||e.name))},t.mark=function(t){return Object.setPrototypeOf?Object.setPrototypeOf(t,d):(t.__proto__=d,s(t,o,"GeneratorFunction")),t.prototype=Object.create(m),t},t.awrap=function(t){return{__await:t}},G(_.prototype),_.prototype[i]=function(){return this},t.AsyncIterator=_,t.async=function(e,r,n,a,i){void 0===i&&(i=Promise);var o=new _(c(e,r,n,a),i);return t.isGeneratorFunction(r)?o:o.next().then((function(t){return t.done?t.value:o.next()}))},G(m),s(m,o,"Generator"),m[a]=function(){return this},m.toString=function(){return"[object Generator]"},t.keys=function(t){var e=[];for(var r in t)e.push(r);return e.reverse(),function r(){for(;e.length;){var n=e.pop();if(n in t)return r.value=n,r.done=!1,r}return r.done=!0,r}},t.values=S,w.prototype={constructor:w,reset:function(t){if(this.prev=0,this.next=0,this.sent=this._sent=void 0,this.done=!1,this.delegate=null,this.method="next",this.arg=void 0,this.tryEntries.forEach(E),!t)for(var e in this)"t"===e.charAt(0)&&r.call(this,e)&&!isNaN(+e.slice(1))&&(this[e]=void 0)},stop:function(){this.done=!0;var t=this.tryEntries[0].completion;if("throw"===t.type)throw t.arg;return this.rval},dispatchException:function(t){if(this.done)throw t;var e=this;function n(r,n){return o.type="throw",o.arg=t,e.next=r,n&&(e.method="next",e.arg=void 0),!!n}for(var a=this.tryEntries.length-1;a>=0;--a){var i=this.tryEntries[a],o=i.completion;if("root"===i.tryLoc)return n("end");if(i.tryLoc<=this.prev){var s=r.call(i,"catchLoc"),c=r.call(i,"finallyLoc");if(s&&c){if(this.prev<i.catchLoc)return n(i.catchLoc,!0);if(this.prev<i.finallyLoc)return n(i.finallyLoc)}else if(s){if(this.prev<i.catchLoc)return n(i.catchLoc,!0)}else{if(!c)throw new Error("try statement without catch or finally");if(this.prev<i.finallyLoc)return n(i.finallyLoc)}}}},abrupt:function(t,e){for(var n=this.tryEntries.length-1;n>=0;--n){var a=this.tryEntries[n];if(a.tryLoc<=this.prev&&r.call(a,"finallyLoc")&&this.prev<a.finallyLoc){var i=a;break}}i&&("break"===t||"continue"===t)&&i.tryLoc<=e&&e<=i.finallyLoc&&(i=null);var o=i?i.completion:{};return o.type=t,o.arg=e,i?(this.method="next",this.next=i.finallyLoc,f):this.complete(o)},complete:function(t,e){if("throw"===t.type)throw t.arg;return"break"===t.type||"continue"===t.type?this.next=t.arg:"return"===t.type?(this.rval=this.arg=t.arg,this.method="return",this.next="end"):"normal"===t.type&&e&&(this.next=e),f},finish:function(t){for(var e=this.tryEntries.length-1;e>=0;--e){var r=this.tryEntries[e];if(r.finallyLoc===t)return this.complete(r.completion,r.afterLoc),E(r),f}},catch:function(t){for(var e=this.tryEntries.length-1;e>=0;--e){var r=this.tryEntries[e];if(r.tryLoc===t){var n=r.completion;if("throw"===n.type){var a=n.arg;E(r)}return a}}throw new Error("illegal catch attempt")},delegateYield:function(t,e,r){return this.delegate={iterator:S(t),resultName:e,nextLoc:r},"next"===this.method&&(this.arg=void 0),f}},t}(t.exports);try{regeneratorRuntime=n}catch(a){Function("r","regeneratorRuntime = r")(n)}},function(t,e){Granify.enabled&&(Granify.SHOP_ID=GRANIFY_CONFIG.SHOP_ID,Granify.CHILD_SITE_ID=null,Granify.use_local_jquery=GRANIFY_CONFIG.local_jquery,Granify.rb=Granify.rb||{},Granify.rb.get_asset_host=function(){var t=localStorage.getItem("granify_asset_url");if(t)return"//"+t.match(/[^\\/]{3,}/).toString()},Granify.rb.server_ga_stores=GRANIFY_CONFIG.serverGaStores,Granify.rb.matching_host=GRANIFY_CONFIG.matchingHost,Granify.rb.asset_host=Granify.rb.get_asset_host()||GRANIFY_CONFIG.assetHost,Granify.rb.env=GRANIFY_CONFIG.env,Granify.domain=Granify.rb.asset_host,Granify.rb.version={js:GRANIFY_CONFIG.version,rb:GRANIFY_CONFIG.rb_version},Granify.compiler="webpack",Granify.rb.isEnvironment=function(t){return GRANIFY_CONFIG.env==t},Granify.rb.get_analytics=function(){Granify.analyticsID=GRANIFY_CONFIG.analytics_tracker})},function(t,e){Granify.enabled&&(Granify.addDays=function(t,e){return t.setTime(t.getTime()+24*e*60*60*1e3),t},Granify.addHours=function(t,e){return t.setTime(t.getTime()+60*e*60*1e3),t},Granify.addMinutes=function(t,e){return t.setTime(t.getTime()+60*e*1e3),t},Granify.addSeconds=function(t,e){return t.setTime(t.getTime()+1e3*e),t},Granify.getFormattedDate=function(){var t=new Date;return t.getUTCFullYear()+"-"+("00"+(t.getUTCMonth()+1)).slice(-2)+"-"+("00"+t.getUTCDate()).slice(-2)+" "+("00"+t.getUTCHours()).slice(-2)+":"+("00"+t.getUTCMinutes()).slice(-2)+":"+("00"+t.getUTCSeconds()).slice(-2)},Granify.getExpiresDateByYear=function(t){var e=new Date;return e.setFullYear(t),e},Granify.getTimezone=function(){return-(new Date).getTimezoneOffset()/60},Granify.convertDateToTimestamp=function(t){return new Date(t).getTime()},Granify.timeSinceTimestamp=function(t){return Date.now()-t},Granify.time_since=function(t){return((new Date).getTime()-t)/1e3})},function(t,e){if(Granify.enabled){Granify.getStorageName=function(t){return Granify.isFunction(t.name)?t.name():t.name},Granify.getStorageExpiration=function(t){return Granify.isFunction(t.expires)?t.expires():t.expires},Granify.getStorageKeysForCookie=function(){return[Granify.keyname(Granify.getStorageName(Granify.storage.UUID)),Granify.keyname(Granify.getStorageName(Granify.storage.SESSION)),Granify.keyname(Granify.getStorageName(Granify.storage.FORCE_MATCHING)),Granify.keyname(Granify.getStorageName(Granify.storage.NEW_USER))]};var r=function(){return+Granify.addHours(new Date,1)};Granify.storage={MUTEX:{name:"mutex",expires:function(){return+Granify.addSeconds(new Date,5)}},UUID:{name:"uuid"},SESSION:{name:"session"},THROW_ERRORS:{name:"throw_granify_errors"},DEBUG_LOG:{name:"debug_log"},TRACK_SENT_ERRORS:{name:"track_sent_errors",expires:r},FORCE_MATCHING:{name:"force_matching_cid",expires:r},BOOKMARKLET:{name:"granify_bookmarklet"},ENTRY_PAGE:{name:"entry_page"},ENTRY_PAGE_SENT:{name:"entry_page_sent"},ENTRY_REFERRER:{name:"entry_referrer"},ENTRY_REFERRER_SENT:{name:"entry_referrer_sent"},CHECK_IFRAME_COOKIES:{name:function(){return"check_cookies_".concat(Granify.start_time_fixed)},expires:function(){return+Granify.addSeconds(new Date,1)}},TRACK_USER_DATA:{name:"track_user_data"},TRACK_GRANIFY_DATA:{name:"track_granify_data"},TRACK_PRODUCT:{name:function(){return"track_product"},expires:function(){return+Granify.addDays(new Date,60)}},TRACK_PRODUCT_ROLLING_WINDOW:{name:"track_product_window"},TRACKED_CART_PRODUCTS:{name:"tracked_cart_products"},MATCH_REQUEST_DATA_CACHE:{name:"match_request_data_cache"},METRICS_DATA_CACHE:{name:"metrics_data_cache"},NEW_USER:{name:"new_user"},SSD_CACHE:{name:"site_state_data_cache"},SSD_M_CACHE:{name:"site_state_data_modifier_cache"},WSD_CACHE:{name:"widget_state_data_cache"},LAST_ORDER:{name:"last_order"},LAST_FAST_ORDER:{name:"last_fast_order"},UNCONFIRMED_ORDERS:{name:"unconfirmed_orders"},LAST_SERVER_TIME:{name:"last_server_time"},MESSAGE_SHOWN:{name:"message_shown"},LAST_GA_FAST_ORDER:{name:"last_ga_fast_order"},GA_GROUP:{name:function(){return"ga_group:".concat(Granify.SHOP_ID)},expires:function(){return+Granify.addMinutes(new Date,10)}},GA_CONTROL_GROUP:{name:function(){return"ga_cgroup:".concat(Granify.SHOP_ID)},expires:function(){return+Granify.addMinutes(new Date,10)}}}}},function(t,e){function r(t,e){var r;if("undefined"===typeof Symbol||null==t[Symbol.iterator]){if(Array.isArray(t)||(r=function(t,e){if(!t)return;if("string"===typeof t)return n(t,e);var r=Object.prototype.toString.call(t).slice(8,-1);"Object"===r&&t.constructor&&(r=t.constructor.name);if("Map"===r||"Set"===r)return Array.from(t);if("Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return n(t,e)}(t))||e&&t&&"number"===typeof t.length){r&&(t=r);var a=0,i=function(){};return{s:i,n:function(){return a>=t.length?{done:!0}:{done:!1,value:t[a++]}},e:function(t){throw t},f:i}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var o,s=!0,c=!1;return{s:function(){r=t[Symbol.iterator]()},n:function(){var t=r.next();return s=t.done,t},e:function(t){c=!0,o=t},f:function(){try{s||null==r.return||r.return()}finally{if(c)throw o}}}}function n(t,e){(null==e||e>t.length)&&(e=t.length);for(var r=0,n=new Array(e);r<e;r++)n[r]=t[r];return n}if(Granify.enabled){Granify.iframeCallbacks={};var a=["track_product","tracked_cart_products"],i=!1,o=[],s=function(t){return null==t&&(t=""),!Array.from(a).includes(t)},c=function(t){return null==t&&(t=""),Granify.isObject(t)&&(t=Granify.getStorageName(t)),Granify.keyname(t)};Granify.keyname=function(t){return"uuid"!==t||Granify.use_iframe?"granify.".concat(t,".").concat(Granify.SHOP_ID):"granify.uuid"},Granify.setIframeData=function(t,e){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"set";return Granify.execAfterFrameLoaded((function(){return"object"===typeof e&&(e=JSON.stringify(e)),Granify.frame.contentWindow.postMessage("".concat(n,":").concat(t,"=").concat(e,"@").concat(+r),"*")}))},Granify.getToggle=function(t,e){return Granify.getIframeData(t,e,"get-toggle")},Granify.setToggle=function(t,e){return Granify.setIframeData(t,e,0,"set-toggle")},Granify.setSharedData=function(t,e){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;return Granify.isObject(t)&&null==r&&(r=Granify.getStorageExpiration(t)),t=c(t),Granify.use_iframe&&Granify.setIframeData(t,e,0===r?null:r),Granify.internalSetSharedData(t,e,r)},Granify.internalSetSharedData=function(t,e){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;if(Granify.use_local_storage&&Granify.localStorageWorking)return Granify.setStorage(t,e,r);if(Granify.use_cookies)try{if(0===r&&(r=null),Granify.isCookieStorage(t))return Granify.setCookie(t,e,r);if(Granify.localStorageWorking)return Granify.setStorage(t,e,r);if(Granify.cookie_fallback&&s(t))return Granify.setCookie(t,JSON.stringify(e),r)}catch(n){return Granify.logError("Can't persist ".concat(t," with value ").concat(e))}},Granify.getIframeData=function(t,e,r){return null==r&&(r="get"),null==Granify.iframeCallbacks[t]&&(Granify.iframeCallbacks[t]=[]),Granify.iframeCallbacks[t].push(e),Granify.execAfterFrameLoaded((function(){return Granify.frame.contentWindow.postMessage("".concat(r,":").concat(t),"*")}))},Granify.getAllIframeData=function(t){var e=Granify.SHOP_ID;return null==Granify.iframeCallbacks[e]&&(Granify.iframeCallbacks[e]=[]),Granify.iframeCallbacks[e].push(t),Granify.execAfterFrameLoaded((function(){return Granify.frame.contentWindow.postMessage("get-all:.","*")}))},Granify.applyIframeStorage=function(t){for(var e=0,n=Object.keys(t);e<n.length;e++){var a=n[e],s=t[a];s?Granify.internalSetSharedData(a,s.data,s.expiry):Granify.internalSetSharedData(a,s)}i=Date.now();var c,u=r(o);try{for(u.s();!(c=u.n()).done;){(0,c.value)()}}catch(f){u.e(f)}finally{u.f()}},Granify.ensureIframeStorageSynced=function(){return new Granify.Promise((function(t){return Granify.use_iframe?i?t():o.push(t):t()}))},Granify.synchronousGetSharedData=function(t){t=c(t);var e=null;return Granify.use_local_storage&&Granify.localStorageWorking?e=Granify.getStorage(t):Granify.use_cookies&&(Granify.isCookieStorage(t)?e=Granify.getCookie(t):Granify.localStorageWorking?e=Granify.getStorage(t):Granify.cookie_fallback&&(e=Granify.getCookieWithParsing(t))),e},Granify.getSharedDataSync=Granify.synchronousGetSharedData,Granify.getSharedData=function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;if(Granify.use_iframe){var r=Granify.Promise.resolve();return i||(r=Granify.ensureIframeStorageSynced()),r.then((function(){var r=Granify.synchronousGetSharedData(t);return"function"===typeof e&&e(r),r}))}var n=Granify.synchronousGetSharedData(t);return"function"===typeof e&&e(n),Granify.Promise.resolve(n)},Granify.getCookieWithParsing=function(t){var e=Granify.getCookie(t);try{return Granify.isString(e)&&"undefined"!==e&&(e=JSON.parse(e)),e}catch(r){return Granify.logError("Can't return cookie value from ".concat(t)),null}},Granify.eraseIframeData=function(t,e){return null==e&&(e="erase"),Granify.execAfterFrameLoaded((function(){return Granify.frame.contentWindow.postMessage("".concat(e,":").concat(t),"*")}))},Granify.eraseSharedData=function(t){if(t=c(t),Granify.use_iframe&&Granify.eraseIframeData(t),Granify.use_local_storage&&Granify.localStorageWorking)return Granify.eraseStorage(t);if(Granify.use_cookies){if(Granify.isCookieStorage(t))return Granify.eraseCookie(t);if(Granify.localStorageWorking)return Granify.eraseStorage(t);if(Granify.cookie_fallback)return Granify.eraseCookie(t)}},Granify.messageDispatcher=function(t){var e;if(t.origin.match(/granify/)||t.origin.match(/localhost|localdocker/)){var r=t.data;if("[object String]"===Object.prototype.toString.call(r)&&(e=r.match(/([\.\w]+):(.*)/)),e){var n,a=e[1],i=e[2];try{var o=JSON.parse(i);i=o?o.data:null}catch(l){n=l}a===Granify.SHOP_ID.toString()&&Granify.applyIframeStorage(i);var s=a.replace(".".concat(Granify.SHOP_ID),"");if("undefined"===i&&(i=Granify.getStorage(s)),"granify.widget_state"===s&&"object"===typeof i&&(i=JSON.stringify(i)),Granify.iframeCallbacks[a]){for(var c=0,u=Array.from(Granify.iframeCallbacks[a]);c<u.length;c++){var f=u[c];try{f&&f(i)}catch(y){n=y,Granify.error(n,"messageDispatch")}}return delete Granify.iframeCallbacks[a]}}}},Granify.isCookieStorage=function(t){return null==t&&(t=""),null==Granify.KEYS_TO_COOKIE&&(Granify.KEYS_TO_COOKIE=Granify.getStorageKeysForCookie()),Granify.KEYS_TO_COOKIE.indexOf(t)>-1},Granify.addGranifyListener(window,"message",Granify.messageDispatcher)}},function(t,e){Granify.itExists=function(t){return"undefined"!==typeof t&&null!==t},Granify.isObject=function(t){return"[object Object]"===Object.prototype.toString.call(t)},Granify.isDate=function(t){return"[object Date]"===Object.prototype.toString.call(t)},Granify.isBoolean=function(t){return!0===t||!1===t||"[object Boolean]"===Object.prototype.toString.call(t)},Granify.isNumber=function(t){return"[object Number]"===Object.prototype.toString.call(t)&&!isNaN(t)},Granify.isInteger=function(t){return"[object Number]"===Object.prototype.toString.call(t)&&isFinite(t)&&Math.floor(t)===t},Granify.isArray=function(t){return"[object Array]"===Object.prototype.toString.call(t)},Granify.isString=function(t){return"[object String]"===Object.prototype.toString.call(t)},Granify.isFunction=function(t){return"[object Function]"===Object.prototype.toString.call(t)},Granify.isPromise=function(t){return"[object Promise]"===Object.prototype.toString.call(t)},Granify.safeCastToInteger=function(t){var e=Granify.isString(t)?Number(t):t;return Granify.isInteger(e)?e:null},Granify.safeCastToFloat=function(t){var e=Granify.isString(t)?Number(t):t;return Granify.isNumber(e)?e:null},Granify.deepClone=function(t){return JSON.parse(JSON.stringify(t))},Granify.flattenArray=function(t){var e=[];return t.forEach((function(t){e=e.concat(t)})),e},Granify.mergeObjects=function(t,e){for(var r in e)e.hasOwnProperty(r)&&(t[r]=e[r]);return t},Granify.deepExtend=function(t){t=t||{};for(var e=1;e<arguments.length;){var r=arguments[e];if(r){for(var n in r)r.hasOwnProperty(n)&&("object"===typeof r[n]?t[n]=Granify.deepExtend(t[n],r[n]):t[n]=r[n]);e++}else e++}return t}},function(t,e){function r(t,e){var r;if("undefined"===typeof Symbol||null==t[Symbol.iterator]){if(Array.isArray(t)||(r=function(t,e){if(!t)return;if("string"===typeof t)return n(t,e);var r=Object.prototype.toString.call(t).slice(8,-1);"Object"===r&&t.constructor&&(r=t.constructor.name);if("Map"===r||"Set"===r)return Array.from(t);if("Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return n(t,e)}(t))||e&&t&&"number"===typeof t.length){r&&(t=r);var a=0,i=function(){};return{s:i,n:function(){return a>=t.length?{done:!0}:{done:!1,value:t[a++]}},e:function(t){throw t},f:i}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var o,s=!0,c=!1;return{s:function(){r=t[Symbol.iterator]()},n:function(){var t=r.next();return s=t.done,t},e:function(t){c=!0,o=t},f:function(){try{s||null==r.return||r.return()}finally{if(c)throw o}}}}function n(t,e){(null==e||e>t.length)&&(e=t.length);for(var r=0,n=new Array(e);r<e;r++)n[r]=t[r];return n}Granify.compact_object=function(t){var e;if(e=Granify.isArray(t)?[]:{},"object"===typeof t){t=Granify.packObj(t);for(var n=0,a=Object.keys(t);n<a.length;n++){var i=a[n],o=t[i];if("number"===typeof o&&0!==o||"string"===typeof o&&0!==o.length)e[i]=o;else if(Granify.isArray(o)){var s,c=[],u=r(o);try{for(u.s();!(s=u.n()).done;){var f=s.value,l=Granify.compact_object(f);c.push(l)}}catch(d){u.e(d)}finally{u.f()}c.length>0&&(e[i]=c)}else if("object"===typeof o&&null!=o){var y=Granify.compact_object(o);null!=y&&"{}"!==JSON.stringify(y)&&(e[i]=y)}}}return e},Granify.data_aliases={id:"i",session:"s",class_name:"cn",uuid:"id",site_id:"sid",child_site_id:"csid",cart_contents:"cc",add_to_cart:"ac",delete_from_cart:"dc",wishList:"wl",start_time:"st",visit_duration:"vd",status:"sts",page_type:"pt",page_meta_data:"pm",mouse_distance:"md",scroll_distance:"sd",scroll_depth:"sh",tab_changes:"tc",mouse_heatmap:"mh",mouse_stats:"ms",timezone:"tz",source:"src",referer:"ref",service:"srv",query:"qry",current_time:"ct",medium:"me",content:"co",campaign:"ca",term:"te",over:"ov",text:"tx",links:"lk",images:"im",other:"oh",time:"tm",touchtime:"ttm",touchstart:"ts",buttons:"bu",selections:"sel",click:"cl",copied_text:"cx",orig_length:"ol",path:"p",scroll_top:"sc",viewport:"v",tags:"t",category:"cat",subcategory:"scat",data:"dt",name:"n",price:"pr",widget_latency_full:"wlf",widget_latency_js:"wlj",entry_page:"ep",entry_referrer:"er",has_unconfirmed_orders:"uo",mouse_active_time:"ma",time_since_start:"tss",time_since_dom:"tsd",metrics:"mt"},Granify.packObj=function(t){var e;e=Granify.isArray(t)?[]:{};for(var r=0,n=Object.keys(t);r<n.length;r++){var a=n[r],i=t[a];(null!=i&&""!==i&&0!==i&&0!==i.length&&"{}"!==i||["timezone","items","ssi"].includes(a))&&(null!=Granify.data_aliases[a]?Granify.isNumber(i)?e[Granify.data_aliases[a]]=Granify.round(i):Granify.isObject(i)?e[Granify.data_aliases[a]]=Granify.packObj(i):e[Granify.data_aliases[a]]=i:e[a]=i)}return e},Granify.removeUnchangedData=function(t){if(Granify.latestSentData){for(var e=["uuid","session","site_id","child_site_id","start_time","visit_duration","tags","x","current_time","has_unconfirmed_orders","force_matching","metrics"],r={},n=0,a=Object.keys(t);n<a.length;n++){var i=a[n];(e.includes(i)||t[i]!==Granify.latestSentData[i])&&(r[i]=t[i])}return r}return t}},function(t,e){Granify.round=function(t){var e=t||0;return Granify.isNumber(t)&&(e=Granify.roundOnePlace(t)),e},Granify.roundOnePlace=function(t){return Math.round(10*t)/10}},function(t,e){Granify.enabled&&(Granify.throttle=function(t,e){var r,n,a,i,o=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},s=0,c=function(){return s=!1===o.leading?0:new Date,a=null,n=t.apply(i,r)};return function(){var u=new Date;s||!1!==o.leading||(s=u);var f=e-(u-s);return i=this,r=arguments,f<=0?(clearTimeout(a),a=null,s=u,n=t.apply(i,r)):a||!1===o.trailing||(a=setTimeout(c,f)),n}})},function(t,e){function r(t,e){return function(t){if(Array.isArray(t))return t}(t)||function(t,e){if("undefined"===typeof Symbol||!(Symbol.iterator in Object(t)))return;var r=[],n=!0,a=!1,i=void 0;try{for(var o,s=t[Symbol.iterator]();!(n=(o=s.next()).done)&&(r.push(o.value),!e||r.length!==e);n=!0);}catch(c){a=!0,i=c}finally{try{n||null==s.return||s.return()}finally{if(a)throw i}}return r}(t,e)||a(t,e)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function n(t,e){var r;if("undefined"===typeof Symbol||null==t[Symbol.iterator]){if(Array.isArray(t)||(r=a(t))||e&&t&&"number"===typeof t.length){r&&(t=r);var n=0,i=function(){};return{s:i,n:function(){return n>=t.length?{done:!0}:{done:!1,value:t[n++]}},e:function(t){throw t},f:i}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var o,s=!0,c=!1;return{s:function(){r=t[Symbol.iterator]()},n:function(){var t=r.next();return s=t.done,t},e:function(t){c=!0,o=t},f:function(){try{s||null==r.return||r.return()}finally{if(c)throw o}}}}function a(t,e){if(t){if("string"===typeof t)return i(t,e);var r=Object.prototype.toString.call(t).slice(8,-1);return"Object"===r&&t.constructor&&(r=t.constructor.name),"Map"===r||"Set"===r?Array.from(t):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?i(t,e):void 0}}function i(t,e){(null==e||e>t.length)&&(e=t.length);for(var r=0,n=new Array(e);r<e;r++)n[r]=t[r];return n}if(Granify.enabled){Granify.getParam=function(t){var e,a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,i=arguments.length>2?arguments[2]:void 0;i||(i=window.location.search),Granify.isArray(i)?(e=[],i.forEach((function(t){return e.push((t.split("?")[1]||t.replace("?","")).split("&"))}))):e=(i.split("?")[1]||i.replace("?","")).split("&");var o,s=null,c=n(e);try{for(c.s();!(o=c.n()).done;){var u=o.value,f=void 0,l=void 0;if(Granify.isString(u)){var y=u.split("="),d=r(y,2);f=d[0],l=d[1]}else f=u[0];t.toLowerCase()===f.toLowerCase()&&(s=l||!0)}}catch(p){c.e(p)}finally{c.f()}return s||a},Granify.paramExists=function(t,e){return e||(e=window.location.search),!!Granify.getParam(t,!1,e)},Granify.removeParam=function(t,e){var r;return e||(e=window.location.search),Granify.isString(e)&&0===e.indexOf("?")?null===(r=Granify.getParam(t,null,e))?null:e.replace(RegExp("".concat(t,"=").concat(r,"&?"),"i"),"").replace(/[?&]$/,""):null},Granify.removeQueryParamFromUrl=function(t,e){var r,n,a;if(null==e&&(e=window),e&&e.location&&(n=e.location.href,a=e.location.search),!Granify.isString(a)||!Granify.isString(n)||-1===n.indexOf(a))return Granify.logError("Granify.removeQueryParamFromUrl: Invalid URL and/or query string params - assure query string is contained within URL",{url:n,queryString:a});if(null!==(r=Granify.removeParam(t,a))){var i=n.replace(a,r);return e.history.replaceState(e.history.state,null,i),Granify.location=i}};var o=/(([0-9]|[1-9][0-9]|1[0-9]{2}|2[0-4][0-9]|25[0-5])\.){3}([0-9]|[1-9][0-9]|1[0-9]{2}|2[0-4][0-9]|25[0-5])/;Granify.forceSecureProtocol=function(t){return t?t.match(/localhost|localdocker/)||t.match(o)?t:0===t.indexOf("//")?"https:".concat(t):t.replace("http://","https://"):Granify.logError("Granify.forceSecureProtocol was passed an invalid value, url is undefined")},Granify.isUrlSecure=function(){return"https:"===location.protocol},Granify.isLocationChanged=function(t){var e=Granify.strDiff(t,GLOBAL.location.href);return""!==e&&"#"!==e&&"#."!==e},Granify.getHashParam=function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,r=window.location.hash.substring(1),n=r.split("&").reduce((function(t,e){var r=e.split("=");return t[r[0]]=r[1],t}),{});return n[t]?n[t]:e}}},function(t,e){function r(t,e){var r;if("undefined"===typeof Symbol||null==t[Symbol.iterator]){if(Array.isArray(t)||(r=function(t,e){if(!t)return;if("string"===typeof t)return n(t,e);var r=Object.prototype.toString.call(t).slice(8,-1);"Object"===r&&t.constructor&&(r=t.constructor.name);if("Map"===r||"Set"===r)return Array.from(t);if("Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return n(t,e)}(t))||e&&t&&"number"===typeof t.length){r&&(t=r);var a=0,i=function(){};return{s:i,n:function(){return a>=t.length?{done:!0}:{done:!1,value:t[a++]}},e:function(t){throw t},f:i}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var o,s=!0,c=!1;return{s:function(){r=t[Symbol.iterator]()},n:function(){var t=r.next();return s=t.done,t},e:function(t){c=!0,o=t},f:function(){try{s||null==r.return||r.return()}finally{if(c)throw o}}}}function n(t,e){(null==e||e>t.length)&&(e=t.length);for(var r=0,n=new Array(e);r<e;r++)n[r]=t[r];return n}if(Granify.enabled){Granify.getDocumentHeight=function(){var t=GLOBAL.document;return Math.max(t.body.scrollHeight,t.documentElement.scrollHeight,t.body.offsetHeight,t.documentElement.offsetHeight,t.body.clientHeight,t.documentElement.clientHeight)},Granify.getDocumentWidth=function(){if(!GLOBAL||!GLOBAL.document||!GLOBAL.document.body)return 0;var t=GLOBAL.document;return Math.max(t.body.scrollWidth,t.documentElement.scrollWidth,t.body.offsetWidth,t.documentElement.offsetWidth,t.body.clientWidth,t.documentElement.clientWidth)},Granify.insertFrame=function(){var t=document.getElementsByTagName("body")[0];return t?(Granify.frame=document.createElement("iframe"),Granify.frame.src=Granify.forceSecureProtocol(Granify.domain)+"/identifier.html?matching=".concat(Granify.matching,"&id=").concat(Granify.SHOP_ID),Granify.frame.style.display="none",Granify.frame.title="Granify identifier",Granify.addGranifyListener(Granify.frame,"load",(function(){return Granify.frameLoaded=!0})),t.appendChild(Granify.frame)):setTimeout(Granify.insertFrame,100)},Granify.insertStylesheet=function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"",r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:function(){},n=GLOBAL.document.createElement("link");return n.rel="stylesheet",n.type="text/css",n.className=e,n.href=t,n.onload=r,GLOBAL.document.getElementsByTagName("HEAD")[0].appendChild(n)},Granify.addStyleRules=function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"granify-style-sheet",r=GLOBAL.document.createElement("style");return r.className=e,r.type="text/css",r.innerHTML=t,GLOBAL.document.getElementsByTagName("HEAD")[0].appendChild(r)},Granify.insertScript=function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:function(){},r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,n=GLOBAL.document.createElement("script");return n.src=t,r&&(n.id=r),n.onload=function(){return e()},GLOBAL.document.getElementsByTagName("HEAD")[0].appendChild(n)},Granify.execAfterDOMAvailable=function(t){return"complete"===GLOBAL.document.readyState||"interactive"===GLOBAL.document.readyState?setTimeout((function(){return t.call(this)}),0):setTimeout((function(){return Granify.execAfterDOMAvailable(t)}),100)},Granify.execAfterDOMLoaded=function(t){return"complete"===GLOBAL.document.readyState?setTimeout((function(){return t.call(this)}),0):setTimeout((function(){return Granify.execAfterDOMLoaded(t)}),100)},Granify.execAfterFrameLoaded=function(t){return Granify.frameLoaded||!Granify.use_iframe?t.call(this):setTimeout((function(){return Granify.execAfterFrameLoaded(t)}),100)},Granify.createXPathFromElement=function(t){for(var e=[];t&&1===t.nodeType;){if("function"===typeof t.hasAttribute?t.hasAttribute("id"):void 0)e.unshift("id("+t.getAttribute("id")+")");else if("function"===typeof t.hasAttribute?t.hasAttribute("class"):void 0)e.unshift(t.nodeName.toLowerCase()+"[@class="+t.getAttribute("class")+"]");else{for(var r=t.previousSibling,n=1;r;)r.nodeName===t.nodeName&&n++,r=r.previousSibling;e.unshift(t.nodeName.toLowerCase()+"["+n+"]")}t=t.parentNode}return e.length?"/"+e.join("/"):null};var a={childList:!0,subtree:!0,attributes:!0,all_frames:!0};Granify.mutationObservers=Granify.mutationObservers||[];Granify.onElementChange=function(){var t=window.MutationObserver||window.WebKitMutationObserver,e=window.addEventListener;return function(r,n,i){null===i&&(i="activeMutationObserver"),t?(Granify.mutationObservers[i]=new t((function(t){(t[0].addedNodes.length||t[0].removedNodes.length||function(t){return t.forEach((function(t){if("attributes"===t.type)return!0})),!1}(t))&&n(t)})),Granify.mutationObservers[i].observe(r,a)):e&&(r.addEventListener("DOMNodeInserted",n,!1),r.addEventListener("DOMNodeRemoved",n,!1))}}(),Granify.onElementAdded=function(){var t=window.MutationObserver||window.WebKitMutationObserver;return function(e,n,a){var i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"activeMutationObserver";t&&(Granify.mutationObservers[i]=new t((function(t){if(t[0].addedNodes.length){var e,i=r(t[0].addedNodes);try{for(i.s();!(e=i.n()).done;){var o=e.value;o.id!==n&&o.className!==n||a(t)}}catch(s){i.e(s)}finally{i.f()}}})),Granify.mutationObservers[i].observe(e,{childList:!0,subtree:!0}))}}()}},function(t,e){Granify.enabled&&(Granify.hashToQuery=function(t){var e=[];for(var r in t)void 0!==t[r]&&t.hasOwnProperty(r)&&e.push(r+"="+encodeURIComponent(t[r]));return e.join("&")},Granify.JSONP=function(t,e,r,n){null==e&&(e={}),null==n&&(n=!0);var a=document.head||document.getElementsByTagName("head")[0],i=document.createElement("script");return n&&(i.async="async"),i.charset="UTF-8",e.callback="granify_cb_"+ +new Date,window[e.callback]=r,i.src=t+"?"+Granify.hashToQuery(e),i.onload=function(){return a.removeChild(i)},a.insertBefore(i,a.firstChild)},Granify.AJAX=function(t,e,r,n){var a;null==e&&(e={}),null==r&&(r=function(){}),null==n&&(n=function(){});try{return a=new XMLHttpRequest,t=t+"?"+(Granify.isObject(e)?Granify.hashToQuery(e):e),a.onreadystatechange=function(){if(4===a.readyState)return 200===a.status?r(JSON.parse(a.responseText)):n(a)},a.open("GET",t,!0),a.send()}catch(i){return Granify.error(i,"AJAX"),n(a)}},Granify.POST=function(t,e,r,n){var a;null==e&&(e={}),null==r&&(r=function(){}),null==n&&(n=function(){});try{a=new XMLHttpRequest;var i=JSON.stringify(e);return a.onreadystatechange=function(){if(4===a.readyState){if(200===a.status){var t=JSON.parse(a.responseText);return r(t)}return n(a)}},a.open("POST",t,!0),a.setRequestHeader("Content-type","text/plain"),Granify.getGPU()&&a.setRequestHeader("Device-GPU",Granify.getGPU()),a.send(i)}catch(o){return Granify.error(o,"POST"),n(a)}})},function(t,e){if(Granify.enabled){var r=["granifymm","granifysm"];Granify.getToolPairGroup=function(){var t=Object.keys(Granify.toolPairs).filter((function(t){return-1!==r.indexOf(t)}))[0];return t&&Granify.toolPairs[t]?"granify":"baseline"},Granify.getGroup=function(t){return Granify.toolPairAvailable()?Granify.getToolPairGroup():t},Granify.toolPairAvailable=function(){return Granify.toolPairs&&0!==Object.keys(Granify.toolPairs).length},Granify.isPlatformMatchingGroup=function(t){return t==Granify.constants.PLATFORM_MATCHING_GROUP}}},function(t,e){if(Granify.enabled){Granify.not_synced_errors=[];var r=null,n=Date.now(),a={},i=Granify._logLevels,o=function(t,e){Granify.test_mode&&GLOBAL.$&&GLOBAL.$("#test-errors").empty().append(t.toUpperCase()+": "+JSON.stringify(e))};Granify._check_debug_query=function(t){if((t=t||window).location&&t.location.search){var e=Granify.getParam("granifydebug",null,t.location.search)||Granify.getParam("granify_debug",null,t.location.search);"true"===e?Granify.setSharedData(Granify.storage.DEBUG_LOG,!0):"false"===e&&Granify.setSharedData(Granify.storage.DEBUG_LOG,!1)}},Granify._should_use_debug_log=function(){return!!Granify.synchronousGetSharedData(Granify.storage.DEBUG_LOG)},Granify.setDebugLogging=function(t){return Granify.isBoolean(t)&&Granify.setSharedData(Granify.storage.DEBUG_LOG,t),Granify._should_use_debug_log()};var s=function(t,e){for(;t.length<e;)t.length%2===0?t=" "+t:t+=" ";return t};Granify.internalLog=function(t,e){if(Granify._should_use_debug_log()){var r,a=((Date.now()-n)/1e3).toFixed(3)+"s";if("IE"!==Granify.ua.browser.name){a=s(a,8);var i=s(t.name.toUpperCase(),8);r=["%c %s %c GRANIFY %c %s %c","background: rgb(64, 64, 64); color: white",a,"background: rgb(162,234,0); color: black","color: black; background: "+t.color,i,""]}else r=["[GRANIFY]["+a+"]["+t.name.toUpperCase()+"]"];for(var o=[],c=0;c<e.length;c++){var u=e[c];if("object"==typeof u)try{u=JSON.parse(JSON.stringify(u))}catch(f){}o.push(u)}Granify.isString(o[0])&&(r[0]=r[0]+" "+o.shift().replace(/^granifi?y( *[:-]) */gi,"")),console[t.func].apply(console,r.concat(o))}},Granify.log=function(){Granify.internalLog(i.info,arguments)},Granify.error=function(t,e,r){r=r||i.error;var n={name:e+"-"+t.name,level:r.name,message:t.message,version:Granify.version.rb,js_version:Granify.version.js,browser:Granify.ua.browser.name,stack:t.stack?t.stack.toString():void 0,column:t.columnNumber,site_id:Granify.SHOP_ID,csid:Granify.CHILD_SITE_ID,UUID:Granify.UUID,session:Granify.SESSION,context_data:t.context_data,env:Granify.rb.env};if(Granify.not_synced_errors.push(n),Granify.errors.push(n.name+" - "+n.message),o(r,n),Granify.throw_errors)throw t;Granify.syncErrors()};Granify.syncErrors=function(){r||(r=setInterval((function(){!function(){var t=Granify.not_synced_errors.length;if(0===t)return r&&clearInterval(r),void(r=null);t>5&&(Granify.not_synced_errors=Granify.not_synced_errors.slice(0,5),Granify.logError("More than 5 errors per second",{errors_count:t})),Granify.POST(Granify.matching+"/log",{errors:JSON.stringify(Granify.not_synced_errors)}),Granify.not_synced_errors=[]}()}),1e3))},Granify.log_message=function(t,e,r,n){n=n||i.error,e=e||{};var s,c=Granify.synchronousGetSharedData(Granify.storage.TRACK_SENT_ERRORS)||{},u=function(t){var e=0,r=0;if(0===t.length)return e;for(;r<t.length;)e=(e<<5)-e+t.charCodeAt(r),e|=0,r++;return e}(t);if(e&&e instanceof Error)s=e,e=void 0,t&&(s.name=t);else if(e&&(n===i.critical&&("string"===typeof e&&(e={Message:e}),e.Device=Granify.ua.ua,e.URL=window.location.href),e=JSON.stringify(e)),s=new Error(e),t&&(s.name=t),Error.captureStackTrace)try{var f=Granify.log_message;f.caller&&(f=f.caller.caller),Error.captureStackTrace(s,f)}catch(l){}else s.stack="".concat(s.name,": ").concat(s.message,"\n").concat(s.stack);r&&c.hasOwnProperty(u)||(o(n,e),Granify.error(s,"log_"+n.name,n),r&&(c[u]=!0,Granify.setSharedData(Granify.storage.TRACK_SENT_ERRORS,c))),r&&a.hasOwnProperty(u)||(a[u]=!0,n!==i.warning?Granify.internalLog(n,[s.stack]):Granify.internalLog(n,[s.name+":",s.message]))},Granify.log_error=function(t,e,r){Granify.log_message(t,e,!!r,i.error)},Granify.logError=function(t,e){Granify.log_message(t,e,!1,i.error)},Granify.logErrorOnce=function(t,e){Granify.log_message(t,e,!0,i.error)},Granify.logWarning=function(t,e){Granify.log_message(t,e,!1,i.warning)},Granify.logWarningOnce=function(t,e){Granify.log_message(t,e,!0,i.warning)},Granify.logCritical=function(t,e){Granify.log_message(t,e,!1,i.critical)},Granify.logCriticalOnce=function(t,e){Granify.log_message(t,e,!0,i.critical)},Granify.logDebug=function(){Granify.internalLog(i.debug,arguments)},Granify.testsDebug=function(t){Granify.testsDebugMessages&&Granify.testsDebugMessages.push(t)},Granify.addErrorHandling=function(t){for(var e in t){var r=t[e];t.hasOwnProperty(e)&&"function"===typeof r&&-1===["rb","error","addErrorHandling","uuid","Promise"].indexOf(e)&&(t[e]=function(e,r){return function(){try{return e.apply(t,arguments)}catch(n){Granify.error(n,r),Granify.internalLog(i.error,[n.stack])}}}(r,e))}},Granify.LogPreQueue&&Granify.isArray(Granify.LogPreQueue)&&Granify.LogPreQueue.forEach((function(t){return Granify.log_message(t.name,t.context,t.sendOnce,t.level)})),Granify.LogPreQueue=[]}},function(t,e){Granify.enabled&&(Granify.getCookie=function(t){try{var e=[],r=new RegExp("[; ]".concat(t,"=([^\\s;]*)"),"ig"),n=("; "+document.cookie).match(r)||[];return 1===n.length?e.push(decodeURIComponent(n[0].split("=")[1])):n.length>1&&(n.forEach((function(t){return e.push(decodeURIComponent(t.split("=")[1]))})),Granify.logError("Multiple cookie occurrences",{key:t,value:e[0],values:e})),e[0]}catch(a){Granify.logError("Error reading cookie",{key:t,clientDate:new Date,cookiesDomain:Granify.cookies_domain,location:location.toString(),exceptionMsg:a.message})}},Granify.setCookie=function(t){var e,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"",n=arguments.length>2?arguments[2]:void 0,a=15768e7;try{if(Granify.eraseCookie(t),null==n&&(n=new Date(+new Date+a)),Granify.itExists(GRANIFY_CONFIG.maximum_cookie_length_in_milliseconds)){var i=new Date(+new Date+GRANIFY_CONFIG.maximum_cookie_length_in_milliseconds);(n>i||n>+new Date+GRANIFY_CONFIG.maximum_cookie_length_in_milliseconds)&&(n=i)}var o=Granify.cookies_domain?"domain=".concat(Granify.cookies_domain,";"):"";e=encodeURIComponent(r);var s=Granify.isNumber(n)?new Date(n):n,c="".concat(t,"=").concat(e)+";expires=".concat(s.toGMTString())+";".concat(o,"path=/");return Granify.canUseSameSiteNone()&&(c+=";SameSite=None"),Granify.isUrlSecure()&&(c+=";Secure"),GLOBAL.document.cookie=c,c}catch(u){Granify.logError("Error writing cookie",{key:t,writeValue:e,clientDate:new Date,cookiesDomain:Granify.cookies_domain,location:location.toString(),exceptionMsg:u.message})}},Granify.eraseCookie=function(t){try{var e=Granify.cookies_domain?"domain=".concat(Granify.cookies_domain,";"):"";return GLOBAL.document.cookie="".concat(t,"=")+";expires=Thu, 01 Jan 1970 00:00:01 GMT"+";".concat(e,"path=/")}catch(r){Granify.logError("Error deleting cookie",{key:t,clientDate:new Date,cookiesDomain:Granify.cookies_domain,location:location.toString(),exceptionMsg:r.message})}})},function(t,e){if(Granify.enabled){Granify.getStorage=function(t){var e=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(Granify.localStorageWorking){Granify.isObject(t)&&(t=Granify.getStorageName(t));var r=Granify.keyname(t),n=null,a=null,i=null;try{n=window.localStorage.getItem(r)||window.localStorage.getItem(t);var o=JSON.parse(n);o&&(null!=o.expires?(i=o.expires,parseInt(i)>+new Date?a=o.data:(a=null,Granify.eraseStorage(t))):(a=null,Granify.eraseStorage(t)))}catch(s){s instanceof SyntaxError?Granify.logError("Error parsing local storage value into JSON",{key:t,localStorageValue:n,value:a,clientDate:new Date,location:location.toString(),exceptionMsg:s.message}):Granify.logError("Error reading value from local storage",{key:t,clientDate:new Date,location:location.toString(),exceptionMsg:s.message})}return e?{data:a,expires:i}:a}},Granify.setStorage=function(t,e,r){var n;if(Granify.localStorageWorking)try{Granify.isObject(t)&&(r||(r=Granify.getStorageExpiration(t)),t=Granify.getStorageName(t),t=Granify.keyname(t));return r||(r=new Date(+new Date+6307e7)),n=JSON.stringify({expires:+r,data:e}),window.localStorage.setItem(t,n)}catch(o){var a,i;try{i=function(){var t,e={},r=0;for(var n in window.localStorage)window.localStorage.hasOwnProperty(n)&&(t=(2*localStorage[n].length+2*n.length)/1024,e[n]="".concat(t.toFixed(2)," KB"),r+=t);return e.__Total__=r>1024?"".concat((r/1024).toFixed(2)," MB"):"".concat(r.toFixed(2)," KB"),e}()}catch(s){i="Failed to dump local storage"}return Granify.logError("Error writing value to local storage",{key:t,writeValue:n,clientDate:new Date,location:location.toString(),exceptionMsg:o.message,localStorage:i,device:null===(a=Granify)||void 0===a?void 0:a.ua})}},Granify.eraseStorage=function(t){if(Granify.localStorageWorking)try{return Granify.isObject(t)&&(t=Granify.getStorageName(t),t=Granify.keyname(t)),window.localStorage.removeItem(t)}catch(e){return Granify.logError("Error deleting value from local storage",{key:t,clientDate:new Date,location:location.toString(),exceptionMsg:e.message})}}}},function(t,e){function r(t,e){var r;if("undefined"===typeof Symbol||null==t[Symbol.iterator]){if(Array.isArray(t)||(r=function(t,e){if(!t)return;if("string"===typeof t)return n(t,e);var r=Object.prototype.toString.call(t).slice(8,-1);"Object"===r&&t.constructor&&(r=t.constructor.name);if("Map"===r||"Set"===r)return Array.from(t);if("Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return n(t,e)}(t))||e&&t&&"number"===typeof t.length){r&&(t=r);var a=0,i=function(){};return{s:i,n:function(){return a>=t.length?{done:!0}:{done:!1,value:t[a++]}},e:function(t){throw t},f:i}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var o,s=!0,c=!1;return{s:function(){r=t[Symbol.iterator]()},n:function(){var t=r.next();return s=t.done,t},e:function(t){c=!0,o=t},f:function(){try{s||null==r.return||r.return()}finally{if(c)throw o}}}}function n(t,e){(null==e||e>t.length)&&(e=t.length);for(var r=0,n=new Array(e);r<e;r++)n[r]=t[r];return n}var a=[],i=null,o=null,s=null;Granify.getSSDLimit=function(){return 5120},Granify.getWSDLimit=function(){return 10240},Granify.updateStateDataFromStorage=function(){return i=Granify.synchronousGetSharedData(Granify.storage.SSD_CACHE)||null,o=Granify.synchronousGetSharedData(Granify.storage.SSD_M_CACHE)||null,s=Granify.synchronousGetSharedData(Granify.storage.WSD_CACHE)||null},Granify.getSSD=function(){return i||null},Granify.getSSD_M=function(){return o||null},Granify.getWSD=function(){return s||null},Granify.clearSSD=function(){return i=null,Granify.eraseSharedData(Granify.storage.SSD_CACHE)},Granify.clearSSD_M=function(){return o=null,Granify.eraseSharedData(Granify.storage.SSD_M_CACHE)},Granify.clearWSD=function(){return s=null,Granify.eraseSharedData(Granify.storage.WSD_CACHE)},Granify.enableSiteStateData=function(){var t=GRANIFY_CONFIG.ssd_cart_item_info_properties;if(a=[],Granify.isArray(t)){var e,n=r(t);try{for(n.s();!(e=n.n()).done;){var i=e.value;Granify.isString(i)?a.push(i):Granify.logError("Entry in 'ssd_cart_item_info_properties' is not String, not using for ssd property",{entry:i})}}catch(o){n.e(o)}finally{n.f()}}else Granify.logError("SSD: Expected 'ssd_cart_item_info_properties' from Dashboard to be an array",{dashboard_properties:t},!0)};var c=function(t,e,n){var a={},i={};if(!e||e.length<=0)return null;var o,s=r(t);try{for(s.s();!(o=s.n()).done;){var c,u=o.value,f=u[n],l={},y=r(e);try{for(y.s();!(c=y.n()).done;){var d=c.value,p=u[d],g=Granify.getProduct(f,d,!0);if(Granify.itExists(p)||Granify.itExists(g)){var h=void 0;h=Granify.itExists(p)?p:g,l[d]=h}else a[f]||(a[f]=[]),a[f].push(d)}}catch(m){y.e(m)}finally{y.f()}Object.keys(l).length>0&&(i[f]=l)}}catch(m){s.e(m)}finally{s.f()}return Object.keys(i).length>0?{tracked_product_info:i,missing_item_properties:a}:{tracked_product_info:!1,missing_item_properties:a}},u=function(t){if(!t.tracked_product_info||0===Object.keys(t.tracked_product_info).length)return 0;for(var e=0,r=0,n=Object.keys(t.tracked_product_info);r<n.length;r++){"undefined"!==n[r]&&e++}return e},f=function(t,e){var r=c(t,e,"sku")||{},n=c(t,e,"product_id")||{},a=u(r)>=u(n)?r:n;return Object.keys(a).length>0?(a.missing_item_properties&&Object.keys(a.missing_item_properties).length>0&&Granify.logWarningOnce("Missing properties for one or more cart items - site_state_data still being sent",a.missing_item_properties),a.tracked_product_info?a.tracked_product_info:void 0):(Granify.logWarning("no trackProductInfo results found",t,e),{})};Granify.setSiteStateDataProperty=function(t,e){if(Granify.isString(t))return(i=Granify.getSSD()||{})[t]=e,Granify.setSharedData(Granify.storage.SSD_CACHE,i);Granify.logWarning("Expected site_state_data 'property_key' to be a string",{property_key:t})},Granify.setSiteStateDataModifierProperty=function(t,e){if(Granify.isString(t)){if(Granify.isObject(e))return(o=Granify.getSSD_M()||{})[t]=e,Granify.setSharedData(Granify.storage.SSD_M_CACHE,o);Granify.logWarning("Expected ssd_modifier 'property_value' to be a hash",{property_value:e})}else Granify.logWarning("Expected ssd_modifier 'property_key' to be a string",{property_key:t})},Granify.setWidgetStateProperty=function(t,e,r){if(Granify.isString(t)){if(Granify.itExists(r))return(s=Granify.getWSD()||{})[r]||(s[r]={}),s[r][t]=e,Granify.setSharedData(Granify.storage.WSD_CACHE,s);Granify.logWarning("setWidgetStateProperty: Expected 'offer_id' when setting WSD",{property_key:e})}else Granify.logWarning("Expected 'property_key' to be a string for widget_state_data",{property_key:t})},Granify.setCartSSDProperty=function(t){var e=f(t,a);if(e&&Object.keys(e).length>0)return Granify.setSiteStateDataProperty("cart_item_info",e)},Granify.setCartSSDModifierProperty=function(t){var e=f(t,a);if(e&&Object.keys(e).length>0)return Granify.setSiteStateDataModifierProperty("cart_item_info",e)}},function(t,e){if(Granify.enabled){null==Granify.events&&(Granify.events={});var r=function(t,e){try{return t.call(e,e)}catch(r){if(null!=t)return Granify.error(r,"Event callback error: ".concat(e,",  ").concat(t.toString()))}};Granify.triggerEventCallbacks=function(t,e){if(Granify.events[t]&&Granify.events[t].callbacks){var n=function(t,e){var n=[],a=Granify.mergeObjects({},Granify.events[t]);null!=(null!=Granify.events[t]?Granify.events[t].data:void 0)?Granify.events[t]={triggered:!0,data:a.data}:Granify.events[t]={triggered:!0};for(var i=a.callbacks.length,o=e||a.data||{},s=0;s<i;s++){var c=a.callbacks[s];"repeat"===c.type&&n.push(c),r(c.callback,o)}return n}(t,e);return n.length>0?Granify.events[t].callbacks=n:void 0}},Granify.trigger=function(t,e){Granify.events[t]||(Granify.events[t]={}),Granify.events[t].triggered=!0,e&&(Granify.events[t].data=e),Granify.triggerEventCallbacks(t,e)};var n=function(t,e,r){return Granify.events[t]||(Granify.events[t]={}),Granify.events[t].callbacks||(Granify.events[t].callbacks=[]),Granify.events[t].callbacks.push({type:r,callback:e})};Granify.onNext=function(t,e){n(t,e,"once")},Granify.on=function(t,e){if(Granify.events[t]&&Granify.events[t].triggered){var a=Granify.events[t].data||{};r(e,a)}else n(t,e,"once")},Granify.onEvery=function(t,e){n(t,e,"repeat")},Granify.onAll=function(t,e){if(Granify.events[t]&&Granify.events[t].triggered){var a=Granify.events[t].data||{};r(e,a)}n(t,e,"repeat")}}},function(t,e){Granify.enabled&&(Granify.isMutexLocked=function(){if(Granify.localStorageWorking){var t=Granify.getStorage(Granify.storage.MUTEX,!0),e=t.data,r=t.expires;return Math.abs(r-Date.now())>864e5?(Granify.releaseMutex(),!1):null!=e}return null!=Granify.synchronousGetSharedData(Granify.storage.MUTEX)},Granify.lockMutex=function(){return Granify.setSharedData(Granify.storage.MUTEX,1)},Granify.releaseMutex=function(){return Granify.eraseSharedData(Granify.storage.MUTEX)},Granify.waitForMutex=function(t){return Granify.isMutexLocked()?setTimeout((function(){return Granify.waitForMutex(t)}),100):t()})},function(t,e){var r;(r=Granify).I18n=function(t){"use strict";var e=t&&t.I18n||{},r=Array.prototype.slice,n=function(t){return("0"+t.toString()).substr(-2)},a=function(t){var e=typeof t;return"function"===e||"object"===e},i=function(t){return"function"===typeof t},o=function(t){return"undefined"!==typeof t&&null!==t},s=function(t){return Array.isArray?Array.isArray(t):"[object Array]"===Object.prototype.toString.call(t)},c=function(t){return"number"===typeof t||"[object Number]"===Object.prototype.toString.call(t)},u=function(t){return!0===t||!1===t},f=function(t){return null===t},l=function(t,e,r){return"undefined"===typeof r||0===+r?Math[t](e):(e=+e,r=+r,isNaN(e)||"number"!==typeof r||r%1!==0?NaN:(e=e.toString().split("e"),+((e=(e=Math[t](+(e[0]+"e"+(e[1]?+e[1]-r:-r)))).toString().split("e"))[0]+"e"+(e[1]?+e[1]+r:r))))},y=function(t,e){return i(t)?t(e):t},d={day_names:["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],abbr_day_names:["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],month_names:[null,"January","February","March","April","May","June","July","August","September","October","November","December"],abbr_month_names:[null,"Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],meridian:["AM","PM"]},p={precision:3,separator:".",delimiter:",",strip_insignificant_zeros:!1},g={unit:"$",precision:2,format:"%u%n",sign_first:!0,delimiter:",",separator:"."},h={unit:"%",precision:3,format:"%n%u",separator:".",delimiter:""},m=[null,"kb","mb","gb","tb"],G={defaultLocale:"en",locale:"en",defaultSeparator:".",placeholder:/(?:\{\{|%\{)(.*?)(?:\}\}?)/gm,fallbacks:!1,translations:{},missingBehaviour:"message",missingTranslationPrefix:""};return e.reset=function(){var t;for(t in G)this[t]=G[t]},e.initializeOptions=function(){var t;for(t in G)o(this[t])||(this[t]=G[t])},e.initializeOptions(),e.locales={},e.locales.get=function(t){var r=this[t]||this[e.locale]||this.default;return i(r)&&(r=r(t)),!1===s(r)&&(r=[r]),r},e.locales.default=function(t){var r=[],n=[];return t&&r.push(t),!t&&e.locale&&r.push(e.locale),e.fallbacks&&e.defaultLocale&&r.push(e.defaultLocale),r.forEach((function(t){var r=t.split("-"),a=null,i=null;3===r.length?(a=[r[0],r[1]].join("-"),i=r[0]):2===r.length&&(a=r[0]),-1===n.indexOf(t)&&n.push(t),e.fallbacks&&[a,i].forEach((function(e){"undefined"!==typeof e&&null!==e&&e!==t&&-1===n.indexOf(e)&&n.push(e)}))})),r.length||r.push("en"),n},e.pluralization={},e.pluralization.get=function(t){return this[t]||this[e.locale]||this.default},e.pluralization.default=function(t){switch(t){case 0:return["zero","other"];case 1:return["one"];default:return["other"]}},e.currentLocale=function(){return this.locale||this.defaultLocale},e.isSet=o,e.lookup=function(t,e){e=e||{};var r,n,a,i,s=this.locales.get(e.locale).slice();for(a=this.getFullScope(t,e);s.length;)if(r=s.shift(),n=a.split(this.defaultSeparator),i=this.translations[r]){for(;n.length&&void 0!==(i=i[n.shift()])&&null!==i;);if(void 0!==i&&null!==i)return i}if(o(e.defaultValue))return y(e.defaultValue,t)},e.pluralizationLookupWithoutFallback=function(t,e,r){var n,i,s=this.pluralization.get(e)(t);if(a(r))for(;s.length;)if(n=s.shift(),o(r[n])){i=r[n];break}return i},e.pluralizationLookup=function(t,e,r){r=r||{};var n,i,s,c,u=this.locales.get(r.locale).slice();for(e=this.getFullScope(e,r);u.length;)if(n=u.shift(),i=e.split(this.defaultSeparator),s=this.translations[n]){for(;i.length&&(s=s[i.shift()],a(s));)0===i.length&&(c=this.pluralizationLookupWithoutFallback(t,n,s));if("undefined"!==typeof c&&null!==c)break}return"undefined"!==typeof c&&null!==c||o(r.defaultValue)&&(c=a(r.defaultValue)?this.pluralizationLookupWithoutFallback(t,r.locale,r.defaultValue):r.defaultValue,s=r.defaultValue),{message:c,translations:s}},e.meridian=function(){var t=this.lookup("time"),e=this.lookup("date");return t&&t.am&&t.pm?[t.am,t.pm]:e&&e.meridian?e.meridian:d.meridian},e.prepareOptions=function(){for(var t,e=r.call(arguments),n={};e.length;)if("object"==typeof(t=e.shift()))for(var a in t)t.hasOwnProperty(a)&&(o(n[a])||(n[a]=t[a]));return n},e.createTranslationOptions=function(t,e){var r=[{scope:t}];return o(e.defaults)&&(r=r.concat(e.defaults)),o(e.defaultValue)&&r.push({message:e.defaultValue}),r},e.translate=function(t,e){e=e||{};var r,n=this.createTranslationOptions(t,e),i=t,c=this.prepareOptions(e);return delete c.defaultValue,n.some((function(e){if(o(e.scope)?(i=e.scope,r=this.lookup(i,c)):o(e.message)&&(r=y(e.message,t)),void 0!==r&&null!==r)return!0}),this)?("string"===typeof r?r=this.interpolate(r,e):s(r)?r=r.map((function(t){return"string"===typeof t?this.interpolate(t,e):t}),this):a(r)&&o(e.count)&&(r=this.pluralize(e.count,i,e)),r):this.missingTranslation(t,e)},e.interpolate=function(t,e){if(null==t)return t;e=e||{};var r,n,a,i,s=t.match(this.placeholder);if(!s)return t;for(;s.length;)a=(r=s.shift()).replace(this.placeholder,"$1"),n=o(e[a])?e[a].toString().replace(/\$/gm,"_#$#_"):a in e?this.nullPlaceholder(r,t,e):this.missingPlaceholder(r,t,e),i=new RegExp(r.replace(/{/gm,"\\{").replace(/}/gm,"\\}")),t=t.replace(i,n);return t.replace(/_#\$#_/g,"$")},e.pluralize=function(t,e,r){var n,a;return r=this.prepareOptions({count:String(t)},r),"undefined"===typeof(a=this.pluralizationLookup(t,e,r)).translations||null==a.translations?this.missingTranslation(e,r):"undefined"!==typeof a.message&&null!=a.message?this.interpolate(a.message,r):(n=this.pluralization.get(r.locale),this.missingTranslation(e+"."+n(t)[0],r))},e.missingTranslation=function(t,e){if("guess"===this.missingBehaviour){var r=t.split(".").slice(-1)[0];return(this.missingTranslationPrefix.length>0?this.missingTranslationPrefix:"")+r.replace("_"," ").replace(/([a-z])([A-Z])/g,(function(t,e,r){return e+" "+r.toLowerCase()}))}return'[missing "'+[null!=e&&null!=e.locale?e.locale:this.currentLocale(),this.getFullScope(t,e)].join(this.defaultSeparator)+'" translation]'},e.missingPlaceholder=function(t,e,r){return"[missing "+t+" value]"},e.nullPlaceholder=function(){return e.missingPlaceholder.apply(e,arguments)},e.toNumber=function(t,e){e=this.prepareOptions(e,this.lookup("number.format"),p);var r,n,a=t<0,i=function(t,e){return l("round",t,-e).toFixed(e)}(Math.abs(t),e.precision).toString().split("."),o=[],s=e.format||"%n",c=a?"-":"";for(t=i[0],r=i[1];t.length>0;)o.unshift(t.substr(Math.max(0,t.length-3),3)),t=t.substr(0,t.length-3);return n=o.join(e.delimiter),e.strip_insignificant_zeros&&r&&(r=r.replace(/0+$/,"")),e.precision>0&&r&&(n+=e.separator+r),n=(s=e.sign_first?"%s"+s:s.replace("%n","%s%n")).replace("%u",e.unit).replace("%n",n).replace("%s",c)},e.toCurrency=function(t,e){return e=this.prepareOptions(e,this.lookup("number.currency.format"),this.lookup("number.format"),g),this.toNumber(t,e)},e.localize=function(t,e,r){switch(r||(r={}),t){case"currency":return this.toCurrency(e);case"number":return t=this.lookup("number.format"),this.toNumber(e,t);case"percentage":return this.toPercentage(e);default:var n;return n=t.match(/^(date|time)/)?this.toTime(t,e):e.toString(),this.interpolate(n,r)}},e.parseDate=function(t){var e,r,n;if(null==t)return t;if("object"===typeof t)return t;if(e=t.toString().match(/(\d{4})-(\d{2})-(\d{2})(?:[ T](\d{2}):(\d{2}):(\d{2})([\.,]\d{1,3})?)?(Z|\+00:?00)?/)){for(var a=1;a<=6;a++)e[a]=parseInt(e[a],10)||0;e[2]-=1,n=e[7]?1e3*("0"+e[7]):null,r=e[8]?new Date(Date.UTC(e[1],e[2],e[3],e[4],e[5],e[6],n)):new Date(e[1],e[2],e[3],e[4],e[5],e[6],n)}else"number"==typeof t?(r=new Date).setTime(t):t.match(/([A-Z][a-z]{2}) ([A-Z][a-z]{2}) (\d+) (\d+:\d+:\d+) ([+-]\d+) (\d+)/)?(r=new Date).setTime(Date.parse([RegExp.$1,RegExp.$2,RegExp.$3,RegExp.$6,RegExp.$4,RegExp.$5].join(" "))):(t.match(/\d+ \d+:\d+:\d+ [+-]\d+ \d+/),(r=new Date).setTime(Date.parse(t)));return r},e.strftime=function(t,r){var a=this.lookup("date"),i=e.meridian();if(a||(a={}),a=this.prepareOptions(a,d),isNaN(t.getTime()))throw new Error("I18n.strftime() requires a valid date object, but received an invalid date.");var o=t.getDay(),s=t.getDate(),c=t.getFullYear(),u=t.getMonth()+1,f=t.getHours(),l=f,y=f>11?1:0,p=t.getSeconds(),g=t.getMinutes(),h=t.getTimezoneOffset(),m=Math.floor(Math.abs(h/60)),G=Math.abs(h)-60*m,_=(h>0?"-":"+")+(m.toString().length<2?"0"+m:m)+(G.toString().length<2?"0"+G:G);return l>12?l-=12:0===l&&(l=12),r=(r=(r=(r=(r=(r=(r=(r=(r=(r=(r=(r=(r=(r=(r=(r=(r=(r=(r=(r=(r=(r=(r=(r=(r=(r=r.replace("%a",a.abbr_day_names[o])).replace("%A",a.day_names[o])).replace("%b",a.abbr_month_names[u])).replace("%B",a.month_names[u])).replace("%d",n(s))).replace("%e",s)).replace("%-d",s)).replace("%H",n(f))).replace("%-H",f)).replace("%I",n(l))).replace("%-I",l)).replace("%l",l)).replace("%m",n(u))).replace("%-m",u)).replace("%M",n(g))).replace("%-M",g)).replace("%p",i[y])).replace("%P",i[y].toLowerCase())).replace("%S",n(p))).replace("%-S",p)).replace("%w",o)).replace("%y",n(c))).replace("%-y",n(c).replace(/^0+/,""))).replace("%Y",c)).replace("%z",_)).replace("%Z",_)},e.toTime=function(t,e){var r=this.parseDate(e),n=this.lookup(t);if(null==r)return r;var a=r.toString();return a.match(/invalid/i)?a:n?this.strftime(r,n):a},e.toPercentage=function(t,e){return e=this.prepareOptions(e,this.lookup("number.percentage.format"),this.lookup("number.format"),h),this.toNumber(t,e)},e.toHumanSize=function(t,e){for(var r,n,a=t,i=0;a>=1024&&i<4;)a/=1024,i+=1;return 0===i?(r=this.t("number.human.storage_units.units.byte",{count:a}),n=0):(r=this.t("number.human.storage_units.units."+m[i]),n=a-Math.floor(a)===0?0:1),e=this.prepareOptions(e,{unit:r,precision:n,format:"%n%u",delimiter:""}),this.toNumber(a,e)},e.getFullScope=function(t,e){return e=e||{},s(t)&&(t=t.join(this.defaultSeparator)),e.scope&&(t=[e.scope,t].join(this.defaultSeparator)),t},e.extend=function(t,e){return"undefined"===typeof t&&"undefined"===typeof e?{}:function t(e,r){var n,a,i;for(n in r)r.hasOwnProperty(n)&&(a=r[n],"string"===typeof(i=a)||"[object String]"===Object.prototype.toString.call(i)||c(a)||u(a)||s(a)||f(a)?e[n]=a:(null==e[n]&&(e[n]={}),t(e[n],a)));return e}(t,e)},e.t=e.translate,e.l=e.localize,e.p=e.pluralize,e}(r)},function(t,e){if(Granify.enabled){Granify.getGPU=function(){try{var t=Granify.getGranifyData("gpu",!1);if(t)return t.value;var e=Granify._getGpuFromCanvas();return Granify.log("Device GPU: "+e),Granify.trackGranifyData("gpu",e,"local"),e}catch(r){return Granify.logWarningOnce("Device GPU could not be determined: "+r),null}},Granify._getGpuFromCanvas=function(){try{var t=document.createElement("canvas").getContext("webgl"),e=t.getExtension("WEBGL_debug_renderer_info");return t.getParameter(e.UNMASKED_RENDERER_WEBGL)}catch(r){Granify.logWarningOnce("Device GPU from Canvas could not be determined: "+r)}}}},function(t,e){Granify.initCoupon=function(t){Granify.itExists(Granify.JQ)?t():Granify.use_local_jquery&&GLOBAL.jQuery?(Granify.JQ=GLOBAL.jQuery,t()):Granify.insertScript("https://ajax.googleapis.com/ajax/libs/jquery/1.7.2/jquery.min.js",(function(){Granify.JQ=GLOBAL.jQuery.noConflict(!0),t()}))}},function(t,e){Granify.checkSinglePageApp=function(){Granify.enabled&&Granify.onEvery("pagetype:change",(function(){Granify.reset("singlePageAppNavigation")}))},Granify.checkSinglePageApp()},function(t,e){if(Granify.enabled){var r=function(t){return Granify.itExists(t)&&Granify.isString(t)},n=function(t){return Granify.isNumber(t)&&t>=0},a=function(t){return Granify.isInteger(t)&&t>=0},i=function(t){return Granify.isNumber(t)&&(t=t.toString()),t},o=function(t){return Granify.isString(t)&&parseFloat(t)==t&&(t=parseFloat(t)),Granify.isNumber(t)&&(t=t.toFixed(4),t=Granify.safeCastToFloat(t)),t},s=function(t){if(Granify.itExists(t)&&t.length>0){var e=Granify.getProduct(t,"regular_price");if(Granify.itExists(e))return e;Granify.logWarning("getRegularPriceFromTrackProduct - Could not find regular_price. trackProduct data missing.",{item_id:t})}return null},c=function(t){return Granify.isString(t)&&Number(t)==t&&(t=Number(t)),t},u=function(t){var e={},r=function(t){if(Granify.itExists(t))return Granify.isString(t)?t:(Granify.logWarning("item.image should be String"),null)}(t.image),a=function(t){var e=i(t.id)||i(t.sku),r=i(t.product_id),a=t.regular_price,c=t.price;return a=Granify.itExists(a)?o(a):o(s(e))||o(s(r)),n(a)&&a>=c?a:(Granify.logWarning("item.regular_price should be Number and greater than current price.",{price:c,regular_price:a}),null)}(t),c=o(t.savings),u=i(t.product_id);return r&&(e.image=r),a&&(e.regular_price=a),c?e.savings=c:Granify.isNumber(e.regular_price)&&(e.savings=Number((e.regular_price-t.price).toFixed(2))),u&&(e.ppid=u,e.product_id=u),GRANIFY_CONFIG.ssd_cart_item_info_properties.forEach((function(r){Granify.itExists(t[r])&&!Granify.itExists(e[r])&&(e[r]=t[r])})),e},f=function(t){var e,s=!1;return t.id&&(t.id=i(t.id)),t.sku&&(t.sku=i(t.sku)),t.product_id&&(t.product_id=i(t.product_id)),t.price&&(t.price=o(t.price)),t.quantity&&(t.quantity=c(t.quantity)),r(t.id)||r(t.sku)||r(t.product_id)?(e=t.title,Granify.isString(e)?n(t.price)?a(t.quantity)?((s=u(t)).id=t.id,s.sku=t.sku,s.title=t.title,s.price=t.price,s.quantity=t.quantity,s):(Granify.log_error("Cart_error",{message:"item.quantity not found or invalid",item:t}),s):(Granify.log_error("Cart_error",{message:"item.price not found or invalid",item:t}),s):(Granify.log_error("Cart_error",{message:"item.title not found or invalid",item:t}),s)):(Granify.log_error("Cart_error",{message:"item identifier data not found or invalid",item:t}),s)},l=function(t){for(var e=function(t){for(var e={},r=0;r<t.length;r++){var n=t[r].sku||t[r].product_id;e[n]||(e[n]=0),e[n]+=t[r].quantity}for(var a=Granify.getProductStorage().all_products_in_cart,i=Object.keys(a),o=0;o<i.length;o++){var s=i[o];if(e[s]){var c=e[s]-a[s].quantity;e[s]=Math.max(c,0)}}return e}(t),r=0;r<t.length;r++){var n=t[r].sku||t[r].product_id;t[r].add_to_cart_count=e[n],e[n]=0}return t},y=function(t){if(!Granify.isObject(t)||!Granify.isArray(t.items))return Granify.log_error("Cart_error",{message:"Called with invalid parameter",param:t}),!1;for(var e=[],r=t.items,n=0,a=r.length;n<a;n++){var i=r[n],o=f(i);o&&e.push(o)}return e=l(e)},d=function(t){if(Granify.isArray(t))return t=t.map((function(t){!function(t){Granify.itExists(t.id)&&!Granify.itExists(t.sku)?t.sku=t.id:Granify.itExists(t.sku)&&!Granify.itExists(t.id)&&(t.id=t.sku)}(t)}))},p=function(t){return Granify.itExists(t)&&Granify.isArray(t)?{items:t}:t},g=function(t,e){null==e&&(e=!1);for(var r=Granify.getProductStorage(),n=e?{}:r.all_products_in_cart,a=0,i=t.length;a<i;a++){var o=t[a],s=o.quantity||0,c=r.all_tracked_products[o.sku]||r.all_products_in_cart[o.sku],u=r.all_tracked_products[o.product_id]||r.all_products_in_cart[o.product_id];Granify.isObject(c)?(n[o.sku]&&(s+=n[o.sku].quantity),n[o.sku]=c,n[o.sku].quantity=s):Granify.isObject(u)&&(n[o.product_id]&&(s+=n[o.product_id].quantity),n[o.product_id]=u,n[o.product_id].quantity=s)}return r.all_products_in_cart=n,Granify.saveProductStorage(r)};Granify.internalTrackCart=function(t){t=p(t),d(t.items),Granify.log("GRANIFY - trackCart() called with: ",t),Granify.trigger("trackCart:called",t),Granify.apiHistory.addToTrackCartHistory(t),Granify.itExists(Granify.metrics)&&Granify.metrics.count("clientcalls.trackCart"),Granify.isBoolean(t)&&!1===t&&(t={items:[]}),Granify.isArray(t)&&(t={items:t});var e=y(t);e&&e.length===t.items.length&&(g(e,!0),Granify.setCartSSDProperty(e),Granify._granifySendCart={items:e},Granify.isNumber(t.price)&&(Granify._granifySendCart.total=t.price)),Granify.triggerCartOfferEvents(e)},Granify.trackCart=function(t){return Granify.log("GRANIFY - Client called trackCart"),Granify.internalTrackCart(t)},Granify.internalAddToCart=function(t){t=p(t),d(t.items),Granify.log("GRANIFY - addToCart() called with: ",t),Granify.trigger("addToCart:called",t),Granify.apiHistory.addToAddToCartHistory(t),Granify.itExists(Granify.metrics)&&Granify.metrics.count("clientcalls.addToCart"),Granify.isArray(t)&&(t={items:t});var e=y(t);e.length>0&&(g(e,!1),Granify.setCartSSDModifierProperty(e),Granify._granifyAddToCart={items:e}),Granify.triggerCartOfferEvents(e)},Granify.addToCart=function(t){return Granify.log("GRANIFY - Client called addToCart"),Granify.internalAddToCart(t)},Granify.internalDeleteFromCart=function(t){if(t=p(t),d(t.items),Granify.log("GRANIFY - deleteFromCart() called with: ",t),Granify.trigger("deleteFromCart:called",t),Granify.itExists(Granify.metrics)&&Granify.metrics.count("clientcalls.deleteFromCart"),Granify.isArray(t)&&(t={items:t}),Granify.isObject(t)&&Granify.isArray(t.items)){for(var e=[],n=t.items,o=0,s=n.length;o<s;o++){var u={},f=n[o];f.sku&&(u.sku=i(f.sku),u.id=i(f.sku)),f.product_id&&(u.product_id=i(f.product_id)),u.quantity=c(f.quantity),r(u.sku)||r(u.product_id)?a(u.quantity)?e.push(u):Granify.log_error("Cart_error",{message:"item.quantity not found or invalid",item:f}):Granify.log_error("Cart_error",{message:"no valid item identifier keys (id/sku, product_id) were provided",item:f})}e.length>0&&(Granify._granifyDeleteFromCart={items:e})}else Granify.log_error("Cart_error",{message:"Called with invalid parameter",param:t})},Granify.deleteFromCart=function(t){return Granify.log("GRANIFY - Client called deleteFromCart"),Granify.internalDeleteFromCart(t)},Granify.getCartContents=function(){var t=Granify.getProductStorage(),e=Object.keys(t.all_products_in_cart);return productValues=e.map((function(e){return t.all_products_in_cart[e]})),productValues}}},function(t,e){function r(t,e){var r;if("undefined"===typeof Symbol||null==t[Symbol.iterator]){if(Array.isArray(t)||(r=function(t,e){if(!t)return;if("string"===typeof t)return n(t,e);var r=Object.prototype.toString.call(t).slice(8,-1);"Object"===r&&t.constructor&&(r=t.constructor.name);if("Map"===r||"Set"===r)return Array.from(t);if("Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return n(t,e)}(t))||e&&t&&"number"===typeof t.length){r&&(t=r);var a=0,i=function(){};return{s:i,n:function(){return a>=t.length?{done:!0}:{done:!1,value:t[a++]}},e:function(t){throw t},f:i}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var o,s=!0,c=!1;return{s:function(){r=t[Symbol.iterator]()},n:function(){var t=r.next();return s=t.done,t},e:function(t){c=!0,o=t},f:function(){try{s||null==r.return||r.return()}finally{if(c)throw o}}}}function n(t,e){(null==e||e>t.length)&&(e=t.length);for(var r=0,n=new Array(e);r<e;r++)n[r]=t[r];return n}(function(){Granify._currentProduct=null;var t=300,e={};function n(t){return Granify.itExists(t)?(Granify.itExists(t.id)&&!Granify.itExists(t.sku)?t.sku=t.id:Granify.itExists(t.sku)&&!Granify.itExists(t.id)&&(t.id=t.sku),t):null}Granify.localStorageWorking||(Granify.locallyTrackedProducts=[]),Granify.initializeTrackProductRollingWindow=function(e){t=Granify.isInteger(e)&&e>0?e:t},Granify._trackOneProduct=function(e,r){return!!(e=i(JSON.parse(JSON.stringify(e))))&&(function(t,e){var r=t.sku||t.id||t.product_id,n=e.all_tracked_products[r];if(n){var a=e.recent_products.indexOf(r);e.recent_products.splice(a,1)}else n={};e.recent_products.push(r),Object.keys(t).forEach((function(e,r){n[e]=t[e]})),e.all_tracked_products[r]=n}(e,r),function(e){for(;e.recent_products.length>t;){var r=e.recent_products.shift();delete e.all_tracked_products[r]}}(r),!0)};var a=function(e){var r=!1;e.forEach((function(e){r=function(e){return!!(e=i(JSON.parse(JSON.stringify(e))))&&(Granify.locallyTrackedProducts.push(e),Granify.locallyTrackedProducts.length>t&&Granify.locallyTrackedProducts.shift(),!0)}(e)})),1==e.length&&r&&Granify.internalSetCurrentProduct({product_id:e[0].product_id,sku:e[0].sku||e[0].id})};function i(t){var e=o(t);if(e)return Granify.log_error("trackProduct - Invalid product object format",{errorType:e,product:t},!0),!1;var r=function(t){var e=[],r={regular_price:"Float",image:String,category:String,sub_category:String,discount_eligible:Boolean,inventory_eligible:Boolean};c(t.title)||e.push("title");Granify.isString(t.price)&&(t.price=Granify.safeCastToFloat(t.price));(!Granify.isNumber(t.price)||t.price<0||t.price<0)&&e.push("price");for(var n in r)"undefined"!==typeof t[n]&&(r[n]===String?c(t[n])||e.push(n):r[n]===Boolean?Granify.isBoolean(t[n])||e.push(n):"Float"===r[n]&&(Granify.isString(t[n])&&(t[n]=Granify.safeCastToFloat(t[n])),(!Granify.isNumber(t[n])||t[n]<0)&&e.push(n)));return e}(t);for(var n in r.length>0&&Granify.log_error("trackProduct - One or more invalid product fields",{fields:r,product:t},!0),Granify.isNumber(t.regular_price)&&Granify.isNumber(t.price)&&(t.savings=Number((t.regular_price-t.price).toFixed(2))),r)delete t[r[n]];return t}function o(t){var e=null;return Granify.isObject(t)?(Granify.isNumber(t.sku)&&(t.sku=""+t.sku),Granify.isNumber(t.id)&&(t.id=""+t.id),Granify.isNumber(t.product_id)&&(t.product_id=""+t.product_id),Granify.itExists(t.sku)?e||c(t.sku)||(e="invalid sku"):Granify.itExists(t.id)?e||c(t.id)||(e="invalid id"):Granify.itExists(t.product_id)?e||c(t.product_id)||(e="invalid product_id"):e="missing all identifying data for product"):e="(object)",e}function s(t){var e,r=u(t);if(null!==r){Granify._currentProduct=r,Granify.trigger(Granify.constants.CURRENT_PRODUCT_CHANGE);var n=Granify.locallyTrackedProducts;if(Granify.localStorageWorking){var a=Granify.getProductStorage();(e=a.all_tracked_products[r])||(n=Object.values(a.all_tracked_products))}e||(e=n.filter((function(t){return t.sku===r||t.product_id===r}))[0])}return!!e&&(Granify.setCurrentProductPropertiesToSSD(e),!0)}function c(t){return Granify.isString(t)&&""!==t.trim()}function u(t){return c(t=Granify.isInteger(t)?""+t:t)||(t=null),t}Granify.internalTrackProduct=function(t){if(Granify.log("GRANIFY - trackProduct() called with: ",t),Granify.trigger("trackProduct:called",t),Granify.apiHistory.addToTrackProductHistory(t),Granify.itExists(Granify.metrics)&&Granify.metrics.count("clientcalls.trackProduct"),Granify.isObject(t)&&null==o(t)&&(t=[t]),t=function(t){if(!Granify.itExists(t))return null;for(var e=[],r=0,a=t.length;r<a;r++){var i=t[r];i=n(i),e.push(i)}return e}(t),Granify.isArray(t)&&0!=t.length)if(Granify.localStorageWorking){var e=Granify.getProductStorage(),r=!1;t.forEach((function(t){r=Granify._trackOneProduct(t,e)})),Granify.saveProductStorage(e),1==t.length&&r&&Granify.internalSetCurrentProduct({product_id:t[0].product_id,sku:t[0].sku||t[0].id})}else a(t);else Granify.log_error("trackProduct - Expected list of products",t)},Granify.trackProduct=function(t){Granify.log("GRANIFY - Client called trackProduct"),Granify.internalTrackProduct(t)},Granify.getProductStorage=function(){return{all_tracked_products:Granify.synchronousGetSharedData(Granify.storage.TRACK_PRODUCT)||{},all_products_in_cart:Granify.synchronousGetSharedData(Granify.storage.TRACKED_CART_PRODUCTS)||{},recent_products:Granify.synchronousGetSharedData(Granify.storage.TRACK_PRODUCT_ROLLING_WINDOW)||[]}},Granify.saveProductStorage=function(t){Granify.setSharedData(Granify.storage.TRACK_PRODUCT_ROLLING_WINDOW,t.recent_products),Granify.setSharedData(Granify.storage.TRACKED_CART_PRODUCTS,t.all_products_in_cart),Granify.setSharedData(Granify.storage.TRACK_PRODUCT,t.all_tracked_products)},Granify.initializeCurrentProductSSDwhitelist=function(t){if(Granify.isArray(t)){var e,n=!1,a=r(t);try{for(a.s();!(e=a.n()).done;){if("string"!=typeof e.value){n=!0;break}}}catch(i){a.e(i)}finally{a.f()}n?Granify.log_error("initializeCurrentProductSSDwhitelist - properties passed contained a value that was not a string"):Granify.currentProductSSDWhitelist=t}else Granify.log_error("initializeCurrentProductSSDwhitelist - Was passed something other than an array")},Granify.removeCurrentProductFromSSD=function(){var t=Granify.getSSD();for(var e in t)"cp_"!=e.substring(0,3)&&"current_product_sku"!=e||(t[e]=void 0);for(e in Granify.clearSSD(),t)Granify.setSiteStateDataProperty(e,t[e])},Granify.setCurrentProductPropertiesToSSD=function(t){Granify.removeCurrentProductFromSSD();var e=["id","product_id","sku","price","regular_price","savings","image","title","quantity","url","ratings","number_of_reviews","in_stock","category","sub_category"];if(Granify.currentProductSSDWhitelist&&(Granify.isArray(Granify.currentProductSSDWhitelist)?e=e.concat(Granify.currentProductSSDWhitelist):Granify.log_error("currentProductSSDWhitelist - is not an array")),t=n(t),Granify.isObject(t)){for(var r=0;r<e.length;r++)t[e[r]]||0==t[e[r]]?Granify.setSiteStateDataProperty("cp_"+e[r],t[e[r]]):Granify.setSiteStateDataProperty("cp_"+e[r],null);"product"==Granify.getPageType()&&(Granify.itExists(t.product_id)&&Granify.setSiteStateDataProperty("current_product_id",t.product_id),Granify.itExists(t.sku)&&Granify.setSiteStateDataProperty("current_product_sku",t.sku))}else Granify.log_error("currentProductToSSD - product was not an object")},Granify.resetCurrentProduct=function(){Granify.log("Resetting current product."),Granify.trigger(Granify.constants.CURRENT_PRODUCT_CHANGE);Granify.setCurrentProductPropertiesToSSD({id:"0",sku:"0",product_id:"0",price:0,regular_price:0,savings:0,image:"",title:"",quantity:0,url:"",number_of_reviews:0,ratings:0,in_stock:0,category:"",sub_category:""})},Granify.internalSetCurrentProduct=function(t){Granify.log("GRANIFY - setCurrentProduct() called with: ",t),Granify.apiHistory.addToSetCurrentProductHistory(t);var r="",n="";Granify.isString(t)?(Granify.logWarningOnce('setCurrentProduct has been updated to expect both id and sku data (instead of just sku). Please update to call setCurrentProduct with Object parameter like this: {"product_id": idString, "sku": skuString}. This install is passing a single String to setCurrentProduct: "'+t+'" - this will be deprecated in the future.'),r=t):Granify.isObject(t)?(Granify.isString(t.sku)?r=t.sku:Granify.isString(t.id)?r=t.id:Granify.logDebug("setCurrentProduct: sku data is either missing or is not of type String!"),Granify.isString(t.product_id)?n=t.product_id:Granify.logDebug("setCurrentProduct: product_id is either missing or is not of type String!")):Granify.logWarningOnce("setCurrentProduct passed with invalid parameter.",t),s(r)||s(n)?(r&&(e.sku=r),n&&(e.product_id=n),Granify.triggerProductOfferEvents([{product_id:n,sku:r}])):Granify.logWarning("setCurrentProduct did not succeed. Could not find product from trackProduct that matched the following id/sku data:",t)},Granify.setCurrentProduct=function(t){Granify.log("GRANIFY - Client called setCurrentProduct"),Granify.internalSetCurrentProduct(t)},Granify.getCurrentProduct=function(t){var e=null;return null===Granify._currentProduct?Granify.log_error("setCurrentProduct - notCalled",t):e=Granify.getProduct(Granify._currentProduct,t),e},Granify.getProduct=function(t,e,r){Granify.itExists(r)||(r=!1);var n,a=u(t);if(null===a)return r||Granify.log_error("getProduct - invalidProductKey",t),null;if(!c(e))return r||Granify.log_error("getProduct - invalidField",e),null;if(Granify.localStorageWorking){var i=Granify.getProductStorage();n=i.all_tracked_products[a]||i.all_products_in_cart[a]}else{var o=Granify.locallyTrackedProducts.filter((function(e){return e.sku===t}))[0],s=Granify.locallyTrackedProducts.filter((function(e){return e.product_id===t}))[0];n=o||s}return"undefined"===typeof n||"undefined"===typeof n[e]?null:n[e]},document.addEventListener("visibilitychange",(function(){Granify.pageType&&"product"==Granify.pageType&&(1==document.hidden&&(Granify.stopped=!0),0==document.hidden&&(Granify.stopped=!1,Granify.setCurrentProduct(e)))}))}).call(this)},function(t,e){(function(){var t;function e(t){return"tud:".concat(t)}function r(e){return Granify.itExists(t)||(t=[]),Granify.itExists(e)?Granify.itExists(t[e])?t[e]:void 0:t}function n(t,e,r,n,a){var i;return n&&Granify.itExists(e)&&Granify.itExists(e[t])?(e[t]=(i=e[t],Granify.isArray(i)?i:[i]),e[t].push(r),e[t]=function(t,e){var r=e.length;if(!Granify.isNumber(t)||r<=t)return e;var n=r-t;return e.slice(n)}(a,e[t])):e[t]=r,e}function a(a,i,o){var s,c,u,f,l,y,d=r()||{},p=Object.keys(a);for(s=0,c=p.length;s<c;s++)u=a[f=p[s]],d=n(e(f),d,u,i,o);for(l=d,Granify.itExists(t)||(t=[]),t[l]=y,s=0,c=p.length;s<c;s++)u=a[f=p[s]],Granify.trigger(e(f),u)}function i(t,r,i){Granify.localStorageWorking?function(t,r,a){var i,o,s,c,u=Granify.synchronousGetSharedData(Granify.storage.TRACK_USER_DATA)||{},f=Object.keys(t);for(i=0,o=f.length;i<o;i++)s=t[c=f[i]],u=n(e(c),u,s,r,a);for(Granify.setSharedData(Granify.storage.TRACK_USER_DATA,u),i=0,o=f.length;i<o;i++)s=t[c=f[i]],Granify.trigger(e(c),s)}(t,r,i):a(t,r,i)}Granify.trackUserData=function(t,e,r){if(Granify.itExists(t)&&!function(t){if(Granify.isObject(t)||Granify.isArray(t)){for(var e in t)if(t.hasOwnProperty(e))return!1;return JSON.stringify(t)===JSON.stringify({})}Granify.log("GRANIFY - WARNING: parameter in trackUserData-isEmpty function should be Array or Object: ",t)}(t)){if(Granify.isArray(t)){for(var n={},a=0,o=t.length;a<o;a++){var s=t[a],c=Object.keys(s);if(c.length>1)return void Granify.log("GRANIFY - trackUserData: WARNING invalid data structure passed to trackUserData!");var u=c[0];n[u]=s[u]}t=n}Granify.isObject(t)?(i(t,e,r),Granify.trackUserData.displayLogs&&Granify.log("GRANIFY - trackUserData() called with: ",{data:t,shouldAppend:e,cacheLimit:r})):Granify.log_error("GRANIFY - WARNING: trackUserData - Expected format of data to be Object, received: ",t)}else Granify.log("GRANIFY - WARNING: trackUserData() called without passing any user data as a parameter.")},Granify.trackUserData.displayLogs=!0,Granify.getUserData=function(t){var e=null;if(Granify.itExists(t)){if(!Granify.isString(t))return Granify.log("GRANIFY - WARNING: getUserData() requires parameter to be valid String for keyname. ",t),!1;e=function(t){if(!Granify.localStorageWorking)return r(t);var e=Granify.synchronousGetSharedData(Granify.storage.TRACK_USER_DATA);return Granify.itExists(e)?e[t]:void 0}(t)}else e=Granify.localStorageWorking?Granify.synchronousGetSharedData(Granify.storage.TRACK_USER_DATA):r();if(Granify.itExists(e))return e;Granify.trackUserData.displayLogs&&Granify.log("GRANIFY - WARNING: the requested user data could not be found. ",t,Granify.localStorageWorking)},Granify.clearAllUserData=function(){Granify.setSharedData(Granify.storage.TRACK_USER_DATA,void 0)}}).call(this)},function(t,e){(function(){function t(t){var e={},r=Object.keys(t);for(var n in r){var a=r[n];void 0==t[a]||"server"!==t[a].scope&&"local"!==t[a].scope&&"session"!==t[a].scope||(e[a]=t[a])}Granify.setSharedData(Granify.storage.TRACK_GRANIFY_DATA,e)}function e(t){if(t){if(!Granify.dataLayer)return void(Granify.dataLayer=t);for(var e in t)t.hasOwnProperty(e)&&!Granify.dataLayer[e]&&(Granify.dataLayer[e]=t[e])}}function r(){var t=Granify.synchronousGetSharedData(Granify.storage.SESSION);void 0!==Granify.dataLayer.session&&t===Granify.dataLayer.session||(Granify.trackGranifyData("session",t,"local"),function(t){var e=Object.keys(t);for(var r in e){var n=e[r];void 0!=t[n]&&"server"===t[n].scope&&Granify.setSiteStateDataProperty("dl_"+n,t[n].value)}}(Granify.dataLayer))}Granify.trackGranifyData=function(e,r,n){(function e(r,n,a){var i;if("session"===a){var o=Granify.events.nonCachedMatchRequestComplete;if(!Granify.SERVER_SESSION_ID&&o&&!0===o.triggered&&Granify.logDebug("nonCachedMatchRequestComplete but no session ID returned, waiting for next event.",o),!Granify.SERVER_SESSION_ID)return Granify.onNext("nonCachedMatchRequestComplete",(function(){e(r,n,a),t(Granify.dataLayer)}));i=Granify.SERVER_SESSION_ID}Granify.dataLayer[r]={sessionId:i,value:n,scope:a}})(e,r,n=n||"server"),function(t,e,r){var n="trackGranifyData:"+t;Granify.trigger(n,{key:t,value:e,scope:r})}(e,r,n),"server"!==n&&"local"!==n&&"session"!==n||(Granify.use_iframe?Granify.ensureIframeStorageSynced().then((function(){t(Granify.dataLayer)})):t(Granify.dataLayer)),"server"===n&&Granify.setSiteStateDataProperty("dl_"+e,r)},Granify.getGranifyData=function(t,e){if(void 0!==Granify.dataLayer[t]){if("session"===Granify.dataLayer[t].scope&&Granify.dataLayer[t].sessionId!==Granify.SERVER_SESSION_ID&&!e)return;return Granify.dataLayer[t]}},Granify.getGranifyDataLayer=function(t){if("any"===(t=t||"any"))return Granify.dataLayer;var e={},r=Object.keys(Granify.dataLayer);for(var n in r){var a=r[n];void 0!=Granify.dataLayer[a]&&Granify.dataLayer[a].scope===t&&(e[a]=Granify.dataLayer[a])}return e},Granify.getGranifyDataValue=function(t,e){var r=Granify.getGranifyData(t,e);if(r)return r.value},Granify.on("nonCachedMatchRequestComplete",(function(){for(var e=Object.keys(Granify.dataLayer),r=0,n=e.length;r<n;r++){var a=e[r];"session"===Granify.dataLayer[a].scope&&Granify.dataLayer[a].sessionId!==Granify.SERVER_SESSION_ID&&delete Granify.dataLayer[a]}Granify.isObject(Granify.dataLayer)&&t(Granify.dataLayer)})),Granify.use_iframe?Granify.getSharedData(Granify.storage.TRACK_GRANIFY_DATA).then(e):e(Granify.getSharedDataSync(Granify.storage.TRACK_GRANIFY_DATA)),Granify.itExists(Granify.dataLayer)||(Granify.dataLayer={}),r()}).call(this)},function(t,e){Granify.enabled&&(Granify.sendMetricsIfReceiptPage=function(){"receipt"===Granify.pageType&&Granify.itExists(Granify.metrics)&&Granify.metrics.count("clientcalls.uxorderpage")},Granify.internalTrackPageView=function(t){if(Granify.log("GRANIFY - trackPageView() called with: ",t),Granify.apiHistory.addToTrackPageViewHistory(t),Granify.itExists(Granify.metrics)&&Granify.metrics.count("clientcalls.trackPageView"),!Granify.itExists(t))return Granify.logError("Granify.trackPageView: no data passed. Requests object with page_type");Granify.pageMetaData=null,Granify.isString(t.page_type)?(t.page_type=t.page_type.toLowerCase().replace(/[^A-Za-z]/g,""),"missing"===t.page_type||t.page_type.length<=0?Granify.logError('Granify.trackPageView: page_type should not be "missing" or be blank or be all numbers.'):(Granify.pageType=t.page_type,Granify.sendMetricsIfReceiptPage(),Granify.trigger("pagetype:change"))):Granify.logError("Granify.trackPageView requires page_type with String page type"),(t.product||t.category||t.subcategory)&&(Granify.pageMetaData={c:t.category,sc:t.subcategory,p:t.product?Granify.compact_object(t.product):void 0},Granify.trigger("pagemeta:change"))},Granify.trackPageView=function(t){Granify.log("GRANIFY - Client called trackPageView"),Granify.internalTrackPageView(t)},Granify.checkPageType=function(){Granify.pageType||(Granify.pageType=Granify.getPageType())},Granify.getPageMetaData=function(){return Granify.pageMetaData},Granify.getPageType=function(){return Granify.pageType||"missing"},Granify.resetPageType=function(){Granify.pageMetaData=null})},function(t,e){Granify.internalAssignGroup=function(t){if(!0!==window.GRANIFY_CONFIG.external_groups)return Granify.logCriticalOnce("Attempting to use group assignment when site is not configured for assigning groups: "+t);var e=Granify.group_table?Granify.group_table:window.GRANIFY_CONFIG.group_table;if(!Granify.itExists(e)||0===Object.keys(e).length)return Granify.logCriticalOnce("Group table does not exist or is empty");var r=Granify.getGroupAlias(t);if(!r)return Granify.logCriticalOnce("Invalid external group given: "+t+" Granify group table: "+JSON.stringify(e));for(var n=r.toString().split(","),a=0;a<n.length;a++)Granify.metrics.countOnce("clientcalls.enableMessages."+n[a].replace(/[^a-z0-9]/gi,""));Granify.trigger("externalGroupReceived",t),Granify.log("External matching group received: "+t)},Granify.assignGroup=function(t){Granify.internalAssignGroup(t)},Granify.enableMessages=Granify.assignGroup,Granify.getGroupAlias=function(t){var e=Granify.group_table?Granify.group_table:window.GRANIFY_CONFIG.group_table;return e?e[t]:(Granify.logCriticalOnce("Group table is not defined in Granify.group_table or window.GRANIFY_CONFIG"),null)}},function(t,e){!function(){Granify.setLocale=function(t){if(Granify.itExists(t))if(Granify.isString(t)){var e=t.toLowerCase().split("-");e[1]&&(e[1]=e[1].toUpperCase()),Granify.I18n.locale=e.join("-"),Granify.trackGranifyData("locale",Granify.I18n.locale,"server"),Granify.setSiteStateDataProperty("language_code",Granify.I18n.locale)}else Granify.logError("Granify.setLocale: locale was not a string",{locale:t});else Granify.logError("Granify.setLocale: locale was not provided")},Granify.mergeTranslations=function(t){Granify.isObject(t)?Granify.deepExtend(Granify.I18n.translations,t):Granify.logError("Granify.mergeTranslations: provided translations were not in an object")},Granify.I18n=Granify.I18n||{},Granify.I18n.defaultLocale=GRANIFY_CONFIG.default_locale||"en",Granify.I18n.fallbacks=!0;var t=Granify.getGranifyData("locale");t?Granify.I18n.locale=t.value:Granify.setLocale(Granify.I18n.defaultLocale)}()},function(t,e){if(Granify.enabled){Granify._checkForceMatchingQuery=function(t){null==t&&(t=window);var e=Granify.getParam("granifyscid",null,t.location.search),r=!!e;if((e=Granify.getParam("granifycid",null,t.location.search)||e)&&!(Number(e)<0)){Granify.setSharedData(Granify.storage.FORCE_MATCHING,e),Granify.removeQueryParamFromUrl("granifycid",t),Granify.removeQueryParamFromUrl("granifyscid",t),r||(Granify._sendResetSessionFlag=!0);var n=Granify.getParam("GRANIFY_clear_wsd",null,window.location.search);return n&&Granify.isString(n)&&n.length>0&&(!function(){try{void 0!==Granify.current_coupon&&(Granify.current_coupon.state.reset(),Granify.current_coupon.remove(),delete Granify.current_coupon,delete Granify.widget_class,delete Granify.WidgetState,delete Granify.Widget,delete Granify.WidgetCommon,delete Granify.assets,delete Granify.ErrorHandlerComponent,delete Granify.campaign,Granify.log("Preview URL Force Matching cleared widget state data as per requested!"))}catch(t){Granify.log("Preview URL Force Matching could not successfully clear widget state data as requested. ",t)}}(),Granify.removeQueryParamFromUrl("GRANIFY_clear_wsd",window)),Granify.trigger("force_match:update")}},Granify._getForceMatchingCid=function(){var t=Granify.synchronousGetSharedData(Granify.storage.FORCE_MATCHING);return!t||Number(t)<0||"number"!==typeof t&&"string"!==typeof t?null:t},Granify._getAndClearResetSessionFlag=function(){return!0===Granify._sendResetSessionFlag?delete Granify._sendResetSessionFlag:null}}},function(t,e){if(Granify.enabled){var r={},n={},a={},i={},o="/custom_assets/widget/",s="",c="",u="",f="",l=null,y={offer:{},outcome:{headline:"",message:""}},d={all_item_ids:["30125369"],has_cart:!0,cart_spent:60,has_cart_savings:!0,cart_savings:20,"site_state_data(cp_id)":"30125369","site_state_data(free_shipping_threshold)":70,"site_state_data(customer_total_points)":2230,"site_state_data(cp_parenthetical_charge)":!0,"site_state_data(total_stock_of_product_page)":"10","random_item_property(cart_item_info,image)":"https://app.granify.com/assets/campaign_previews/t-shirt.jpg","restricted_item_property(cart_item_info,in_stock)":12,"restricted_item_property(cart_item_info,url)":"https://www.etsy.com/listing/556825453/scratch-off-travel-map-scratch-travel"},p={random_item_id:"30125369",restricted_item_id:"30125369",restricted_item_title:"Granify T-Shirt in Heather Grey",restricted_item_price:32.2,random_item_title:"Granify T-Shirt in Heather Grey",random_item_price:32.2,random_item_image:"https://app.granify.com/assets/campaign_previews/t-shirt.jpg","random_item_property(cart_item_info,savings)":2,"restricted_item_property(cart_item_info,savings)":2,"random_item_property(cart_item_info,regular_price)":34.2,"restricted_item_property(cart_item_info,regular_price)":34.2,"random_item_property(cart_item_info,image)":"https://app.granify.com/assets/campaign_previews/t-shirt.jpg","restricted_item_property(cart_item_info,image)":"https://app.granify.com/assets/campaign_previews/t-shirt.jpg","random_item_property(cart_item_info,rating)":4.2,"restricted_item_property(cart_item_info,rating)":4.2,"random_item_property(cart_item_info,number_of_reviews)":31,"restricted_item_property(cart_item_info,number_of_reviews)":31,"random_item_property(cart_item_info,brand)":"Granify Outfitters Ltd","restricted_item_property(cart_item_info,brand)":"Granify Outfitters Ltd",restricted_item_image:"https://app.granify.com/assets/campaign_previews/t-shirt.jpg","site_state_data(total_stock_of_product_page)":"10","site_state_data(cp_id)":"30125369","site_state_data(cp_title)":"Granify T-Shirt in Heather Grey","site_state_data(cp_price)":32.2,"site_state_data(cp_regular_price)":34.2,"site_state_data(cp_savings)":2,"site_state_data(cp_image)":"https://app.granify.com/assets/campaign_previews/t-shirt.jpg","site_state_data(cp_rating)":4.2,"site_state_data(cp_number_of_reviews)":31,"site_state_data(cp_brand)":"Granify Outfitters Ltd","state_data(free_shipping_threshold)":70,current_product_cart_actions_stats:{1:10,5:12,15:15,1440:100},current_product_views_stats:{1:10,5:12,15:15,1440:100},restricted_product_cart_actions_stats:{1:10,5:12,15:15,1440:100},parent_product_cart_actions_stats:{1:10,5:12,15:15,1440:100},restricted_product_views_stats:{1:10,5:12,15:15,1440:100},parent_product_views_stats:{1:10,5:12,15:15,1440:100}},g={"open-state":"open","timerbar-state":"open",expiration:null,widget_origin_state:"","times-seen":0,GRA_sid:0,GRA_sts:0,match:0,show:0,close:0,cta:0};r=y,n=d,a=p,i=g;var h=!1,m=!1,G=function(){void 0!==Granify.current_coupon&&(Granify.current_coupon.state.reset(),Granify.current_coupon.remove(),delete Granify.current_coupon,delete Granify.widget_class,delete Granify.WidgetState,delete Granify.Widget,delete Granify.WidgetCommon,delete Granify.assets,delete Granify.ErrorHandlerComponent,delete Granify.campaign)},_=function(){try{if(!m){var t=document.querySelectorAll("body")[0];Granify.onElementAdded(t,"granify-widget-container",(function(){return Granify.current_coupon.matchingRequestsMessageDisplay()})),m=!0}return Granify.loadWidget({custom_url:f+o+s+".js",campaign:r,sud:n,sod:a,wsd:i,preview:h}),Granify.stop()}catch(e){return Granify.log("GRANIFY - preview_url_force_loading failed to load widget using provided url query parameters. ",e.message)}},v=function(t,e){try{e=JSON.parse(e)}catch(o){try{e=decodeURI(e),e=JSON.parse(e)}catch(s){return Granify.log("GRANIFY - invalid shared "+t+" data passed through GRANIFY_load_widget query parameter! Failed to parse following data from url: ",e),void Granify.log("GRANIFY - further information for above error: ",s)}}if("campaign"===t&&Granify.deepExtend(r,e),"user"===t&&Granify.deepExtend(n,e),"offer"===t&&Granify.deepExtend(a,e),"widget_state"===t)return Granify.deepExtend(i,e)};Granify.forceLoadWidgetUrlQueryRequest=function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:window;s=Granify.getParam("GRANIFY_widget",null,t.location.search);var e=Granify.getParam("GRANIFY_campaign",null,t.location.search);c=Granify.getParam("GRANIFY_sud",null,t.location.search),u=Granify.getParam("GRANIFY_sod",null,t.location.search);var m=Granify.getParam("GRANIFY_wsd",null,t.location.search);return f=Granify.getParam("GRANIFY_domain",null,t.location.search),l=Granify.getParam("GRANIFY_temp_campaign_id",null,t.location.search),!!(s&&Granify.isString(s)&&s.length>0)&&(Granify.removeQueryParamFromUrl("GRANIFY_widget",t),e&&Granify.isString(e)&&e.length>0?(v("campaign",e),Granify.removeQueryParamFromUrl("GRANIFY_campaign",t)):r=y,c&&Granify.isString(c)&&c.length>0?(v("user",c),Granify.removeQueryParamFromUrl("GRANIFY_sud",t)):n=d,u&&Granify.isString(u)&&u.length>0?(v("offer",u),Granify.removeQueryParamFromUrl("GRANIFY_sod",t)):a=p,m&&Granify.isString(m)&&m.length>0?(v("widget_state",m),Granify.removeQueryParamFromUrl("GRANIFY_wsd",t)):i=g,f&&Granify.isString(f)&&f.length>0?Granify.removeQueryParamFromUrl("GRANIFY_domain",t):f="https://app.granify.com",l&&Granify.isString(l)&&l.length>0?(v("campaign",JSON.stringify({id:l})),h=!0,Granify.removeQueryParamFromUrl("GRANIFY_temp_campaign_id",t)):h=!1,Granify.log("GRANIFY - force-loading "+f+o+s+".js as per url query request."),G(),_(),!0)}}},function(t,e){Granify.campaignPlayback={},Granify.campaignPlayback.enable=function(){function t(t){var e=Granify.getGranifyData(t,!0);return!(!e||!Granify.itExists(e.value))&&e.value}var e="campaign_playback_storage",r="campaign_match_recording_enabled",n="campaign_playback_tool_natural_matching_disabled",a=t(r),i=["sod","sud","wsd","pd","sd","should_display"],o=Granify.match.handleMatchResponse,s=Granify.match.handleOffer;function c(t){var e=t.split("-")[0];return!(!Granify.campaigns||!Granify.campaigns[e])&&(alert("WARNING: campaign "+e+' has already been loaded on this page. Trying to load the same campaign twice on a page is not currently supported by Granify JS. Please press "Reset Offers" to clear campaigns from page if you would like to load this campaign again.'),!0)}t("campaign_playback_tool_enabled")||(Granify.trackGranifyData("campaign_playback_tool_enabled",!0,"page"),Granify.trackGranifyData("campaign_playback_tool_requested",!0,"local"),Granify.campaignPlayback.naturalMatchingDisabled=function(){return t(n)},Granify.campaignPlayback.enableNaturalMatching=function(){Granify.trackGranifyData(n,!1,"local")},Granify.campaignPlayback.disableNaturalMatching=function(){Granify.trackGranifyData(n,!0,"local")},Granify.campaignPlayback.isRecording=function(){return t(r)},Granify.campaignPlayback.startRecording=function(){a=!0,Granify.trackGranifyData(r,!0,"local")},Granify.campaignPlayback.stopRecording=function(){a=!1,Granify.trackGranifyData(r,!1,"local")},Granify.campaignPlayback.getAvailableCampaigns=function(){return Object.keys(t(e)||{})},Granify.campaignPlayback.campaignKeyExists=function(t){return-1!==Granify.campaignPlayback.getAvailableCampaigns().indexOf(t)},Granify.campaignPlayback.getDateRecorded=function(t){if(Granify.campaignPlayback.campaignKeyExists(t))return new Date(Granify.getGranifyData(e).value[t].data.current_time)},Granify.campaignPlayback.setNewCampaign=function(r,n){var a=Granify.deepClone(t(e))||{};Granify.campaignPlayback.campaignKeyExists(r)||(Granify.isObject(a)||(a={}),a[r]=n,Granify.trackGranifyData(e,a,"local"),Granify.log("saved "+r+" to replayable campaigns"),Granify.isFunction(Granify.campaignPlayback.updateUIContent)&&Granify.campaignPlayback.updateUIContent())},Granify.campaignPlayback.importRecording=function(r){var n=Granify.deepClone(t(e))||{},a=Object.keys(r)[0];n[a]=r[a],Granify.trackGranifyData(e,n,"local"),Granify.isFunction(Granify.campaignPlayback.updateUIContent)&&Granify.campaignPlayback.updateUIContent()},Granify.campaignPlayback.exportRecording=function(t){if(Granify.itExists(t)&&Granify.campaignPlayback.campaignKeyExists(t)){var e={};e[t]=Granify.getGranifyData("campaign_playback_storage").value[t];var r="// paste this into console to import campaign: \n \n// CAMPAIGN: "+t+" \n// RECORDED ON: "+Granify.campaignPlayback.getDateRecorded(t)+" \n \nGranify.campaignPlayback.importRecording("+JSON.stringify(e)+");",n=t+".js";Granify.webUI.downloadString(r,"text/csv",n)}else window.alert(t+" DOES NOT EXIST.")},Granify.campaignPlayback.deleteCampaign=function(r){var n=t(e);n&&0!=n.length?(delete n[r],Granify.trackGranifyData(e,n,"local")):Granify.log("No campaign playback data to delete!")},Granify.campaignPlayback.playSingleMatchCampaign=function(t){if(!Granify.campaignPlayback.campaignKeyExists(t))return Granify.log(t+" not available for playback!");if(!c(t)){var r=Granify.getGranifyData(e).value[t],n=function(t){for(var e=Granify.deepClone(t),r=0,n=i.length;r<n;r++){var a=i[r];delete e.campaign[a],e[a]=t.campaign[a]||{}}return e.st=Granify.start_time_fixed,e.ss=Granify.SERVER_SESSION_ID,e}(r.resp),a=r.data;n.playback=!0,o(n,a,!1),Granify.log("Replaying campaign "+t+" as a single match campaign...")}},Granify.campaignPlayback.playMultiMatchCampaign=function(t){if(!Granify.campaignPlayback.campaignKeyExists(t))return Granify.log(t+" not available for playback!");if(!c(t)){var r=Granify.getGranifyData(e).value[t],n=function(t){for(var e=Granify.deepClone(t),r=Granify.deepClone(e.campaign),n=0,a=i.length;n<a;n++){var o=i[n];delete r[o],r.shared_data=r.shared_data||{},r.shared_data[o]=t.campaign[o]||{}}return delete e.campaign,e.mm_campaign=r,e.st=Granify.start_time_fixed,e.ss=Granify.SERVER_SESSION_ID,e}(r.resp),a=r.data;n.playback=!0,o(n,a,!1),Granify.log("Replaying campaign "+t+" as a multi match campaign...")}},Granify.match.handleMatchResponse=function(t,e,r){try{if(!Granify.itExists(t)||r||!a)return void o(t,e,r);var n,s;Granify.itExists(t.campaign)&&(n={resp:function(t){var e=Granify.deepClone(t);delete e.mm_campaign;for(var r=0,n=i.length;r<n;r++){var a=i[r];if(Granify.itExists(t[a])){var o=Granify.deepClone(t[a])||{};delete e[a],e.campaign[a]=o}}return e}(t),data:e},s=t.campaign.id+"-"+t.campaign.experiment,Granify.campaignPlayback.setNewCampaign(s,n)),Granify.itExists(t.mm_campaign)&&(n={resp:function(t){var e=Granify.deepClone(t);delete e.campaign,delete e.sod,delete e.sud,delete e.wsd,delete e.should_display;var r=Granify.deepClone(e.mm_campaign);return delete e.mm_campaign,e.campaign=r,e}(t),data:e},s=t.mm_campaign.id+"-"+t.mm_campaign.experiment,Granify.campaignPlayback.setNewCampaign(s,n))}catch(c){Granify.log("WARNING: campaign playback tool error: ",c)}o(t,e,r)},Granify.match.handleOffer=function(t){!t.playback&&Granify.campaignPlayback.naturalMatchingDisabled()||s(t)},Granify.campaignPlayback.displayUI())},Granify.campaignPlayback.updateUIContent=function(){var t=document.getElementById("granify-playback-tool-wrapper");function e(){if(0!=Granify.campaignPlayback.getAvailableCampaigns().length){var t=document.getElementById("playbackToolCampaignsList").value,e=Granify.campaignPlayback.getDateRecorded(t),r=e.toDateString()+" "+e.toTimeString().split(" ")[0]+" (local)";document.getElementById("playbackToolRecordedDate").innerHTML=r}}function r(e,r){var n='<div class="'+e+'" style="background: #c3c8d0; color: white; padding: 5px; text-align: center; margin: 10px 0;">'+r+"</div>";Granify.webUI.appendHTMLto(t,n)}function n(e,r,n){var a='<div class="'+e+'" style="background: #80878e; color: white; padding: 5px; text-align: center; margin: 10px 0; cursor: pointer;" onmouseover="this.style.background=\'#8ea3ca\'" onmouseout="this.style.background=\'#80878e\'" onmousedown="this.style.background=\'#9dcdf7\'" onmouseup="this.style.background=\'#80878e\'">'+r+"</div>";Granify.webUI.appendHTMLto(t,a),document.getElementsByClassName(e)[0].onclick=function(){n()}}t.innerHTML="";Granify.webUI.appendHTMLto(t,'<div>Recorded Offers:<select id="playbackToolCampaignsList" name="campaigns" style="width: 100%; height: initial; margin: 2px 0 5px 0; padding: 5px 0px 5px 5px; border: 1px solid;"></select></div>');Granify.webUI.appendHTMLto(t,'<div style="font-size: 10px"> Recorded on: <br> <div id="playbackToolRecordedDate" style="margin-bottom: 5px"></div></div>'),Granify.onEvery("playbackToolListChanged",(function(){e()})),Granify.webUI.populateListElement(document.getElementById("playbackToolCampaignsList"),Granify.campaignPlayback.getAvailableCampaigns(),"playbackToolListChanged"),e();Granify.webUI.appendHTMLto(t,'<div id="playbackToolNatMatchLabel" style="text-align: left; font-size: 14px; width: 80%;color: #5C79AF; float: left"> <b>show match: <span id="granify-show-match-status"></span></b></div>');var a=function(){Granify.campaignPlayback.enableNaturalMatching(),document.querySelectorAll("#playbackToolMatchingToggle")[0].querySelector("#granify-webUI-checkbox").checked=!0,document.getElementById("granify-show-match-status").innerHTML="ON"},i=function(){Granify.campaignPlayback.disableNaturalMatching(),document.querySelectorAll("#playbackToolMatchingToggle")[0].querySelector("#granify-webUI-checkbox").checked=!1,document.getElementById("granify-show-match-status").innerHTML="OFF"},o=function(t){t.preventDefault(),t.stopPropagation(),Granify.campaignPlayback.naturalMatchingDisabled()?a():i()},s=Granify.webUI.generateToggleSwitch("playbackToolMatchingToggle","8EA3CA",1,!0);Granify.webUI.injectCSS(s.css),Granify.webUI.appendHTMLto(t,s.html),document.getElementById("playbackToolMatchingToggle").onclick=function(t){o(t)},Granify.campaignPlayback.naturalMatchingDisabled()?i():a();Granify.webUI.appendHTMLto(t,'<div id="playbackToolRecordingLabel" style="text-align: left; font-size: 14px; width: 80%;color: #5C79AF; float: left"> <b>recording: <span id="granify-recording-match-status"></span></b></div>');var c=function(){Granify.campaignPlayback.startRecording(),document.querySelectorAll("#playbackToolRecordingToggle")[0].querySelector("#granify-webUI-checkbox").checked=!0,document.getElementById("granify-recording-match-status").innerHTML="ON"},u=function(){Granify.campaignPlayback.stopRecording(),document.querySelectorAll("#playbackToolRecordingToggle")[0].querySelector("#granify-webUI-checkbox").checked=!1,document.getElementById("granify-recording-match-status").innerHTML="OFF"},f=function(t){t.preventDefault(),t.stopPropagation(),Granify.campaignPlayback.isRecording()?u():c()},l=Granify.webUI.generateToggleSwitch("playbackToolRecordingToggle","F36A6A",1,!0);Granify.webUI.injectCSS(l.css),Granify.webUI.appendHTMLto(t,l.html),document.getElementById("playbackToolRecordingToggle").onclick=function(t){f(t)},Granify.campaignPlayback.isRecording()?c():u();0==Granify.campaignPlayback.getAvailableCampaigns().length?(r("singleMatchPlayback","Play SingleMatch"),r("multiMatchPlayback","Play MultiMatch"),r("clearCampaignData","Reset Offers"),r("exportCampaign","Export Recording"),r("deleteCampaign","Delete Recording")):(n("singleMatchPlayback","Play SingleMatch",(function(){var t=document.getElementById("playbackToolCampaignsList").value;Granify.campaignPlayback.playSingleMatchCampaign(t)})),n("multiMatchPlayback","Play MultiMatch",(function(){var t=document.getElementById("playbackToolCampaignsList").value;Granify.campaignPlayback.playMultiMatchCampaign(t)})),n("clearCampaignData","Reset Offers",(function(){Granify.itExists(Granify.current_coupon)&&Granify.current_coupon.remove(),void 0!==Granify.campaigns&&(Object.keys(Granify.campaigns).forEach((function(t){Granify.itExists(Granify.campaigns[t].remove)&&Granify.campaigns[t].remove()})),Granify.campaigns={},delete Granify.widget_class,delete Granify.WidgetState,delete Granify.Widget,delete Granify.WidgetCommon,delete Granify.assets,delete Granify.ErrorHandlerComponent,delete Granify.campaign,delete Granify.events["offer:shown"],delete Granify.events["multimatch:shown"],delete Granify.events["message:shown"],delete Granify.events["message:notShown"],delete Granify.events["message:show"],delete Granify.events["message:hide"],delete Granify.events.currentCouponStateLoaded)})),n("exportCampaign","Export Recording",(function(){var t=document.getElementById("playbackToolCampaignsList").value;Granify.campaignPlayback.exportRecording(t)})),n("deleteCampaign","Delete Recording",(function(){var t=document.getElementById("playbackToolCampaignsList").value;1==confirm("Are you sure you want to delete\n"+t+"?")&&Granify.campaignPlayback.deleteCampaign(t),Granify.campaignPlayback.updateUIContent()})))},Granify.campaignPlayback.displayUI=function(){function t(){var t=document.getElementById("granify-playback-tool");t.parentNode.removeChild(t),Granify.trackGranifyData("campaign_playback_tool_enabled",!1,"page"),Granify.trackGranifyData("campaign_playback_tool_requested",!1,"local")}Granify.removeErrorHandling=!0,Granify.itExists(Granify.campaigns)||(Granify.campaigns={}),document.getElementById("playbackTool")&&t();Granify.webUI.appendHTMLto(document.body,'<div id="granify-playback-tool" style="z-index: 2147483647; position: fixed; width: 200px; background-color: rgba(255,255,255,0.88); top: 2%; right: 2%; border-style: solid; border-width: 1px; border-color: rgba(0,0,0,0.3); padding: 20px;"></div>');var e=document.getElementById("granify-playback-tool");Granify.webUI.appendHTMLto(e,'<div id="granify-playback-tool-header"style="background-color: #5c79af; color: white; text-align: center; padding: 10px 0; margin-bottom: 10px; cursor: move;"><b>PLAYBACK TOOL</b></div>');Granify.webUI.appendHTMLto(e,'<div class="playbackToolclose" style="position: absolute; text-align: center; top: 0px; right: 0px; height: 20px; width: 20px; color: #5c79af; cursor: pointer;"><b>x</b></div>'),document.getElementsByClassName("playbackToolclose")[0].onclick=function(){t()};Granify.webUI.appendHTMLto(e,'<div id="granify-playback-tool-wrapper"></div>'),Granify.campaignPlayback.updateUIContent(),Granify.webUI.makeElementDraggable(document.getElementById("granify-playback-tool"))}},function(t,e){(function(){Granify.SP={},Granify.SP.appendShopperProfileRequest=function(t){Granify.itExists(Granify.matchData)||(Granify.matchData={}),Granify.itExists(Granify.matchData.sp)||(Granify.matchData.sp=[]),Granify.matchData.sp.push(t)},Granify.SP.sendSSI=function(t){Granify.itExists(Granify.matchData)||(Granify.matchData={}),Granify.matchData.ssi=t},Granify.SP.setSiteShopperId=function(t,e){if(!Granify.isFunction(t))return Granify.log("Granify - WARNING: getSSIfunction() has not been defined for this site.");var r=Granify.getUserData("last_ssi")||"",n=Granify.getUserData("last_ssi_session")||"",a=t(),i=e||Granify.SESSION;return r==a&&n==i||((null===a||Granify.itExists(a)&&a.length>0)&&(Granify.trackUserData({last_ssi:a}),Granify.trackUserData({last_ssi_session:i}),Granify.SP.sendSSI(a)),Granify.onNext("nonCachedMatchRequestComplete",(function(t){Granify.itExists(t.sp)||(Granify.log("GRANIFY: sent ssi via match request but did not receive any shopper profile data in return."),Granify.trigger("shopperProfileReceived",{}))}))),a},Granify.SP.getSiteShopperId=function(){return Granify.getUserData("last_ssi")||""}}).call(this)},function(t,e){Granify.itExists(Granify.match)||(Granify.match={}),Granify.match.supportedMatchingVersionCheck=function(t){return"javascript"===t&&Granify.version.js<200?(Granify.log_error("JAVASCRIPT  v"+Granify.version.js+' DOES NOT SUPPORT NATIVE JAVASCRIPT COPY OF JS-MATCHING FILE!Please either upgrade to js v200 (or newer), or fix this js version\'s routing to point to the old "matching.coffee" copy of the matching file (ie: NOT "matching.js").'),!1):!("coffeescript"===t&&Granify.version.js>=200)||(Granify.log_error("JAVASCRIPT  v"+Granify.version.js+' DOES NOT SUPPORT LEGACY COFFEESCRIPT COPY OF JS-MATCHING FILE!Please either downgrade to js v199 (or older), or fix this js version\'s routing to point to the new "matching.js" copy of the matching file (ie: NOT "matching.coffee").'),!1)}},function(t,e){(function(){var t={},e=[],r=["matches","msMatchesSelector","webkitMatchesSelector"];function n(t,e){for(var n=0;n<r.length;n++)if(t[r[n]])return t[r[n]](e)}function a(t,e){for(var r=0;r<e.length;r++)if(e[r]&&n(e[r],t)||e[r].querySelector&&e[r].querySelector(t))return!0;return!1}function i(t){for(var r=[],n=0;n<t.length;n++)for(var i=t[n],o=0;o<e.length;o++){var s=e[o];if(!(r.indexOf(s)>-1)){var c=("add"===s.type||"change"===s.type)&&a(s.selector,i.addedNodes),u=("remove"===s.type||"change"===s.type)&&a(s.selector,i.removedNodes);(c||u)&&(s.callback(t),r.push(s))}}}function o(e,r,n,a){if(t[a])t[a].disconnect(),t[a].observe(e,r);else{var i=new MutationObserver(n);i.observe(e,r),t[a]=i}}function s(t,r,n){o(document.body,{childList:!0,subtree:!0},i,"generic"),"add"===t&&document.querySelector(r)&&n(),e.push({selector:r,callback:n,type:t})}Granify.onElementAttributeChange=function(t,e){var r={attributes:!0};s("add",t,(function(){e(),o(document.querySelector(t),r,e,"attribute-"+t)}))},Granify.onElementAddedDeep=s.bind(this,"add"),Granify.onElementRemovedDeep=s.bind(this,"remove"),Granify.onElementChangedDeep=s.bind(this,"change"),Granify.resetMutationObservers=function(){for(var r=0,n=Object.values(t);r<n.length;r++){n[r].disconnect()}t={},e=[]}}).call(this)},function(t,e){Granify.urlChange={urlChangeWatcher:function(t){Granify.logDebug("Granify - Initalize urlChange watcher"),Granify.isNumber(t)&&0!==t||(t=1e3);var e=Granify.urlChange.createURLChangeTriggerer();Granify.urlChange.intervalKey=window.setInterval(e,t),e()},intervalKey:null,getCurrentURL:function(){return window.location.pathname},createURLChangeTriggerer:function(){var t=null;return function(e){var r=Granify.urlChange.getCurrentURL();!0!==e&&t===r||(Granify.trigger(Granify.constants.EVENT_URL_CHANGE,r),t=r,Granify.log("URLChange event triggered, as URL was changed."))}}}},function(t,e){Granify.granifyGetPageType=function(t){if(!Granify.itExists(t)||!Granify.isArray(GRANIFY_CONFIG.pageTypeRegex)||0===GRANIFY_CONFIG.pageTypeRegex.length)return null;for(var e=GRANIFY_CONFIG.pageTypeRegex,r=0;r<e.length;r++){var n;try{n=new RegExp(e[r].regex,"i")}catch(a){return Granify.logCriticalOnce("Invalid regex",e[r]),null}if(!0===n.test(t))return e[r].pageType}return Granify.constants.DEFAULT_CUSTOM_INSTALL_PAGE_TYPE}},function(t,e){Granify.initializeCustomInstallAPIs=function(){if(window.GRANIFY_CONFIG.customInstall&&(!0===window.GRANIFY_CONFIG.customInstall.trackPageView&&(Granify.trackPageView=Granify.log.bind(this,"Client attempted to call trackPageView when Custom Install is set in dashboard config."),Granify.customInstallTrackPageView.init()),!0===window.GRANIFY_CONFIG.customInstall.trackOrder&&Granify.customInstallTrackOrder.init(),!0===window.GRANIFY_CONFIG.customInstall.trackCart&&(Granify.trackCart=Granify.log.bind(this,"Client attempted to call trackCart when Custom Install is set in dashboard config."),Granify.customInstallTrackCart.init()),!0===window.GRANIFY_CONFIG.customInstall.trackProduct&&(Granify.trackProduct=Granify.log.bind(this,"Client attempted to call trackProduct when Custom Install is set in dashboard config."),Granify.customInstallTrackProduct.init()),!0===window.GRANIFY_CONFIG.customInstall.trackWishList&&(Granify.trackWishList=Granify.log.bind(this,"Client attempted to call trackWishList when Custom Install is set in dashboard config"),Granify.customInstallTrackWishList.init()),!0===window.GRANIFY_CONFIG.customInstall.setCurrentProduct&&(Granify.setCurrentProduct=Granify.log.bind(this,"Client attempted to call setCurrentProduct when Custom Install is set in dashboard config."),Granify.customInstallSetCurrentProduct.init()),!0===window.GRANIFY_CONFIG.customInstall.eventGroupNotification&&Granify.customInstallEvents.initGroupNotifier(),!0===window.GRANIFY_CONFIG.customInstall.eventMessageNotification&&Granify.customInstallEvents.initMessageNotifier(),!0===window.GRANIFY_CONFIG.customInstall.assignGroup)){Granify.assignGroup=Granify.log.bind(this,"Client attempted to call assignGroup or enableMessages, when Custom Install is set in dashboard config."),Granify.customInstallAssignGroup.init()}}},function(t,e){Granify.enabled&&setInterval((function(){Granify.trigger("tick")}),1e3)},function(t,e){Granify.customInstallTrackPageView={pageData:null,currentPageStates:{},init:function(){Granify.customInstallTrackPageView.pageData=null,Granify.onAll(Granify.constants.EVENT_URL_CHANGE,(function(){Granify.customInstallTrackPageView.updatePageType(Granify.constants.EVENT_URL_CHANGE)})),Granify.onAll(Granify.constants.PAGE_TYPE_CHANGE_NEEDED,(function(){Granify.customInstallTrackPageView.updatePageType(Granify.constants.PAGE_TYPE_CHANGE_NEEDED)}))},updatePageType:function(t){Granify.customInstallTrackPageView.pageData=null,Granify.customInstallTrackPageView.getCurrentPageType(t),this.validPageViewHasAlreadyOccured(window.location.href)||Granify.customInstallTrackPageView.callTrackPageView()},validPageViewHasAlreadyOccured:function(t){return!!Granify.itExists(Granify.granifyCustomScriptPageTypeOverrideConfig)&&this._applyOverrides(Granify.granifyCustomScriptPageTypeOverrideConfig,t)},_applyOverrides:function(t,e){this._clearExistingPageStates();for(var r=0;r<t.length;r++){var n=t[r];if(this.pageData===n.page_type){var a;try{a=new RegExp(n.URLRegex,"g")}catch(SyntaxError){return Granify.logCriticalOnce("current regex: '"+n.URLRegex+"' with description '"+n.description+"is invalid"),!1}var i=a.exec(e);if(void 0===i||null===i)return Granify.logCriticalOnce("current regex: '"+n.URLRegex+"' with description '"+n.description+"' didn't match page url: '"+e+"' for pagetype '"+this.pageData+"'. Couldn't determine if tpv should be called."),!1;if(!Granify.itExists(i[1]))return Granify.logCriticalOnce("Unable to pull 1st match group out of url '"+e+"' using given regex '"+n.URLRegex+" with description '"+n.description+"'"),!1;var o=i[1];if(this.currentPageStates[this.pageData]===o)return!0;this.currentPageStates[this.pageData]=o;break}}return!1},_clearExistingPageStates:function(){for(var t in this.currentPageStates)t!==this.pageData&&(this.currentPageStates[t]=null)},getCurrentPageType:function(t){if(Granify.isFunction(window.clientGetPageType))Granify.customInstallTrackPageView.pageData=window.clientGetPageType(window.location.pathname);else if(Granify.isFunction(Granify.granifyCustomScriptPageType)&&(Granify.customInstallTrackPageView.pageData=Granify.granifyCustomScriptPageType(t,window.location.pathname)),!Granify.customInstallTrackPageView.pageData&&Granify.customInstallTrackPageView.granifyPageTypeRegexExists()){var e=window.location.pathname;GRANIFY_CONFIG.full_url_for_tpv_regex&&(e=window.location.toString()),Granify.customInstallTrackPageView.pageData=Granify.granifyGetPageType(e)}},callTrackPageView:function(){if(!Granify.isString(Granify.customInstallTrackPageView.pageData)||!Granify.pageTypeIsValid(Granify.customInstallTrackPageView.pageData))return Granify.logWarningOnce("Page type method provided invalid page type",{pageType:Granify.customInstallTrackPageView.pageData});Granify.internalTrackPageView({page_type:Granify.customInstallTrackPageView.pageData})},granifyPageTypeRegexExists:function(){return Granify.isArray(GRANIFY_CONFIG.pageTypeRegex)&&GRANIFY_CONFIG.pageTypeRegex.length>0}},Granify.pageTypeIsValid=function(t){return-1!==["home","product","collection","cart","checkout","receipt","search","blog","other","flight","account","login","preferences","guestdetails","flights","info","guide","video"].indexOf(t)}},function(t,e){Granify.customInstallTrackOrder={currentOrder:null,init:function(){Granify.customInstallTrackOrder.currentOrder=null,Granify.onAll(Granify.constants.EVENT_URL_CHANGE,(function(){Granify.customInstallTrackOrder.updateTrackOrder(Granify.constants.EVENT_URL_CHANGE)}))},updateTrackOrder:function(t){Granify.customInstallTrackOrder.currentOrder=null,Granify.customInstallTrackOrder.getCurrentOrderData(t),Granify.customInstallTrackOrder.callTrackOrder()},getCurrentOrderData:function(t){Granify.isFunction(window.clientGetOrderData)?Granify.customInstallTrackOrder.currentOrder=window.clientGetOrderData():Granify.isFunction(Granify.customInstallGetOrderData)?Granify.customInstallTrackOrder.currentOrder=Granify.customInstallGetOrderData(t):Granify.logCriticalOnce("Custom Install: attempting to use trackOrder but no source found")},callTrackOrder:function(){if(Granify.isPromise(Granify.customInstallTrackOrder.currentOrder))return Granify.customInstallTrackOrder.currentOrder.then((function(t){Granify.isObject(t)&&Granify.internalTrackOrder(t)}));Granify.isObject(Granify.customInstallTrackOrder.currentOrder)&&Granify.internalTrackOrder(Granify.customInstallTrackOrder.currentOrder)}}},function(t,e){Granify.customInstallTrackCart={cartData:null,init:function(){Granify.customInstallTrackCart.cartData=null,Granify.onAll(Granify.constants.NEW_SESSION_INITIALIZED,(function(){Granify.customInstallTrackCart.updateTrackCart(Granify.constants.NEW_SESSION_INITIALIZED)})),Granify.onAll(Granify.constants.EVENT_URL_CHANGE,(function(){Granify.customInstallTrackCart.updateTrackCart(Granify.constants.EVENT_URL_CHANGE)})),Granify.onAll(Granify.constants.EVENT_UPDATED_CART,(function(t){Granify.customInstallTrackCart.updateTrackCart(Granify.constants.EVENT_UPDATED_CART,t)})),Granify.onAll(Granify.constants.EVENT_ADD_TO_CART,(function(t){Granify.customInstallTrackCart.updateTrackCart(Granify.constants.EVENT_ADD_TO_CART,t)})),Granify.onAll(Granify.constants.EVENT_REMOVE_FROM_CART,(function(t){Granify.customInstallTrackCart.updateTrackCart(Granify.constants.EVENT_REMOVE_FROM_CART,t)}))},updateTrackCart:function(t,e){Granify.customInstallTrackCart.cartData=null,Granify.customInstallTrackCart.getCurrentCartData(t,e),Granify.customInstallTrackCart.callTrackCart(t)},getCurrentCartData:function(t,e){Granify.isFunction(window.clientGetCartData)?Granify.customInstallTrackCart.cartData=window.clientGetCartData():Granify.isFunction(Granify.customInstallGetCartData)?Granify.customInstallTrackCart.cartData=Granify.customInstallGetCartData(t,e):Granify.logCriticalOnce("Custom Install: attempting to use trackCart but no source found")},callTrackCart:function(t){if(Granify.isPromise(Granify.customInstallTrackCart.cartData))return Granify.customInstallTrackCart.cartData.then((function(t){Granify.customInstallTrackCart.cartData=t,Granify.customInstallTrackCart.callTrackCart()}));Granify.isArray(Granify.customInstallTrackCart.cartData)?Granify.internalTrackCart(Granify.customInstallTrackCart.cartData):t===Granify.constants.EVENT_ADD_TO_CART?Granify.internalAddToCart([Granify.customInstallTrackCart.cartData]):t===Granify.constants.EVENT_REMOVE_FROM_CART&&Granify.internalDeleteFromCart([Granify.customInstallTrackCart.cartData])}}},function(t,e){Granify.customInstallTrackProduct={productData:null,init:function(){Granify.customInstallTrackProduct.productData=null,Granify.onAll(Granify.constants.EVENT_URL_CHANGE,(function(){Granify.customInstallTrackProduct.updateProductData(Granify.constants.EVENT_URL_CHANGE)})),Granify.onAll(Granify.constants.PRODUCT_PAGE_CHANGE,(function(t){Granify.customInstallTrackProduct.updateProductData(Granify.constants.PRODUCT_PAGE_CHANGE,t)}))},updateProductData:function(t,e){Granify.customInstallTrackProduct.productData=null,Granify.customInstallTrackProduct.getCurrentProductData(t,e),Granify.customInstallTrackProduct.callTrackProduct()},getCurrentProductData:function(t,e){if(Granify.isFunction(window.clientGetProductData))Granify.customInstallTrackProduct.productData=window.clientGetProductData();else{if(!Granify.isFunction(Granify.customInstallGetProductData))return Granify.logCriticalOnce("Custom Install: attempting to use trackProduct but no source found");Granify.customInstallTrackProduct.productData=Granify.customInstallGetProductData(t,e)}},callTrackProduct:function(){if(Granify.isPromise(Granify.customInstallTrackProduct.productData))return Granify.customInstallTrackProduct.productData.then((function(t){Granify.isArray(t)&&Granify.internalTrackProduct(t)}));Granify.isArray(Granify.customInstallTrackProduct.productData)&&Granify.internalTrackProduct(Granify.customInstallTrackProduct.productData)}}},function(t,e){Granify.customInstallTrackWishList={wishListData:null,init:function(){Granify.customInstallTrackWishList.wishListData=null,Granify.onAll(Granify.constants.EVENT_URL_CHANGE,(function(){Granify.customInstallTrackWishList.updateTrackWishList(Granify.constants.EVENT_URL_CHANGE)})),Granify.onAll(Granify.constants.EVENT_UPDATED_WISHLIST,(function(t){Granify.customInstallTrackWishList.updateTrackWishList(Granify.constants.EVENT_UPDATED_WISHLIST,t)}))},updateTrackWishList:function(t,e){Granify.customInstallTrackWishList.wishListData=null,Granify.customInstallTrackWishList.getCurrentWishListData(t,e),Granify.customInstallTrackWishList.callTrackWishList()},getCurrentWishListData:function(t,e){Granify.isFunction(window.clientGetWishListData)?Granify.customInstallTrackWishList.wishListData=window.clientGetWishListData():Granify.isFunction(Granify.customInstallGetWishListData)?Granify.customInstallTrackWishList.wishListData=Granify.customInstallGetWishListData(t,e):Granify.logCriticalOnce("Custom Install: attempting to use trackWishList but no source found")},callTrackWishList:function(){Granify.isPromise(Granify.customInstallTrackWishList.wishListData)?Granify.customInstallTrackWishList.wishListData.then((function(t){Granify.isArray(t)&&Granify.internalTrackWishList(t)})):Granify.isObject(Granify.customInstallTrackWishList.wishListData)&&Granify.internalTrackWishList(Granify.customInstallTrackWishList.wishListData)}}},function(t,e){Granify.customInstallSetCurrentProduct={currentProduct:null,init:function(){Granify.customInstallSetCurrentProduct.currentProduct=null,Granify.onAll(Granify.constants.EVENT_URL_CHANGE,(function(){Granify.customInstallSetCurrentProduct.updateCurrentProduct(Granify.constants.EVENT_URL_CHANGE)})),Granify.onAll(Granify.constants.PRODUCT_PAGE_CHANGE,(function(){Granify.customInstallSetCurrentProduct.updateCurrentProduct(Granify.constants.PRODUCT_PAGE_CHANGE)})),Granify.onAll(Granify.constants.PRODUCT_SELECTION_CHANGE,(function(t){Granify.customInstallSetCurrentProduct.updateCurrentProduct(Granify.constants.PRODUCT_SELECTION_CHANGE,t)}))},updateCurrentProduct:function(t,e){Granify.customInstallSetCurrentProduct.currentProduct=null,Granify.customInstallSetCurrentProduct.getCurrentProductData(t,e),Granify.customInstallSetCurrentProduct.callSetCurrentProduct()},getCurrentProductData:function(t,e){Granify.isFunction(window.clientGetCurrentProduct)?Granify.customInstallSetCurrentProduct.currentProduct=window.clientGetCurrentProduct():Granify.isFunction(Granify.customInstallGetCurrentProduct)?Granify.customInstallSetCurrentProduct.currentProduct=Granify.customInstallGetCurrentProduct(t,e):Granify.logCriticalOnce("Custom Install: attempting to use setCurrentProduct but no source found")},callSetCurrentProduct:function(){if(Granify.isPromise(Granify.customInstallSetCurrentProduct.currentProduct))return Granify.customInstallSetCurrentProduct.currentProduct.then((function(t){Granify.isObject(t)&&Granify.internalSetCurrentProduct(t)}));Granify.isObject(Granify.customInstallSetCurrentProduct.currentProduct)&&Granify.internalSetCurrentProduct(Granify.customInstallSetCurrentProduct.currentProduct)}}},function(t,e){Granify.customInstallEvents={CLIENT_NOTIFICATION_RETRY_TIME:500,CLIENT_NOTIFICATION_RETRY_LIMIT:50,initGroupNotifier:function(){Granify.onEvery(Granify.constants.EVENT_GROUP_ASSIGNED,Granify.customInstallEvents.notifyClientOfGroup)},notifyClientOfGroup:function(){if("missing"===Granify.pageType&&Granify.logWarning("Late trackPageView call, and attempting to notify group once/page. This is not intended behavior."),Granify.customInstallEvents.hasPageTypeOrSessionIDChanged()){var t=Granify.customInstallEvents.getClientGroupMethod;Granify.customInstallEvents.callClientMethod(t,"group notifications",0,Granify.group),Granify.trackGranifyData("customInstallGroupPagetype",Granify.pageType,"page"),Granify.trackGranifyData("customInstallGroupSessionID",Granify.group,"session")}},getClientGroupMethod:function(){return window.granifyEventGroupAssigned},getClientMessageMethod:function(){return window.granifyEventMessageShown},initMessageNotifier:function(){var t=Granify.customInstallEvents.notifyClientOfMessage;Granify.onEvery(Granify.constants.EVENT_MESSAGE_ACKNOWLEDGED,t.bind(this,Granify.constants.EVENT_MESSAGE_SHOWN)),Granify.onEvery(Granify.constants.EVENT_MESSAGE_NOT_SHOWN,t.bind(this,Granify.constants.EVENT_MESSAGE_NOT_SHOWN))},notifyClientOfMessage:function(t,e){var r=Granify.customInstallEvents.getClientMessageMethod;Granify.customInstallEvents.callClientMethod(r,"message notifications",0,t,e.id)},hasPageTypeOrSessionIDChanged:function(){var t=Granify.getGranifyData("customInstallGroupPagetype"),e=Granify.getGranifyData("customInstallGroupSessionID");return!t||!e||t.value!==Granify.pageType||e.sessionId!==Granify.SERVER_SESSION_ID},callClientMethod:function(t,e,r){var n=[].slice.call(arguments);n[2]+=1;var a=Granify.customInstallEvents.callClientMethod.bind.apply(Granify.customInstallEvents.callClientMethod,[this].concat(n)),i=t();if(r>=Granify.customInstallEvents.CLIENT_NOTIFICATION_RETRY_LIMIT)return Granify.itExists(i)?Granify.logCriticalOnce("Client method for `"+e+"` did not return true in timeout period."):Granify.logCriticalOnce("Client method for `"+e+"` did not get defined in the timeout period.");if(!Granify.itExists(i))return Granify.logWarningOnce("Client method for `"+e+"` does not exist."),window.setTimeout(a,Granify.customInstallEvents.CLIENT_NOTIFICATION_RETRY_TIME);try{var o=i.apply(this,[].slice.call(arguments).splice(3));if(!1===o)return window.setTimeout(a,Granify.customInstallEvents.CLIENT_NOTIFICATION_RETRY_TIME)}catch(s){Granify.logCriticalOnce("Client method for matching group analytics threw exception.",s)}}}},function(t,e){Granify.customInstallAssignGroup={matchingGroup:null,init:function(){Granify.customInstallAssignGroup.matchingGroup=null,Granify.onAll(Granify.constants.EVENT_URL_CHANGE,Granify.customInstallAssignGroup.updateGroup.bind(this))},updateGroup:function(){Granify.customInstallAssignGroup.matchingGroup=null,Granify.customInstallAssignGroup.getCurrentGroup(),Granify.customInstallAssignGroup.callAssignGroup()},getCurrentGroup:function(){if(Granify.isFunction(window.clientGetGranifyGroup))Granify.customInstallAssignGroup.matchingGroup=window.clientGetGranifyGroup();else{if(!Granify.isFunction(Granify.customInstallGetGroup))return Granify.logCriticalOnce("Custom Install: attempting to use assignGroup but no source found");Granify.customInstallAssignGroup.matchingGroup=Granify.customInstallGetGroup()}},callAssignGroup:function(){if(Granify.isPromise(Granify.customInstallAssignGroup.matchingGroup))return Granify.customInstallAssignGroup.matchingGroup.then((function(t){Granify.isString(t)&&Granify.internalAssignGroup(t)}));Granify.isString(Granify.customInstallAssignGroup.matchingGroup)&&Granify.internalAssignGroup(Granify.customInstallAssignGroup.matchingGroup)}}},function(t,e){(function(){var t=!1;function e(){var t=Granify.restrictedElementList.some((function(t){return null!==document.querySelector(t)})),e=Boolean(t||function(){var t=!1;Granify.restrictedElementListByAttribute&&Granify.restrictedElementListByAttribute.forEach((function(e){var r=document.querySelector(e.selector);try{if(r&&e.hasOwnProperty("path")&&e.hasOwnProperty("restrictedValue"))e.path.reduce((function(t,e){return t[e]}),r)==e.restrictedValue&&(t=t||!0,Granify.logDebug('Restricted State: "path" property for "'.concat(e.selector,'" matches restricted value "').concat(e.restrictedValue,'",')+" setting restricted state to ".concat(t)));else if(r&&e.hasOwnProperty("querySelector")&&e.querySelector.length>0){var n=null;e.querySelector.some((function(t){return n=t,document.querySelector(t)}))&&(t=t||!0,Granify.logDebug('Restricted State: "New element "'.concat(n,'" found. Setting restricted state to ').concat(t)))}else r&&Granify.logWarningOnce('Restricted State: Element "'.concat(e.selector,'" has no path or querySelector defined.'))}catch(a){Granify.logDebug("Error with given object given in setRestrictedElementListByAttribute()",JSON.stringify(e))}}));return t}()),n=Granify.getGranifyData(Granify.constants.RESTRICTED_STATE);(n&&n.value)!==e&&(Granify.log("Restricted state changed - setting state to: ".concat(e)),r(e))}function r(e){var r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;r&&(Granify.logDebug('Restricted State: DOM node "'.concat(r,'" added. Setting restricted state to ').concat(e,".")),t&&Granify.log("Restricted state changed - setting state to: ".concat(e))),Granify.trackGranifyData(Granify.constants.RESTRICTED_STATE,e),!0===e&&Granify.trigger(Granify.constants.RESTRICTED_STATE_ENTERED)}Granify.defaultRestrictedElementList=Granify.defaultRestrictedElementList||[],Granify.restrictedElementList=[],Granify.restrictedElementListByAttribute=[],Granify.addRestrictedElementToList=function(n){t=!1,Granify.restrictedElementList=Granify.restrictedElementList.concat([n]),e(),Granify.onElementAddedDeep(n,r.bind(this,!0,n)),Granify.onElementRemovedDeep(n,e),t=!0},Granify.setRestrictedElementList=function(n){Granify.restrictedElementList=n.concat(Granify.defaultRestrictedElementList),e(),t=!1;for(var a=0;a<n.length;a++){var i=n[a];Granify.onElementAddedDeep(i,r.bind(this,!0,i)),Granify.onElementRemovedDeep(i,e)}t=!0},Granify.setRestrictedElementListByAttribute=function(t){Granify.restrictedElementListByAttribute=t,Granify.restrictedElementListByAttribute.forEach((function(t){Granify.onElementAttributeChange(t.selector,e),Granify.onElementRemovedDeep(t.selector,e)}))},Granify.logRestrictedStateElements=function(){var t={};Granify.restrictedElementList.forEach((function(e){t[e]=null!==document.querySelector(e)})),Granify.restrictedElementListByAttribute.forEach((function(e){var r=document.querySelector(e.selector);try{if(t[e.selector]={},r&&e.hasOwnProperty("path")&&e.hasOwnProperty("restrictedValue")){t[e.selector].path={};var n=e.path.reduce((function(t,e){return t[e]}),r);t[e.selector].path["".concat(e.path," == ").concat(e.restrictedValue)]=n==e.restrictedValue}else r&&e.hasOwnProperty("querySelector")&&e.querySelector.length>0?(t[e.selector].querySelector={},e.querySelector.forEach((function(r){t[e.selector].querySelector[r]=Boolean(document.querySelector(r))}))):t[e.selector]=r?"Could not find path or querySelector for this element.":"Element not on page."}catch(a){Granify.logDebug("Error with given object given in setRestrictedElementListByAttribute()",JSON.stringify(e))}})),Granify.log(JSON.stringify(t,null,2))}}).call(this)},function(t,e){Granify.webUI=Granify.webUI||{},Granify.webUI.appendHTMLto=function(t,e){for(var r=(new DOMParser).parseFromString(e,"text/html"),n=0;n<r.body.childNodes.length;n++)t.appendChild(r.body.childNodes[n])},Granify.webUI.injectCSS=function(t){var e=document.createElement("style");e.type="text/css",e.innerHTML=t,document.getElementsByTagName("head")[0].appendChild(e)},Granify.webUI.makeElementDraggable=function(t){var e=0,r=0,n=0,a=0;function i(t){t=t||window.event,n=t.clientX,a=t.clientY,document.onmouseup=s,document.onmousemove=o}function o(i){i=i||window.event,e=n-i.clientX,r=a-i.clientY,n=i.clientX,a=i.clientY,t.style.top=t.offsetTop-r+"px",t.style.left=t.offsetLeft-e+"px"}function s(){document.onmouseup=null,document.onmousemove=null}document.getElementById(t.id+"-header")?document.getElementById(t.id+"-header").onmousedown=i:t.onmousedown=i},Granify.webUI.populateListElement=function(t,e,r){for(var n=0,a=e.length;n<a;n++){var i=e[n],o=document.createElement("option");o.textContent=i,o.value=i,t.appendChild(o)}Granify.itExists(r)&&t.addEventListener("change",(function(){var e=t.value;Granify.trigger(r,e)}))},Granify.webUI.generateToggleSwitch=function(t,e,r,n){return{html:'<label id="'+t+'" class="granify-webUI-switch"><input id="granify-webUI-checkbox" type="checkbox"><span class="granify-webUI-slider '+(n?"round":"")+'"></span></label>',css:"#"+t+" {position: relative;display: inline-block;margin-bottom: "+5*r+"px;width: "+30*r+"px;height: "+17*r+"px;}#"+t+" input { opacity: 0; width: 0; height: 0; }#"+t+" .granify-webUI-slider {position: absolute;cursor: pointer;top: 0; left: 0; right: 0; bottom: 0;background-color: #ccc;-webkit-transition: .4s; transition: .4s;}#"+t+' .granify-webUI-slider:before {position: absolute; content: "";height: '+13*r+"px;width: "+13*r+"px;left: "+2*r+"px;bottom: "+2*r+"px;background-color: white;-webkit-transition: .4s; transition: .4s;}#"+t+" input:checked + .granify-webUI-slider {background-color: #"+e+";}#"+t+" input:focus + .granify-webUI-slider {box-shadow: 0 0 "+1*r+"px #"+e+";}#"+t+" input:checked + .granify-webUI-slider:before {-webkit-transform: translateX("+13*r+"px);-ms-transform: translateX("+13*r+"px);transform: translateX("+13*r+"px);}.granify-webUI-slider.round {border-radius: "+17*r+"px; }.granify-webUI-slider.round:before { border-radius: 50%; }"}},Granify.webUI.downloadString=function(t,e,r){var n=new Blob([t],{type:e}),a=document.createElement("a");a.download=r,a.href=URL.createObjectURL(n),a.dataset.downloadurl=[e,a.download,a.href].join(":"),a.style.display="none",document.body.appendChild(a),a.click(),document.body.removeChild(a),setTimeout((function(){URL.revokeObjectURL(a.href)}),1500)}},function(t,e){(function(){Granify.onAll(Granify.constants.PAGE_TYPE_CHANGE,(function(){var t=Granify.apiHistory.getLatestSetCurrentProductCall(),e=Granify.itExists(t)&&t.url.split("?")[0]==window.location.href.split("?")[0];"product"!==Granify.pageType||e||(Granify.logDebug("Clearing ID-related CP values on fresh product page load."),Granify.setSiteStateDataProperty("cp_product_id",null),Granify.setSiteStateDataProperty("cp_sku",null),Granify.setSiteStateDataProperty("cp_id",null),Granify.setSiteStateDataProperty("current_product_id",null),Granify.setSiteStateDataProperty("current_product_sku",null))}))}).call(this)},function(t,e,r){"use strict";var n,a=function(){return"undefined"===typeof n&&(n=Boolean(window&&document&&document.all&&!window.atob)),n},i=function(){var t={};return function(e){if("undefined"===typeof t[e]){var r=document.querySelector(e);if(window.HTMLIFrameElement&&r instanceof window.HTMLIFrameElement)try{r=r.contentDocument.head}catch(n){r=null}t[e]=r}return t[e]}}(),o=[];function s(t){for(var e=-1,r=0;r<o.length;r++)if(o[r].identifier===t){e=r;break}return e}function c(t,e){for(var r={},n=[],a=0;a<t.length;a++){var i=t[a],c=e.base?i[0]+e.base:i[0],u=r[c]||0,f="".concat(c," ").concat(u);r[c]=u+1;var l=s(f),y={css:i[1],media:i[2],sourceMap:i[3]};-1!==l?(o[l].references++,o[l].updater(y)):o.push({identifier:f,updater:h(y,e),references:1}),n.push(f)}return n}function u(t){var e=document.createElement("style"),n=t.attributes||{};if("undefined"===typeof n.nonce){var a=r.nc;a&&(n.nonce=a)}if(Object.keys(n).forEach((function(t){e.setAttribute(t,n[t])})),"function"===typeof t.insert)t.insert(e);else{var o=i(t.insert||"head");if(!o)throw new Error("Couldn't find a style target. This probably means that the value for the 'insert' parameter is invalid.");o.appendChild(e)}return e}var f,l=(f=[],function(t,e){return f[t]=e,f.filter(Boolean).join("\n")});function y(t,e,r,n){var a=r?"":n.media?"@media ".concat(n.media," {").concat(n.css,"}"):n.css;if(t.styleSheet)t.styleSheet.cssText=l(e,a);else{var i=document.createTextNode(a),o=t.childNodes;o[e]&&t.removeChild(o[e]),o.length?t.insertBefore(i,o[e]):t.appendChild(i)}}function d(t,e,r){var n=r.css,a=r.media,i=r.sourceMap;if(a?t.setAttribute("media",a):t.removeAttribute("media"),i&&btoa&&(n+="\n/*# sourceMappingURL=data:application/json;base64,".concat(btoa(unescape(encodeURIComponent(JSON.stringify(i))))," */")),t.styleSheet)t.styleSheet.cssText=n;else{for(;t.firstChild;)t.removeChild(t.firstChild);t.appendChild(document.createTextNode(n))}}var p=null,g=0;function h(t,e){var r,n,a;if(e.singleton){var i=g++;r=p||(p=u(e)),n=y.bind(null,r,i,!1),a=y.bind(null,r,i,!0)}else r=u(e),n=d.bind(null,r,e),a=function(){!function(t){if(null===t.parentNode)return!1;t.parentNode.removeChild(t)}(r)};return n(t),function(e){if(e){if(e.css===t.css&&e.media===t.media&&e.sourceMap===t.sourceMap)return;n(t=e)}else a()}}t.exports=function(t,e){(e=e||{}).singleton||"boolean"===typeof e.singleton||(e.singleton=a());var r=c(t=t||[],e);return function(t){if(t=t||[],"[object Array]"===Object.prototype.toString.call(t)){for(var n=0;n<r.length;n++){var a=s(r[n]);o[a].references--}for(var i=c(t,e),u=0;u<r.length;u++){var f=s(r[u]);0===o[f].references&&(o[f].updater(),o.splice(f,1))}r=i}}}},function(t,e,r){(e=r(67)(!0)).push([t.i,'.granify__status-bar-wrapper {\n  position: fixed;\n  bottom: 0px;\n  left: 0px;\n  height: 40px;\n  width: 100%;\n  display: flex;\n  align-items: stretch;\n  font-family: sans-serif;\n  font-size: 15px;\n  z-index: 2147483648;\n  text-align: left;\n  box-sizing: border-box;\n}\n\n.granify__status-bar-wrapper * {\n  box-sizing: border-box;\n}\n\n/* Hide the status bar on mobile screens */\n\n@media only screen and (max-width: 560px) {\n  .granify__status-bar-wrapper {\n    display: none;\n  }\n}\n\n.granify__status-bar-button {\n  display: flex;\n  align-items: center;\n  background: #97d525;\n  color: white;\n  padding: 10px;\n  font-size: 0.8em;\n  cursor: pointer;\n  -webkit-user-select: none;\n     -moz-user-select: none;\n      -ms-user-select: none;\n          user-select: none;\n  z-index: 1;\n}\n\n.granify__status-bar-button:hover {\n  background: #8dc723;\n}\n\n.granify__status-bar-chevron {\n  position: relative;\n}\n\n/* Create the triangle at the end of sections */\n\n.granify__status-bar-chevron::after,\n.granify__status-bar-content::after {\n  position: absolute;\n  right: -20px;\n  display: block;\n  width: 0;\n  height: 0;\n  border-top: 20px solid transparent;\n  border-bottom: 20px solid transparent;\n  border-left: 20px solid #97d525;\n  content: "";\n}\n\n.granify__status-bar-content::after {\n  border-left: 20px solid #085156;\n}\n\n.granify__status-bar-chevron:hover::after {\n  border-left: 20px solid #8dc723;\n}\n\n.granify__status-bar-content {\n  flex: 1 1 auto;\n  display: flex;\n  align-items: center;\n  background: #085156;\n  color: white;\n  white-space: nowrap;\n\n  transition: transform 0.1s;\n  transform: translateX(0);\n}\n\n.granify__status-bar-content.granify__status-bar-hidden {\n  transform: translateX(-100%);\n}\n\n.granify__status-bar-content .granify__status-bar-logo {\n  flex: 0 0 40px;\n  height: 40px;\n  margin-left: 20px;\n  background: url(https://www.granify.com/hubfs/Granify%20Logos/granify_logo_ico_rgb.svg);\n}\n\n.granify__status-bar-campaign-info {\n  flex: 1 1 auto;\n  overflow: hidden;\n  position: relative;\n  height: 100%;\n  margin-left: 10px;\n  margin-right: 10px;\n}\n\n.granify__status-bar-campaign-info-inner {\n  height: 100%;\n  position: absolute;\n  display: flex;\n  align-items: center;\n  min-width: 100%;\n}\n\n.granify__status-bar-campaign-info-inner > *:not(:first-child) {\n  margin-left: 10px;\n}\n\n/* only animate when the slide class is applied */\n\n.granify__status-bar-campaign-info-inner.granify__status-bar-campaign-info-slide {\n  -webkit-animation-duration: 10s;\n          animation-duration: 10s;\n  -webkit-animation-timing-function: linear;\n          animation-timing-function: linear;\n  -webkit-animation-iteration-count: infinite;\n          animation-iteration-count: infinite;\n  -webkit-animation-name: granify__status-bar-ticker;\n          animation-name: granify__status-bar-ticker;\n}\n\n/* animate back and forth */\n\n@-webkit-keyframes granify__status-bar-ticker {\n  0%,\n  33% {\n    left: 0;\n    transform: translateX(0);\n  }\n\n  66%,\n  100% {\n    left: 100%;\n    transform: translateX(-100%);\n  }\n}\n\n@keyframes granify__status-bar-ticker {\n  0%,\n  33% {\n    left: 0;\n    transform: translateX(0);\n  }\n\n  66%,\n  100% {\n    left: 100%;\n    transform: translateX(-100%);\n  }\n}\n\n.granify__status-bar-crf-label {\n  color: #ff9191;\n  -webkit-user-select: none;\n     -moz-user-select: none;\n      -ms-user-select: none;\n          user-select: none;\n  margin-right: 10px;\n}\n\n.granify__status-bar-crf-slider {\n  display: block;\n  position: absolute;\n  left: 0;\n  right: 0;\n  bottom: 100%;\n  width: 100%;\n  color: white;\n  background: #064146;\n  padding: 10px;\n  white-space: normal;\n  z-index: -100;\n  transition: transform 0.3s, left 0.1s, right 0.1s;\n  transform: translateY(100%);\n}\n\n.granify__status-bar-crf-slider.granify__status-bar-crf-slider-active {\n  transform: translateY(0);\n}\n\n/* Hide the crf-slider when content is hidden */\n\n.granify__status-bar-content.granify__status-bar-hidden ~ .granify__status-bar-crf-slider {\n  right: 150%;\n  left: -150%;\n}\n',"",{version:3,sources:["statusBar.css"],names:[],mappings:"AAAA;EACE,eAAe;EACf,WAAW;EACX,SAAS;EACT,YAAY;EACZ,WAAW;EACX,aAAa;EACb,oBAAoB;EACpB,uBAAuB;EACvB,eAAe;EACf,mBAAmB;EACnB,gBAAgB;EAChB,sBAAsB;AACxB;;AAEA;EACE,sBAAsB;AACxB;;AAEA,0CAA0C;;AAC1C;EACE;IACE,aAAa;EACf;AACF;;AAEA;EACE,aAAa;EACb,mBAAmB;EACnB,mBAAmB;EACnB,YAAY;EACZ,aAAa;EACb,gBAAgB;EAChB,eAAe;EACf,yBAAiB;KAAjB,sBAAiB;MAAjB,qBAAiB;UAAjB,iBAAiB;EACjB,UAAU;AACZ;;AAEA;EACE,mBAAmB;AACrB;;AAEA;EACE,kBAAkB;AACpB;;AAEA,+CAA+C;;AAC/C;;EAEE,kBAAkB;EAClB,YAAY;EACZ,cAAc;EACd,QAAQ;EACR,SAAS;EACT,kCAAkC;EAClC,qCAAqC;EACrC,+BAA+B;EAC/B,WAAW;AACb;;AAEA;EACE,+BAA+B;AACjC;;AAEA;EACE,+BAA+B;AACjC;;AAEA;EACE,cAAc;EACd,aAAa;EACb,mBAAmB;EACnB,mBAAmB;EACnB,YAAY;EACZ,mBAAmB;;EAEnB,0BAA0B;EAC1B,wBAAwB;AAC1B;;AAEA;EACE,4BAA4B;AAC9B;;AAEA;EACE,cAAc;EACd,YAAY;EACZ,iBAAiB;EACjB,uFAAuF;AACzF;;AAEA;EACE,cAAc;EACd,gBAAgB;EAChB,kBAAkB;EAClB,YAAY;EACZ,iBAAiB;EACjB,kBAAkB;AACpB;;AAEA;EACE,YAAY;EACZ,kBAAkB;EAClB,aAAa;EACb,mBAAmB;EACnB,eAAe;AACjB;;AAEA;EACE,iBAAiB;AACnB;;AAEA,iDAAiD;;AACjD;EACE,+BAAuB;UAAvB,uBAAuB;EACvB,yCAAiC;UAAjC,iCAAiC;EACjC,2CAAmC;UAAnC,mCAAmC;EACnC,kDAA0C;UAA1C,0CAA0C;AAC5C;;AAEA,2BAA2B;;AAC3B;EACE;;IAEE,OAAO;IACP,wBAAwB;EAC1B;;EAEA;;IAEE,UAAU;IACV,4BAA4B;EAC9B;AACF;;AAZA;EACE;;IAEE,OAAO;IACP,wBAAwB;EAC1B;;EAEA;;IAEE,UAAU;IACV,4BAA4B;EAC9B;AACF;;AAEA;EACE,cAAc;EACd,yBAAiB;KAAjB,sBAAiB;MAAjB,qBAAiB;UAAjB,iBAAiB;EACjB,kBAAkB;AACpB;;AAEA;EACE,cAAc;EACd,kBAAkB;EAClB,OAAO;EACP,QAAQ;EACR,YAAY;EACZ,WAAW;EACX,YAAY;EACZ,mBAAmB;EACnB,aAAa;EACb,mBAAmB;EACnB,aAAa;EACb,iDAAiD;EACjD,2BAA2B;AAC7B;;AAEA;EACE,wBAAwB;AAC1B;;AAEA,+CAA+C;;AAC/C;EACE,WAAW;EACX,WAAW;AACb",file:"statusBar.css",sourcesContent:['.granify__status-bar-wrapper {\n  position: fixed;\n  bottom: 0px;\n  left: 0px;\n  height: 40px;\n  width: 100%;\n  display: flex;\n  align-items: stretch;\n  font-family: sans-serif;\n  font-size: 15px;\n  z-index: 2147483648;\n  text-align: left;\n  box-sizing: border-box;\n}\n\n.granify__status-bar-wrapper * {\n  box-sizing: border-box;\n}\n\n/* Hide the status bar on mobile screens */\n@media only screen and (max-width: 560px) {\n  .granify__status-bar-wrapper {\n    display: none;\n  }\n}\n\n.granify__status-bar-button {\n  display: flex;\n  align-items: center;\n  background: #97d525;\n  color: white;\n  padding: 10px;\n  font-size: 0.8em;\n  cursor: pointer;\n  user-select: none;\n  z-index: 1;\n}\n\n.granify__status-bar-button:hover {\n  background: #8dc723;\n}\n\n.granify__status-bar-chevron {\n  position: relative;\n}\n\n/* Create the triangle at the end of sections */\n.granify__status-bar-chevron::after,\n.granify__status-bar-content::after {\n  position: absolute;\n  right: -20px;\n  display: block;\n  width: 0;\n  height: 0;\n  border-top: 20px solid transparent;\n  border-bottom: 20px solid transparent;\n  border-left: 20px solid #97d525;\n  content: "";\n}\n\n.granify__status-bar-content::after {\n  border-left: 20px solid #085156;\n}\n\n.granify__status-bar-chevron:hover::after {\n  border-left: 20px solid #8dc723;\n}\n\n.granify__status-bar-content {\n  flex: 1 1 auto;\n  display: flex;\n  align-items: center;\n  background: #085156;\n  color: white;\n  white-space: nowrap;\n\n  transition: transform 0.1s;\n  transform: translateX(0);\n}\n\n.granify__status-bar-content.granify__status-bar-hidden {\n  transform: translateX(-100%);\n}\n\n.granify__status-bar-content .granify__status-bar-logo {\n  flex: 0 0 40px;\n  height: 40px;\n  margin-left: 20px;\n  background: url(https://www.granify.com/hubfs/Granify%20Logos/granify_logo_ico_rgb.svg);\n}\n\n.granify__status-bar-campaign-info {\n  flex: 1 1 auto;\n  overflow: hidden;\n  position: relative;\n  height: 100%;\n  margin-left: 10px;\n  margin-right: 10px;\n}\n\n.granify__status-bar-campaign-info-inner {\n  height: 100%;\n  position: absolute;\n  display: flex;\n  align-items: center;\n  min-width: 100%;\n}\n\n.granify__status-bar-campaign-info-inner > *:not(:first-child) {\n  margin-left: 10px;\n}\n\n/* only animate when the slide class is applied */\n.granify__status-bar-campaign-info-inner.granify__status-bar-campaign-info-slide {\n  animation-duration: 10s;\n  animation-timing-function: linear;\n  animation-iteration-count: infinite;\n  animation-name: granify__status-bar-ticker;\n}\n\n/* animate back and forth */\n@keyframes granify__status-bar-ticker {\n  0%,\n  33% {\n    left: 0;\n    transform: translateX(0);\n  }\n\n  66%,\n  100% {\n    left: 100%;\n    transform: translateX(-100%);\n  }\n}\n\n.granify__status-bar-crf-label {\n  color: #ff9191;\n  user-select: none;\n  margin-right: 10px;\n}\n\n.granify__status-bar-crf-slider {\n  display: block;\n  position: absolute;\n  left: 0;\n  right: 0;\n  bottom: 100%;\n  width: 100%;\n  color: white;\n  background: #064146;\n  padding: 10px;\n  white-space: normal;\n  z-index: -100;\n  transition: transform 0.3s, left 0.1s, right 0.1s;\n  transform: translateY(100%);\n}\n\n.granify__status-bar-crf-slider.granify__status-bar-crf-slider-active {\n  transform: translateY(0);\n}\n\n/* Hide the crf-slider when content is hidden */\n.granify__status-bar-content.granify__status-bar-hidden ~ .granify__status-bar-crf-slider {\n  right: 150%;\n  left: -150%;\n}\n']}]),t.exports=e},function(t,e,r){"use strict";t.exports=function(t){var e=[];return e.toString=function(){return this.map((function(e){var r=function(t,e){var r=t[1]||"",n=t[3];if(!n)return r;if(e&&"function"===typeof btoa){var a=(o=n,s=btoa(unescape(encodeURIComponent(JSON.stringify(o)))),c="sourceMappingURL=data:application/json;charset=utf-8;base64,".concat(s),"/*# ".concat(c," */")),i=n.sources.map((function(t){return"/*# sourceURL=".concat(n.sourceRoot||"").concat(t," */")}));return[r].concat(i).concat([a]).join("\n")}var o,s,c;return[r].join("\n")}(e,t);return e[2]?"@media ".concat(e[2]," {").concat(r,"}"):r})).join("")},e.i=function(t,r,n){"string"===typeof t&&(t=[[null,t,""]]);var a={};if(n)for(var i=0;i<this.length;i++){var o=this[i][0];null!=o&&(a[o]=!0)}for(var s=0;s<t.length;s++){var c=[].concat(t[s]);n&&a[c[0]]||(r&&(c[2]?c[2]="".concat(r," and ").concat(c[2]):c[2]=r),e.push(c))}},e}},function(t,e){Granify.checkGranifyEnabled=function(t){if((t=t||window).location&&t.location.search){var e=t.location.search;if(Granify.paramExists("granifyenabled",e.toLowerCase())){"false"===Granify.getParam("granifyenabled",null,e.toLowerCase())&&(Granify.enabled=!1,Granify.logDebug("Granify disabled; stopping matching."));var r=new RegExp("granifyenabled","i"),n=e.match(r);Granify.removeQueryParamFromUrl(n.toString(),t)}}}},function(t,e){if(Granify.checkGranifyEnabled(window),Granify.enabled){Granify.jstype="javascript",Granify.tracking_stopped=!1,Granify.tracking_initialized=!1,Granify.campaign=null,Granify.old_offer=null,Granify.campaignDataArray=[],Granify.group="unknown",Granify.externalGroupReady=!1,Granify.matching=Granify.rb.matching_host,Granify.match=Granify.match||{},Granify.match.isNewSessionStart=!1,Granify.nextMatchIsFirstNonCachedRequest=!1;Granify.test_mode=!1,Granify.rb.isEnvironment("test")&&(Granify.test_mode=!0),Granify.match.PRODUCTION_TRACK_THROTTLE_VAL=100,Granify.match.TESTING_TRACK_THROTTLE_VAL=0,Granify.tracking_wait_interval=1e3,Granify.matching_requests=[],Granify.version=Granify.rb.version,Granify.match.supportedMatchingVersionCheck(Granify.jstype),Granify.getSharedData(Granify.storage.THROW_ERRORS).then((function(t){if(t)return Granify.throw_errors=!0})),Granify.errors=[],Granify.testsDebugMessages=[],Granify.hasUnconfirmedOrders=!1,Granify.latency={},Granify.latency.mutex=!1,Granify.match_timeout=null,Granify.resetSources=[],Granify.rb.get_analytics(),Granify.cached_data_processing=!1;var r=function(){return!0===GRANIFY_CONFIG.external_groups};Granify.urlChange.urlChangeWatcher(),Granify.use_iframe&&(document.addEventListener("visibilitychange",(function(){!1===document.hidden&&Granify.getAllIframeData()})),Granify.onAll(Granify.constants.EVENT_URL_CHANGE,(function(){Granify.getAllIframeData()}))),Granify.start=function(){return Granify.addGranifyListener(GLOBAL,"pagehide",(function(){try{Granify.cacheMatchingData(),Granify.stop()}catch(t){}})),Granify.stopped=!1,Granify.tracking_stopped=!1,Granify.isMutexLocked()||(Granify.lockMutex(),Granify.acquiredMutex=!0),setTimeout((function(){null==Granify._stack&&(Granify._stack=[]);for(var t=[],e=0,r=Granify._stack.length;e<r;e++){var n=Granify._stack[e];"trackOrder"===n[0]?t.push(Granify[n[0]](n[1],!0)):t.push(void 0)}return t}),0),Granify.reset("start"),Granify.idle_watch=setInterval((function(){return Granify.idle_tracking()}),1e3),setTimeout((function(){if(Granify.acquiredMutex)return Granify.onPageLoad();Granify.waitForMutex((function(){return Granify.onPageLoad()}))}),0)},Granify.onPageLoad=function(){return"loading"!==GLOBAL.document.readyState?(Granify.use_iframe&&(Granify.insertFrame(),Granify.importState()),Granify.initializeUUID().then((function(){Granify.init(),Granify.userMonitor.activateNewAndReturnUserMonitor()}),(function(t){Granify.logCritical("Failed to prepare a session UUID",t)}))):(Granify.is_ie&&Granify.addGranifyListener(GLOBAL,"DOMContentLoaded",Granify.init),Granify.addGranifyListener(GLOBAL,"load",Granify.init))},Granify.init=function(){if(!this.wasInitialized){this.wasInitialized=!0,Granify.init_time=+new Date;for(var t=Granify.tracker_classes,e=0,r=t.length;e<r;e++){var n=t[e];Granify.trackers.push(new n)}Granify.enableSiteStateData(),Granify.initializeCustomInstallAPIs();try{Granify.updateStateDataFromStorage()}catch(i){Granify.logError("Granify.init - Could not update state data from Storage on load",{error_message:i.message},!0)}Granify.reloadFlags((function(){Granify.acquiredMutex&&Granify.releaseMutex(),Granify.initializeMatching()})),Granify._functionsAvailable=!0,Granify.trigger("granify:init");try{var a=Granify.getStorage(Granify.storage.BOOKMARKLET);if(Granify.paramExists("granify_preview",[location.href,GLOBAL.document.referrer])&&(Granify.previewMode=!0),"open"===a||Granify.previewMode)return Granify.insertScript(Granify.domain+"/install-bookmarklet.js",(function(){}),"granify-bookmarklet-script")}catch(o){}}},Granify.checkRestrictedStateMatch=function(){var t=0;Granify.itExists(Granify.getGranifyData("restricted_state_match_count"))&&(t=Granify.getGranifyData("restricted_state_match_count").value),Granify.getGranifyData("restricted_state")&&Granify.getGranifyData("restricted_state").value&&(t++,Granify.trackGranifyData("restricted_state_match_count",t))},Granify.initializeMatching=function(){var t;if(Granify.itExists(Granify.metrics)){if(Granify.onEvery(Granify.constants.EVENT_MESSAGE_SHOWN,(function(){Granify.metrics.count("trigger.messageshown")})),Granify.onEvery(Granify.constants.EVENT_MESSAGE_NOT_SHOWN,(function(){Granify.metrics.count("trigger.messagenotshown")})),Granify.itExists(Granify.getGranifyData("restricted_state_match_count"))){var e=Granify.getGranifyData("restricted_state_match_count").value;Granify.metrics.count("trigger.restrictedstatematch",e)}Granify.trackGranifyData("restricted_state_match_count",0),Granify.on("message:show",Granify.checkRestrictedStateMatch),Granify.on("matchRequestComplete",Granify.checkRestrictedStateMatch)}for(Granify.on(Granify.constants.EVENT_GROUP_ASSIGNED,(function(t){Granify.itExists(Granify.metrics)&&Granify.metrics.count("trigger.matchinggroupassigned."+t.groupId)})),null==Granify._stack&&(Granify._stack=[]);t=Granify._stack.shift();){var n=t.shift();Granify[n].apply(null,t)}var a=Granify.getGranifyData("campaign_playback_tool_requested",!0);if(!!a&&a.value&&Granify.campaignPlayback.enable(),r()){var i=setTimeout((function(){Granify.logCritical("Expecting a group assignment, but none was received after 10 seconds")}),1e4);return Granify.on("externalGroupReceived",(function(t){return clearTimeout(i),Granify.group=t,null==Granify.matchData&&(Granify.matchData={}),Granify.matchData.mg=Granify.getGroupAlias(t),Granify.externalGroupReady=!0,Granify.startMatchRequests()}))}return Granify.startMatchRequests()},Granify.stop=function(){Granify.stopped=!0,Granify.tracking_stopped=!0;for(var t=0,e=Granify.trackers.length;t<e;t++){Granify.trackers[t].stop()}Granify.old_trackers=Granify.trackers,Granify.trackers=[]},Granify.match.getThrottleVal=function(){return Granify.unitTestsDisableMatchThrottle?Granify.match.TESTING_TRACK_THROTTLE_VAL:Granify.match.PRODUCTION_TRACK_THROTTLE_VAL},Granify.restartLibrary=function(){if(Granify.stopped){Granify.log("restarting library"),Granify.stopped=!1,Granify.tracking_stopped=!1,Granify.trackers=Granify.old_trackers;for(var t=0,e=Granify.trackers.length;t<e;t++){Granify.trackers[t].start()}return Granify.resetLocal(),Granify.scheduleNextMatch()}},Granify.resetLocal=function(){Granify.page_visit=0,Granify.start_time=+new Date,Granify.start_time_fixed=Granify.start_time,Granify.cumulated_active_time=0,Granify.mouse_activity_resumed_date=Granify.start_time_fixed,Granify.mouse_active_time_total=0,Granify.idle_time=0,Granify.current_time=null;for(var t=0,e=Granify.trackers.length;t<e;t++){Granify.trackers[t].reset()}return Granify.eraseSharedData(Granify.storage.ENTRY_PAGE_SENT),Granify.eraseSharedData(Granify.storage.ENTRY_REFERRER_SENT),Granify.getSharedData(Granify.storage.UNCONFIRMED_ORDERS).then((function(t){if(null!=t&&""!==t&&0!==t.length)return Granify.hasUnconfirmedOrders=!0})),Granify.externalGroupReady=!1,Granify.latestSentData=null,Granify._check_debug_query(),Granify._checkForceMatchingQuery()},Granify.reset=function(t){return null==t&&(t="unknown"),Granify.resetSources.length<10&&Granify.resetSources.push(t),Granify.resetLocal(),Granify.data=null,Granify.tags=[],Granify.location=GLOBAL.location.href,Granify.resetPageType()},Granify.track=Granify.throttle((function(){var t=(new Date).getTime();Granify.page_visit+=(t-Granify.start_time)/1e3,Granify.start_time=t;try{Granify.reloadFlags((function(){Granify.startMatchRequests()}))}catch(e){Granify.error(e,"match")}return!0}),Granify.match.getThrottleVal()),Granify.scheduleNextMatch=function(){r()&&!1===Granify.externalGroupReady||Granify.unitTestsDisableNextMatch||Granify.tracking_stopped||setTimeout((function(){return Granify.track()}),Granify.tracking_wait_interval)},Granify.idle_tracking=Granify.throttle((function(){if(Granify.idle_time+=1,!Granify.stopped)return Granify.idle_time>5&&!Granify.tracking_stopped?(Granify.tracking_stopped=!0,Granify.cumulated_active_time+=Granify.time_since(Granify.mouse_activity_resumed_date)):Granify.tracking_stopped&&Granify.idle_time<=5&&(Granify.tracking_stopped=!1,Granify.mouse_activity_resumed_date=+new Date,Granify.scheduleNextMatch()),Granify.tracking_stopped?void 0:Granify.mouse_active_time_total=Granify.cumulated_active_time+Granify.time_since(Granify.mouse_activity_resumed_date)}),100),Granify.match.handleSessionData=function(t){if(null==(null!=t?t.tg:void 0)||null!=t.se&&1===t.se){if(!Granify.match.isNewSessionStart)return Granify.SESSION_INITIALIZED=2,Granify.stop(),!1}else{if(Granify.SESSION_INITIALIZED=1,r()?(Granify.sendGaGroup(Granify.group),Granify.trigger(Granify.group)):t.tg?Granify.group="baseline":Granify.group=Granify.getGroup("granify"),Granify.isPlatformMatchingGroup(t.mg)&&!Granify.toolPairAvailable())return!1;Granify.sendGaGroup(Granify.group),Granify.trigger(Granify.constants.EVENT_GROUP_ASSIGNED,{groupId:t.mg,groupName:Granify.group,sessionID:Granify.SERVER_SESSION_ID})}},Granify.match.handleOffer=function(t){if(!Granify.stopped)try{return Granify.match.handleSessionData(t),Granify.match.handleWidgetDisplayMetrics(t),t.cg&&!GRANIFY_CONFIG.displayAck?(Granify.trigger("control_group"),!0):(Granify.offerController.handleOffer(t),Granify.displayController.handleDisplay(t),!0)}catch(e){return Granify.error(e,"handleOffer"),!1}},Granify.touchSession=function(){Granify.setSharedData(Granify.storage.SESSION,Granify.SESSION);var t=[];return t.push(Granify.getSharedData(Granify.storage.ENTRY_PAGE)),t.push(Granify.getSharedData(Granify.storage.ENTRY_REFERRER)),Granify.Promise.all(t).then((function(t){var e=t[0],r=t[1];if(e&&Granify.setSharedData(Granify.storage.ENTRY_PAGE,e),r)return Granify.setSharedData(Granify.storage.ENTRY_REFERRER,r)}))},Granify.match.confirmNewSessionWithMatching=function(){Granify.itExists(Granify.matchData)||(Granify.matchData={}),Granify.matchData.nsk=1,Granify.matchData.s=Granify.match.sessionFromMatching},Granify.reloadFlags=function(t){if(!Granify.previewMode){var e=[];e.push(Granify.getSharedData(Granify.storage.UUID)),e.push(Granify.getSharedData(Granify.storage.SESSION)),Granify.Promise.all(e).then((function(e){var r=e[0];return r?(Granify.UUID=r,Granify.isNewSession=!1,Granify.match.isNewSessionStart?(Granify.SESSION_INITIALIZED=0,Granify.resetLocal(),Granify.isNewSession=!0,Granify.match.confirmNewSessionWithMatching(),Granify.trigger(Granify.constants.NEW_SESSION_INITIALIZED,Granify.SESSION)):(Granify.SESSION_INITIALIZED=1,Granify.isNewSession=!1),Granify.SESSION=Granify.match.sessionFromMatching||-1,Granify.touchSession(),t()):Granify.stop()}))}},Granify.getMatchingData=function(t){var e,r;t=t||!1,r=null!=Granify.mouse_active_time_total?Granify.round(Granify.mouse_active_time_total):0;var n,a={uuid:Granify.UUID,session:Granify.SESSION||-1,site_id:Granify.SHOP_ID,start_time:Granify.start_time_fixed,visit_duration:null!=Granify.page_visit?Granify.round(Granify.page_visit):0,page_type:Granify.getPageType(),tags:Granify.tags,mouse_active_time:r,x:Granify.version.js};if(Granify.CHILD_SITE_ID&&(a.child_site_id=Granify.CHILD_SITE_ID),null!=Granify.matchData)for(n in Granify.matchData){Granify.matchData[n];a[n]=Granify.matchData[n]}null!=Granify.getPageMetaData()&&(a.page_meta_data=JSON.stringify(Granify.getPageMetaData())),null!=Granify._granifySendCart&&(a.cart_contents=Granify._granifySendCart,Granify._granifySendCart=null),null!=Granify._granifyAddToCart&&(a.add_to_cart=Granify._granifyAddToCart,Granify._granifyAddToCart=null),null!=Granify._granifyDeleteFromCart&&(a.delete_from_cart=Granify._granifyDeleteFromCart,Granify._granifyDeleteFromCart=null),null!==Granify._granifySendWishList&&(a.wishList=Granify._granifySendWishList,Granify._granifySendWishList=null),t||(a.ssd=JSON.stringify(Granify.getSSD()),a.ssd.length>Granify.getSSDLimit()&&(Granify.logErrorOnce("site_state_data exceeds size limit allowed by Matching; not sending data.",{string_length:a.ssd.length}),a.ssd=JSON.stringify(null)),Granify.clearSSD(),a.ssd_m=JSON.stringify(Granify.getSSD_M()),a.ssd_m.length>Granify.getSSDLimit()&&(Granify.logErrorOnce("site_state_data (modifier) exceeds size limit allowed by Matching; not sending data.",{string_length:a.ssd_m.length}),a.ssd_m=JSON.stringify(null)),Granify.clearSSD_M(),a.wsd=JSON.stringify(Granify.getWSD()),a.wsd.length>Granify.getWSDLimit()&&(Granify.logErrorOnce("widget_state_data exceeds size limit allowed by Matching; not sending data.",{string_length:a.wsd.length}),a.wsd=JSON.stringify(null)),Granify.clearWSD());for(var i=0,o=Granify.trackers.length;i<o;i++){var s,c,u=Granify.trackers[i].getData();for(s in u)c=u[s],a[s]=c}return Granify.hasUnconfirmedOrders&&(a.has_unconfirmed_orders=+Granify.hasUnconfirmedOrders),null==Granify.ga&&(Granify.ga=JSON.stringify(Granify.packObj(Granify.getGaAttributes()))),a.ga=Granify.ga,Granify.data&&(a.data=JSON.stringify(Granify.data),Granify.data=null),Granify.latency.mutex&&Granify.latency.offer_shown&&(a.widget_latency_full=Granify.latency.offer_shown-Granify.latency.last_request_sent,a.widget_latency_js=Granify.latency.offer_shown-Granify.latency.last_request_response,Granify.latency.mutex=!1,Granify.latency.offer_shown=null),null!=(e=Granify.synchronousGetSharedData(Granify.storage.MATCH_REQUEST_DATA_CACHE))&&"undefined"!==e?{data:a,cached_data:e}:(Granify.matchData=null,{data:a})},Granify.cacheMatchingData=function(){var t=null,e=Granify.getMatchingData(!0);Granify.itExists(e.cachedData)||Granify.itExists(e.data)&&((t=e.data).dp=!0,Granify.setSharedData(Granify.storage.MATCH_REQUEST_DATA_CACHE,t))},Granify.clearCachedMatchingData=function(){return Granify.setSharedData(Granify.storage.MATCH_REQUEST_DATA_CACHE,void 0)},Granify.match.setNewSessionStartFlag=function(t){Granify.match.isNewSessionStart=t},Granify.match.isNewSessionStartResponse=function(t){var e=!1;return Granify.itExists(t)&&Granify.itExists(t.nss)&&(e=1==t.nss),e},Granify.match.validSessionIdInResponse=function(t){if(Granify.itExists(t)&&Granify.itExists(t.s)){var e=t.s;if(Granify.isInteger(e)&&e>=15e11)return!0}return!1},Granify.match.setSessionId=function(t){if(Granify.itExists(t.s))if(Granify.match.validSessionIdInResponse(t)){if(t.s===Granify.SESSION)return;Granify.match.sessionFromMatching=t.s}else Granify.logError("GRANIFY - matching.js: ERROR, received invalid session id from matching: ",t.s,!0)},Granify.match.updateRequestResponse=function(){Granify.latency.mutex||(Granify.latency.last_request_response=+new Date)},Granify.match.handleSessionResponse=function(t){var e=Granify.match.isNewSessionStartResponse(t);Granify.match.setNewSessionStartFlag(e),Granify.match.isStaleResponse=!1,Granify.trigger("resolveMatchingResponsePromise",t),null!=t.st&&t.st!==Granify.start_time_fixed&&(Granify.match.isStaleResponse=!0)},Granify.match.handleCachedResponse=function(t,e){t&&(Granify.clearCachedMatchingData(),Granify.cached_data_processing=!1,Granify.log("Granify - matching : cached data successfully sent to matching: ",e))},Granify.match.flagEntryDataAsSent=function(t){t.entry_page&&Granify.setSharedData(Granify.storage.ENTRY_PAGE_SENT,"1"),t.entry_referrer&&Granify.setSharedData(Granify.storage.ENTRY_REFERRER_SENT,"1")},Granify.match.setLatestServerTime=function(t){t.ct&&(Granify.lastServerTime=t.ct,Granify.clientTimeOffset=parseInt(+(new Date).getTime()/1e3)-parseInt(Granify.lastServerTime),Granify.setSharedData(Granify.storage.LAST_SERVER_TIME,{time:Granify.lastServerTime,session:Granify.SESSION||-1}))},Granify.match.initializeDataForResetting=function(t){if(!t)for(var e=0,r=Granify.trackers.length;e<r;e++){var n=Granify.trackers[e];Granify.itExists(n.initializeData)&&n.initializeData()}},Granify.match.handleMatchResponse=function(t,e,r){var n=!1;if(Granify.itExists(t)&&"ok"!==t){if(Granify.match.setSessionId(t),Granify.SERVER_SESSION_ID=t.ss,Granify.match.updateRequestResponse(),null!=t.error)return void Granify.trigger("rejectMatchingResponsePromise",t.error);Granify.match.handleSessionResponse(t),Granify.match.handleCachedResponse(r,e),Granify.latestSentData=e,Granify.match.flagEntryDataAsSent(e),Granify.match.setLatestServerTime(t),null!=t.sp&&Granify.trigger("shopperProfileReceived",t.sp),r||null==t.ev||Granify.on(Granify.constants.EVENT_GROUP_ASSIGNED,(function(){for(var e=t.ev,r=0,n=e.length;r<n;r++)e[r].e&&e[r].ed&&Granify.isString(e[r].e)&&Granify.trackGranifyData(e[r].e,e[r].ed,"local")})),r||Granify.match.handleToolPairsResponse(t),Granify.hasUnconfirmedOrders&&Granify.resendUnconfirmedOrders(t.co),t.force_matching&&Granify.forceMatchingStatusBar.updateCRF(t.crf),Granify.match.initializeDataForResetting(r)}else n=!0,Granify.log("GRANIFY: handleMatchResponse - no data returned from match response.");Granify.previewModeWithMatching||Granify.match.isStaleResponse||r||n||r||Granify.match.handleOffer(t),r||Granify.scheduleNextMatch(),Granify.trigger("matchRequestComplete",t),r||Granify.trigger("nonCachedMatchRequestComplete",t)},Granify.match_function=function(){var t=arguments.length<=0||void 0===arguments[0]?null:arguments[0],e=arguments.length<=1||void 0===arguments[1]?null:arguments[1];if(!Granify.stopped&&!Granify.forceLoadWidgetUrlQueryRequest()&&(!r()||!1!==Granify.externalGroupReady))if(Granify.previewMode)Granify.stop();else if(clearTimeout(Granify.match_timeout),Granify.SHOP_ID&&Granify.UUID&&null!=Granify.SESSION_INITIALIZED){if(!Granify.UUID.match(/^[0-9A-Fa-f-]+$/))return Granify.logError("Wrong UUID format",{x:Granify.version.js,domain:Granify.cookies_domain,uuid:JSON.stringify(Granify.UUID)}),void Granify.setSharedData(Granify.storage.UUID,"");if(!(Granify.lastScroll&&new Date-Granify.lastScroll<500)){Granify.checkPageType(),Granify.trigger("matchRequestStart"),Granify.touchSession(),t&&e&&Granify.clearCachedMatchingData();var n=!1;if(null==t){var a=Granify.getMatchingData(),i=Granify.itExists(a)&&Granify.itExists(a.cached_data)&&Granify.itExists(a.cached_data.session)&&a.cached_data.session==Granify.SESSION;if(Granify.itExists(a)&&Granify.itExists(a.cached_data)&&Granify.itExists(a.data)&&!1===Granify.cached_data_processing){if(i)return Granify.cached_data_processing=!0,void Granify.match_function().then((function(){return Granify.firstNonCachedRequest=!0,Granify.match_function(a.data)}));var o=a.cached_data.session||"MISSING";Granify.clearCachedMatchingData(),t=a.data,Granify.log("Granify: skipped sending cached data from old session. Cached session is: "+o+".")}else Granify.itExists(a)&&Granify.itExists(a.cached_data)&&!0===Granify.cached_data_processing?(t=a.cached_data,r()&&(t.mg=Granify.getGroupAlias(Granify.group)),n=!0):Granify.itExists(a)&&!Granify.itExists(a.cached_data)&&Granify.itExists(a.data)&&(t=a.data)}var s=[];return s.push(Granify.getSharedData(Granify.storage.ENTRY_PAGE)),s.push(Granify.getSharedData(Granify.storage.ENTRY_PAGE_SENT)),s.push(Granify.getSharedData(Granify.storage.ENTRY_REFERRER)),s.push(Granify.getSharedData(Granify.storage.ENTRY_REFERRER_SENT)),Granify.Promise.all(s).then((function(e){var r,a,i,o,s,c=e[0],u=e[1],f=e[2],l=e[3];(c&&!u&&(t.entry_page=c),f&&!l&&(t.entry_referrer=f),n)||(null!=(a=Granify._getForceMatchingCid())&&(t.force_matching=a),null!=(i=Granify._getAndClearResetSessionFlag())&&(t.reset_session=i));return null==Granify.current_time&&!1===Granify.cached_data_processing?Granify.current_time=t.start_time:!0===Granify.cached_data_processing?(Granify.current_time=parseInt(+(new Date).getTime()),Granify.nextMatchIsFirstNonCachedRequest=!0):0!=Granify.nextMatchIsFirstNonCachedRequest?(Granify.page_visit=0,Granify.start_time=+new Date,Granify.start_time_fixed=Granify.start_time,t.start_time=Granify.start_time_fixed,Granify.current_time=t.start_time,Granify.nextMatchIsFirstNonCachedRequest=!1):Granify.current_time=parseInt(+(new Date).getTime()),null!=t&&(t.current_time=Granify.current_time),null==Granify.timeSinceStart&&null!=("undefined"!==typeof performance&&null!==performance&&null!=(o=performance.timing)?o.navigationStart:void 0)&&(Granify.timeSinceStart=Granify.current_time-performance.timing.navigationStart,t.time_since_start=Granify.timeSinceStart),null==Granify.timeSinceDom&&null!=("undefined"!==typeof performance&&null!==performance&&null!=(s=performance.timing)?s.domLoading:void 0)&&(Granify.timeSinceDom=Granify.current_time-performance.timing.domLoading,t.time_since_dom=Granify.timeSinceDom),Granify.firstNonCachedRequest?(r=Granify.packObj(t),Granify.firstNonCachedRequest=!1):r=Granify.packObj(Granify.removeUnchangedData(t)),Granify.latency.mutex||(Granify.latency.last_request_sent=+new Date),new Granify.Promise((function(e,a){Granify.onNext("resolveMatchingResponsePromise",(function(t){Granify.events.rejectMatchingResponsePromise=void 0,e(t)})),Granify.onNext("rejectMatchingResponsePromise",(function(t){Granify.events.resolveMatchingResponsePromise=void 0,a(t)})),Granify.POST(Granify.matching+"/match",r,(function(e){Granify.match.handleMatchResponse(e,t,n)}))}))}))}Granify.match_timeout=setTimeout((function(){return Granify.track()}),1e3)}else Granify.match_timeout=setTimeout((function(){return Granify.track()}),100)},Granify.location=GLOBAL.location.href,Granify.startMatchRequests=Granify.throttle(Granify.match_function,Granify.tracking_wait_interval),Granify.addErrorHandling(Granify);var n=[];Granify._stack=Granify._stack||[];for(var a=0,i=Granify._stack.length;a<i;a++){var o=Granify._stack[a];if("error"===o[0]||"log_error"===o[0]){var s=o.shift();Granify[s].apply(null,o)}else n.push(o)}Granify._stack=n,Granify.use_iframe||Granify.use_local_storage||Granify.use_cookies?GRANIFY_CONFIG.shop_type!==Granify.constants.HYBRID_APP_SHOP_TYPE||Granify.StateAlreadyImported?Granify.start():Granify.readyToStart=!0:(Granify.log("Disabling Granify library, no storage option available"),Granify.enabled=!1,Granify.stop())}},function(t,e,r){"use strict";r.r(e);var n={};r.r(n),r.d(n,"example",(function(){return wn})),r.d(n,"shopify",(function(){return Ra})),r.d(n,"shopifyStorefront",(function(){return Di}));r(1),r(3),r(4),r(5),r(6),r(7),r(8),r(9),r(12),r(13);var a=r(0),i=r.n(a);function o(t,e){var r;if("undefined"===typeof Symbol||null==t[Symbol.iterator]){if(Array.isArray(t)||(r=function(t,e){if(!t)return;if("string"===typeof t)return s(t,e);var r=Object.prototype.toString.call(t).slice(8,-1);"Object"===r&&t.constructor&&(r=t.constructor.name);if("Map"===r||"Set"===r)return Array.from(t);if("Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return s(t,e)}(t))||e&&t&&"number"===typeof t.length){r&&(t=r);var n=0,a=function(){};return{s:a,n:function(){return n>=t.length?{done:!0}:{done:!1,value:t[n++]}},e:function(t){throw t},f:a}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var i,o=!0,c=!1;return{s:function(){r=t[Symbol.iterator]()},n:function(){var t=r.next();return o=t.done,t},e:function(t){c=!0,i=t},f:function(){try{o||null==r.return||r.return()}finally{if(c)throw i}}}}function s(t,e){(null==e||e>t.length)&&(e=t.length);for(var r=0,n=new Array(e);r<e;r++)n[r]=t[r];return n}function c(t,e,r,n,a,i,o){try{var s=t[i](o),c=s.value}catch(u){return void r(u)}s.done?e(c):Promise.resolve(c).then(n,a)}function u(t){return function(){var e=this,r=arguments;return new Promise((function(n,a){var i=t.apply(e,r);function o(t){c(i,n,a,o,s,"next",t)}function s(t){c(i,n,a,o,s,"throw",t)}o(void 0)}))}}Granify.createUUID=u(i.a.mark((function t(){var e,r,n,a,s;return i.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(!GRANIFY_CONFIG.uuidPath){t.next=14;break}return t.next=3,Granify.whenPropertyExists(window,GRANIFY_CONFIG.uuidPath);case 3:e=GRANIFY_CONFIG.uuidPath.split("."),r=GLOBAL,t.prev=5,n=o(e);try{for(n.s();!(a=n.n()).done;)s=a.value,r=r[s]}catch(i){n.e(i)}finally{n.f()}return Granify.wasUUIDCreated=!0,t.abrupt("return",Granify.uuidv5(r.toString(),"0e47003c-a9e4-4453-ae8d-dffc37375dc9"));case 12:t.prev=12,t.t0=t.catch(5);case 14:return Granify.wasUUIDCreated=!0,t.abrupt("return",Granify.uuid.v4());case 16:case"end":return t.stop()}}),t,null,[[5,12]])}))),Granify.initializeCookieUUID=u(i.a.mark((function t(){var e,r,n;return i.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(e=/(?:^|[; ])granify\.uuid=([^;]*)/,r=GLOBAL.document.cookie.match(e),n=r?r[1]:null,t.t0=n,t.t0){t.next=8;break}return t.next=7,Granify.createUUID();case 7:t.t0=t.sent;case 8:Granify.UUID=t.t0,Granify.setCookie("granify.uuid",Granify.UUID);case 10:case"end":return t.stop()}}),t)}))),Granify.initializeLocalStorageUUID=u(i.a.mark((function t(){var e,r,n,a,o;return i.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:e=null,r=null;try{(n=JSON.parse(window.localStorage.getItem("granify.uuid")))&&n.expires&&(r=n.expires,parseInt(r)>+new Date&&(e=n.data)),e||window.localStorage.removeItem("granify.uuid")}catch(i){}if(!e){t.next=6;break}Granify.UUID=e,t.next=10;break;case 6:return t.next=8,Granify.createUUID();case 8:Granify.UUID=t.sent;try{6307e7,a=Granify.getExpiry(6307e7),r=r||new Date(+new Date+a),o=JSON.stringify({expires:+r,data:Granify.UUID}),window.localStorage.setItem("granify.uuid",o)}catch(s){}case 10:case"end":return t.stop()}}),t)}))),Granify.initializeIframeUUID=u(i.a.mark((function t(){var e,r,n;return i.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,Granify.getSharedData(Granify.storage.UUID);case 2:if(!(e=t.sent)){t.next=7;break}Granify.UUID=e,t.next=11;break;case 7:return t.next=9,Granify.createUUID();case 9:Granify.UUID=t.sent;try{6307e7,r=Granify.getExpiry(6307e7),n=new Date(+new Date+r),Granify.setSharedData(Granify.storage.UUID,Granify.UUID,+n)}catch(a){}case 11:case"end":return t.stop()}}),t)}))),Granify.initializeUUID=function(){return Granify.use_cookies?Granify.initializeCookieUUID():Granify.use_local_storage&&!Granify.use_iframe?Granify.initializeLocalStorageUUID():Granify.use_iframe?Granify.initializeIframeUUID():void 0},window.GLOBAL=window,window.parent!=window&&document.getElementById("js-iframe-async")&&(window.GLOBAL=window.parent),GLOBAL.Granify&&GLOBAL.Granify.enabled?(window.Granify={},Granify.enabled=!1):(GLOBAL.Granify?window.Granify=GLOBAL.Granify:GLOBAL.Granify=window.Granify={},Granify.enabled=!0,Granify.stopped=!1,Granify.trackers=[],Granify.tracker_classes=[],Granify.wasUUIDCreated=!1,GRANIFY_CONFIG.cookies_domain&&GRANIFY_CONFIG.cookies_domain.trim().length>0&&"localhost"!==GRANIFY_CONFIG.cookies_domain?Granify.cookies_domain=window.localhostCookiesDomain||".".concat(GRANIFY_CONFIG.cookies_domain.trim()):Granify.cookies_domain="",Granify.determineStorageMethod(),Granify.use_iframe||(Granify.importState(),Granify.initializeUUID().catch((function(t){Granify.logCritical("Failed to prepare a session UUID",t)}))),function(){Granify.is_ie=!1;var t=window.navigator.userAgent,e=t.indexOf("MSIE "),r=t.indexOf("Trident/");if(e>0||r>0){var n;if(Granify.is_ie=!0,e>0)n=parseInt(t.substring(e+5,t.indexOf(".",e)),10);else{var a=t.indexOf("rv:");n=parseInt(t.substring(a+3,t.indexOf(".",a)),10)}n<9&&(Granify.enabled=!1)}}());r(15),r(16),r(17),r(18),r(19),r(20);Granify.strDiff=function(t,e){return t.length>e.length?t.replace(e,""):e.replace(t,"")};r(21),r(22),r(23),r(24),r(25),r(26);var f=function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:10;return new Promise((function(e){setTimeout(e,t)}))};function l(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}var y=new(function(){function t(){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t)}var e,r,n;return e=t,(r=[{key:"navigateWithURL",value:function(t){this.navigateWithCallback((function(){window.location.href=t}))}},{key:"navigateWithCallback",value:function(t){var e=Granify.getMatchingData();return f(10).then((function(){return Granify.match_function(e.data,!0)})).catch((function(t){Granify.logErrorOnce(t)})).finally(t)}}])&&l(e.prototype,r),n&&l(e,n),t}());Granify.navigateWithURL=y.navigateWithURL,Granify.navigateWithCallback=y.navigateWithCallback;r(27),r(28),r(29),r(30),r(31),r(32);function d(t,e,r,n,a,i,o){try{var s=t[i](o),c=s.value}catch(u){return void r(u)}s.done?e(c):Promise.resolve(c).then(n,a)}function p(t){return function(){var e=this,r=arguments;return new Promise((function(n,a){var i=t.apply(e,r);function o(t){d(i,n,a,o,s,"next",t)}function s(t){d(i,n,a,o,s,"throw",t)}o(void 0)}))}}function g(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}var h=function(){function t(){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t)}var e,r,n,a,o;return e=t,(r=[{key:"sendBeacon",value:(o=p(i.a.mark((function t(e){return i.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return this._validateRequest(e),this._url=e.url,this._data=e.data,t.abrupt("return",this._trySendBeacon());case 4:case"end":return t.stop()}}),t,this)}))),function(t){return o.apply(this,arguments)})},{key:"_trySendBeacon",value:(a=p(i.a.mark((function t(){var e,r,n,a;return i.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if("function"!==typeof(null===(e=window)||void 0===e||null===(r=e.navigator)||void 0===r?void 0:r.sendBeacon)||"function"!==typeof(null===(n=window)||void 0===n?void 0:n.Blob)){t.next=10;break}if(a=new window.Blob([JSON.stringify(this._data)],{type:"text/plain"}),t.prev=2,!window.navigator.sendBeacon(this._url,a)){t.next=5;break}return t.abrupt("return",this._data);case 5:t.next=10;break;case 7:t.prev=7,t.t0=t.catch(2),Granify.logDebug("Failed to send a Beacon with latest metrics",this._data);case 10:return t.abrupt("return",this._trySendFetch());case 11:case"end":return t.stop()}}),t,this,[[2,7]])}))),function(){return a.apply(this,arguments)})},{key:"_trySendFetch",value:function(){return fetch(this._url,{method:"post",headers:{"Content-Type":"text/plain"},body:JSON.stringify(this._data),keepalive:!0})}},{key:"_validateRequest",value:function(t){["url","data"].forEach((function(e){if(Object.is(t[e],void 0))throw new TypeError("Missing ".concat(e," for RequestBeacon"))}))}}])&&g(e.prototype,r),n&&g(e,n),t}();function m(t,e,r,n,a,i,o){try{var s=t[i](o),c=s.value}catch(u){return void r(u)}s.done?e(c):Promise.resolve(c).then(n,a)}function G(t){return function(){var e=this,r=arguments;return new Promise((function(n,a){var i=t.apply(e,r);function o(t){m(i,n,a,o,s,"next",t)}function s(t){m(i,n,a,o,s,"throw",t)}o(void 0)}))}}function _(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}var v=function(){function t(){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this.WAIT_TIME=200}var e,r,n,a,o,s;return e=t,(r=[{key:"makeRequest",value:(s=G(i.a.mark((function t(e){return i.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return this._validateRequest(e),this._url=e.url,this._data=e.data,this._method=e.method||"GET",this._numberOfRetries=e.numberOfRetries||1,this._contentType=e.contentType||"application/json",this._currentTries=0,t.abrupt("return",this._tryMakeRequest());case 7:case"end":return t.stop()}}),t,this)}))),function(t){return s.apply(this,arguments)})},{key:"_sleep",value:function(t){return new Promise((function(e){setTimeout((function(){e()}),t)}))}},{key:"_tryMakeRequest",value:(o=G(i.a.mark((function t(){var e,r;return i.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(!(this._currentTries<this._numberOfRetries)){t.next=22;break}return t.prev=1,t.next=4,this._doRequest();case 4:if(!(r=t.sent).ok){t.next=8;break}return Granify.logDebug("Request Retry Successful Response:",r.json()),t.abrupt("break",22);case 8:t.next=13;break;case 10:t.prev=10,t.t0=t.catch(1),e=t.t0;case 13:if(this._currentTries++,!(this._currentTries>=this._numberOfRetries)){t.next=17;break}throw Granify.logDebug("Reached the Maximum Number of retries(".concat(this._numberOfRetries,") for request: ").concat(this._url),this._data),e;case 17:return Granify.logDebug("Request Retry Failed, sleeping and trying again. Current Retry Count: ".concat(this._currentTries),this._data),t.next=20,this._sleep(this.WAIT_TIME*Math.pow(2,this._currentTries));case 20:t.next=0;break;case 22:return t.abrupt("return",this._data);case 23:case"end":return t.stop()}}),t,this,[[1,10]])}))),function(){return o.apply(this,arguments)})},{key:"_doRequest",value:(a=G(i.a.mark((function t(){return i.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,fetch(this._url,{method:this._method,cache:"no-cache",headers:{"Content-Type":this._contentType},body:JSON.stringify(this._data)}).catch((function(t){Granify.logErrorOnce("Request Retry Error: ".concat(t))}));case 2:return t.abrupt("return",t.sent);case 3:case"end":return t.stop()}}),t,this)}))),function(){return a.apply(this,arguments)})},{key:"_validateRequest",value:function(t){["url","data"].forEach((function(e){if(Object.is(t[e],void 0))throw new TypeError("Missing ".concat(e," for RequestRetry"))}))}}])&&_(e.prototype,r),n&&_(e,n),t}();function b(t,e,r,n,a,i,o){try{var s=t[i](o),c=s.value}catch(u){return void r(u)}s.done?e(c):Promise.resolve(c).then(n,a)}function E(t){return function(){var e=this,r=arguments;return new Promise((function(n,a){var i=t.apply(e,r);function o(t){b(i,n,a,o,s,"next",t)}function s(t){b(i,n,a,o,s,"throw",t)}o(void 0)}))}}function w(t,e){var r;if("undefined"===typeof Symbol||null==t[Symbol.iterator]){if(Array.isArray(t)||(r=function(t,e){if(!t)return;if("string"===typeof t)return S(t,e);var r=Object.prototype.toString.call(t).slice(8,-1);"Object"===r&&t.constructor&&(r=t.constructor.name);if("Map"===r||"Set"===r)return Array.from(t);if("Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return S(t,e)}(t))||e&&t&&"number"===typeof t.length){r&&(t=r);var n=0,a=function(){};return{s:a,n:function(){return n>=t.length?{done:!0}:{done:!1,value:t[n++]}},e:function(t){throw t},f:a}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var i,o=!0,s=!1;return{s:function(){r=t[Symbol.iterator]()},n:function(){var t=r.next();return o=t.done,t},e:function(t){s=!0,i=t},f:function(){try{o||null==r.return||r.return()}finally{if(s)throw i}}}}function S(t,e){(null==e||e>t.length)&&(e=t.length);for(var r=0,n=new Array(e);r<e;r++)n[r]=t[r];return n}function A(t,e,r){return e in t?Object.defineProperty(t,e,{value:r,enumerable:!0,configurable:!0,writable:!0}):t[e]=r,t}function k(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}var O=function(){function t(e){var r;!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this.COUNT="c",this.COUNT_ONCE="co",this.BASE_METRIC_NAME="js.{site_id}.",this.BATCH_INTERVAL=GRANIFY_CONFIG.metrics_batch_interval||1e3,this.BATCH_WHITELIST=GRANIFY_CONFIG.metrics_batch_whitelist||[],this.batchTimeout=null,this.sending=!1,this.metricsToSend=(A(r={},this.COUNT,{}),A(r,this.COUNT_ONCE,{}),r),this._url=e,this._siteCanSendMetrics()&&this._setupBatchTriggers()}var e,r,n,a,o,s,c,u;return e=t,(r=[{key:"count",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1;this._count(t,e,this.COUNT)}},{key:"countOnce",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1;this._count(t,e,this.COUNT_ONCE)}},{key:"flush",value:function(){return this._flushBatch(this._sendRequest.bind(this))}},{key:"_count",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:this.COUNT;if(this._siteCanSendMetrics()){var n=this.BASE_METRIC_NAME+t;this.metricsToSend[r][n]=(this.metricsToSend[r][n]||0)+e,this._flushIfWhitelisted(t)}}},{key:"_siteCanSendMetrics",value:function(){return GRANIFY_CONFIG.metrics_enabled}},{key:"_setupBatchTriggers",value:function(){var t=this;this._resetTimeoutTrigger(),document.addEventListener("visibilitychange",(function(){"hidden"===document.visibilityState&&t._closeHandler()}),{capture:!0}),"onpagehide"in window?window.addEventListener("pagehide",this._closeHandler.bind(this),{capture:!0}):(window.addEventListener("unload",this._closeHandler.bind(this),{capture:!0}),window.addEventListener("beforeunload",this._closeHandler.bind(this),{capture:!0}))}},{key:"_resetTimeoutTrigger",value:function(){clearTimeout(this.batchTimeout),this.batchTimeout=setTimeout(this._timeoutHandler.bind(this),this.BATCH_INTERVAL)}},{key:"_flushIfWhitelisted",value:function(t){var e,r=w(this.BATCH_WHITELIST);try{for(r.s();!(e=r.n()).done;){var n=e.value;if("string"===typeof n&&t===n)return this._flushBatch(this._sendRequest.bind(this));if(n instanceof RegExp&&n.test(t))return this._flushBatch(this._sendRequest.bind(this))}}catch(a){r.e(a)}finally{r.f()}}},{key:"_timeoutHandler",value:(u=E(i.a.mark((function t(){return i.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,this._flushBatch(this._sendRequest.bind(this));case 2:this._resetTimeoutTrigger();case 3:case"end":return t.stop()}}),t,this)}))),function(){return u.apply(this,arguments)})},{key:"_closeHandler",value:(c=E(i.a.mark((function t(){return i.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.abrupt("return",this._flushBatch(this._sendBeacon.bind(this)));case 1:case"end":return t.stop()}}),t,this)}))),function(){return c.apply(this,arguments)})},{key:"_flushBatch",value:(s=E(i.a.mark((function t(e){var r,n;return i.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(!this.sending){t.next=2;break}return t.abrupt("return");case 2:if(this.sending=!0,r=this._getBatchData()){t.next=7;break}return this.sending=!1,t.abrupt("return");case 7:return t.prev=7,n=this._formatMetricRequestData(r),t.next=11,e(n);case 11:t.next=17;break;case 13:t.prev=13,t.t0=t.catch(7),this._rebatchData(r),Granify.logError("Failed to send latest batch of metrics: ".concat(t.t0));case 17:return t.prev=17,this.sending=!1,t.finish(17);case 20:case"end":return t.stop()}}),t,this,[[7,13,17,20]])}))),function(t){return s.apply(this,arguments)})},{key:"_getBatchData",value:function(){var t=A({},this.COUNT,this.metricsToSend[this.COUNT]);return this.metricsToSend[this.COUNT]={},this._hasSession()?(t[this.COUNT_ONCE]=this.metricsToSend[this.COUNT_ONCE],this.metricsToSend[this.COUNT_ONCE]={}):t[this.COUNT_ONCE]={},(0!==Object.keys(t[this.COUNT]).length||0!==Object.keys(t[this.COUNT_ONCE]).length)&&t}},{key:"_formatMetricRequestData",value:function(t){return JSON.parse(JSON.stringify({mt:t,sid:GRANIFY_CONFIG.SHOP_ID,csid:Granify.CHILD_SITE_ID,uuid:Granify.UUID||""}))}},{key:"_hasSession",value:function(){return Granify.SERVER_SESSION_ID&&-1!==Granify.SERVER_SESSION_ID}},{key:"_rebatchData",value:function(t){for(var e in t[this.COUNT])t[this.COUNT].hasOwnProperty(e)&&this.count(e.substring(this.BASE_METRIC_NAME.length),t[this.COUNT][e]);for(var r in t[this.COUNT_ONCE])t[this.COUNT_ONCE].hasOwnProperty(r)&&this.countOnce(r.substring(this.BASE_METRIC_NAME.length),t[this.COUNT_ONCE][r])}},{key:"_sendRequest",value:(o=E(i.a.mark((function t(e){var r;return i.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,(new v).makeRequest({url:"".concat(this._url,"/metric"),data:e,method:"POST",numberOfRetries:5,contentType:"text/plain"});case 2:r=t.sent,Granify.logDebug("Metrics sent:",r);case 4:case"end":return t.stop()}}),t,this)}))),function(t){return o.apply(this,arguments)})},{key:"_sendBeacon",value:(a=E(i.a.mark((function t(e){var r;return i.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,(new h).sendBeacon({url:"".concat(this._url,"/metric"),data:e});case 2:r=t.sent,Granify.logDebug("Metrics sent:",r);case 4:case"end":return t.stop()}}),t,this)}))),function(t){return a.apply(this,arguments)})}])&&k(e.prototype,r),n&&k(e,n),t}();Granify.metrics=new O(Granify.rb.matching_host);r(33),r(34);function T(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}var C=function(){function t(){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this.initialize(),this.start()}var e,r,n;return e=t,(r=[{key:"initialize",value:function(){}},{key:"start",value:function(){}},{key:"stop",value:function(){}},{key:"reset",value:function(){}},{key:"getData",value:function(){return{}}}])&&T(e.prototype,r),n&&T(e,n),t}();function I(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}function D(t,e){return(D=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t})(t,e)}function P(t){var e=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(t){return!1}}();return function(){var r,n=R(t);if(e){var a=R(this).constructor;r=Reflect.construct(n,arguments,a)}else r=n.apply(this,arguments);return N(this,r)}}function N(t,e){return!e||"object"!==typeof e&&"function"!==typeof e?function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t):e}function R(t){return(R=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}var x=function(t){!function(t,e){if("function"!==typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&D(t,e)}(i,t);var e,r,n,a=P(i);function i(){return function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,i),a.call(this)}return e=i,(r=[{key:"initialize",value:function(){this.hidden="",this.visibilityChange=""}},{key:"start",value:function(){try{return this.reset(),Granify.itExists(GLOBAL.document.hidden)?(this.hidden="hidden",this.visibilityChange="visibilitychange"):Granify.itExists(GLOBAL.document.mozHidden)?(this.hidden="mozHidden",this.visibilityChange="mozvisibilitychange"):Granify.itExists(GLOBAL.document.msHidden)?(this.hidden="msHidden",this.visibilityChange="msvisibilitychange"):Granify.itExists(GLOBAL.document.webkitHidden)&&(this.hidden="webkitHidden",this.visibilityChange="webkitvisibilitychange"),Granify.addGranifyListener(GLOBAL.document,this.visibilityChange,this.handler.bind(this))}catch(t){return Granify.error(t,"browserTracker-start")}}},{key:"handler",value:function(){try{if(Granify.stopped)return;return GLOBAL.document[this.hidden]?(Granify.tab_changes+=1,Granify.page_visit+=((new Date).getTime()-Granify.start_time)/1e3):Granify.start_time=(new Date).getTime()}catch(t){return Granify.error(t,"handleVisibilityChange")}}},{key:"stop",value:function(){try{return Granify.removeGranifyListener(GLOBAL.document,this.visibilityChange,this.handler)}catch(t){return Granify.error(t,"browserTracker-stop")}}},{key:"getReferrer",value:function(){var t=GLOBAL.document;if(t&&Granify.itExists(t.referrer))return decodeURI(t.referrer).replace(/https?:\/\//,"");Granify.logError("Unable to determine referrer, GLOBAL.document.referrer is falsey")}},{key:"getData",value:function(){try{Granify.referrer=Granify.referrer||this.getReferrer();var t=GLOBAL.location.toString().replace(GLOBAL.location.origin,"");return{tab_changes:Granify.tab_changes||0,viewport:JSON.stringify({h:Math.max(GLOBAL.document.documentElement.clientHeight,GLOBAL.innerHeight||0),w:Math.max(GLOBAL.document.documentElement.clientWidth,GLOBAL.innerWidth||0)}),timezone:Granify.getTimezone(),referer:Granify.referrer,path:t}}catch(e){return Granify.error(e,"browserTracker-getData")}}},{key:"reset",value:function(){Granify.tab_changes=0}}])&&I(e.prototype,r),n&&I(e,n),i}(C);function L(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}function j(t,e){return(j=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t})(t,e)}function F(t){var e=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(t){return!1}}();return function(){var r,n=M(t);if(e){var a=M(this).constructor;r=Reflect.construct(n,arguments,a)}else r=n.apply(this,arguments);return U(this,r)}}function U(t,e){return!e||"object"!==typeof e&&"function"!==typeof e?function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t):e}function M(t){return(M=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}var B=function(t){!function(t,e){if("function"!==typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&j(t,e)}(i,t);var e,r,n,a=F(i);function i(){var t;return function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,i),(t=a.call(this)).handlerKeyboard=Granify.throttle((function(){Granify.idle_time=0}),100),t}return e=i,(r=[{key:"start",value:function(){try{Granify.addGranifyListener(GLOBAL,"keyup",this.handlerKeyboard)}catch(t){Granify.error(t,"keyboardTracker-start")}}},{key:"stop",value:function(){try{Granify.removeGranifyListener(GLOBAL,"keyup",this.handlerKeyboard)}catch(t){Granify.error(t,"keyboardTracker-stop")}}}])&&L(e.prototype,r),n&&L(e,n),i}(C);function H(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}function V(t,e){return(V=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t})(t,e)}function W(t){var e=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(t){return!1}}();return function(){var r,n=q(t);if(e){var a=q(this).constructor;r=Reflect.construct(n,arguments,a)}else r=n.apply(this,arguments);return Y(this,r)}}function Y(t,e){return!e||"object"!==typeof e&&"function"!==typeof e?function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t):e}function q(t){return(q=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}var z=function(t){!function(t,e){if("function"!==typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&V(t,e)}(i,t);var e,r,n,a=W(i);function i(){return function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,i),a.call(this)}return e=i,(r=[{key:"initialize",value:function(){this.throttledHandleScroll=Granify.throttle(this.handleScroll,100),this.throttledGetMouseStats=Granify.throttle(this.getMouseStats,100),this.throttledHandleMouseContext=Granify.throttle(this.handleMouseContext,100),this.throttledHandleTouchContext=Granify.throttle(this.handleTouchContext,100)}},{key:"handleScroll",value:function(){if(!Granify.stopped&&null!=GLOBAL.document.body){var t=GLOBAL.document.documentElement&&GLOBAL.document.documentElement.scrollTop||GLOBAL.document.body.scrollTop;Granify.scroll_distance+=Math.abs(Granify.prev_scroll_top-t),Granify.prev_scroll_top=t;var e=(t+GLOBAL.innerHeight)/Granify.getDocumentHeight()*100;return e=Granify.round(e),Granify.scroll_depth=e>Granify.scroll_depth?e:Granify.scroll_depth,Granify.idle_time=0,Granify.lastScroll=new Date}}},{key:"handleStats",value:function(t){if(!Granify.stopped)try{return this.blockTime(),this.getMouseStats(t.pageX||t.clientX,t.pageY||t.clientY)}catch(e){return t=e,Granify.error(t,"getMouseStats")}}},{key:"getMouseStats",value:function(t,e){var r=t-Granify.prev_mouse_pos.x,n=e-Granify.prev_mouse_pos.y;Granify.mouse_distance+=Math.sqrt(r*r+n*n);var a=Granify.getDocumentWidth()/2,i=Math.floor(Math.abs(a-t)/50),o=Math.floor(e/50),s=(t<a?"L":"R")+i.toString()+"x"+o.toString();null==Granify.mouse_heatmap[s]&&(Granify.mouse_heatmap[s]={},Granify.mouse_heatmap[s].t=0,Granify.mouse_heatmap[s].d=0,Granify.mouse_heatmap[s].c=0);var c=Math.sqrt(r*r+n*n),u=10*c,f=(u-Granify.prev_mouse_pos.s)/10;if(isNaN(u)&&(u=0),isNaN(f)&&(f=0),Granify.mouse_heatmap[s].d+=c,Granify.mouse_heatmap[s].s=u,Granify.mouse_heatmap[s].a=f,Granify.prev_mouse_pos={x:t,y:e,s:Granify.mouse_heatmap[s].s,a:Granify.mouse_heatmap[s].a,block:s},Granify.idle_time=0,GLOBAL.document.body&&(Granify.scrollTop=GLOBAL.document.body.scrollTop||GLOBAL.document.documentElement.scrollTop,t<a-350&&e-Granify.scrollTop<50))return Granify.mouse_heatmap[s].e=1}},{key:"handleMouseContext",value:function(t){if(!Granify.stopped){var e=t.type,r=t.target||t.srcElement,n=t.pageX||t.clientX,a=t.pageY||t.clientY;try{this.getMouseContext(e,r,n,a)}catch(i){Granify.error(i,"mouse_context")}}}},{key:"handleTouchContext",value:function(t){if(!Granify.stopped){var e=t.type,r=t.target||t.srcElement;try{this.getTouchContext(e,r)}catch(n){Granify.error(n,"touch_context")}}}},{key:"handleMouseClick",value:function(t){this.handleMouseContext(t)}},{key:"getMouseContext",value:function(t,e){var r,n,a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,o=["B","P","STRONG","DIV","SPAN","I","EM","LI"],s=e.tagName;switch(t){case"click":r="click",n=1;break;case"mouseover":Granify.event_start_time=(new Date).getTime(),r="over",n=1;break;case"mouseout":r="time",n=Granify.event_start_time?((new Date).getTime()-Granify.event_start_time)/1e3:0;break;default:r="selection"}if(Granify.mouse_stats||(Granify.mouse_stats={clicks:[]}),"selection"===r&&null!=GLOBAL.getSelection&&""!==this.getSelectionHTML()&&(Granify.mouse_stats.selections+=1),"click"===r){var c={};c.path=Granify.createXPathFromElement(e),c.id=e.id,c.class_name=e.className,c.time=Granify.round((new Date).getTime()/1e3),c.x=parseInt(a),c.y=parseInt(i),"A"!==s&&"BUTTON"!==s&&("INPUT"!==s||"SUBMIT"!==e.type.toUpperCase()&&"BUTTON"!==e.type.toUpperCase())||(c.text=e.innerText),Granify.mouse_stats.clicks.push(c);var u=Granify.prev_mouse_pos.block;if(u&&""!==u&&Granify.mouse_heatmap&&Granify.mouse_heatmap[u]){var f=Granify.mouse_heatmap[u];f.c=(f.c||0)+1}}return Granify.mouse_stats[r]||(Granify.mouse_stats[r]={links:0,text:0,images:0,buttons:0,other:0}),"A"===s?Granify.mouse_stats[r].links+=n:o.includes(s)&&e.children&&0===e.children.length&&""!==e.innerText?Granify.mouse_stats[r].text+=n:"IMG"===s?Granify.mouse_stats[r].images+=n:"BUTTON"===s||"INPUT"===s&&("SUBMIT"===e.type.toUpperCase()||"BUTTON"===e.type.toUpperCase())?Granify.mouse_stats[r].buttons+=n:Granify.mouse_stats[r].other+=n}},{key:"getTouchContext",value:function(t,e){var r,n,a,i=["IMG"],o=Granify.clientImageElements?i.concat(Granify.clientImageElements):i,s=null===(r=e.tagName)||void 0===r?void 0:r.toUpperCase();switch(t){case"touchstart":Granify.touch_start_time||(Granify.touch_start_time=(new Date).getTime()),n="touchstart",a=1;break;case"touchend":n="touchtime",a=Granify.touch_start_time?((new Date).getTime()-Granify.touch_start_time)/1e3:0;break;default:return}return Granify.mouse_stats||(Granify.mouse_stats={clicks:[]}),Granify.mouse_stats[n]||(Granify.mouse_stats[n]={links:0,text:0,images:0,buttons:0,other:0}),"A"===s?Granify.mouse_stats[n].links+=a:["B","P","STRONG","DIV","SPAN","I","EM","LI"].includes(s)&&e.children&&0===e.children.length&&""!==e.innerText?Granify.mouse_stats[n].text+=a:o.includes(s)&&("DIV"!==e||e.querySelector("img"))?Granify.mouse_stats[n].images+=a:"BUTTON"===s||"INPUT"===s&&("SUBMIT"===e.type.toUpperCase()||"BUTTON"===e.type.toUpperCase())?Granify.mouse_stats[n].buttons+=a:Granify.mouse_stats[n].other+=a}},{key:"blockTime",value:function(){var t=Granify.getDocumentWidth()/2,e=Math.floor(Math.abs(t-Granify.prev_mouse_pos.x)/50),r=Math.floor(Granify.prev_mouse_pos.y/50),n=(Granify.prev_mouse_pos.x<t?"L":"R")+e.toString()+"x"+r.toString();return null==Granify.mouse_heatmap[n]&&(Granify.mouse_heatmap[n]={},Granify.mouse_heatmap[n].t=0,Granify.mouse_heatmap[n].d=0),Granify.tracking_stopped||(Granify.mouse_heatmap[n].t+=(new Date-Granify.lastBlockTrack)/1e3),Granify.lastBlockTrack=new Date}},{key:"getSelectionHTML",value:function(){try{var t="";if(null!=GLOBAL.getSelection){var e=GLOBAL.getSelection();if(e.rangeCount){for(var r=GLOBAL.document.createElement("div"),n=0;n<e.rangeCount;n++)r.appendChild(e.getRangeAt(n).cloneContents());t=r.innerHTML}}else null!=GLOBAL.document.selection&&"Text"===GLOBAL.document.selection.type&&(t=GLOBAL.document.selection.createRange().htmlText);return t}catch(a){return""}}},{key:"handleMouseCopy",value:function(){if(!Granify.stopped)try{if(GLOBAL.document.getSelection){var t={text:GLOBAL.document.getSelection().toString().replace(/[\"\\\']/gi,"").substring(0,140),orig_length:GLOBAL.document.getSelection().toString().length};return Granify.mouse_stats.copied_text.push(t)}}catch(e){return Granify.error(e,"getMouseCopy")}}},{key:"start",value:function(){try{this.reset(),Granify.lastBlockTrack=new Date,Granify.addGranifyListener(GLOBAL.document,"mousemove",this.handleStats.bind(this));for(var t=0,e=["mouseover","mouseout","mouseup"];t<e.length;t++){var r=e[t];Granify.addGranifyListener(GLOBAL,r,this.throttledHandleMouseContext.bind(this))}for(var n=0,a=["touchstart","touchend"];n<a.length;n++){var i=a[n];Granify.addGranifyListener(GLOBAL,i,this.throttledHandleTouchContext.bind(this))}Granify.addGranifyListener(GLOBAL,"click",this.handleMouseClick.bind(this)),Granify.addGranifyListener(GLOBAL,"scroll",this.throttledHandleScroll.bind(this)),Granify.addGranifyListener(GLOBAL,"copy",this.handleMouseCopy.bind(this))}catch(o){Granify.error(o,"mouseTracker-start")}}},{key:"stop",value:function(){try{Granify.removeGranifyListener(GLOBAL.document,"mousemove",this.handleStats);for(var t=0,e=["mouseover","mouseout","mouseup"];t<e.length;t++){var r=e[t];Granify.removeGranifyListener(GLOBAL,r,this.throttledHandleMouseContext)}for(var n=0,a=["touchstart","touchend"];n<a.length;n++){var i=a[n];Granify.removeGranifyListener(GLOBAL,i,this.throttledHandleTouchContext)}return Granify.removeGranifyListener(GLOBAL,"click",this.handleMouseClick),Granify.removeGranifyListener(GLOBAL,"scroll",this.throttledHandleScroll),Granify.removeGranifyListener(GLOBAL,"copy",this.handleMouseCopy)}catch(o){return Granify.error(o,"mouseTracker-stop")}}},{key:"reset",value:function(){Granify.scroll_distance=0,Granify.scroll_depth=0,Granify.prev_scroll_top=0,Granify.mouse_distance=0,Granify.prev_mouse_pos={x:0,y:0,s:Granify.prev_mouse_pos&&Granify.prev_mouse_pos.s||0,a:Granify.prev_mouse_pos&&Granify.prev_mouse_pos.a||0},Granify.mouse_heatmap={},Granify.mouse_stats={},Granify.mouse_stats.selections=0;for(var t=0,e=["over","click","time","touchstart","touchtime"];t<e.length;t++){var r=e[t];Granify.mouse_stats[r]={};for(var n=0,a=["text","links","images","buttons","other"];n<a.length;n++){var i=a[n];Granify.mouse_stats[r][i]=0}}Granify.mouse_stats.copied_text=[],Granify.mouse_stats.clicks=[]}},{key:"getData",value:function(){try{return{mouse_distance:null!=Granify.mouse_distance?Granify.round(Granify.mouse_distance):0,scroll_distance:Granify.scroll_distance||0,scroll_depth:Granify.scroll_depth||0,mouse_heatmap:JSON.stringify(Granify.compact_object(Granify.reduce_precision(Granify.mouse_heatmap)))||"{}",mouse_stats:JSON.stringify(Granify.compact_object(Granify.reduce_ms_precision(Granify.mouse_stats)))||"{}",scroll_top:Granify.prev_scroll_top||0}}catch(t){return Granify.error(t,"mouseTracker-getData"),{}}}},{key:"initializeData",value:function(){Granify.mouse_heatmap={},Granify.mouse_stats.clicks=[]}}])&&H(e.prototype,r),n&&H(e,n),i}(C);function K(t,e,r,n,a,i,o){try{var s=t[i](o),c=s.value}catch(u){return void r(u)}s.done?e(c):Promise.resolve(c).then(n,a)}function J(t,e){var r;if("undefined"===typeof Symbol||null==t[Symbol.iterator]){if(Array.isArray(t)||(r=function(t,e){if(!t)return;if("string"===typeof t)return X(t,e);var r=Object.prototype.toString.call(t).slice(8,-1);"Object"===r&&t.constructor&&(r=t.constructor.name);if("Map"===r||"Set"===r)return Array.from(t);if("Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return X(t,e)}(t))||e&&t&&"number"===typeof t.length){r&&(t=r);var n=0,a=function(){};return{s:a,n:function(){return n>=t.length?{done:!0}:{done:!1,value:t[n++]}},e:function(t){throw t},f:a}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var i,o=!0,s=!1;return{s:function(){r=t[Symbol.iterator]()},n:function(){var t=r.next();return o=t.done,t},e:function(t){s=!0,i=t},f:function(){try{o||null==r.return||r.return()}finally{if(s)throw i}}}}function X(t,e){(null==e||e>t.length)&&(e=t.length);for(var r=0,n=new Array(e);r<e;r++)n[r]=t[r];return n}if(Granify.reduce_precision=function(t){for(var e={},r=0,n=Object.keys(t);r<n.length;r++){var a=n[r],i=t[a];e[a]={d:Granify.round(i.d),t:Granify.round(i.t),s:Granify.round(i.s),a:Granify.round(i.a),c:Granify.round(i.c)},null!=i.e&&(e[a].e=i.e)}return e},Granify.reduce_ms_precision=function(t){var e;e=Granify.isArray(t)?[]:{};for(var r=0,n=Object.keys(t);r<n.length;r++){var a=n[r],i=t[a];if("object"!==typeof i||Granify.isArray(i))e[a]=i;else{e[a]={};for(var o=0,s=Object.keys(i);o<s.length;o++){var c=s[o],u=i[c];isNaN(u)&&(u=0),e[a][c]=parseFloat(Granify.round(u))}}}return e},Granify.enabled&&Granify.tracker_classes.push(x,B,z),Granify.enabled){Granify.getGaAttributes=function(){try{var t,e=new RegExp("(?:^|\\W)__utmz=([^;]*)","g").exec(GLOBAL.document.cookie);if(e&&(t=decodeURI(e[1])),t&&t.length>0){var r,n={},a=J(t.split(".").slice(4).join(".").split("|"));try{for(a.s();!(r=a.n()).done;){var i=r.value.split("=");n[i[0]]=i[1],null!=n[i[0]]&&(n[i[0]]=n[i[0]].replace(/\(/,""),n[i[0]]=n[i[0]].replace(/\)/,""))}}catch(s){a.e(s)}finally{a.f()}var o={};return n.utmcmd&&(o.medium=n.utmcmd),n.utmcsr&&(o.source=n.utmcsr),n.utmcct&&(o.content=n.utmcct.replace(/\t|\r|\n/gm,"")),n.utmccn&&(o.campaign=n.utmccn),n.utmctr&&(o.term=n.utmctr.replace(/\t|\r|\n/gm,"")),o}return{}}catch(s){return Granify.error(s,"getGaAttributes")}},Granify.shouldTrackGa=function(){return Granify.analyticsID.length>0},Granify.loadGaTracking=function(){if(!window.granifyGA&&Granify.shouldTrackGa()){var t=GLOBAL.GoogleAnalyticsObject;t&&GLOBAL[t]&&Granify.isFunction(GLOBAL[t])?window.granifyGA=GLOBAL[t]:function(t,e,r,n,a,i,o){t.GoogleAnalyticsObject=a,t[a]=t[a]||function(){(t[a].q=t[a].q||[]).push(arguments)},t[a].l=1*new Date,i=e.createElement(r),o=e.getElementsByTagName(r)[0],i.async=1,i.src=n,o.parentNode.insertBefore(i,o)}(window,document,"script","//www.google-analytics.com/analytics.js","granifyGA");for(var e=Granify.analyticsID,r=[],n=0;n<e.length;n++){var a=e[n];r.push(window.granifyGA("create",a[0],{name:"granifyTracker"+n}))}return r}},Granify.trackGaEvent=function(t,e,r){if(Granify.shouldTrackGa()){"undefined"!==typeof granifyGA&&null!==window.granifyGA||Granify.loadGaTracking();for(var n=[],a=0;a<Granify.analyticsID.length;a++){var i=Granify.analyticsID[a],o=i[1],s=i[2];if(("customer"!==t||s)&&("message"!==t||"control-group"!==e||o)){var c={};i[4]&&(c.nonInteraction=1),n.push(window.granifyGA("granifyTracker"+a+".send","event",t,e,r,c))}}return n}},Granify.sendGaGroup=function(){var t,e=(t=i.a.mark((function t(e){return i.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,Granify.getSharedData(Granify.storage.GA_GROUP);case 2:if(t.sent){t.next=6;break}return Granify.trackGaEvent("customer","group",e),t.abrupt("return",Granify.setSharedData(Granify.storage.GA_GROUP,"1"));case 6:case"end":return t.stop()}}),t)})),function(){var e=this,r=arguments;return new Promise((function(n,a){var i=t.apply(e,r);function o(t){K(i,n,a,o,s,"next",t)}function s(t){K(i,n,a,o,s,"throw",t)}o(void 0)}))});return function(t){return e.apply(this,arguments)}}(),Granify.sendGaOrder=function(t){if(Granify.shouldTrackGa()){"undefined"!==typeof window.granifyGA&&null!==window.granifyGA||Granify.loadGaTracking();var e=(t.total_price||0)-(t.subtotal_price||0)-(t.total_tax||0);e<0&&(function(t){throw new Error('"'+t+'" is read-only')}("shipping"),e=0);for(var r=[],n=0;n<Granify.analyticsID.length;n++){if(Granify.analyticsID[n][3]){if(window.granifyGA("granifyTracker"+n+".require","ecommerce","ecommerce.js"),window.granifyGA("granifyTracker"+n+".ecommerce:addTransaction",{id:String(t.order_number),affiliation:String(Granify.SHOP_ID),revenue:String(t.subtotal_price||0),shipping:String(e),tax:String(t.total_tax||0),currency:t.currency||"USD"}),t.line_items){var a,i=J(t.line_items);try{for(i.s();!(a=i.n()).done;){var o=a.value;window.granifyGA("granifyTracker"+n+".ecommerce:addItem",{id:String(t.order_number),name:String(o.name),sku:String(o.product_id),category:"General",price:String(o.price||0),quantity:String(o.quantity||0),currency:t.currency||"USD"})}}catch(s){i.e(s)}finally{i.f()}}r.push(window.granifyGA("granifyTracker"+n+".ecommerce:send"))}}return r}},Granify.shouldTrackGaOnServerSide=function(){return!!Granify.shouldTrackGa()&&Granify.rb.server_ga_stores.includes(Number(Granify.SHOP_ID))},Granify.on("offer:shown",(function(){var t=Granify.old_offer;if(Granify.log("trackGaEvent offer:shown "+t.id+":"+t.experiment),!Granify.previewMode&&!Granify.previewModeWithMatching)return Granify.trackGaEvent("message","shown",t.id+":"+t.experiment)})),Granify.onAll("multimatch:shown",(function(){var t=this.options;if(Granify.log("trackGaEvent multimatch:shown "+t.id+":"+t.experiment),!Granify.previewMode&&!Granify.previewModeWithMatching)return Granify.trackGaEvent("message","shown",t.id+":"+t.experiment)})),Granify.on("control_group",(function(){return Granify.getSharedData(Granify.storage.GA_CONTROL_GROUP).then((function(t){if(!t)return Granify.trackGaEvent("message","control-group","not-shown"),Granify.setSharedData(Granify.storage.GA_CONTROL_GROUP,"1")}))}))}r(35),r(36);var Q={ADD_TO_CART:"ADD_TO_CART",TRACK_CART:"TRACK_CART",TRACK_PAGE_VIEW:"TRACK_PAGE_VIEW",TRACK_PRODUCT:"TRACK_PRODUCT",TRACK_WISHLIST:"TRACK_WISHLIST",SCRIPT_LOAD:"SCRIPT_LOAD",SET_CURRENT_PRODUCT:"SET_CURRENT_PRODUCT"};function $(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}var Z=function(){function t(){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this.clearHistory()}var e,r,n;return e=t,(r=[{key:"clearHistory",value:function(){this._history={};for(var t=0,e=Object.values(Q);t<e.length;t++){var r=e[t];this._history[r]=[]}}},{key:"addToAddToCartHistory",value:function(t){this._addToHistory(t,Q.ADD_TO_CART)}},{key:"addToTrackCartHistory",value:function(t){var e=this._addToHistory(t,Q.TRACK_CART);Granify.trackGranifyData(Granify.constants.LATEST_TRACK_CART,e,"local")}},{key:"addToTrackPageViewHistory",value:function(t){this._addToHistory(t,Q.TRACK_PAGE_VIEW)}},{key:"addToTrackProductHistory",value:function(t){this._addToHistory(t,Q.TRACK_PRODUCT)}},{key:"addToTrackWishListHistory",value:function(t){this._addToHistory(t,Q.TRACK_WISHLIST)}},{key:"trackScriptLoad",value:function(t){this._addToHistory(t,Q.SCRIPT_LOAD)}},{key:"addToSetCurrentProductHistory",value:function(t){this._addToHistory(t,Q.SET_CURRENT_PRODUCT)}},{key:"getAddToCartHistory",value:function(){return this._history[Q.ADD_TO_CART]}},{key:"getTrackCartHistory",value:function(){return this._history[Q.TRACK_CART]}},{key:"getTrackPageViewHistory",value:function(){return this._history[Q.TRACK_PAGE_VIEW]}},{key:"getTrackProductHistory",value:function(){return this._history[Q.TRACK_PRODUCT]}},{key:"getTrackWishListHistory",value:function(){return this._history[Q.TRACK_WISHLIST]}},{key:"getScriptLoadHistory",value:function(){return this._history[Q.SCRIPT_LOAD]}},{key:"getSetCurrentProductHistory",value:function(){return this._history[Q.SET_CURRENT_PRODUCT]}},{key:"getLatestAddToCartCall",value:function(){return this._getLastElement(this._history[Q.ADD_TO_CART])}},{key:"getLatestTrackCartCall",value:function(){return this._getLastElement(this._history[Q.TRACK_CART])}},{key:"getLatestTrackPageViewCall",value:function(){return this._getLastElement(this._history[Q.TRACK_PAGE_VIEW])}},{key:"getLatestTrackProductCall",value:function(){return this._getLastElement(this._history[Q.TRACK_PRODUCT])}},{key:"getLatestTrackWishListCall",value:function(){return this._getLastElement(this._history[Q.TRACK_WISHLIST])}},{key:"getLatestScriptLoad",value:function(){return this._getLastElement(this._history[Q.SCRIPT_LOAD])}},{key:"getLatestSetCurrentProductCall",value:function(){return this._getLastElement(this._history[Q.SET_CURRENT_PRODUCT])}},{key:"getLatestTrackCartCallPersistent",value:function(){var t=Granify.getGranifyData(Granify.constants.LATEST_TRACK_CART);return t&&t.value}},{key:"_getLastElement",value:function(t){return t[t.length-1]}},{key:"_addToHistory",value:function(t,e){var r={timestamp:Date.now(),apiCallContents:Granify.deepClone(t),url:window.location.toString()};return this._history[e].push(r),r}}])&&$(e.prototype,r),n&&$(e,n),t}();function tt(t,e){return function(t){if(Array.isArray(t))return t}(t)||function(t,e){if("undefined"===typeof Symbol||!(Symbol.iterator in Object(t)))return;var r=[],n=!0,a=!1,i=void 0;try{for(var o,s=t[Symbol.iterator]();!(n=(o=s.next()).done)&&(r.push(o.value),!e||r.length!==e);n=!0);}catch(c){a=!0,i=c}finally{try{n||null==s.return||s.return()}finally{if(a)throw i}}return r}(t,e)||rt(t,e)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function et(t,e){var r;if("undefined"===typeof Symbol||null==t[Symbol.iterator]){if(Array.isArray(t)||(r=rt(t))||e&&t&&"number"===typeof t.length){r&&(t=r);var n=0,a=function(){};return{s:a,n:function(){return n>=t.length?{done:!0}:{done:!1,value:t[n++]}},e:function(t){throw t},f:a}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var i,o=!0,s=!1;return{s:function(){r=t[Symbol.iterator]()},n:function(){var t=r.next();return o=t.done,t},e:function(t){s=!0,i=t},f:function(){try{o||null==r.return||r.return()}finally{if(s)throw i}}}}function rt(t,e){if(t){if("string"===typeof t)return nt(t,e);var r=Object.prototype.toString.call(t).slice(8,-1);return"Object"===r&&t.constructor&&(r=t.constructor.name),"Map"===r||"Set"===r?Array.from(t):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?nt(t,e):void 0}}function nt(t,e){(null==e||e>t.length)&&(e=t.length);for(var r=0,n=new Array(e);r<e;r++)n[r]=t[r];return n}function at(t,e,r,n,a,i,o){try{var s=t[i](o),c=s.value}catch(u){return void r(u)}s.done?e(c):Promise.resolve(c).then(n,a)}function it(t){return function(){var e=this,r=arguments;return new Promise((function(n,a){var i=t.apply(e,r);function o(t){at(i,n,a,o,s,"next",t)}function s(t){at(i,n,a,o,s,"throw",t)}o(void 0)}))}}if(Granify.apiHistory=new Z,Granify.enabled){var ot=function(){var t=it(i.a.mark((function t(e){var r,n,a,o,s;return i.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.prev=0,t.next=3,Granify.checkOrderParameters(e);case 3:return t.next=5,Granify.getSharedData(Granify.storage.LAST_FAST_ORDER);case 5:if(r=t.sent,e.order_number&&r!==e.order_number){t.next=8;break}throw new Error("Order has already been sent fast.");case 8:return t.next=10,Granify.getSharedData(Granify.storage.UNCONFIRMED_ORDERS);case 10:if(t.t0=t.sent,t.t0){t.next=13;break}t.t0=[];case 13:if((n=t.t0).push(e),Granify.setSharedData(Granify.storage.UNCONFIRMED_ORDERS,n),Granify.hasUnconfirmedOrders=!0,t.t1=Granify.SHOP_ID,t.t2=Granify.CHILD_SITE_ID||void 0,t.t3=Granify.UUID,t.t3){t.next=24;break}return t.next=23,Granify.getSharedData(Granify.storage.UUID);case 23:t.t3=t.sent;case 24:if(t.t4=t.t3,t.t5=Granify.SESSION,t.t5){t.next=30;break}return t.next=29,Granify.getSharedData(Granify.storage.SESSION);case 29:t.t5=t.sent;case 30:return t.t6=t.t5,t.t7=e.order_number,t.t8=e.subtotal_price,t.t9=e.total_price,t.t10=e.currency,t.t11=ut(e.line_items),t.t12=Granify.stopped,t.t13=Granify.version.js,a={site_id:t.t1,csid:t.t2,uuid:t.t4,session:t.t6,order_number:t.t7,subtotal_price:t.t8,total_price:t.t9,currency:t.t10,item_count:t.t11,method:"jsonp",stopped:t.t12,x:t.t13},Granify.shouldTrackGaOnServerSide()&&(a.track_ga=!0),ft(e.line_items,a),o="".concat(Granify.matching,"/javascript/orders/fast-update"),Granify.JSONP(o,a,(function(t){t.error&&Granify.JSONP(o,a,(function(){}))})),t.next=45,Granify.getSharedData(Granify.storage.LAST_ORDER);case 45:s=t.sent,1!=Granify.SESSION_INITIALIZED||a.track_ga||s===e.order_number||(Granify.sendGaOrder(a),Granify.setSharedData(Granify.storage.LAST_GA_FAST_ORDER,a.order_number)),Granify.setSharedData(Granify.storage.LAST_FAST_ORDER,a.order_number),t.next=53;break;case 50:t.prev=50,t.t14=t.catch(0),Granify.logError("Granify - TrackOrderError: Fast Order failed. Not sending data.",{message:t.t14.message,data:JSON.stringify(e)});case 53:case"end":return t.stop()}}),t,null,[[0,50]])})));return function(e){return t.apply(this,arguments)}}(),st=function(t,e){return new Promise((function(r,n){Granify.POST(t,e,r,n)}))},ct=function(){var t=it(i.a.mark((function t(e){var r,n,a;return i.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,new Promise((function(t){return Granify.reloadFlags(t)}));case 2:return t.prev=2,r=function(){var t=it(i.a.mark((function t(){return i.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,st(a,e);case 2:Granify.removeUnconfirmedOrder(e.order_number);case 3:case"end":return t.stop()}}),t)})));return function(){return t.apply(this,arguments)}}(),t.next=6,Granify.getSharedData(Granify.storage.LAST_ORDER);case 6:if(n=t.sent,e.order_number){t.next=12;break}throw Granify.logError("Granify - TrackOrderError: order_number or data missing. Not sending data.",{data:e}),new Error;case 12:if(n!==e.order_number){t.next=15;break}throw Granify.log("Granify - TrackOrderError: order already sent. Not sending data.",{data:e}),new Error;case 15:return t.next=17,Granify.getSharedData(Granify.storage.LAST_FAST_ORDER);case 17:return t.sent!==e.order_number&&Granify.trackOrder(e,!0),t.next=21,Granify.checkOrderParameters(e);case 21:if(t.sent){t.next=24;break}throw new Error;case 24:return e.stopped=Granify.stopped,e.item_count=ut(e.line_items),a="".concat(Granify.matching,"/javascript/orders/update"),t.prev=27,t.next=30,r();case 30:t.next=35;break;case 32:t.prev=32,t.t0=t.catch(27),r();case 35:return t.next=37,Granify.getSharedData(Granify.storage.LAST_GA_FAST_ORDER);case 37:t.sent===e.order_number||1!==Granify.SESSION_INITIALIZED||e.track_ga||Granify.sendGaOrder(e),Granify.setSharedData(Granify.storage.LAST_ORDER,e.order_number),Granify.trackCart(!1),t.next=46;break;case 43:t.prev=43,t.t1=t.catch(2),Granify.logError("Granify - TrackOrderError: processing failed: ",{message:t.t1.message,args:JSON.stringify(e)});case 46:case"end":return t.stop()}}),t,null,[[2,43],[27,32]])})));return function(e){return t.apply(this,arguments)}}(),ut=function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],e=t.map((function(t){return Number(t.quantity)||1}));return e.reduce((function(t,e){return t+e}),0)},ft=function(t,e){var r,n={},a=et(t);try{for(a.s();!(r=a.n()).done;){var i=r.value;i.csid&&(n[i.csid]||(n[i.csid]={ic:0,sb:0}),n[i.csid].ic+=i.quantity,n[i.csid].sb+=i.quantity*i.price)}}catch(l){a.e(l)}finally{a.f()}for(var o=0,s=Object.entries(n);o<s.length;o++){var c=tt(s[o],2),u=c[0],f=c[1];e["ic_"+u]=f.ic,e["sb_"+u]=Math.round(100*f.sb)/100}};Granify.checkOrderParameters=function(){var t=it(i.a.mark((function t(e){var r,n,a,o,s,c,u;return i.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.prev=0,e.client_order_date=parseInt(+(new Date).getTime()/1e3),t.next=4,Granify.getSharedData(Granify.storage.LAST_SERVER_TIME);case 4:if((r=t.sent)&&r.time&&Granify.SESSION&&r.session===Granify.SESSION&&(e.order_date=r.time),Granify.pageType="receipt",e.site_id=Granify.SHOP_ID,Granify.CHILD_SITE_ID&&(e.csid=Granify.CHILD_SITE_ID),t.t0=Granify.UUID,t.t0){t.next=14;break}return t.next=13,Granify.getSharedData(Granify.storage.UUID);case 13:t.t0=t.sent;case 14:if(e.uuid=t.t0,Granify.shouldTrackGaOnServerSide()&&(e.track_ga=!0),e.financial_status=(e.financial_status||"paid").toLowerCase(),!Granify.itExists(e.total_line_items_price)&&Granify.itExists(e.subtotal_price)&&(e.total_line_items_price=e.subtotal_price),t.t1=Granify.SESSION,t.t1){t.next=23;break}return t.next=22,Granify.getSharedData(Granify.storage.SESSION);case 22:t.t1=t.sent;case 23:e.session=t.t1,e.method="post",e.x=Granify.version.js,n=0,a=["currency","subtotal_price","order_number"];case 27:if(!(n<a.length)){t.next=36;break}if(o=a[n],Granify.itExists(e[o])&&0!==e[o].toString().length){t.next=33;break}return Granify.logError("Granify - ".concat(o," is required!"),e),e=null,t.abrupt("return");case 33:n++,t.next=27;break;case 36:if(e.items&&!e.line_items&&(e.line_items=e.items,delete e.items),e.line_items){s=et(e.line_items);try{for(s.s();!(c=s.n()).done;)(u=c.value).id&&!u.sku?u.sku=u.id:u.sku&&!u.id&&(u.id=u.sku),u.sku||u.product_id||Granify.logError("no identifying keys (id/sku, product_id) provided for an item in order; attempting to send order anyway...",e)}catch(i){s.e(i)}finally{s.f()}}return t.abrupt("return",e);case 41:t.prev=41,t.t2=t.catch(0),Granify.logError("Granify - TrackOrderError: Error while processing required fields: ",{message:t.t2.message,args:e},!0);case 44:case"end":return t.stop()}}),t,null,[[0,41]])})));return function(e){return t.apply(this,arguments)}}(),Granify.internalTrackOrder=function(t){var e=arguments.length>1&&void 0!==arguments[1]&&arguments[1];return Granify.trigger("trackOrder:called",t),Granify.itExists(Granify.metrics)&&!e&&Granify.metrics.count("clientcalls.trackOrder"),e?ot(t):(Granify.log("GRANIFY - trackOrder() called with: ",t),ct(t))},Granify.trackOrder=function(t){var e=arguments.length>1&&void 0!==arguments[1]&&arguments[1];Granify.log("GRANIFY - Client called trackOrder"),Granify.internalTrackOrder(t,e)},Granify.removeUnconfirmedOrder=function(){var t=it(i.a.mark((function t(e){var r;return i.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,Granify.getSharedData(Granify.storage.UNCONFIRMED_ORDERS);case 2:if(t.t0=t.sent,t.t0){t.next=5;break}t.t0=[];case 5:0===(r=(r=t.t0).filter((function(t){return t.order_number!==e}))).length&&(Granify.hasUnconfirmedOrders=!1),Granify.setSharedData(Granify.storage.UNCONFIRMED_ORDERS,r);case 9:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}(),Granify.resendUnconfirmedOrders=function(){var t=it(i.a.mark((function t(e){var r,n,a,o,s,c,u,f,l,y,d,p,g,h;return i.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return r=JSON.parse(e||"[]"),n=[],t.next=4,Granify.getSharedData(Granify.storage.UNCONFIRMED_ORDERS);case 4:if(t.t0=t.sent,t.t0){t.next=7;break}t.t0=[];case 7:a=t.t0,o=et(a);try{for(c=function(){var t=s.value;n.find((function(e){return e.order_number===t.order_number}))||n.push(t)},o.s();!(s=o.n()).done;)c()}catch(i){o.e(i)}finally{o.f()}u=!1,f=4,l=11,y=0,d=n;case 14:if(!(y<d.length)){t.next=44;break}if((p=d[y]).resent_tries=p.resent_tries||0,g=void 0,r.includes(p.order_number)||p.resent_tries>f?(p.toRemove=!0,u=!0):g=(+new Date-(p.last_resent_date||1e3*p.client_order_date))/1e3,h=l+3*(p.resent_tries+1)*3,!(g>h)){t.next=41;break}if(u=!0,p.last_resent_date=+new Date,p.resent_tries++,p.order_date||(p.order_date=parseInt(p.client_order_date)-Granify.clientTimeOffset),p.uuid){t.next=32;break}if(t.t1=Granify.UUID,t.t1){t.next=31;break}return t.next=30,Granify.getSharedData(Granify.storage.UUID);case 30:t.t1=t.sent;case 31:p.uuid=t.t1;case 32:if(p.session){t.next=39;break}if(t.t2=Granify.SESSION,t.t2){t.next=38;break}return t.next=37,Granify.getSharedData(Granify.storage.SESSION);case 37:t.t2=t.sent;case 38:p.session=t.t2;case 39:return t.next=41,st("".concat(Granify.matching,"/javascript/orders/update"),p);case 41:y++,t.next=14;break;case 44:n=n.filter((function(t){return!t.toRemove})),(u||n.length!=a.length)&&Granify.setSharedData(Granify.storage.UNCONFIRMED_ORDERS,n),0===n.length&&(Granify.hasUnconfirmedOrders=!1);case 47:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}()}r(37),r(38),r(39),r(40),r(41);function lt(t){return(lt="function"===typeof Symbol&&"symbol"===typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"===typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function yt(t,e,r){return e in t?Object.defineProperty(t,e,{value:r,enumerable:!0,configurable:!0,writable:!0}):t[e]=r,t}function dt(t,e){var r=Object.keys(t);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(t);e&&(n=n.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),r.push.apply(r,n)}return r}function pt(t){for(var e=1;e<arguments.length;e++){var r=null!=arguments[e]?arguments[e]:{};e%2?dt(Object(r),!0).forEach((function(e){yt(t,e,r[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(r)):dt(Object(r)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(r,e))}))}return t}function gt(t){return(gt=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}function ht(t,e){return(ht=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t})(t,e)}function mt(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(t){return!1}}function Gt(t,e,r){return(Gt=mt()?Reflect.construct:function(t,e,r){var n=[null];n.push.apply(n,e);var a=new(Function.bind.apply(t,n));return r&&ht(a,r.prototype),a}).apply(null,arguments)}function _t(t){var e="function"===typeof Map?new Map:void 0;return(_t=function(t){if(null===t||(r=t,-1===Function.toString.call(r).indexOf("[native code]")))return t;var r;if("function"!==typeof t)throw new TypeError("Super expression must either be null or a function");if("undefined"!==typeof e){if(e.has(t))return e.get(t);e.set(t,n)}function n(){return Gt(t,arguments,gt(this).constructor)}return n.prototype=Object.create(t.prototype,{constructor:{value:n,enumerable:!1,writable:!0,configurable:!0}}),ht(n,t)})(t)}function vt(t,e){(null==e||e>t.length)&&(e=t.length);for(var r=0,n=new Array(e);r<e;r++)n[r]=t[r];return n}function bt(t,e){var r;if("undefined"===typeof Symbol||null==t[Symbol.iterator]){if(Array.isArray(t)||(r=function(t,e){if(t){if("string"===typeof t)return vt(t,e);var r=Object.prototype.toString.call(t).slice(8,-1);return"Object"===r&&t.constructor&&(r=t.constructor.name),"Map"===r||"Set"===r?Array.from(t):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?vt(t,e):void 0}}(t))||e&&t&&"number"===typeof t.length){r&&(t=r);var n=0;return function(){return n>=t.length?{done:!0}:{done:!1,value:t[n++]}}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}return(r=t[Symbol.iterator]()).next.bind(r)}var Et=Object.prototype.toString,wt=function(t){if(void 0===t)return"undefined";if(null===t)return"null";var e=lt(t);if("boolean"===e)return"boolean";if("string"===e)return"string";if("number"===e)return"number";if("symbol"===e)return"symbol";if("function"===e)return"GeneratorFunction"===St(t)?"generatorfunction":"function";if(function(t){return Array.isArray?Array.isArray(t):t instanceof Array}(t))return"array";if(function(t){if(t.constructor&&"function"===typeof t.constructor.isBuffer)return t.constructor.isBuffer(t);return!1}(t))return"buffer";if(function(t){try{if("number"===typeof t.length&&"function"===typeof t.callee)return!0}catch(e){if(-1!==e.message.indexOf("callee"))return!0}return!1}(t))return"arguments";if(function(t){return t instanceof Date||"function"===typeof t.toDateString&&"function"===typeof t.getDate&&"function"===typeof t.setDate}(t))return"date";if(function(t){return t instanceof Error||"string"===typeof t.message&&t.constructor&&"number"===typeof t.constructor.stackTraceLimit}(t))return"error";if(function(t){return t instanceof RegExp||"string"===typeof t.flags&&"boolean"===typeof t.ignoreCase&&"boolean"===typeof t.multiline&&"boolean"===typeof t.global}(t))return"regexp";switch(St(t)){case"Symbol":return"symbol";case"Promise":return"promise";case"WeakMap":return"weakmap";case"WeakSet":return"weakset";case"Map":return"map";case"Set":return"set";case"Int8Array":return"int8array";case"Uint8Array":return"uint8array";case"Uint8ClampedArray":return"uint8clampedarray";case"Int16Array":return"int16array";case"Uint16Array":return"uint16array";case"Int32Array":return"int32array";case"Uint32Array":return"uint32array";case"Float32Array":return"float32array";case"Float64Array":return"float64array"}if(function(t){return"function"===typeof t.throw&&"function"===typeof t.return&&"function"===typeof t.next}(t))return"generator";switch(e=Et.call(t)){case"[object Object]":return"object";case"[object Map Iterator]":return"mapiterator";case"[object Set Iterator]":return"setiterator";case"[object String Iterator]":return"stringiterator";case"[object Array Iterator]":return"arrayiterator"}return e.slice(8,-1).toLowerCase().replace(/\s/g,"")};function St(t){return"function"===typeof t.constructor?t.constructor.name:null}var At={any:function(t){return void 0!==t},arguments:function(t){return"arguments"===wt(t)},array:function(t){return"array"===wt(t)},boolean:function(t){return"boolean"===wt(t)},buffer:function(t){return"buffer"===wt(t)},date:function(t){return"date"===wt(t)&&!isNaN(t)},error:function(t){return"error"===wt(t)},float32array:function(t){return"float32array"===wt(t)},float64array:function(t){return"float64array"===wt(t)},function:function(t){return"function"===wt(t)},generatorfunction:function(t){return"generatorfunction"===wt(t)},int16array:function(t){return"int16array"===wt(t)},int32array:function(t){return"int32array"===wt(t)},int8array:function(t){return"int8array"===wt(t)},map:function(t){return"map"===wt(t)},null:function(t){return"null"===wt(t)},number:function(t){return"number"===wt(t)},object:function(t){return"object"===wt(t)},promise:function(t){return"promise"===wt(t)},regexp:function(t){return"regexp"===wt(t)},set:function(t){return"set"===wt(t)},string:function(t){return"string"===wt(t)},symbol:function(t){return"symbol"===wt(t)},uint16array:function(t){return"uint16array"===wt(t)},uint32array:function(t){return"uint32array"===wt(t)},uint8array:function(t){return"uint8array"===wt(t)},uint8clampedarray:function(t){return"uint8clampedarray"===wt(t)},undefined:function(t){return"undefined"===wt(t)},weakmap:function(t){return"weakmap"===wt(t)},weakset:function(t){return"weakset"===wt(t)}};function kt(t,e){if(!t)throw new Error("Invariant failed")}var Ot,Tt=function(t){var e,r;function n(e){var r;kt(e.length>0);var a=e[0],i=a.path,o=a.value,s=a.type,c=a.branch,u=function(t,e){if(null==t)return{};var r,n,a={},i=Object.keys(t);for(n=0;n<i.length;n++)r=i[n],e.indexOf(r)>=0||(a[r]=t[r]);return a}(a,["path","value","type","branch"]),f="Expected a value of type `"+s+"`"+(i.length?" for `"+i.join(".")+"`":"")+" but received `"+JSON.stringify(o)+"`.";return(r=t.call(this,f)||this).type=s,r.value=o,Object.assign(function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(r),u),r.path=i,r.branch=c,r.failures=e,r.stack=(new Error).stack,r.__proto__=n.prototype,r}return r=t,(e=n).prototype=Object.create(r.prototype),e.prototype.constructor=e,e.__proto__=r,n}(_t(TypeError)),Ct=Symbol("STRUCT"),It=function(t){var e=t.struct.Error,r=function t(e){return t.assert(e)};return Object.defineProperty(r,Ct,{value:!0}),r.kind=t.kind,r.type=t.type,r.default=function(){return"function"===typeof t.defaults?t.defaults():t.defaults},r.test=function(t){return!r.check(t,[t],[])[0]},r.assert=function(t){var n=r.check(t,[t],[]),a=n[0],i=n[1];if(a)throw new e(a);return i},r.validate=function(t){var n=r.check(t,[t],[]),a=n[0],i=n[1];return a?[new e(a)]:[void 0,i]},r.check=function(t,e,n){return void 0===t&&(t=r.default()),[[r.fail({value:t,branch:e,path:n})]]},r.fail=function(t){return pt(pt({},t),{},{type:"type"in t?t.type:r.type})},r},Dt=function(t,e,r){if("function"===typeof(n=t)&&n[Ct])return t;var n;if(Array.isArray(t)){if(1===t.length){var a=t[0];return r.array([a],e)}if(t.length>1)return r.tuple(t,e)}if("function"===typeof t)return r.function(t,e);if("object"===lt(t))return r.object(t,e);if("string"===typeof t){var i,o=!1;if(t.endsWith("?")&&(o=!0,t=t.slice(0,-1)),t.includes("|")){var s=t.split(/\s*\|\s*/g);i=r.union(s,e)}else if(t.includes("&")){var c=t.split(/\s*&\s*/g);i=r.intersection(c,e)}else i=r.scalar(t,e);return o&&(i=r.union([i,"undefined"],void 0)),i}throw new Error("A schema definition must be an object, array, string or function, but you passed: "+t)},Pt=function(t,e,r){kt(Array.isArray(t)&&0!==t.length);var n=t.map((function(t){return r(t)})),a=n.map((function(t){return t.type})).join(" | "),i=It({kind:"union",type:a,defaults:e,struct:r});return i.check=function(t,e,r){void 0===t&&(t=i.default());for(var a,o=bt(n);!(a=o()).done;){var s=a.value.check(t,e,r),c=s[0],u=s[1];if(!c)return[void 0,u]}return[[i.fail({value:t,branch:e,path:r})]]},i},Nt=function(t){void 0===t&&(t={});var e=function t(e,r){return Dt(e,r,t)};return e.array=function(t,r){return function(t,e,r){kt(Array.isArray(t)&&1===t.length);var n=r(t[0],void 0),a=It({kind:"array",type:n.type+"[]",defaults:e,struct:r});return a.check=function(t,e,r){if(void 0===t&&(t=a.default()),!Array.isArray(t))return[[a.fail({value:t,branch:e,path:r})]];for(var i=[],o=[],s=0;s<t.length;s++){var c=t[s],u=n.check(c,e.concat(c),r.concat(s)),f=u[0],l=u[1];f?o.push.apply(o,f):i[s]=l}return o.length?[o]:[void 0,i]},a}(t,r,e)},e.dynamic=function(t,r){return function(t,e,r){kt("function"===typeof t);var n=It({kind:"dynamic",type:"dynamic<\u2026>",defaults:e,struct:r});return n.check=function(e,r,a){return void 0===e&&(e=n.default()),t(e,r,a).check(e,r,a)},n}(t,r,e)},e.enum=function(t,r){return function(t,e,r){kt(Array.isArray(t));var n=r((function(e){return t.includes(e)}),e);return n.kind="enum",n.type=t.map((function(t){return"string"===typeof t?'"'+t+'"':""+t})).join(" | "),n}(t,r,e)},e.function=function(t,r){return function(t,e,r){var n=It({kind:"function",type:"function<\u2026>",defaults:e,struct:r});return n.check=function(e,r,a){void 0===e&&(e=n.default());var i=t(e,r,a);if(!0===i)return[void 0,e];var o=[];if(!1===i)o.push(n.fail({value:e,branch:r,path:a}));else if(Array.isArray(i)&&i.length>0)for(var s,c=bt(i);!(s=c()).done;){var u=s.value;o.push(n.fail(pt({value:e,branch:r,path:a},u)))}else"object"===lt(i)?o.push(n.fail(pt({value:e,branch:r,path:a},i))):kt(!1);return[o]},n}(t,r,e)},e.instance=function(t,r){return function(t,e,r){kt("function"===typeof t);var n=r((function(e){return e instanceof t}),e);return n.kind="instance",n.type="instance<"+t.name+">",n}(t,r,e)},e.interface=function(t,r){return function(t,e,r){kt("object"===lt(t));var n={};for(var a in t)n[a]=r(t[a]);var i=It({kind:"interface",type:"interface<{"+Object.keys(t).join()+"}>",defaults:e,struct:r});return i.check=function(t,e,r){if(void 0===t&&(t=i.default()),"object"!==lt(t)&&"function"!==typeof t)return[[i.fail({value:t,branch:e,path:r})]];var a=[];for(var o in n){var s=n[o],c=t[o],u=s.check(c,e.concat(c),r.concat(o))[0];u&&a.push.apply(a,u)}return a.length?[a]:[void 0,t]},i}(t,r,e)},e.intersection=function(t,r){return function(t,e,r){kt(Array.isArray(t)&&0!==t.length);var n=t.map((function(t){return r(t)})),a=n.map((function(t){return t.type})).join(" & "),i=It({kind:"intersection",type:a,defaults:e,struct:r});return i.check=function(t,e,r){void 0===t&&(t=i.default());for(var a,o=t,s=bt(n);!(a=s()).done;){var c=a.value.check(t,e,r),u=c[0],f=c[1];if(u)return[[i.fail({value:t,branch:e,path:r})]];o=f}return[void 0,o]},i}(t,r,e)},e.lazy=function(t,r){return function(t,e,r){kt("function"===typeof t);var n=It({kind:"lazy",type:"lazy<\u2026>",defaults:e,struct:r});return n.check=function(){return Object.assign(n,t()),n.check.apply(n,arguments)},n}(t,r,e)},e.literal=function(t,r){return function(t,e,r){var n=r((function(e){return e===t}),e);return n.kind="literal",n.type="string"===typeof t?'"'+t+'"':""+t,n}(t,r,e)},e.object=function(t,r){return function(t,e,r){kt("object"===lt(t));var n={};for(var a in t)n[a]=r(t[a]);var i=It({kind:"object",type:"{"+Object.keys(t).join()+"}",defaults:e,struct:r});return i.check=function(t,e,r){void 0===t&&(t=i.default());var a=i.default();if(void 0===t&&(t=a),"object"!==wt(t))return[[i.fail({value:t,branch:e,path:r})]];for(var o,s={},c=[],u=bt(new Set(Object.keys(n).concat(Object.keys(t))));!(o=u()).done;){var f=o.value,l=t[f],y=r.concat(f),d=e.concat(l),p=n[f];if(void 0===l&&null!=a&&f in a&&(l="function"===typeof a[f]?a[f](t,e,r):a[f]),f in n){var g=p.check(l,d,y),h=g[0],m=g[1];h?c.push.apply(c,h):void 0!==m&&f in n&&(s[f]=m)}else c.push(i.fail({type:void 0,value:l,path:y,branch:t}))}return c.length?[c]:[void 0,s]},i}(t,r,e)},e.optional=function(t,r){return Pt([t,"undefined"],r,e)},e.partial=function(t,r){return function(t,e,r){kt("object"===lt(t));var n={};for(var a in t)n[a]=r.union([t[a],"undefined"]);var i=It({kind:"object",type:"{"+Object.keys(t).join()+"}",defaults:e,struct:r});return i.check=function(t,e,r){void 0===t&&(t=i.default());var a=i.default();if(void 0===t&&(t=a),"object"!==wt(t))return[[i.fail({value:t,branch:e,path:r})]];for(var o,s={},c=[],u=bt(t);!(o=u()).done;){var f=o.value,l=t[f],y=r.concat(f),d=e.concat(l),p=n[f];if(void 0===l&&null!=a&&f in a&&(l="function"===typeof a[f]?a[f](t,e,r):a[f]),f in n){var g=p.check(l,d,y),h=g[0],m=g[1];h?c.push.apply(c,h):void 0!==m&&f in n&&(s[f]=m)}else c.push(i.fail({type:void 0,value:l,path:y,branch:t}))}return c.length?[c]:[void 0,s]},i}(t,r,e)},e.pick=function(t,r){return function(t,e,r){kt("object"===lt(t));var n={};for(var a in t)n[a]=r(t[a]);var i=It({kind:"pick",type:"pick<{"+Object.keys(t).join()+"}>",defaults:e,struct:r});return i.check=function(t,e,r){void 0===t&&(t=i.default());var a=i.default();if(void 0===t&&(t=a),"object"!==wt(t))return[[i.fail({value:t,branch:e,path:r})]];var o={},s=[];for(var c in n){var u=t[c],f=r.concat(c),l=e.concat(u),y=n[c];void 0===u&&null!=a&&c in a&&(u="function"===typeof a[c]?a[c](t,e,r):a[c]);var d=y.check(u,l,f),p=d[0],g=d[1];p?s.push.apply(s,p):void 0!==g&&c in n&&(o[c]=g)}return s.length?[s]:[void 0,o]},i}(t,r,e)},e.record=function(t,r){return function(t,e,r){kt(Array.isArray(t)&&2===t.length);var n=r(t[0]),a=r(t[1]),i=It({kind:"record",type:"record<"+n.type+","+a.type+">",defaults:e,struct:r});return i.check=function(t,e,r){var o=i.default();if(t=o?pt(pt({},o),t):t,"object"!==wt(t))return[[i.fail({value:t,branch:e,path:r})]];var s={},c=[];for(var u in t){var f=t[u],l=r.concat(u),y=e.concat(f),d=n.check(u,y,l),p=d[0],g=d[1];if(p)c.push.apply(c,p);else{var h=a.check(f,y,l),m=h[0],G=h[1];m?c.push.apply(c,m):s[g]=G}}return c.length?[c]:[void 0,s]},i}(t,r,e)},e.scalar=function(t,r){return function(t,e,r){kt("string"===typeof t);var n=r.Types;kt(t in n);var a=r(n[t],e);return a.kind="scalar",a.type=t,a}(t,r,e)},e.size=function(t,r){return function(t,e,r){kt(Array.isArray(t)&&2===t.length&&t.every((function(t){return"number"===typeof t})));var n=t[0],a=t[1],i=r((function(t){return null!=t&&"number"===typeof t.length&&t.length>=n&&t.length<=a}),e);return i.kind="size",i.type="size<"+n+","+a+">",i}(t,r,e)},e.tuple=function(t,r){return function(t,e,r){kt(Array.isArray(t));var n=t.map((function(t){return r(t)})),a=It({kind:"tuple",type:"["+n.map((function(t){return t.type})).join()+"]",defaults:e,struct:r});return a.check=function(t,e,r){if(void 0===t&&(t=a.default()),!Array.isArray(t))return[[a.fail({value:t,branch:e,path:r})]];for(var i=[],o=[],s=Math.max(t.length,n.length),c=0;c<s;c++){var u=n[c],f=t[c],l=r.concat(c),y=e.concat(f);if(u){var d=u.check(f,y,l),p=d[0],g=d[1];p?o.push.apply(o,p):i[c]=g}else o.push(a.fail({type:void 0,value:f,path:l,branch:y}))}return o.length?[o]:[void 0,i]},a}(t,r,e)},e.union=function(t,r){return Pt(t,r,e)},e.Error=t.error||Tt,e.Types=pt(pt({},At),t.types),e},Rt=(Nt(),function(t){return"[object Number]"==Object.prototype.toString.call(t)&&!isNaN(t)});function xt(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}function Lt(t,e,r){return e in t?Object.defineProperty(t,e,{value:r,enumerable:!0,configurable:!0,writable:!0}):t[e]=r,t}var jt=(Lt(Ot={},Granify.constants.OFFER_EVENT_CLICK_UNMINIMIZE,"clkUnmin"),Lt(Ot,Granify.constants.OFFER_EVENT_CLICK_MINIMIZE,"clkMin"),Lt(Ot,Granify.constants.OFFER_EVENT_CLICK_CLOSE,"clkClose"),Lt(Ot,Granify.constants.OFFER_EVENT_CLICK_TOGGLE,"clkToggle"),Lt(Ot,Granify.constants.OFFER_EVENT_CLICK_INTERACT,"clkInteract"),Lt(Ot,Granify.constants.OFFER_EVENT_CTA_VIEW_PRODUCT,"ctaVwPrd"),Lt(Ot,Granify.constants.OFFER_EVENT_CTA_ADD_TO_CART,"ctaAddCart"),Lt(Ot,Granify.constants.OFFER_EVENT_CTA_CHECKOUT,"ctaChkOut"),Lt(Ot,Granify.constants.OFFER_EVENT_CTA,"cta"),Lt(Ot,Granify.constants.OFFER_EVENT_ADD_TO_CART,"addCart"),Lt(Ot,Granify.constants.OFFER_EVENT_AUTO_CLOSE,"autoClose"),Lt(Ot,Granify.constants.OFFER_EVENT_VIEW_PRODUCT,"vwPrd"),Lt(Ot,Granify.constants.OFFER_EVENT_ACKNOWLEDGED,"ack"),Lt(Ot,Granify.constants.OFFER_EVENT_PRODUCT_SHOWN,"prodShown"),Lt(Ot,Granify.constants.OFFER_EVENT_COUPON_SHOWN,"couponShown"),Ot),Ft=function(){function t(){var e=this;!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this.OFFER_EVENT_URL="https:".concat(GRANIFY_CONFIG.matchingHost,"/offer_events"),this.sendParamsToMatching=!0,Granify.onAll(Granify.constants.OFFER_EVENT,(function(t){var r=t.eventParams,n=t.callbackFunction;return e.send(r,n)}))}var e,r,n;return e=t,(r=[{key:"send",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:function(){};if(!1===this.sendParamsToMatching)return Granify.log("OfferEvents called in testing mode:"),Granify.log(this._makeParams(t)),e({ack:!0});if(!this._eventParamsValid(t))return Granify.logCriticalOnce("Malformed event parameters for offer event ",t);var r=this._makeParams(t);Granify.log("Sending offerEvent"),Granify.POST(this.OFFER_EVENT_URL,r,e)}},{key:"_eventParamsValid",value:function(t){var e=Qt({eventType:"offerEvent",serializedWidget:{campaign_id:"string|number",offer_id:"string",is_multimatch:"boolean",offerEventAddToCartTriggered:"boolean?",product_ids:["string?"],skus:["string?"]},productIndex:"number?"});try{return e(t),!0}catch(r){return!1}}},{key:"_makeParams",value:function(t){var e=t.eventType,r=t.serializedWidget,n=t.productIndex,a=void 0===n?0:n,i={event:jt[e],uuid:Granify.UUID,sid:GRANIFY_CONFIG.SHOP_ID,x:Granify.version.js,cid:r.campaign_id,oid:r.offer_id,mm:r.is_multimatch};if(Granify.CHILD_SITE_ID&&(i.csid=Granify.CHILD_SITE_ID),r.product_ids&&r.product_ids.length){var o=r.product_ids[a];i.pid=o}if(r.skus&&r.skus.length){var s=r.skus[a];i.sku=s}return i}}])&&xt(e.prototype,r),n&&xt(e,n),t}();Granify.offerEvents=new Ft;var Ut=function(t){return Object.keys(jt).includes(t)};function Mt(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}var Bt=[Granify.constants.SITE_EVENT_TYPE_COUNT,Granify.constants.SITE_EVENT_TYPE_TIME,Granify.constants.SITE_EVENT_TYPE_DATA,Granify.constants.SITE_EVENT_TYPE_DATA_ARRAY],Ht=function(){function t(){var e=this;!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this.SITE_EVENTS_URL="https:".concat(GRANIFY_CONFIG.matchingHost,"/site_events"),this.sendParamsToMatching=!0,Granify.onAll(Granify.constants.SITE_EVENT,(function(t){var r=t.eventParams,n=t.callbackFunction;return e.send(r,n)}))}var e,r,n;return e=t,(r=[{key:"send",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:function(){};if(!1===this.sendParamsToMatching)return Granify.logDebug("SiteEvents called in testing mode:",this._makeParams(t)),e({ack:!0});if(!this._eventParamsValid(t)){var r=t&&t.eventName?t.eventName:"";return Granify.logCriticalOnce("Malformed event parameters for site event ".concat(r),t)}var n=this._makeParams(t);Granify.logDebug("Sending siteEvent"),Granify.POST(this.SITE_EVENTS_URL,n,e)}},{key:"_eventParamsValid",value:function(t){var e=Qt({vendor:"string",eventName:"string",eventType:"siteEventType",eventValue:"number",eventData:"string?"});try{return e(t),!0}catch(r){return Granify.logDebug("Site Events validator failed: ".concat(r.message)),!1}}},{key:"_makeParams",value:function(t){var e=t.vendor,r=t.eventName,n=t.eventType,a=t.eventValue,i=t.eventData,o={sid:GRANIFY_CONFIG.SHOP_ID,uuid:Granify.UUID,x:Granify.version.js,events:[{vendor:e,event_name:r,event_type:n,event_value:a}]};return i&&(o.events[0].event_data=i),Granify.CHILD_SITE_ID&&(o.csid=Granify.CHILD_SITE_ID),o}}])&&Mt(e.prototype,r),n&&Mt(e,n),t}();Granify.siteEvents=new Ht;var Vt=function(t){return Bt.includes(t)};function Wt(t,e){return function(t){if(Array.isArray(t))return t}(t)||function(t,e){if("undefined"===typeof Symbol||!(Symbol.iterator in Object(t)))return;var r=[],n=!0,a=!1,i=void 0;try{for(var o,s=t[Symbol.iterator]();!(n=(o=s.next()).done)&&(r.push(o.value),!e||r.length!==e);n=!0);}catch(c){a=!0,i=c}finally{try{n||null==s.return||s.return()}finally{if(a)throw i}}return r}(t,e)||function(t,e){if(!t)return;if("string"===typeof t)return Yt(t,e);var r=Object.prototype.toString.call(t).slice(8,-1);"Object"===r&&t.constructor&&(r=t.constructor.name);if("Map"===r||"Set"===r)return Array.from(t);if("Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return Yt(t,e)}(t,e)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function Yt(t,e){(null==e||e>t.length)&&(e=t.length);for(var r=0,n=new Array(e);r<e;r++)n[r]=t[r];return n}function qt(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}var zt={ALPHABETICAL:"Alphabetical",BEST_SELLING:"Best Selling",FEATURED:"Featured",PRICE_HIGH_TO_LOW:"Price High to Low",PRICE_LOW_TO_HIGH:"Price Low to High",NEWEST:"Newest",RATING:"Rating",RELEVANCE:"Relevance",SHIPPING_TIME:"Shipping Time",TRENDING:"Trending",UNKNOWN:"Unknown"},Kt=Object.values(zt),Jt=function(){function t(e){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this.sortOrderTypes=zt,this.sortOrderMapping=new Map,this.enabled=!1,e&&e.includes("data")&&(this.enabled=!0),this.addDefaultSortOrderMappings()}var e,r,n;return e=t,(r=[{key:"addDefaultSortOrderMappings",value:function(){var t=this;Kt.forEach((function(e){t.sortOrderMapping.set(e,e)}))}},{key:"addSortOrderMappings",value:function(){var t=this,e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],r=Qt({sortOrderType:"sortOrderType",siteSortOrderKeys:["string"]}),n=!0;return e.forEach((function(e){var a=Wt(r.validate(e),1)[0];if(a)return Granify.logWarningOnce("Sort Order validator failed: ".concat(a.message)),n=!1;e.siteSortOrderKeys.forEach((function(r){t.sortOrderMapping.set(r,e.sortOrderType)}))})),n}},{key:"saveSortOrder",value:function(t){var e,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;if(!this.enabled)return Granify.logWarningOnce("Sort Order tracking is not available for this site."),!1;Granify.itExists(r)||(r=Granify.getPageType()),t=this.findGranifySortOrder(t),Granify.logDebug("Saving Sort Order Terms: ".concat(t," (").concat(t,") on ").concat(r," pageType")),Granify.trigger(Granify.constants.SITE_EVENT,{eventParams:{vendor:Granify.constants.GRANIFY_VENDOR,eventName:(null===(e=r)||void 0===e?void 0:e.toLowerCase())+Granify.constants.SITE_EVENT_SORT_SUFFIX,eventType:Granify.constants.SITE_EVENT_TYPE_DATA,eventValue:0,eventData:t}})}},{key:"findGranifySortOrder",value:function(t){var e;return null!==(e=this.sortOrderMapping.get(t))&&void 0!==e?e:zt.UNKNOWN}}])&&qt(e.prototype,r),n&&qt(e,n),t}();Granify.sortOrderUtility=new Jt(Bt);var Xt=function(t){return Kt.includes(t)},Qt=Nt({types:{price:function(t){return Rt(t)},offerEvent:function(t){return Ut(t)},siteEventType:function(t){return Vt(t)},sortOrderType:function(t){return Xt(t)}}});function $t(t,e){return function(t){if(Array.isArray(t))return t}(t)||function(t,e){if("undefined"===typeof Symbol||!(Symbol.iterator in Object(t)))return;var r=[],n=!0,a=!1,i=void 0;try{for(var o,s=t[Symbol.iterator]();!(n=(o=s.next()).done)&&(r.push(o.value),!e||r.length!==e);n=!0);}catch(c){a=!0,i=c}finally{try{n||null==s.return||s.return()}finally{if(a)throw i}}return r}(t,e)||function(t,e){if(!t)return;if("string"===typeof t)return Zt(t,e);var r=Object.prototype.toString.call(t).slice(8,-1);"Object"===r&&t.constructor&&(r=t.constructor.name);if("Map"===r||"Set"===r)return Array.from(t);if("Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return Zt(t,e)}(t,e)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function Zt(t,e){(null==e||e>t.length)&&(e=t.length);for(var r=0,n=new Array(e);r<e;r++)n[r]=t[r];return n}function te(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}var ee=function(){function t(){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t)}var e,r,n;return e=t,n=[{key:"trackWishList",value:function(t){return Granify.log("GRANIFY - Client called trackWishList"),Granify.internalTrackWishList(t)}},{key:"internalTrackWishList",value:function(e){return Granify.trigger("trackWishList:called",e),Granify.apiHistory.addToTrackWishListHistory(e),t._isWishListValid(e)?(Granify._granifySendWishList=e,!0):(Granify.logWarning("internalTrackWishList called with invalid data",e),!1)}},{key:"_isWishListValid",value:function(t){var e=Qt({sku:"string?",product_id:"string",price:"price?",regular_price:"price?",title:"string?",image:"string?",date_added:"number?",price_when_added:"price?",in_stock:"boolean",cta_url:"string?",product_url:"string?"}),r=$t(Qt({list_name:"string",items:[e]}).validate(t),1)[0];return!r||(Granify.logError("Wish List Validation Error: ".concat(r)),!1)}}],(r=null)&&te(e.prototype,r),n&&te(e,n),t}();Granify.trackWishList=ee.trackWishList,Granify.internalTrackWishList=ee.internalTrackWishList;r(42),r(43);var re=function t(){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t)};re.internalSetShopperId=function(t){return t=re._convertNullEquivalent(t),re._isValidShopperId(t)?(Granify.log("Calling internalSetShopperId with id: ".concat(t)),Granify.onNext("nonCachedMatchRequestComplete",(function(){Granify.SP.setSiteShopperId((function(){return t}),Granify.SERVER_SESSION_ID)})),!0):(Granify.logErrorOnce("Calling internalSetShopperId with invalid id: ".concat(t)),!1)},re.setShopperId=function(t){Granify.log("GRANIFY - Client called setShopperId"),Granify.internalSetShopperId(t)},re._isValidShopperId=function(t){return null===t||"unknown"!==t&&("string"!==typeof t||""!==t.trim())&&(!!Granify.isString(t)&&0!==t.length)},re._convertNullEquivalent=function(t){return!1===t||void 0===t?null:t},Granify.internalSetShopperId=re.internalSetShopperId,Granify.setShopperId=re.setShopperId;r(44),r(45),r(46),r(47),r(48),r(49),r(50),r(51),r(52),r(53);var ne=[{code:"usd",symbols:["$","\ufe69","\uff04","us$"],name:"United States Dollar",exponent:2},{code:"eur",symbols:["\u20ac"],name:"Euro Member Countries",exponent:2},{code:"aud",symbols:["au$"],name:"Australia Dollar",exponent:2},{code:"brl",symbols:["r$"],name:"Brazil Real",exponent:2},{code:"cad",symbols:["ca$"],name:"Canada Dollar",exponent:2},{code:"clp",symbols:[],name:"Chile Peso",exponent:2},{code:"cny",symbols:[],name:"China Yuan Renminbi",exponent:2},{code:"cop",symbols:[],name:"Colombia Peso",exponent:2},{code:"czk",symbols:["k\u010d"],name:"Czech Republic Koruna",exponent:2},{code:"dkk",symbols:["dkr"],name:"Denmark Krone",exponent:2},{code:"hkd",symbols:["hk$"],name:"Hong Kong Dollar",exponent:2},{code:"idr",symbols:["rp"],name:"Indonesia Rupiah",exponent:2},{code:"inr",symbols:["rs"],name:"India Rupee",exponent:2},{code:"jpy",symbols:["\xa5","\xa5","\u5186"],name:"Japan Yen",exponent:2},{code:"jod",symbols:[],name:"Jordanian Dinar",exponent:2},{code:"kpw",symbols:["\u20a9"],name:"Korea Won",exponent:2},{code:"mop",symbols:[],name:"Macao Pataca",exponent:2},{code:"mxn",symbols:[],name:"Mexico Peso",exponent:2},{code:"myr",symbols:["rm"],name:"Malaysia Ringgit",exponent:2},{code:"nok",symbols:[],name:"Norway Krone",exponent:2},{code:"nzd",symbols:["nz$"],name:"New Zealand Dollar",exponent:2},{code:"php",symbols:["\u20b1"],name:"Philippines Peso",exponent:2},{code:"pln",symbols:["z\u0142"],name:"Poland Zloty",exponent:2},{code:"ron",symbols:["lei"],name:"Romania New Leu",exponent:2},{code:"rub",symbols:["\u20bd"],name:"Russia Ruble",exponent:2},{code:"sar",symbols:["\ufdfc"],name:"Saudi Arabia Riyal",exponent:2},{code:"sek",symbols:["kr"],name:"Sweden Krona",exponent:2},{code:"sgd",symbols:["sg$"],name:"Singapore Dollar",exponent:2},{code:"chf",symbols:[],name:"Switzerland Franc",exponent:2},{code:"thb",symbols:["\u0e3f"],name:"Thailand Baht",exponent:2},{code:"twd",symbols:["nt$"],name:"Taiwan New Dollar",exponent:2},{code:"zar",symbols:["r"],name:"South Africa Rand",exponent:2},{code:"aed",symbols:["\u062f.\u0625","dirham"],name:"United Arab Emirates dirham",exponent:2},{code:"gbp",symbols:["\xa3","\uffe1"],name:"United Kingdom Pound",exponent:2}],ae=ne.reduce((function(t,e){return t.concat(e.code).concat(e.symbols)}),[]).map((function(t){return t.replace(/([\$\.])/g,"\\$1")})).join("|"),ie="(\\s*\\d+(?:".concat("[.,\\'\u2018\u2019\u201b\u2032\xb4`]","*\\d+)*)"),oe="(".concat(ae,")"),se=["[\u2212\u2013\u2011\u2014\u2012-]?",oe,"[\u2212\u2013\u2011\u2014\u2012-]?",ie].join("\\s*"),ce=["[\u2212\u2013\u2011\u2014\u2012-]?",ie,oe].join("\\s*"),ue="(?:\\s*".concat([se,ce].join("|"),")"),fe=new RegExp("".concat("(?:^|\\s+)").concat(ue).concat("(?=$|\\s+|[,;:\\!\\?\\.\\'\"\\+\\-])"),"ig");function le(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};if(!(t=String(t||"")))return null;fe.lastIndex=0;var r=fe.exec(t);return r?ye(r,e):null}function ye(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},r=e.parseNegative,n=void 0!==r&&r,a=new RegExp("[\u2212\u2013\u2011\u2014\u2012-]").test(t[0]),i=(t[1]||t[4]||"").toLowerCase(),o=ne.find((function(t){return t.code===i||t.symbols.indexOf(i)>-1}));if(!o)return null;var s=o.exponent,c=n&&a?-1:1,u=c*de(t[2]||t[3],s),f=Math.round(u*Math.pow(10,s));return{value:f,floatValue:u,symbol:i,currencyCode:o.code,currency:o}}function de(t,e){var r=t.split(new RegExp("[.,\\'\u2018\u2019\u201b\u2032\xb4`]+")),n=parseInt(r.join("")),a=r[r.length-1],i=r.length>1&&a.length<=e,o=a.length;return i?n/Math.pow(10,o):n}function pe(t,e,r,n,a,i,o){try{var s=t[i](o),c=s.value}catch(u){return void r(u)}s.done?e(c):Promise.resolve(c).then(n,a)}function ge(t){return function(){var e=this,r=arguments;return new Promise((function(n,a){var i=t.apply(e,r);function o(t){pe(i,n,a,o,s,"next",t)}function s(t){pe(i,n,a,o,s,"throw",t)}o(void 0)}))}}function he(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function me(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}var Ge=function(){function t(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:500;he(this,t),this.objectWatcherTick=null,this.objectWatchers=[],this.tick_interval=e}var e,r,n;return e=t,(r=[{key:"someElementsExistAsync",value:function(t){var e=this,r=t.map((function(t){return e.getElementAsync(t)}));return Promise.race(r)}},{key:"allElementsExistAsync",value:function(t){var e=this,r=t.map((function(t){return e.getElementAsync(t)}));return Promise.all(r)}},{key:"someElementsExist",value:function(t){var e=this;return t.map((function(t){return e.getElement(t)})).some(Boolean)}},{key:"allElementsExist",value:function(t){var e=this;return t.map((function(t){return e.getElement(t)})).every(Boolean)}},{key:"getElement",value:function(t){return document.querySelector(t)}},{key:"getElementAsync",value:function(t){var e=this;return new Promise((function(r){Granify.onElementAddedDeep(t,(function(){r(e.getElement(t))}))}))}},{key:"getElementText",value:function(t){try{return this.getElement(t).innerText}catch(e){return null}}},{key:"getElementTextAsync",value:function(t){var e=this;return new Promise(function(){var r=ge(i.a.mark((function r(n){var a;return i.a.wrap((function(r){for(;;)switch(r.prev=r.next){case 0:return r.next=2,e.getElementAsync(t);case 2:a=r.sent,n(a.innerText);case 4:case"end":return r.stop()}}),r)})));return function(t){return r.apply(this,arguments)}}())}},{key:"getPriceFromElement",value:function(t){return le(this.getElementText(t))}},{key:"getIntegerFromElement",value:function(t){return this._getInteger(this.getElementText(t))}},{key:"getPriceFromDOMElement",value:function(t){return le(t.innerText)}},{key:"getPriceFromElementAsync",value:function(t){var e=this;return new Promise(function(){var r=ge(i.a.mark((function r(n){var a;return i.a.wrap((function(r){for(;;)switch(r.prev=r.next){case 0:return r.next=2,e.getElementTextAsync(t);case 2:a=r.sent,n(le(a));case 4:case"end":return r.stop()}}),r)})));return function(t){return r.apply(this,arguments)}}())}},{key:"getIntegerFromElementAsync",value:function(t){var e=this;return new Promise(function(){var r=ge(i.a.mark((function r(n){var a;return i.a.wrap((function(r){for(;;)switch(r.prev=r.next){case 0:return r.next=2,e.getElementTextAsync(t);case 2:a=r.sent,n(e._getInteger(a));case 4:case"end":return r.stop()}}),r)})));return function(t){return r.apply(this,arguments)}}())}},{key:"getValueFromObject",value:function(t){try{return t.reduce((function(t,e){return t[e]}),window)}catch(e){return}}},{key:"getValueFromObjectAsync",value:function(t){var e=this.getValueFromObject(t);if(e)return Promise.resolve(e);this._startObjectWatcherTick();var r={path:t,promiseResolver:void 0};return this.objectWatchers.push(r),new Promise((function(t){return r.promiseResolver=t}))}},{key:"getValueFromObjectWithinTimeLimit",value:function(t,e){if(e<500)throw new TypeError("Cannot set watcher with lower timeLimit than ".concat(500));var r=this.getValueFromObject.bind(this,t),n=this.getValueFromObjectAsync.bind(this,t);return this._timeConstrainedGetter(r,n,e)}},{key:"getPriceFromElementWithinTimeLimit",value:function(t,e){var r=this.getPriceFromElement.bind(this,t),n=this.getPriceFromElementAsync.bind(this,t);return this._timeConstrainedGetter(r,n,e)}},{key:"getElementWithinTimeLimit",value:function(t,e){var r=this.getElement.bind(this,t),n=this.getElementAsync.bind(this,t);return this._timeConstrainedGetter(r,n,e)}},{key:"getElementTextWithinTimeLimit",value:function(t,e){var r=this.getElementText.bind(this,t),n=this.getElementTextAsync.bind(this,t);return this._timeConstrainedGetter(r,n,e)}},{key:"_timeConstrainedGetter",value:function(t,e,r){var n=t();return n?Promise.resolve(n):new Promise(function(){var t=ge(i.a.mark((function t(n,a){var o;return i.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return setTimeout(a,r),t.next=3,e();case 3:o=t.sent,n(o);case 5:case"end":return t.stop()}}),t)})));return function(e,r){return t.apply(this,arguments)}}())}},{key:"_startObjectWatcherTick",value:function(){this.objectWatcherTick||(this.objectWatcherTick=setInterval(this._handleObjectWatcherOnTick.bind(this),this.tick_interval))}},{key:"_stopObjectWatcherTickIfNoWatchers",value:function(){this.objectWatchers.length||(this.objectWatcherTick=clearInterval(this.objectWatcherTick))}},{key:"_handleObjectWatcherOnTick",value:function(){for(var t=this.objectWatchers.length-1;t>=0;t--){var e=this.objectWatchers[t],r=e.path,n=e.promiseResolver,a=this.getValueFromObject(r);void 0!==a&&(n(a),this.objectWatchers.splice(t,1))}this._stopObjectWatcherTickIfNoWatchers()}},{key:"_getInteger",value:function(t){var e=t.replace(",","").replace(".","").match(/\d+/g);return e?e.map((function(t){return parseInt(t)}))[0]:e}}])&&me(e.prototype,r),n&&me(e,n),t}();Granify.domParser=new Ge,Granify.scraper=Granify.domParser;var _e;r(54),r(55),r(56),r(57),r(58),r(59),r(60),r(61),r(62),r(63);function ve(t,e){var r;if("undefined"===typeof Symbol||null==t[Symbol.iterator]){if(Array.isArray(t)||(r=function(t,e){if(!t)return;if("string"===typeof t)return be(t,e);var r=Object.prototype.toString.call(t).slice(8,-1);"Object"===r&&t.constructor&&(r=t.constructor.name);if("Map"===r||"Set"===r)return Array.from(t);if("Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return be(t,e)}(t))||e&&t&&"number"===typeof t.length){r&&(t=r);var n=0,a=function(){};return{s:a,n:function(){return n>=t.length?{done:!0}:{done:!1,value:t[n++]}},e:function(t){throw t},f:a}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var i,o=!0,s=!1;return{s:function(){r=t[Symbol.iterator]()},n:function(){var t=r.next();return o=t.done,t},e:function(t){s=!0,i=t},f:function(){try{o||null==r.return||r.return()}finally{if(s)throw i}}}}function be(t,e){(null==e||e>t.length)&&(e=t.length);for(var r=0,n=new Array(e);r<e;r++)n[r]=t[r];return n}function Ee(t,e,r,n,a,i,o){try{var s=t[i](o),c=s.value}catch(u){return void r(u)}s.done?e(c):Promise.resolve(c).then(n,a)}function we(t,e,r){return e in t?Object.defineProperty(t,e,{value:r,enumerable:!0,configurable:!0,writable:!0}):t[e]=r,t}var Se=function(){return new Promise((function(t){Granify.on("nonCachedMatchRequestComplete",(function(){var e=Granify.getGranifyDataValue(Granify.constants.SERIALIZED_CAMPAIGN_HISTORY);e||(e=[]),t(JSON.parse(JSON.stringify(e)))}))}))},Ae=function(t,e){var r=t.indexOf(e);return-1===r?null:r},ke={cart:Granify.constants.OFFER_EVENT_ADD_TO_CART,product:Granify.constants.OFFER_EVENT_VIEW_PRODUCT},Oe=(we(_e={},Granify.constants.OFFER_EVENT_ADD_TO_CART,!1),we(_e,Granify.constants.OFFER_EVENT_VIEW_PRODUCT,!1),_e),Te=function(){var t,e=(t=i.a.mark((function t(e){var r,n,a,o,s,c,u,f,l,y,d,p,g,h,m,G,_=arguments;return i.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(r=_.length>1&&void 0!==_[1]?_[1]:[],!0!==Oe[n=ke[e]]){t.next=4;break}return t.abrupt("return");case 4:Oe[n]=!0,a=ve(r),t.prev=6,a.s();case 8:if((o=a.n()).done){t.next=40;break}return s=o.value,c=s.sku,u=s.product_id,f=s.add_to_cart_count,t.next=15,Se();case 15:if(l=t.sent,"cart"!==e||0!==f){t.next=18;break}return t.abrupt("continue",38);case 18:y=ve(l),t.prev=19,y.s();case 21:if((d=y.n()).done){t.next=29;break}if(p=d.value,"cart"!==e||!0!==p.offerEventAddToCartTriggered){t.next=25;break}return t.abrupt("continue",27);case 25:g=[Ae(p.skus,c),Ae(p.product_ids,u)],h=g[0],m=g[1],null===h&&null===m||(p.offerEventAddToCartTriggered="cart"===e||p.offerEventAddToCartTriggered,G={eventType:n,serializedWidget:p,productIndex:null!==h?h:m},Granify.trigger(Granify.constants.OFFER_EVENT,{eventParams:G}));case 27:t.next=21;break;case 29:t.next=34;break;case 31:t.prev=31,t.t0=t.catch(19),y.e(t.t0);case 34:return t.prev=34,y.f(),t.finish(34);case 37:Granify.trackGranifyData(Granify.constants.SERIALIZED_CAMPAIGN_HISTORY,l,"session");case 38:t.next=8;break;case 40:t.next=45;break;case 42:t.prev=42,t.t1=t.catch(6),a.e(t.t1);case 45:return t.prev=45,a.f(),t.finish(45);case 48:Oe[n]=!1;case 49:case"end":return t.stop()}}),t,null,[[6,42,45,48],[19,31,34,37]])})),function(){var e=this,r=arguments;return new Promise((function(n,a){var i=t.apply(e,r);function o(t){Ee(i,n,a,o,s,"next",t)}function s(t){Ee(i,n,a,o,s,"throw",t)}o(void 0)}))});return function(t){return e.apply(this,arguments)}}();Granify.triggerProductOfferEvents=Te.bind(void 0,"product"),Granify.triggerCartOfferEvents=Te.bind(void 0,"cart");r(64);function Ce(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}var Ie=function(){function t(e){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this.enabled=!1,e&&e.includes("data_array")&&(this.enabled=!0)}var e,r,n;return e=t,(r=[{key:"saveTerms",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;this.enabled?(Granify.logDebug("Saving Search Terms: ".concat(t.join(", ")," with ").concat(e," total results")),Granify.trigger(Granify.constants.SITE_EVENT,{eventParams:{vendor:Granify.constants.GRANIFY_VENDOR,eventName:Granify.constants.SITE_EVENT_SEARCH_TERMS,eventType:Granify.constants.SITE_EVENT_TYPE_DATA_ARRAY,eventValue:e,eventData:t.filter((function(t){return t})).join("|")}})):Granify.logWarningOnce("Search Terms tracking is not available for this site.")}}])&&Ce(e.prototype,r),n&&Ce(e,n),t}();function De(t,e,r,n,a,i,o){try{var s=t[i](o),c=s.value}catch(u){return void r(u)}s.done?e(c):Promise.resolve(c).then(n,a)}function Pe(t){return function(){var e=this,r=arguments;return new Promise((function(n,a){var i=t.apply(e,r);function o(t){De(i,n,a,o,s,"next",t)}function s(t){De(i,n,a,o,s,"throw",t)}o(void 0)}))}}function Ne(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}Granify.searchUtility=new Ie(Bt);var Re=function(){function t(){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t)}var e,r,n,a;return e=t,(r=[{key:"activateNewAndReturnUserMonitor",value:function(){var t=this;Granify.on("nonCachedMatchRequestComplete",Pe(i.a.mark((function e(){return i.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,t._monitorNewAndReturnUsers();case 2:return e.abrupt("return",e.sent);case 3:case"end":return e.stop()}}),e)}))))}},{key:"_monitorNewAndReturnUsers",value:(a=Pe(i.a.mark((function t(){var e,r,n;return i.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return e="first_visit_session_id",this._setNewUserFlag(),t.t0=Boolean,t.next=5,Granify.getSharedData(Granify.storage.NEW_USER);case 5:if(t.t1=t.sent,r=(0,t.t0)(t.t1),n=Granify.getGranifyDataValue(e),r){t.next=11;break}return this._countReturnUser(),t.abrupt("return");case 11:if(n){t.next=15;break}return Granify.trackGranifyData(e,Granify.SERVER_SESSION_ID),this._countNewUser(),t.abrupt("return");case 15:if(n==Granify.SERVER_SESSION_ID){t.next=19;break}return Granify.setSharedData(Granify.storage.NEW_USER,!1),this._countReturnUser(),t.abrupt("return");case 19:this._countNewUser();case 20:case"end":return t.stop()}}),t,this)}))),function(){return a.apply(this,arguments)})},{key:"_countNewUser",value:function(){Granify.metrics.countOnce("newUser")}},{key:"_countReturnUser",value:function(){Granify.metrics.countOnce("returnUser")}},{key:"_setNewUserFlag",value:function(){Granify.wasUUIDCreated&&Granify.setSharedData(Granify.storage.NEW_USER,!0)}}])&&Ne(e.prototype,r),n&&Ne(e,n),t}();function xe(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}Granify.userMonitor=new Re;var Le=function(){function t(){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this.displayedCampaigns={}}var e,r,n;return e=t,(r=[{key:"handleDisplay",value:function(t){var e=t.d||t.should_display,r=Granify.campaigns||{};if("object"===typeof e){for(var n=0,a=Object.keys(e);n<a.length;n++){var i=a[n],o=r[i];o&&this.setDisplay(!!e[i],o)}for(var s=0,c=Object.keys(r);s<c.length;s++){var u=c[s];/^\d{1,6}$/.test(u)||void 0===e[u]&&this.removeCampaign(Granify.campaigns[u])}}else if("boolean"===typeof e)for(var f=0,l=Object.values(r);f<l.length;f++){var y=l[f];this.triggerMessage(e,y.options||y.state)}else if(!Granify.itExists(e)&&Granify.itExists(Granify.campaigns))for(var d=0,p=Object.values(r);d<p.length;d++){var g=p[d];this.removeCampaign(g)}}},{key:"removeCampaign",value:function(t){Granify.itExists(t)&&"function"===typeof t.remove&&t.remove()}},{key:"setDisplay",value:function(t,e){var r=this;e.html?this.triggerMessage(t,e.options||e.state):Granify.on(e.state.widget_event,(function(){r.triggerMessage(t,e.options||e.state)}))}},{key:"triggerMessage",value:function(t,e){Granify.trigger(t?Granify.constants.EVENT_MESSAGE_SHOW:Granify.constants.EVENT_MESSAGE_HIDE,{id:e.id,offerId:e.offer_id,widget:e.experiment})}}])&&xe(e.prototype,r),n&&xe(e,n),t}();Granify.displayController=new Le;Granify.match=Granify.match||{},Granify.match.handleWidgetDisplayMetrics=function(t){if(null!=t.sns){var e=Granify.deepClone(t.sns);Array.isArray(e)||(e=[e]),e.forEach((function(e){var r=e.cid||"not available",n=e.did||"not available",a=Granify.group||"not available",i="not available";if(t.campaign&&t.campaign.experiment&&(i=t.campaign.experiment),e.experiment&&(i=e.experiment),null==e.ms)return!1;var o=e.ms?Granify.constants.EVENT_MESSAGE_SHOWN:Granify.constants.EVENT_MESSAGE_NOT_SHOWN;Granify.itExists(Granify.metrics)&&Granify.metrics.count("internal."+o.toLowerCase().replace(/[^A-Za-z]/g,"")),Granify.trigger(o,{id:r,widget:i,display_id:n,group:a})}))}},Granify.match.handleToolPairsResponse=function(t){if(t&&t.tp)return Granify.toolPairs=(e=t.tp,r={},Object.keys(e).forEach((function(t){r[t.toLowerCase()]=e[t]})),r),Granify.trackGranifyData(Granify.constants.STORED_SESSION_TOOL_PAIRS,Granify.toolPairs,"session"),Granify.trigger(Granify.constants.EVENT_TOOL_PAIRS_ASSIGNED,Granify.toolPairs),!0;var e,r;if(Granify.itExists(Granify.toolPairs))return!0;var n=Granify.getGranifyDataValue(Granify.constants.STORED_SESSION_TOOL_PAIRS,!1);return n?(Granify.toolPairs=n,Granify.trigger(Granify.constants.EVENT_TOOL_PAIRS_ASSIGNED,Granify.toolPairs),!0):Granify.logWarningOnce("Tried getting tool pairs from session storage but nothing found. We should have recieved this from the initial match request.")};var je=r(2),Fe=r.n(je);function Ue(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}var Me=function(){function t(){var e=this;!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this.refreshDelay=500,this.cid=null,this.crf=null,this.campaign=null,this.displaying=!1,this.hidden=!1,this.elements={},Granify.on("force_match:update",(function(){e.refresh()})),this.refresh()}var e,r,n;return e=t,(r=[{key:"refresh",value:function(){this.cid=Granify._getForceMatchingCid(),this.cid&&"null"!==this.cid&&(this.displaying||this.display(),this.elements.idLabel.innerText=this.cid,this.campaign?this.elements.campaignLabel.innerText=this.campaign.experiment+": "+this.campaign.headline:this.elements.campaignLabel.innerText=null,this.crf?(this.elements.crfLabel.innerText="Failed Restrictions",this.elements.crfSlider.innerText=this.crf,this.crfTranslation.length>0&&(this.elements.crfLabel.innerText+=" ("+this.crfTranslation+")"),this.elements.crfLabel.style.display="block"):(this.elements.crfLabel.innerText=null,this.elements.crfSlider.innerText=null,this.elements.crfLabel.style.display="none"),this.elements.campaignInfoWrapperInner.clientWidth>this.elements.campaignInfoWrapper.clientWidth?this.elements.campaignInfoWrapperInner.classList.add("granify__status-bar-campaign-info-slide"):this.elements.campaignInfoWrapperInner.classList.remove("granify__status-bar-campaign-info-slide"))}},{key:"refreshWithDelay",value:function(){var t=this;setTimeout((function(){t.refresh()}),this.refreshDelay)}},{key:"translateCRF",value:function(t){return t?t.search(/missing site_state_data\(cp_number_of_reviews/)>=0?"Number of reviews missing.":t.search(/missing site_state_data\(cp_product_id/)>=0?"Install error, trackProduct failed.":t.search(/missing site_state_data\(dl_client_current_locale/)>=0?"Install error, locale not passed.":t.search(/missing site_state_data\(dl_loyalty_details_function_available/)>=0?"Page Loyalty Details Function is missing.":t.search(/missing site_state_data\(dl_restricted_state/)>=0?"Install error, restricted state missing.":t.search(/missing site_state_data\(dl_tooltip_product_concepts_possible/)>=0?"Install error, append location missing.":t.search(/cart_contains_item_from_offer\(restricted_item_id/)>=0?"Campaign matched cart item no longer present.":t.search(/changed_since_offer_triggered\(num_pagevisits/)>=0?"Too many page navigations since match.":t.search(/changed_since_offer_triggered\(site_state_data\(cp_product_id/)>=0?"Navigated away from matched product page.":t.search(/changed_since_offer_triggered\(site_state_data\(dl_language_code/)>=0?"Changed language since match.":t.search(/cart_spent:/)>=0?"Invalid cart total value.":t.search(/cdiscount_coupons_available/)>=0?"No coupons available.":t.search(/current_page_type/)>=0?"Invalid page type.":t.search(/has_restricted_cart_item_add|has_restricted_cart_item_product_id_add/)>=0?"Cart item doesn't exist or add-to-cart count invalid.":t.search(/has_restricted_cart_item_view|has_restricted_cart_item_product_id_view/)>=0?"Cart item doesn't exist or view count invalid.":t.search(/has_restricted_cart_item_purchase|has_restricted_cart_item_product_id_purchase/)>=0?"Cart item doesn't exist or purchase count invalid.":t.search(/current_product_add|current_product_sku_add/)>=0?"Item's add-to-cart count invalid.":t.search(/current_product_view|current_product_sku_view/)>=0?"Item's view count invalid.":t.search(/current_product_purchase|current_product_sku_purchase/)>=0?"Item's purchase count invalid.":t.search(/has_cart:/)>=0?"No items detected in cart.":t.search(/has_cart_savings:/)>=0?"No items in cart with savings.":t.search(/cart_savings:/)>=0?"Total cart savings not in valid range.":t.search(/has_restricted_cart_item_discount_percentage/)>=0?"Cart item doesn't exist or discount is invalid.":t.search(/has_restricted_cart_item_feature\(ca.*restricted_top_cart_id/)>=0?"Cart item can't be in the top cart index.":t.search(/has_restricted_cart_item_numeric.*in_stock/)>=0?"Cart item doesn't exist or stock count invalid.":t.search(/has_restricted_cart_item_numeric.*,price,>/)>=0?"Cart item doesn't exist or price threshold not met.":t.search(/has_restricted_cart_item_numeric.*regular_price,>/)>=0?"Cart item doesn't exist or regular price threshold not met.":t.search(/has_restricted_cart_item_numeric.*,price/)>=0?"Cart item doesn't exist or price invalid.":t.search(/has_restricted_cart_item_numeric.*regular_price/)>=0?"Cart item doesn't exist or regular price invalid.":t.search(/has_restricted_cart_item_numeric.*savings/)>=0?"Cart item doesn't exist or doesn't have savings.":t.search(/has_restricted_cart_item_numeric.*ratings/)>=0?"Cart item doesn't exist or ratings invalid.":t.search(/has_restricted_cart_item_string.*category/)>=0?"Cart item doesn't exist or is of an invalid category.":t.search(/has_restricted_cart_item_string.*image/)>=0?"Cart item doesn't exist or has an invalid image.":t.search(/has_restricted_cart_item_string.*product_id/)>=0?"Cart item doesn't exist or has an invalid product ID.":t.search(/has_restricted_cart_item_string.*promotion_end_timestamp/)>=0?"Cart item doesn't exist or has an invalid ending timestamp.":t.search(/has_restricted_cart_item_string.*title/)>=0?"Cart item doesn't exist or has an invalid title.":t.search(/in_list\(.*restricted_item/)>=0?"Cart item doesn't exist or is invalid for whitelist/blacklist.":t.search(/in_list\(/)>=0?"Current item is invalid for whitelist/blacklist.":t.search(/matching_group:/)>=0?"Invalid matching group assigned.":t.search(/path:/)>=0?"URL is not allowed.":t.search(/pc_is_hidden_gem\(.*restricted_product/)>=0?"Cart item doesn't exist or is not a qualified hidden gem.":t.search(/pc_is_hidden_gem\(/)>=0?"Item is not a qualified hidden gem.":t.search(/site_state_data\(add_to_|site_state_data\(dl_client_add_to_|site_state_data\(dl_add_to_/)>=0?"Page add to bag element not detected.":t.search(/site_state_data\(cp_product_id\):.*\[1\]\[0-9\]/)>=0?"Item has a matrix ID or invalid product ID":t.search(/site_state_data\(cp_product_id\):/)>=0?"Invalid item product ID.":t.search(/site_state_data\(cp_price\):/)>=0?"Invalid item price.":t.search(/site_state_data\(cp_regular_price\):/)>=0?"Invalid item regular price.":t.search(/site_state_data\(cp_savings\):/)>=0?"Invalid item savings amount.":t.search(/missing site_state_data\(cp_promotion_percentage_discount\)/)>=0?"Item discount percentage not passed.":t.search(/site_state_data\(cp_promotion_percentage_discount\):/)>=0?"Invalid item discount percentage.":t.search(/site_state_data\(cp_category\):/)>=0?"Invalid item category.":t.search(/site_state_data\(cp_sub_category\):/)>=0?"Invalid item sub-category.":t.search(/site_state_data\(cp_in_stock\):/)>=0?"Invalid item stock.":t.search(/site_state_data\(dl_inline_cart_concepts_possible\):/)>=0?"Campaign append location not detected.":t.search(/site_state_data\(dl.*item_total/)>=0?"Insuffient/Invalid category item total.":t.search(/sp_viewed_product_w_price_drop\(/)>=0?"User history contains no valid price drop item.":"":""}},{key:"updateCRF",value:function(t){this.crf=t,this.crfTranslation=this.translateCRF(t),this.refreshWithDelay()}},{key:"updateCampaign",value:function(t){this.campaign=t,this.refreshWithDelay()}},{key:"createElement",value:function(t){for(var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},r=arguments.length>2?arguments[2]:void 0,n=document.createElement(t),a=0,i=Object.keys(e);a<i.length;a++){var o=i[a];n[o]=e[o]}return r&&r.appendChild(n),n}},{key:"display",value:function(){var t=this;this.displaying=!0,this.elements.style=this.createElement("style",{innerText:Fe.a}),this.elements.wrapper=this.createElement("div",{className:"granify__status-bar-wrapper"}),this.elements.content=this.createElement("div",{className:"granify__status-bar-content",innerHTML:'<span class="granify__status-bar-logo"></span><span><strong>Force Matching:</strong></span>'}),this.elements.campaignInfoWrapper=this.createElement("div",{className:"granify__status-bar-campaign-info"},this.elements.content),this.elements.campaignInfoWrapperInner=this.createElement("div",{className:"granify__status-bar-campaign-info-inner"},this.elements.campaignInfoWrapper),this.elements.idLabel=this.createElement("span",{},this.elements.campaignInfoWrapperInner),this.elements.campaignLabel=this.createElement("span",{className:"granify__status-bar-campaign-label"},this.elements.campaignInfoWrapperInner),this.elements.crfLabel=this.createElement("span",{className:"granify__status-bar-crf-label"},this.elements.content),this.elements.crfSlider=this.createElement("div",{className:"granify__status-bar-crf-slider"}),this.elements.crfLabel.addEventListener("click",(function(){t.elements.crfSlider.classList.toggle("granify__status-bar-crf-slider-active")})),this.elements.closeButton=this.createElement("div",{className:"granify__status-bar-button",innerHTML:'<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="white" width="24px" height="24px">\n  <path d="M0 0h24v24H0z" fill="none"/>\n  <path d="M19 6.41L17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"/>\n</svg>'},this.elements.wrapper),this.elements.closeButton.addEventListener("click",this.destroy.bind(this)),this.elements.toggleButton=this.createElement("div",{className:"granify__status-bar-button granify__status-bar-chevron",innerHTML:'<svg xmlns="http://www.w3.org/2000/svg" height="24" viewBox="0 0 24 24" width="24" fill="white">\n  <path d="M0 0h24v24H0z" fill="none"/>\n  <path d="M10 6L8.59 7.41 13.17 12l-4.58 4.59L10 18l6-6z"/>\n</svg>'},this.elements.wrapper),this.elements.toggleButton.addEventListener("click",(function(){t.elements.content.classList.toggle("granify__status-bar-hidden")})),this.elements.wrapper.appendChild(this.elements.content),this.elements.wrapper.appendChild(this.elements.crfSlider),document.body.appendChild(this.elements.wrapper),document.head.appendChild(this.elements.style)}},{key:"destroy",value:function(){document.body.removeChild(this.elements.wrapper),document.head.removeChild(this.elements.style),this.elements={},Granify.setSharedData(Granify.storage.FORCE_MATCHING,null),Granify._sendResetSessionFlag=!0;var t=Granify.campaigns[this.campaign.offer_id];t&&"function"===typeof t.remove&&t.remove(),this.displaying=!1}}])&&Ue(e.prototype,r),n&&Ue(e,n),t}();Granify.forceMatchingStatusBar=new Me;r(68);function Be(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}var He=function(){function t(){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this._internalCache=new Map}var e,r,n;return e=t,(r=[{key:"set",value:function(t,e,r){if(this._internalCache.has(t))this._internalCache.get(t).set(e,r);else{var n=new Map;n.set(e,r),this._internalCache.set(t,n)}return this}},{key:"has",value:function(t,e){return!!this._internalCache.has(t)&&this._internalCache.get(t).has(e)}},{key:"get",value:function(t,e){if(this._internalCache.has(t))return this._internalCache.get(t).get(e)}},{key:"delete",value:function(t,e){if(!this._internalCache.has(t))return!1;var r=this._internalCache.get(t),n=r.delete(e);return 0===r.size&&this._internalCache.delete(t),n}}])&&Be(e.prototype,r),n&&Be(e,n),t}();function Ve(t,e){var r;if("undefined"===typeof Symbol||null==t[Symbol.iterator]){if(Array.isArray(t)||(r=function(t,e){if(!t)return;if("string"===typeof t)return We(t,e);var r=Object.prototype.toString.call(t).slice(8,-1);"Object"===r&&t.constructor&&(r=t.constructor.name);if("Map"===r||"Set"===r)return Array.from(t);if("Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return We(t,e)}(t))||e&&t&&"number"===typeof t.length){r&&(t=r);var n=0,a=function(){};return{s:a,n:function(){return n>=t.length?{done:!0}:{done:!1,value:t[n++]}},e:function(t){throw t},f:a}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var i,o=!0,s=!1;return{s:function(){r=t[Symbol.iterator]()},n:function(){var t=r.next();return o=t.done,t},e:function(t){s=!0,i=t},f:function(){try{o||null==r.return||r.return()}finally{if(s)throw i}}}}function We(t,e){(null==e||e>t.length)&&(e=t.length);for(var r=0,n=new Array(e);r<e;r++)n[r]=t[r];return n}function Ye(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}!function(){var t=new He;function e(t,e){var r,n=t,a=Ve(e.split("."));try{for(a.s();!(r=a.n()).done;){var i=r.value;if(void 0===n[i])return!1;n=n[i]}}catch(o){a.e(o)}finally{a.f()}return!0}Granify.whenPropertyExists=function(r,n,a){if(!r)return Promise.reject("Object to check is not valid");if(!function(t){return t&&"string"===typeof t}(n))return Promise.reject('Property name "'.concat(n,'" is invalid"'));var i=Object.assign({initialDelayInMs:50,maxDelayInMs:2e3,timeoutInMs:2e4},a||{});if(e(r,n)){if(t.has(r,n)){var o=t.get(r,n);return clearTimeout(o.retryTimer),clearTimeout(o.timeoutTimer),o.resolve(),t.delete(r,n),o.promise}return Promise.resolve()}if(t.has(r,n))return t.get(r,n).promise;var s={options:i,propertyName:n,objectToCheck:r,duration:0,retries:0,resolve:null,reject:null,timeoutTimer:null,retryTimer:null},c=new Promise((function(r,n){s.resolve=r,s.reject=n,function r(n){n.retries++;var a=function(t){return Math.min(Math.max(t.options.initialDelayInMs,t.duration),t.options.maxDelayInMs)}(n);n.duration+=a,n.retryTimer=setTimeout((function(){if(e(n.objectToCheck,n.propertyName))return clearTimeout(n.timeoutTimer),n.resolve(),void t.delete(n.objectToCheck,n.propertyName);r(n)}),a)}(s)}));return s.promise=c,i.timeoutInMs&&(s.timeoutTimer=setTimeout((function(){clearTimeout(s.retryTimer),s.reject("Property ".concat(s.propertyName," did not appear within the designated timeout.")),t.delete(s.objectToCheck,s.propertyName)}),i.timeoutInMs)),t.set(r,n,s),c}}(Granify);var qe=function(){function t(e){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this.prefix=e}var e,r,n;return e=t,(r=[{key:"show",value:function(){Granify.logDebug("BaseVendorAPI: ".concat(this.prefix,".show"))}},{key:"onShow",value:function(t){Granify.logDebug("".concat(this.prefix," Vendor API: onShow called with"),t),Granify.onEvery("".concat(this.prefix,".show"),t)}},{key:"onGroupAssigned",value:function(t){Granify.logDebug("".concat(this.prefix," Vendor API: onGroupAssigned called with"),t),Granify.onEvery("".concat(this.prefix,".groupAssigned"),t)}},{key:"ping",value:function(){return Granify.logDebug("".concat(this.prefix," ping called")),!0}},{key:"_saveOfferEvent",value:function(t,e){var r="".concat(this.prefix,":").concat(t);Granify.logDebug("".concat(this.prefix,": Saving Offer Event '").concat(r,"'"),e)}},{key:"_saveSiteEvent",value:function(t){Granify.logDebug("".concat(this.prefix,": Saving Site Event '").concat(this.prefix,":").concat(t,"'")),Granify.trigger(Granify.constants.SITE_EVENT,{eventParams:{vendor:this.prefix,eventName:t,eventType:Granify.constants.SITE_EVENT_TYPE_COUNT,eventValue:1}})}}])&&Ye(e.prototype,r),n&&Ye(e,n),t}();function ze(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}var Ke=function(){function t(){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t)}var e,r,n;return e=t,n=[{key:"register",value:function(t,e){return!!this.validate(t,e)&&(this._extendsBaseClass(e)?(this.registry.push({name:t,classReference:e}),Granify.logDebug("".concat(this.registerName,": ").concat(t,", added to registry")),!0):(Granify.logError("".concat(this.registerName,": ").concat(t,", not added because it does not extend ").concat(this.baseClass.name)),!1))}},{key:"validate",value:function(){return!0}},{key:"resetRegistry",value:function(){this.registry=[]}},{key:"_extendsBaseClass",value:function(t){return t.prototype instanceof this.baseClass}}],(r=null)&&ze(e.prototype,r),n&&ze(e,n),t}();function Je(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function Xe(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}function Qe(t,e){return(Qe=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t})(t,e)}function $e(t){var e=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(t){return!1}}();return function(){var r,n=tr(t);if(e){var a=tr(this).constructor;r=Reflect.construct(n,arguments,a)}else r=n.apply(this,arguments);return Ze(this,r)}}function Ze(t,e){return!e||"object"!==typeof e&&"function"!==typeof e?function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t):e}function tr(t){return(tr=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}Ke.registerName="Base Registry",Ke.baseClass=Object,Ke.registry=[];var er=function(t){!function(t,e){if("function"!==typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&Qe(t,e)}(i,t);var e,r,n,a=$e(i);function i(){return Je(this,i),a.apply(this,arguments)}return e=i,n=[{key:"register",value:function(t,e){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;return this._extendsBaseClass(e)?(i.registry.push({name:t,classReference:e,customInstallClassReference:r}),Granify.logDebug("Vendor API: ".concat(t,", added to registry")),!0):(Granify.logError("".concat(this.registerName,": ").concat(t,", not added because it does not extend ").concat(this.baseClass.name)),!1)}},{key:"enabledVendors",get:function(){return i.registry.filter((function(t){return GRANIFY_CONFIG.vendorApisEnabled.includes(t.name)}))}}],(r=null)&&Xe(e.prototype,r),n&&Xe(e,n),i}(Ke);function rr(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}er.registerName="Vendor API",er.baseClass=qe,er.registry=[];var nr=function(){function t(){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t)}var e,r,n;return e=t,n=[{key:"getEvent",value:function(t){var e=this.LIGHTBOX_EVENTS.UNKNOWN;try{e=this._getNoDisplayEvents(t,e),e=this._getOfferDisplayEvents(t,e)}catch(r){Granify.logDebug("LightboxEventParser: Cannot find lightbox event",t)}return e}},{key:"_getOfferDisplayEvents",value:function(t,e){if(!this._isUnknownEvent(e)||!t.detail.response)return e;switch(t.detail.response.showedLightbox){case this.LIGHTBOX_EVENTS.ACQUISITION_SHOWED:e=this._getAcquisitionEvent(t.detail.response);break;case this.LIGHTBOX_EVENTS.OPT_BACK_SHOWED:e=this._getOptBackEvent(t.detail.response)}return e}},{key:"_getAcquisitionEvent",value:function(t){var e=this.LIGHTBOX_EVENTS.ACQUISITION_SHOWED;return t.invalidDisplay===this.LIGHTBOX_EVENTS.ACQUISITION_INVALID_EMAIL&&(e=this.LIGHTBOX_EVENTS.ACQUISITION_INVALID_EMAIL),t.alreadyRegistered===this.LIGHTBOX_EVENTS.ACQUISITION_ALREADY_REGISTERED&&(e=this.LIGHTBOX_EVENTS.ACQUISITION_ALREADY_REGISTERED),t.signedUp===this.LIGHTBOX_EVENTS.ACQUISITION_SIGNED_UP&&(e=this.LIGHTBOX_EVENTS.ACQUISITION_SIGNED_UP),e}},{key:"_getOptBackEvent",value:function(t){var e=this.LIGHTBOX_EVENTS.OPT_BACK_SHOWED;return t.signedUp===this.LIGHTBOX_EVENTS.OPT_BACK_SIGNED_UP&&(e=this.LIGHTBOX_EVENTS.OPT_BACK_SIGNED_UP),e}},{key:"_getNoDisplayEvents",value:function(t,e){if(!this._isUnknownEvent(e))return e;switch(t.detail.showIgnored){case this.LIGHTBOX_EVENTS.NO_DISPLAY:e=this.LIGHTBOX_EVENTS.NO_DISPLAY}return e}},{key:"_isUnknownEvent",value:function(t){return t===this.LIGHTBOX_EVENTS.UNKNOWN}}],(r=null)&&rr(e.prototype,r),n&&rr(e,n),t}();function ar(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}nr.LIGHTBOX_EVENTS={UNKNOWN:"Unknown",ACQUISITION_SHOWED:"Acquisition",ACQUISITION_SIGNED_UP:"Completed",ACQUISITION_INVALID_EMAIL:"Invalid",ACQUISITION_ALREADY_REGISTERED:"Existing",OPT_BACK_SHOWED:"OptBack",OPT_BACK_SIGNED_UP:"Completed",NO_DISPLAY:"Suppressed"};var ir=function(){function t(){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this.initializeSvData(),this.attachedToDataLayerEvents(),this.attachedVendorApiEvents()}var e,r,n;return e=t,(r=[{key:"initializeSvData",value:function(){window._svData=window._svData||[],Granify.synchronousGetSharedData(Granify.storage.DEBUG_LOG)&&(window._svData.debug=!0)}},{key:"attachedVendorApiEvents",value:function(){Granify.fourCite.onShow(this.vendorShowCallback.bind(this)),Granify.fourCite.onGroupAssigned(this.vendorGroupAssignedCallback)}},{key:"vendorShowCallback",value:function(){window.dataLayer.push({granify4Cite_showLightbox:!0}),this.add4CiteScript(),Granify.logDebug("FourCiteCustomInstall: vendorShowCallback")}},{key:"add4CiteScript",value:function(){window._svq=window._svq||[],window._svq.push(["_setAccount","1150_03572"]),function(t,e){var r=t.createElement(e);r.type="text/javascript",r.src="//track.securedvisit.com/js/sv.js";var n=t.getElementsByTagName(e)[0];n.parentNode.insertBefore(r,n)}(document,"script")}},{key:"vendorGroupAssignedCallback",value:function(t){window.dataLayer.push({granify4Cite_group:t}),Granify.logDebug("FourCiteCustomInstall: vendorGroupAssignedCallback with ".concat(t))}},{key:"attachedToDataLayerEvents",value:function(){window._svData.push(["on","offerdisplay",this.offerDisplayCallback]),window._svData.push(["on","offerclose",this.offerCloseCallback]),window._svData.push(["on","nodisplay",this.offerNoDisplayCallback]),Granify.logDebug("FourCiteCustomInstall: attachedToDataLayerEvents")}},{key:"offerCloseCallback",value:function(t){Granify.fourCite.dismissedLightbox(),Granify.logDebug("FourCiteCustomInstall: offerdisplay with data",t)}},{key:"offerDisplayCallback",value:function(t){switch(nr.getEvent(t)){case nr.LIGHTBOX_EVENTS.ACQUISITION_SHOWED:case nr.LIGHTBOX_EVENTS.OPT_BACK_SHOWED:Granify.fourCite.showedLightbox();break;case nr.LIGHTBOX_EVENTS.ACQUISITION_SIGNED_UP:case nr.LIGHTBOX_EVENTS.OPT_BACK_SIGNED_UP:Granify.fourCite.signedUp()}Granify.logDebug("FourCiteCustomInstall: offerdisplay with data",t)}},{key:"offerNoDisplayCallback",value:function(t){nr.getEvent(t)===nr.LIGHTBOX_EVENTS.NO_DISPLAY&&(Granify.fourCite.showIgnored(),Granify.logDebug("FourCiteCustomInstall: offerNoDisplayCallback with data",t))}}])&&ar(e.prototype,r),n&&ar(e,n),t}();function or(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}function sr(t,e){return(sr=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t})(t,e)}function cr(t){var e=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(t){return!1}}();return function(){var r,n=fr(t);if(e){var a=fr(this).constructor;r=Reflect.construct(n,arguments,a)}else r=n.apply(this,arguments);return ur(this,r)}}function ur(t,e){return!e||"object"!==typeof e&&"function"!==typeof e?function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t):e}function fr(t){return(fr=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}var lr=function(t){!function(t,e){if("function"!==typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&sr(t,e)}(i,t);var e,r,n,a=cr(i);function i(){var t;return function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,i),(t=a.call(this,"4Cite")).attachedVendorApiEvents(),t}return e=i,(r=[{key:"attachedVendorApiEvents",value:function(){Granify.onAll(Granify.constants.EVENT_TOOL_PAIRS_ASSIGNED,this.toolPairsAssigned)}},{key:"toolPairsAssigned",value:function(t){var e="4cite";!1===t["4citeemail"]&&(e="granify"),"boolean"===typeof t.granifyemail&&(e="granify"),Granify.trigger("4Cite.groupAssigned",e)}},{key:"dismissedLightbox",value:function(){this._saveSiteEvent(Granify.constants.SITE_EVENT_DISMISSEDLIGHTBOX)}},{key:"showIgnored",value:function(){this._saveSiteEvent(Granify.constants.SITE_EVENT_SHOWIGNORED)}},{key:"showedLightbox",value:function(){this._saveSiteEvent(Granify.constants.SITE_EVENT_SHOWEDLIGHTBOX)}},{key:"signedUp",value:function(){this._saveSiteEvent(Granify.constants.SITE_EVENT_SIGNEDUP)}}])&&or(e.prototype,r),n&&or(e,n),i}(qe);er.register("fourCite",lr,ir);r(69);function yr(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}var dr=function(){function t(){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t)}var e,r,n;return e=t,n=[{key:"createVendorApis",value:function(){Granify.logDebug("VendorApiController: createVendorApis() called");var t=er.enabledVendors;Granify.logDebug("VendorApiController: Vendor APIs to create",t),t.forEach((function(t){Granify[t.name]=new t.classReference,t.customInstallClassReference&&(Granify[t.name+"CustomInstall"]=new t.customInstallClassReference)}))}}],(r=null)&&yr(e.prototype,r),n&&yr(e,n),t}();function pr(t,e){return function(t){if(Array.isArray(t))return t}(t)||function(t,e){if("undefined"===typeof Symbol||!(Symbol.iterator in Object(t)))return;var r=[],n=!0,a=!1,i=void 0;try{for(var o,s=t[Symbol.iterator]();!(n=(o=s.next()).done)&&(r.push(o.value),!e||r.length!==e);n=!0);}catch(c){a=!0,i=c}finally{try{n||null==s.return||s.return()}finally{if(a)throw i}}return r}(t,e)||function(t,e){if(!t)return;if("string"===typeof t)return gr(t,e);var r=Object.prototype.toString.call(t).slice(8,-1);"Object"===r&&t.constructor&&(r=t.constructor.name);if("Map"===r||"Set"===r)return Array.from(t);if("Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return gr(t,e)}(t,e)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function gr(t,e){(null==e||e>t.length)&&(e=t.length);for(var r=0,n=new Array(e);r<e;r++)n[r]=t[r];return n}function hr(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}var mr=function(){function t(e){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this.name=e}var e,r,n;return e=t,(r=[{key:"validate",value:function(){return Granify.logWarning("".concat(this.name,": validate() should be overwritten.")),!1}},{key:"getCampaign",value:function(){return Granify.logWarning("".concat(this.name,": getCampaign() should be overwritten.")),{}}},{key:"handleOffer",value:function(){Granify.logDebug("".concat(this.name,": handling match request offer"))}},{key:"getOfferData",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return{product_data:t.pd,sku_data:t.spd,shared_offer_data:t.sod,shared_user_data:t.sud,site_data:t.sd,widget_state_data:t.wsd,campaign_data:t.slots}}},{key:"getUrl",value:function(t,e){var r;return r=e.raw_url?e.raw_url:e.custom_url?e.custom_url+"/"+t.id:Granify.domain+"/custom_assets/widget/"+t.experiment+".js/"+t.id,e.preview&&(r+="?preview=true"),r}},{key:"scaffoldCampaign",value:function(t,e){var r=pr(Qt.pick({id:"number",offer_id:"string",experiment:"string"}).validate(t),1)[0];r&&Granify.logWarning("".concat(this.name,": Campaign passed to scaffoldCampaign() failed validation"),r);var n=e.d||t.should_display||e.should_display||!1;return"object"===typeof n&&(n=n[t.offer_id]),{id:t.id,offer_id:t.offer_id,experiment:t.experiment,force_matching:e.force_matching,headline:t.outcome.headline,url:this.getUrl(t,e),is_multimatch:!1,is_baseline:t.is_baseline,should_display:n,widget_event:"offer:"+t.offer_id+":shown"}}},{key:"campaignIsLoaded",value:function(t){if(Granify.itExists(Granify.campaigns)){var e=Object.keys(Granify.campaigns).map((function(t){return t.toString()})),r=t.offer_id.toString();return e.some((function(t){return r===t}))}return!1}}])&&hr(e.prototype,r),n&&hr(e,n),t}();function Gr(t,e){var r=Object.keys(t);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(t);e&&(n=n.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),r.push.apply(r,n)}return r}function _r(t){for(var e=1;e<arguments.length;e++){var r=null!=arguments[e]?arguments[e]:{};e%2?Gr(Object(r),!0).forEach((function(e){vr(t,e,r[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(r)):Gr(Object(r)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(r,e))}))}return t}function vr(t,e,r){return e in t?Object.defineProperty(t,e,{value:r,enumerable:!0,configurable:!0,writable:!0}):t[e]=r,t}function br(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function Er(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}function wr(t,e,r){return(wr="undefined"!==typeof Reflect&&Reflect.get?Reflect.get:function(t,e,r){var n=function(t,e){for(;!Object.prototype.hasOwnProperty.call(t,e)&&null!==(t=Or(t)););return t}(t,e);if(n){var a=Object.getOwnPropertyDescriptor(n,e);return a.get?a.get.call(r):a.value}})(t,e,r||t)}function Sr(t,e){return(Sr=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t})(t,e)}function Ar(t){var e=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(t){return!1}}();return function(){var r,n=Or(t);if(e){var a=Or(this).constructor;r=Reflect.construct(n,arguments,a)}else r=n.apply(this,arguments);return kr(this,r)}}function kr(t,e){return!e||"object"!==typeof e&&"function"!==typeof e?function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t):e}function Or(t){return(Or=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}function Tr(t,e){var r=Object.keys(t);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(t);e&&(n=n.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),r.push.apply(r,n)}return r}function Cr(t){for(var e=1;e<arguments.length;e++){var r=null!=arguments[e]?arguments[e]:{};e%2?Tr(Object(r),!0).forEach((function(e){Ir(t,e,r[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(r)):Tr(Object(r)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(r,e))}))}return t}function Ir(t,e,r){return e in t?Object.defineProperty(t,e,{value:r,enumerable:!0,configurable:!0,writable:!0}):t[e]=r,t}function Dr(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function Pr(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}function Nr(t,e,r){return(Nr="undefined"!==typeof Reflect&&Reflect.get?Reflect.get:function(t,e,r){var n=function(t,e){for(;!Object.prototype.hasOwnProperty.call(t,e)&&null!==(t=jr(t)););return t}(t,e);if(n){var a=Object.getOwnPropertyDescriptor(n,e);return a.get?a.get.call(r):a.value}})(t,e,r||t)}function Rr(t,e){return(Rr=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t})(t,e)}function xr(t){var e=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(t){return!1}}();return function(){var r,n=jr(t);if(e){var a=jr(this).constructor;r=Reflect.construct(n,arguments,a)}else r=n.apply(this,arguments);return Lr(this,r)}}function Lr(t,e){return!e||"object"!==typeof e&&"function"!==typeof e?function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t):e}function jr(t){return(jr=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}function Fr(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function Ur(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}function Mr(t,e,r){return(Mr="undefined"!==typeof Reflect&&Reflect.get?Reflect.get:function(t,e,r){var n=function(t,e){for(;!Object.prototype.hasOwnProperty.call(t,e)&&null!==(t=Wr(t)););return t}(t,e);if(n){var a=Object.getOwnPropertyDescriptor(n,e);return a.get?a.get.call(r):a.value}})(t,e,r||t)}function Br(t,e){return(Br=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t})(t,e)}function Hr(t){var e=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(t){return!1}}();return function(){var r,n=Wr(t);if(e){var a=Wr(this).constructor;r=Reflect.construct(n,arguments,a)}else r=n.apply(this,arguments);return Vr(this,r)}}function Vr(t,e){return!e||"object"!==typeof e&&"function"!==typeof e?function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t):e}function Wr(t){return(Wr=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}var Yr={SingleMatchController:function(t){!function(t,e){if("function"!==typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&Sr(t,e)}(i,t);var e,r,n,a=Ar(i);function i(){return br(this,i),a.apply(this,arguments)}return e=i,(r=[{key:"validate",value:function(t){return Granify.itExists(t.campaign)}},{key:"getCampaign",value:function(t){var e=t.campaign;return _r(_r({},this.scaffoldCampaign(e,t)),this.getOfferData(e.shared_data||t))}},{key:"handleOffer",value:function(t){wr(Or(i.prototype),"handleOffer",this).call(this,t);var e=this.getCampaign(t);if(this.campaignIsLoaded(e))Granify.updateWidget(e);else{if(!e.should_display)return;Granify.campaign=e,Granify.old_offer=e,Granify.latency.mutex=!0,Granify.loadWidget(e)}}}])&&Er(e.prototype,r),n&&Er(e,n),i}(mr),MultiMatchController:function(t){!function(t,e){if("function"!==typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&Rr(t,e)}(i,t);var e,r,n,a=xr(i);function i(){return Dr(this,i),a.apply(this,arguments)}return e=i,(r=[{key:"validate",value:function(t){return Granify.itExists(t.mm_campaign)}},{key:"getCampaign",value:function(t){var e=t.mm_campaign;return Cr(Cr(Cr({},this.scaffoldCampaign(e,t)),this.getOfferData(e.shared_data)),{},{is_multimatch:!0})}},{key:"handleOffer",value:function(t){Nr(jr(i.prototype),"handleOffer",this).call(this,t);var e=this.getCampaign(t);if(this.campaignIsLoaded(e))Granify.updateWidget(e);else{if(!e.should_display)return;Granify.latency.mutex=!0,Granify.loadWidget(e)}}}])&&Pr(e.prototype,r),n&&Pr(e,n),i}(mr),OfferController:function(t){!function(t,e){if("function"!==typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&Br(t,e)}(i,t);var e,r,n,a=Hr(i);function i(){return Fr(this,i),a.apply(this,arguments)}return e=i,(r=[{key:"validate",value:function(t){return Granify.itExists(t.offers)}},{key:"handleOffer",value:function(t){Mr(Wr(i.prototype),"handleOffer",this).call(this,t),Granify.itExists(Granify.offers)||(Granify.offers={})}}])&&Ur(e.prototype,r),n&&Ur(e,n),i}(mr)};function qr(t,e){return function(t){if(Array.isArray(t))return t}(t)||function(t,e){if("undefined"===typeof Symbol||!(Symbol.iterator in Object(t)))return;var r=[],n=!0,a=!1,i=void 0;try{for(var o,s=t[Symbol.iterator]();!(n=(o=s.next()).done)&&(r.push(o.value),!e||r.length!==e);n=!0);}catch(c){a=!0,i=c}finally{try{n||null==s.return||s.return()}finally{if(a)throw i}}return r}(t,e)||function(t,e){if(!t)return;if("string"===typeof t)return zr(t,e);var r=Object.prototype.toString.call(t).slice(8,-1);"Object"===r&&t.constructor&&(r=t.constructor.name);if("Map"===r||"Set"===r)return Array.from(t);if("Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return zr(t,e)}(t,e)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function zr(t,e){(null==e||e>t.length)&&(e=t.length);for(var r=0,n=new Array(e);r<e;r++)n[r]=t[r];return n}function Kr(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function Jr(t,e){return(Jr=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t})(t,e)}function Xr(t){var e=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(t){return!1}}();return function(){var r,n=$r(t);if(e){var a=$r(this).constructor;r=Reflect.construct(n,arguments,a)}else r=n.apply(this,arguments);return Qr(this,r)}}function Qr(t,e){return!e||"object"!==typeof e&&"function"!==typeof e?function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t):e}function $r(t){return($r=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}var Zr=function(t){!function(t,e){if("function"!==typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&Jr(t,e)}(r,t);var e=Xr(r);function r(){return Kr(this,r),e.apply(this,arguments)}return r}(Ke);function tn(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}Zr.registerName="Offer Route",Zr.baseClass=mr,Zr.registry=[];var en=function(){function t(){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this.offerRoutes={}}var e,r,n;return e=t,(r=[{key:"createOfferRoutes",value:function(){var t=this;Granify.logDebug("OfferRouteController: createOfferRoutes() called");var e=Zr.registry;this.offerRoutes={},e.forEach((function(e){t.offerRoutes[e.name]=new e.classReference(e.name)}))}},{key:"handleOffer",value:function(t){Object.values(this.offerRoutes).forEach((function(e){e.validate(t)&&e.handleOffer(t)}))}}])&&tn(e.prototype,r),n&&tn(e,n),t}();function rn(t){return function(t){if(Array.isArray(t))return on(t)}(t)||function(t){if("undefined"!==typeof Symbol&&Symbol.iterator in Object(t))return Array.from(t)}(t)||an(t)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function nn(t,e){var r;if("undefined"===typeof Symbol||null==t[Symbol.iterator]){if(Array.isArray(t)||(r=an(t))||e&&t&&"number"===typeof t.length){r&&(t=r);var n=0,a=function(){};return{s:a,n:function(){return n>=t.length?{done:!0}:{done:!1,value:t[n++]}},e:function(t){throw t},f:a}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var i,o=!0,s=!1;return{s:function(){r=t[Symbol.iterator]()},n:function(){var t=r.next();return o=t.done,t},e:function(t){s=!0,i=t},f:function(){try{o||null==r.return||r.return()}finally{if(s)throw i}}}}function an(t,e){if(t){if("string"===typeof t)return on(t,e);var r=Object.prototype.toString.call(t).slice(8,-1);return"Object"===r&&t.constructor&&(r=t.constructor.name),"Map"===r||"Set"===r?Array.from(t):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?on(t,e):void 0}}function on(t,e){(null==e||e>t.length)&&(e=t.length);for(var r=0,n=new Array(e);r<e;r++)n[r]=t[r];return n}function sn(t,e,r,n,a,i,o){try{var s=t[i](o),c=s.value}catch(u){return void r(u)}s.done?e(c):Promise.resolve(c).then(n,a)}function cn(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}var un=function(){function t(e,r){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this.name=e,this.logFormat=r||{background:"#186c6e",text:"white"},this.registry={},this.actionCache={},this.logDebug("Registering events..."),this.registerEvents(),this.logDebug("Registering actions..."),this.registerActions(),this.log("Platform initialized.")}var e,r,n,a,o;return e=t,(r=[{key:"registerEvents",value:function(){}},{key:"eventName",value:function(t){return"".concat(this.name,":").concat(t)}},{key:"registerActions",value:function(){}},{key:"registerAction",value:function(t,e){this.actionCache[e]||(this.actionCache[e]=new e(this));var r=this.actionCache[e];this.registry[t]?this.registry[t].push(r):(this.registry[t]=[r],Granify.onAll(t,this._handleEvent.bind(this,t)))}},{key:"registerCustomAction",value:function(t,e){return this.registerAction(this.eventName(t),e)}},{key:"_handleEvent",value:(a=i.a.mark((function t(e){var r,n,a,o;return i.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:r=nn(this.registry[e]),t.prev=1,r.s();case 3:if((n=r.n()).done){t.next=19;break}return a=n.value,t.prev=5,t.next=8,a.getData();case 8:if(void 0===(o=t.sent)){t.next=12;break}return t.next=12,a.execute(o);case 12:t.next=17;break;case 14:t.prev=14,t.t0=t.catch(5),Granify.logError("Failed to execute action for Granify Lite Platform",{action:a.method,platform:this.name,stack:t.t0.stack});case 17:t.next=3;break;case 19:t.next=24;break;case 21:t.prev=21,t.t1=t.catch(1),r.e(t.t1);case 24:return t.prev=24,r.f(),t.finish(24);case 27:case"end":return t.stop()}}),t,this,[[1,21,24,27],[5,14]])})),o=function(){var t=this,e=arguments;return new Promise((function(r,n){var i=a.apply(t,e);function o(t){sn(i,r,n,o,s,"next",t)}function s(t){sn(i,r,n,o,s,"throw",t)}o(void 0)}))},function(t){return o.apply(this,arguments)})},{key:"trigger",value:function(t){for(var e,r=arguments.length,n=new Array(r>1?r-1:0),a=1;a<r;a++)n[a-1]=arguments[a];(e=Granify).trigger.apply(e,[this.eventName(t)].concat(n))}},{key:"_prepareLog",value:function(t){var e="";"string"===typeof t[0]&&(e=" "+t.shift()),e="%c ".concat(this.name,"Platform %c").concat(e);var r=this.logFormat,n=r.background,a=r.text;return t.unshift(e,"background:".concat(n,";color:").concat(a),""),t}},{key:"log",value:function(){for(var t,e=arguments.length,r=new Array(e),n=0;n<e;n++)r[n]=arguments[n];(t=Granify).log.apply(t,rn(this._prepareLog(r)))}},{key:"logDebug",value:function(){for(var t,e=arguments.length,r=new Array(e),n=0;n<e;n++)r[n]=arguments[n];(t=Granify).logDebug.apply(t,rn(this._prepareLog(r)))}}])&&cn(e.prototype,r),n&&cn(e,n),t}();function fn(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}var ln=function(){function t(e,r){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this.platform=e,this.method=r}var e,r,n;return e=t,(r=[{key:"getData",value:function(){}},{key:"execute",value:function(t){if(this.method){var e=Granify[this.method];if(!e)throw new Error("Granify Lite: Granify missing required action method: "+this.method);e.bind(Granify)(t)}}},{key:"log",value:function(){var t;(t=this.platform).log.apply(t,arguments)}},{key:"logDebug",value:function(){var t;(t=this.platform).logDebug.apply(t,arguments)}}])&&fn(e.prototype,r),n&&fn(e,n),t}();function yn(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}function dn(t,e){return(dn=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t})(t,e)}function pn(t){var e=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(t){return!1}}();return function(){var r,n=hn(t);if(e){var a=hn(this).constructor;r=Reflect.construct(n,arguments,a)}else r=n.apply(this,arguments);return gn(this,r)}}function gn(t,e){return!e||"object"!==typeof e&&"function"!==typeof e?function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t):e}function hn(t){return(hn=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}var mn=function(t){!function(t,e){if("function"!==typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&dn(t,e)}(i,t);var e,r,n,a=pn(i);function i(t){return function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,i),a.call(this,t,"trackPageView")}return e=i,(r=[{key:"getData",value:function(){return this.log("TrackPageViewAction#getData() was called."),{page_type:"home"}}}])&&yn(e.prototype,r),n&&yn(e,n),i}(ln);function Gn(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}function _n(t,e){return(_n=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t})(t,e)}function vn(t){var e=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(t){return!1}}();return function(){var r,n=En(t);if(e){var a=En(this).constructor;r=Reflect.construct(n,arguments,a)}else r=n.apply(this,arguments);return bn(this,r)}}function bn(t,e){return!e||"object"!==typeof e&&"function"!==typeof e?function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t):e}function En(t){return(En=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}var wn=function(t){!function(t,e){if("function"!==typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&_n(t,e)}(i,t);var e,r,n,a=vn(i);function i(){return function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,i),a.call(this,"Example")}return e=i,(r=[{key:"registerEvents",value:function(){var t=this;setTimeout((function(){t.trigger("exampleEvent")}),1e4)}},{key:"registerActions",value:function(){this.registerAction(Granify.constants.EVENT_URL_CHANGE,mn),this.registerCustomAction("exampleEvent",mn)}}])&&Gn(e.prototype,r),n&&Gn(e,n),i}(un);function Sn(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}function An(t,e){return(An=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t})(t,e)}function kn(t){var e=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(t){return!1}}();return function(){var r,n=Tn(t);if(e){var a=Tn(this).constructor;r=Reflect.construct(n,arguments,a)}else r=n.apply(this,arguments);return On(this,r)}}function On(t,e){return!e||"object"!==typeof e&&"function"!==typeof e?function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t):e}function Tn(t){return(Tn=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}var Cn=function(t){!function(t,e){if("function"!==typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&An(t,e)}(i,t);var e,r,n,a=kn(i);function i(t){return function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,i),a.call(this,t,"setShopperId")}return e=i,(r=[{key:"getData",value:function(){var t;if(!GRANIFY_CONFIG.customInstall.setShopperId){var e=null===(t=window.__st)||void 0===t?void 0:t.cid;return!e&&Granify.SP.getSiteShopperId()?null:null===e||void 0===e?void 0:e.toString()}}}])&&Sn(e.prototype,r),n&&Sn(e,n),i}(ln);function In(t,e){var r;if("undefined"===typeof Symbol||null==t[Symbol.iterator]){if(Array.isArray(t)||(r=function(t,e){if(!t)return;if("string"===typeof t)return Dn(t,e);var r=Object.prototype.toString.call(t).slice(8,-1);"Object"===r&&t.constructor&&(r=t.constructor.name);if("Map"===r||"Set"===r)return Array.from(t);if("Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return Dn(t,e)}(t))||e&&t&&"number"===typeof t.length){r&&(t=r);var n=0,a=function(){};return{s:a,n:function(){return n>=t.length?{done:!0}:{done:!1,value:t[n++]}},e:function(t){throw t},f:a}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var i,o=!0,s=!1;return{s:function(){r=t[Symbol.iterator]()},n:function(){var t=r.next();return o=t.done,t},e:function(t){s=!0,i=t},f:function(){try{o||null==r.return||r.return()}finally{if(s)throw i}}}}function Dn(t,e){(null==e||e>t.length)&&(e=t.length);for(var r=0,n=new Array(e);r<e;r++)n[r]=t[r];return n}function Pn(t,e,r,n,a,i,o){try{var s=t[i](o),c=s.value}catch(u){return void r(u)}s.done?e(c):Promise.resolve(c).then(n,a)}function Nn(t){return function(){var e=this,r=arguments;return new Promise((function(n,a){var i=t.apply(e,r);function o(t){Pn(i,n,a,o,s,"next",t)}function s(t){Pn(i,n,a,o,s,"throw",t)}o(void 0)}))}}function Rn(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}function xn(t,e){return(xn=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t})(t,e)}function Ln(t){var e=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(t){return!1}}();return function(){var r,n=Fn(t);if(e){var a=Fn(this).constructor;r=Reflect.construct(n,arguments,a)}else r=n.apply(this,arguments);return jn(this,r)}}function jn(t,e){return!e||"object"!==typeof e&&"function"!==typeof e?function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t):e}function Fn(t){return(Fn=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}var Un=function(t){!function(t,e){if("function"!==typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&xn(t,e)}(u,t);var e,r,n,a,o,s,c=Ln(u);function u(t){var e;return function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,u),(e=c.call(this,t,"trackCart")).originalPriceCache={},e.oldItemsString="",e}return e=u,(r=[{key:"getData",value:(s=Nn(i.a.mark((function t(){var e,r;return i.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(!GRANIFY_CONFIG.customInstall.trackCart){t.next=2;break}return t.abrupt("return");case 2:return t.next=4,this.getItems();case 4:if(e=t.sent,r=JSON.stringify(e),this.oldItemsString===r){t.next=9;break}return this.oldItemsString=r,t.abrupt("return",e);case 9:case"end":return t.stop()}}),t,this)}))),function(){return s.apply(this,arguments)})},{key:"getItems",value:(o=Nn(i.a.mark((function t(){var e,r,n,a,o,s,c;return i.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.prev=0,t.next=3,fetch("/cart.js",{method:"GET"});case 3:e=t.sent,t.next=9;break;case 6:return t.prev=6,t.t0=t.catch(0),t.abrupt("return");case 9:if(e.ok){t.next=12;break}return Granify.logError("Could not resolve request to cart AJAX API."),t.abrupt("return");case 12:return t.next=14,e.json();case 14:r=t.sent,n=r.items,a=In(n),t.prev=17,a.s();case 19:if((o=a.n()).done){t.next=26;break}return s=o.value,t.next=23,this.getOriginalPrice(s);case 23:s.original_price=t.sent;case 24:t.next=19;break;case 26:t.next=31;break;case 28:t.prev=28,t.t1=t.catch(17),a.e(t.t1);case 31:return t.prev=31,a.f(),t.finish(31);case 34:if(c=this.formatItems(n)){t.next=37;break}return t.abrupt("return");case 37:return t.abrupt("return",{items:c});case 38:case"end":return t.stop()}}),t,this,[[0,6],[17,28,31,34]])}))),function(){return o.apply(this,arguments)})},{key:"getOriginalPrice",value:(a=Nn(i.a.mark((function t(e){var r,n,a,o,s;return i.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(!(r=e.id)||r in this.originalPriceCache){t.next=19;break}return a=null===(n=e.url)||void 0===n?void 0:n.split("?")[0],t.prev=3,t.next=6,fetch("".concat(a,".js"),{method:"GET"});case 6:o=t.sent,t.next=12;break;case 9:return t.prev=9,t.t0=t.catch(3),t.abrupt("return");case 12:if(o.ok){t.next=15;break}return Granify.logError("Could not resolve request to product AJAX API."),t.abrupt("return");case 15:return t.next=17,o.json();case 17:s=t.sent,this.originalPriceCache[r]=s.compare_at_price;case 19:return t.abrupt("return",this.originalPriceCache[r]);case 20:case"end":return t.stop()}}),t,this,[[3,9]])}))),function(t){return a.apply(this,arguments)})},{key:"formatItems",value:function(t){try{return t.map((function(t){return{sku:t.id.toString(),product_id:t.product_id.toString(),quantity:t.quantity,price:t.final_price/100,regular_price:(t.original_price||t.price)/100,title:t.title,image:t.image}}))}catch(e){return void Granify.logError("Error formatting items returned from cart AJAX API.")}}}])&&Rn(e.prototype,r),n&&Rn(e,n),u}(ln);function Mn(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}function Bn(t,e){return(Bn=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t})(t,e)}function Hn(t){var e=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(t){return!1}}();return function(){var r,n=Wn(t);if(e){var a=Wn(this).constructor;r=Reflect.construct(n,arguments,a)}else r=n.apply(this,arguments);return Vn(this,r)}}function Vn(t,e){return!e||"object"!==typeof e&&"function"!==typeof e?function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t):e}function Wn(t){return(Wn=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}var Yn=function(t){!function(t,e){if("function"!==typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&Bn(t,e)}(i,t);var e,r,n,a=Hn(i);function i(t){return function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,i),a.call(this,t,"trackCart")}return e=i,(r=[{key:"getData",value:function(){if(window.Shopify&&window.Shopify.checkout&&!GRANIFY_CONFIG.customInstall.trackCart)return!1}}])&&Mn(e.prototype,r),n&&Mn(e,n),i}(ln);function qn(t,e,r,n,a,i,o){try{var s=t[i](o),c=s.value}catch(u){return void r(u)}s.done?e(c):Promise.resolve(c).then(n,a)}function zn(t){return function(){var e=this,r=arguments;return new Promise((function(n,a){var i=t.apply(e,r);function o(t){qn(i,n,a,o,s,"next",t)}function s(t){qn(i,n,a,o,s,"throw",t)}o(void 0)}))}}function Kn(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}function Jn(t,e){return(Jn=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t})(t,e)}function Xn(t){var e=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(t){return!1}}();return function(){var r,n=$n(t);if(e){var a=$n(this).constructor;r=Reflect.construct(n,arguments,a)}else r=n.apply(this,arguments);return Qn(this,r)}}function Qn(t,e){return!e||"object"!==typeof e&&"function"!==typeof e?function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t):e}function $n(t){return($n=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}var Zn=function(t){!function(t,e){if("function"!==typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&Jn(t,e)}(u,t);var e,r,n,a,o,s,c=Xn(u);function u(t,e){var r;return function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,u),(r=c.call(this,t,e)).productJsonWrapper=document.querySelector("[id*=ProductJson]"),r}return e=u,(r=[{key:"getData",value:(s=zn(i.a.mark((function t(){return i.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:case"end":return t.stop()}}),t)}))),function(){return s.apply(this,arguments)})},{key:"formatProducts",value:function(){}},{key:"filterAvailableProducts",value:function(t){if(t.variants=t.variants.filter((function(t){return t.available})),!(t.variants.length<1))return t}},{key:"getProductJson",value:(o=zn(i.a.mark((function t(){var e,r,n;return i.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(this.productJsonWrapper){t.next=7;break}return this.log("ProductJson object not found, requesting product info from Shopify AJAX API"),e=window.location.pathname,t.next=5,this.getProductsFromProductApi(e);case 5:return r=t.sent,t.abrupt("return",r);case 7:return t.prev=7,n=JSON.parse(this.productJsonWrapper.innerText),t.abrupt("return",n);case 12:t.prev=12,t.t0=t.catch(7),this.log("Could not parse ProductJson from page.");case 15:case"end":return t.stop()}}),t,this,[[7,12]])}))),function(){return o.apply(this,arguments)})},{key:"getProductsFromProductApi",value:(a=zn(i.a.mark((function t(e){var r,n;return i.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,fetch("".concat(e,".js"),{method:"GET"});case 2:if((r=t.sent).ok){t.next=6;break}return this.log("Could not resolve request to product AJAX API."),t.abrupt("return");case 6:return t.next=8,r.json();case 8:return n=t.sent,t.abrupt("return",n);case 10:case"end":return t.stop()}}),t,this)}))),function(t){return a.apply(this,arguments)})}])&&Kn(e.prototype,r),n&&Kn(e,n),u}(ln);function ta(t,e,r,n,a,i,o){try{var s=t[i](o),c=s.value}catch(u){return void r(u)}s.done?e(c):Promise.resolve(c).then(n,a)}function ea(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}function ra(t,e){return(ra=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t})(t,e)}function na(t){var e=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(t){return!1}}();return function(){var r,n=ia(t);if(e){var a=ia(this).constructor;r=Reflect.construct(n,arguments,a)}else r=n.apply(this,arguments);return aa(this,r)}}function aa(t,e){return!e||"object"!==typeof e&&"function"!==typeof e?function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t):e}function ia(t){return(ia=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}var oa={size:"size",color:"color",colour:"color"},sa=function(t){!function(t,e){if("function"!==typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&ra(t,e)}(c,t);var e,r,n,a,o,s=na(c);function c(t){return function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,c),s.call(this,t,"trackProduct")}return e=c,(r=[{key:"getData",value:(a=i.a.mark((function t(){var e,r;return i.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(!GRANIFY_CONFIG.customInstall.trackProduct&&"product"===Granify.pageType){t.next=2;break}return t.abrupt("return");case 2:return t.next=4,this.getProductJson();case 4:if(e=t.sent){t.next=7;break}return t.abrupt("return");case 7:if(r=this.filterAvailableProducts(e)){t.next=10;break}return t.abrupt("return");case 10:return t.abrupt("return",this.formatProducts(r));case 11:case"end":return t.stop()}}),t,this)})),o=function(){var t=this,e=arguments;return new Promise((function(r,n){var i=a.apply(t,e);function o(t){ta(i,r,n,o,s,"next",t)}function s(t){ta(i,r,n,o,s,"throw",t)}o(void 0)}))},function(){return o.apply(this,arguments)})},{key:"formatProducts",value:function(t){try{for(var e={},r=0;r<(null===(n=t.options)||void 0===n?void 0:n.length);r++){var n,a=t.options[r].name?t.options[r].name.toLowerCase():t.options[r].toLowerCase();oa[a]&&(e[oa[a]]="option"+(r+1))}return t.variants.map((function(r){for(var n={sku:r.id.toString(),product_id:t.id.toString(),title:t.title,price:r.price/100,regular_price:(r.compare_at_price||r.price)/100,image:t.images[0],in_stock:r.available,ratings:0,number_of_reviews:0,category:t.type,sub_category:"N/A"},a=0,i=Object.keys(e);a<i.length;a++){var o=i[a];n[o]=r[e[o]]}return n}))}catch(i){return void this.log("Error formatting products for trackProduct.")}}}])&&ea(e.prototype,r),n&&ea(e,n),c}(Zn);function ca(t,e,r,n,a,i,o){try{var s=t[i](o),c=s.value}catch(u){return void r(u)}s.done?e(c):Promise.resolve(c).then(n,a)}function ua(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}function fa(t,e){return(fa=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t})(t,e)}function la(t){var e=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(t){return!1}}();return function(){var r,n=da(t);if(e){var a=da(this).constructor;r=Reflect.construct(n,arguments,a)}else r=n.apply(this,arguments);return ya(this,r)}}function ya(t,e){return!e||"object"!==typeof e&&"function"!==typeof e?function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t):e}function da(t){return(da=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}var pa=function(t){!function(t,e){if("function"!==typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&fa(t,e)}(c,t);var e,r,n,a,o,s=la(c);function c(t){return function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,c),s.call(this,t,"setCurrentProduct")}return e=c,r=[{key:"getData",value:(a=i.a.mark((function t(){var e,r,n,a;return i.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(!GRANIFY_CONFIG.customInstall.setCurrentProduct&&"product"===Granify.pageType){t.next=2;break}return t.abrupt("return");case 2:return t.next=4,this.getProductJson();case 4:if(e=t.sent){t.next=7;break}return t.abrupt("return");case 7:if((r=this.filterAvailableProducts(e))&&r.variants&&!(r.variants.length<2)){t.next=10;break}return t.abrupt("return");case 10:if(n=c.getSkuFromUrl()){t.next=13;break}return t.abrupt("return",this.formatProducts(r));case 13:return(a=this.filterSkuVariant(r.variants,n))&&(r.variants=a),t.abrupt("return",this.formatProducts(r));case 16:case"end":return t.stop()}}),t,this)})),o=function(){var t=this,e=arguments;return new Promise((function(r,n){var i=a.apply(t,e);function o(t){ca(i,r,n,o,s,"next",t)}function s(t){ca(i,r,n,o,s,"throw",t)}o(void 0)}))},function(){return o.apply(this,arguments)})},{key:"filterSkuVariant",value:function(t,e){var r=t.filter((function(t){return t.id.toString()===e.toString()}));if(0!==r.length)return r}},{key:"formatProducts",value:function(t){try{return{sku:t.variants[0].id.toString(),product_id:t.id.toString()}}catch(e){return void this.log("Error formatting products for setCurrentProduct.")}}}],n=[{key:"getSkuFromUrl",value:function(){return new URL(window.location.href).searchParams.get("variant")}}],r&&ua(e.prototype,r),n&&ua(e,n),c}(Zn);function ga(t,e){var r;if("undefined"===typeof Symbol||null==t[Symbol.iterator]){if(Array.isArray(t)||(r=function(t,e){if(!t)return;if("string"===typeof t)return ha(t,e);var r=Object.prototype.toString.call(t).slice(8,-1);"Object"===r&&t.constructor&&(r=t.constructor.name);if("Map"===r||"Set"===r)return Array.from(t);if("Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return ha(t,e)}(t))||e&&t&&"number"===typeof t.length){r&&(t=r);var n=0,a=function(){};return{s:a,n:function(){return n>=t.length?{done:!0}:{done:!1,value:t[n++]}},e:function(t){throw t},f:a}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var i,o=!0,s=!1;return{s:function(){r=t[Symbol.iterator]()},n:function(){var t=r.next();return o=t.done,t},e:function(t){s=!0,i=t},f:function(){try{o||null==r.return||r.return()}finally{if(s)throw i}}}}function ha(t,e){(null==e||e>t.length)&&(e=t.length);for(var r=0,n=new Array(e);r<e;r++)n[r]=t[r];return n}function ma(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}function Ga(t,e){return(Ga=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t})(t,e)}function _a(t){var e=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(t){return!1}}();return function(){var r,n=ba(t);if(e){var a=ba(this).constructor;r=Reflect.construct(n,arguments,a)}else r=n.apply(this,arguments);return va(this,r)}}function va(t,e){return!e||"object"!==typeof e&&"function"!==typeof e?function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t):e}function ba(t){return(ba=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}var Ea=function(t){!function(t,e){if("function"!==typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&Ga(t,e)}(i,t);var e,r,n,a=_a(i);function i(t){var e;return function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,i),(e=a.call(this,t,"trackPageView")).pageTypes=[{name:"home",regex:/^\/?$/i},{name:"collection",regex:/^\/collections\/(.*)/i},{name:"search",regex:/^\/search/i},{name:"product",regex:/^\/products\/(.+)/i},{name:"cart",regex:/^\/cart/i},{name:"login",regex:/^\/account\/login/i},{name:"account",regex:/^\/account/},{name:"checkout",regex:/^\/(\d+)\/checkouts\/(.+)/},{name:"receipt",regex:/^\/(\d+)\/orders\/(.+)/}],e}return e=i,(r=[{key:"getData",value:function(){if(!GRANIFY_CONFIG.customInstall.trackPageView){var t,e=ga(this.pageTypes);try{for(e.s();!(t=e.n()).done;){var r=t.value;if(r.regex.test(location.pathname))return{page_type:r.name}}}catch(n){e.e(n)}finally{e.f()}return Granify.logError("No page type found for URL",{url:location.href}),{page_type:"missing"}}}}])&&ma(e.prototype,r),n&&ma(e,n),i}(ln);function wa(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}function Sa(t,e){return(Sa=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t})(t,e)}function Aa(t){var e=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(t){return!1}}();return function(){var r,n=Oa(t);if(e){var a=Oa(this).constructor;r=Reflect.construct(n,arguments,a)}else r=n.apply(this,arguments);return ka(this,r)}}function ka(t,e){return!e||"object"!==typeof e&&"function"!==typeof e?function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t):e}function Oa(t){return(Oa=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}var Ta=function(t){!function(t,e){if("function"!==typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&Sa(t,e)}(i,t);var e,r,n,a=Aa(i);function i(t){return function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,i),a.call(this,t,"trackOrder")}return e=i,(r=[{key:"getData",value:function(){if(window.Shopify&&window.Shopify.checkout&&!GRANIFY_CONFIG.customInstall.trackOrder){var t=window.Shopify.checkout,e={currency:t.currency,order_number:t.order_id.toString(),total_line_items_price:Number(t.subtotal_price),subtotal_price:Number(t.subtotal_price),total_tax:Number(t.total_tax),total_shipping:Number(t.shipping_rate.price),total_price:Number(t.payment_due),financial_status:"paid",line_items:t.line_items.map((function(t){return{sku:t.variant_id.toString(),product_id:t.product_id.toString(),quantity:Number(t.quantity),price:Number(t.price),regular_price:Number(t.compare_at_price||t.price),title:t.title}})),discount_codes:[]};return t.discount&&e.discount_codes.push({code:t.discount.code,amount:Number(t.discount.amount)}),e}}}])&&wa(e.prototype,r),n&&wa(e,n),i}(ln);function Ca(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}function Ia(t,e){return(Ia=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t})(t,e)}function Da(t){var e=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(t){return!1}}();return function(){var r,n=Na(t);if(e){var a=Na(this).constructor;r=Reflect.construct(n,arguments,a)}else r=n.apply(this,arguments);return Pa(this,r)}}function Pa(t,e){return!e||"object"!==typeof e&&"function"!==typeof e?function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t):e}function Na(t){return(Na=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}var Ra=function(t){!function(t,e){if("function"!==typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&Ia(t,e)}(i,t);var e,r,n,a=Da(i);function i(){var t;return function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,i),(t=a.call(this,"Shopify")).lastSku=pa.getSkuFromUrl(),t}return e=i,(r=[{key:"registerEvents",value:function(){setInterval(function(){var t=pa.getSkuFromUrl();this.lastSku!==t&&(this.trigger("skuChange"),this.lastSku=t)}.bind(this),100),setInterval(function(){Granify.idle_time<10&&this.trigger("cartUpdated")}.bind(this),2e3)}},{key:"registerActions",value:function(){this.registerAction(Granify.constants.EVENT_URL_CHANGE,Cn),this.registerAction(Granify.constants.EVENT_URL_CHANGE,Ea),this.registerAction(Granify.constants.PAGE_TYPE_CHANGE,Ta),this.registerAction(Granify.constants.PAGE_TYPE_CHANGE,Un),this.registerCustomAction("cartUpdated",Un),this.registerAction(Granify.constants.PAGE_TYPE_CHANGE,Yn),this.registerAction(Granify.constants.PAGE_TYPE_CHANGE,sa),this.registerAction(Granify.constants.PAGE_TYPE_CHANGE,pa),this.registerCustomAction("skuChange",pa)}}])&&Ca(e.prototype,r),n&&Ca(e,n),i}(un);function xa(t){return{query:"\n      query getProductByHandle($handle: String!) {\n        productByHandle(handle: $handle) {\n          id\n          productType\n          vendor\n          handle\n          title\n          variants(first: 200) {\n            edges {\n              cursor\n              node {\n                id\n                sku\n                title\n                quantityAvailable\n                availableForSale\n                priceV2 {\n                  amount\n                  currencyCode\n                }\n                compareAtPriceV2 {\n                  amount\n                  currencyCode\n                }\n                image {\n                  transformedSrc\n                }\n                selectedOptions {\n                  name\n                  value\n                }\n              }\n            }\n          }\n        }\n      }\n    ",operationName:"getProductByHandle",variables:{handle:t}}}function La(t){return{query:"\n      query getCartById($id: ID!) {\n        node(id: $id) {\n          id\n          __typename\n          ... on Checkout {\n            lineItems(first: 50) {\n              edges {\n                node {\n                  id\n                  quantity\n                  title\n                  unitPrice {\n                    amount\n                  }\n                  variant {\n                    id\n                    sku\n                    product {\n                      id\n                      handle\n                    }\n                    priceV2 {\n                      amount\n                      currencyCode\n                    }\n                    compareAtPriceV2 {\n                      amount\n                      currencyCode\n                    }\n                    image {\n                      transformedSrc\n                    }\n                  }\n                }\n              }\n            }\n          }\n        }\n      }\n    ",operationName:"getCartById",variables:{id:t}}}function ja(t,e){var r;if("undefined"===typeof Symbol||null==t[Symbol.iterator]){if(Array.isArray(t)||(r=function(t,e){if(!t)return;if("string"===typeof t)return Fa(t,e);var r=Object.prototype.toString.call(t).slice(8,-1);"Object"===r&&t.constructor&&(r=t.constructor.name);if("Map"===r||"Set"===r)return Array.from(t);if("Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return Fa(t,e)}(t))||e&&t&&"number"===typeof t.length){r&&(t=r);var n=0,a=function(){};return{s:a,n:function(){return n>=t.length?{done:!0}:{done:!1,value:t[n++]}},e:function(t){throw t},f:a}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var i,o=!0,s=!1;return{s:function(){r=t[Symbol.iterator]()},n:function(){var t=r.next();return o=t.done,t},e:function(t){s=!0,i=t},f:function(){try{o||null==r.return||r.return()}finally{if(s)throw i}}}}function Fa(t,e){(null==e||e>t.length)&&(e=t.length);for(var r=0,n=new Array(e);r<e;r++)n[r]=t[r];return n}var Ua,Ma=[];function Ba(t){return function(){throw new Error("Hook has not been implemented: "+t)}}Granify.registerLiteHooks=function(t){for(var e=0,r=Object.keys(t);e<r.length;e++){var n,a=r[e],i=ja(Ma);try{for(i.s();!(n=i.n()).done;){var o=n.value;o.hasOwnProperty(a)&&"function"===typeof t[a]&&(o[a]=t[a])}}catch(s){i.e(s)}finally{i.f()}}};var Ha={getAPIEndpoint:function(){return GRANIFY_CONFIG.customValues.API_ENDPOINT},getAccessToken:function(){return Ua||(Ua=GRANIFY_CONFIG.customValues.ACCESS_TOKEN,delete GRANIFY_CONFIG.customValues.ACCESS_TOKEN),Ua},getUseFirstProductToggle:function(){return GRANIFY_CONFIG.customValues.USE_FIRST_PRODUCT},getCheckoutId:Ba("getCheckoutId"),getProductHandle:Ba("getProductHandle"),getCurrentVariant:Ba("getCurrentVariant"),processBaseProduct:function(){return{}},processProductVariant:function(){return{}}};!function(t){for(var e=0,r=Object.keys(t);e<r.length;e++){var n=r[e],a=t[n];"function"!==typeof a&&Granify.logWarning("An invalid default hook was attempted to be registered",{key:n,value:a})}Ma.push(t)}(Ha);var Va=Ha;function Wa(t,e){var r;if("undefined"===typeof Symbol||null==t[Symbol.iterator]){if(Array.isArray(t)||(r=function(t,e){if(!t)return;if("string"===typeof t)return Ya(t,e);var r=Object.prototype.toString.call(t).slice(8,-1);"Object"===r&&t.constructor&&(r=t.constructor.name);if("Map"===r||"Set"===r)return Array.from(t);if("Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return Ya(t,e)}(t))||e&&t&&"number"===typeof t.length){r&&(t=r);var n=0,a=function(){};return{s:a,n:function(){return n>=t.length?{done:!0}:{done:!1,value:t[n++]}},e:function(t){throw t},f:a}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var i,o=!0,s=!1;return{s:function(){r=t[Symbol.iterator]()},n:function(){var t=r.next();return o=t.done,t},e:function(t){s=!0,i=t},f:function(){try{o||null==r.return||r.return()}finally{if(s)throw i}}}}function Ya(t,e){(null==e||e>t.length)&&(e=t.length);for(var r=0,n=new Array(e);r<e;r++)n[r]=t[r];return n}function qa(t,e,r,n,a,i,o){try{var s=t[i](o),c=s.value}catch(u){return void r(u)}s.done?e(c):Promise.resolve(c).then(n,a)}function za(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}function Ka(t,e){return(Ka=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t})(t,e)}function Ja(t){var e=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(t){return!1}}();return function(){var r,n=Qa(t);if(e){var a=Qa(this).constructor;r=Reflect.construct(n,arguments,a)}else r=n.apply(this,arguments);return Xa(this,r)}}function Xa(t,e){return!e||"object"!==typeof e&&"function"!==typeof e?function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t):e}function Qa(t){return(Qa=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}var $a=function(t){!function(t,e){if("function"!==typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&Ka(t,e)}(c,t);var e,r,n,a,o,s=Ja(c);function c(t){return function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,c),s.call(this,t,"trackCart")}return e=c,(r=[{key:"getData",value:(a=i.a.mark((function t(){var e,r;return i.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(!GRANIFY_CONFIG.customInstall.trackCart){t.next=2;break}return t.abrupt("return");case 2:if(e=Va.getCheckoutId()){t.next=5;break}return t.abrupt("return",{items:[]});case 5:return t.next=7,this.platform.graphql.query(La(e));case 7:if(r=t.sent){t.next=10;break}return t.abrupt("return");case 10:return t.prev=10,t.abrupt("return",{items:this.processProducts(r.data.node.lineItems.edges)});case 14:t.prev=14,t.t0=t.catch(10),Granify.logCritical("Could not process cart items",t.t0);case 17:case"end":return t.stop()}}),t,this,[[10,14]])})),o=function(){var t=this,e=arguments;return new Promise((function(r,n){var i=a.apply(t,e);function o(t){qa(i,r,n,o,s,"next",t)}function s(t){qa(i,r,n,o,s,"throw",t)}o(void 0)}))},function(){return o.apply(this,arguments)})},{key:"processProducts",value:function(t){try{var e,r=[],n=Wa(t);try{for(n.s();!(e=n.n()).done;){var a=e.value.node,i=a.variant.compareAtPriceV2||a.variant.priceV2,o={shopify_product_id:a.variant.product.handle,shopify_variant_id:a.variant.sku,product_id:this.platform.graphql.convertId(a.variant.product.id),sku:this.platform.graphql.convertId(a.variant.id),title:a.title,quantity:a.quantity,currency:a.variant.priceV2.currencyCode,price:Number(a.variant.priceV2.amount),regular_price:Number(i.amount),image:a.variant.image.transformedSrc};r.push(o)}}catch(s){n.e(s)}finally{n.f()}return r}catch(s){return void Granify.logError("Error formatting products for trackCart.",s.stack)}}}])&&za(e.prototype,r),n&&za(e,n),c}(ln);function Za(t,e){var r;if("undefined"===typeof Symbol||null==t[Symbol.iterator]){if(Array.isArray(t)||(r=function(t,e){if(!t)return;if("string"===typeof t)return ti(t,e);var r=Object.prototype.toString.call(t).slice(8,-1);"Object"===r&&t.constructor&&(r=t.constructor.name);if("Map"===r||"Set"===r)return Array.from(t);if("Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return ti(t,e)}(t))||e&&t&&"number"===typeof t.length){r&&(t=r);var n=0,a=function(){};return{s:a,n:function(){return n>=t.length?{done:!0}:{done:!1,value:t[n++]}},e:function(t){throw t},f:a}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var i,o=!0,s=!1;return{s:function(){r=t[Symbol.iterator]()},n:function(){var t=r.next();return o=t.done,t},e:function(t){s=!0,i=t},f:function(){try{o||null==r.return||r.return()}finally{if(s)throw i}}}}function ti(t,e){(null==e||e>t.length)&&(e=t.length);for(var r=0,n=new Array(e);r<e;r++)n[r]=t[r];return n}function ei(t,e){var r=Object.keys(t);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(t);e&&(n=n.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),r.push.apply(r,n)}return r}function ri(t){for(var e=1;e<arguments.length;e++){var r=null!=arguments[e]?arguments[e]:{};e%2?ei(Object(r),!0).forEach((function(e){ni(t,e,r[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(r)):ei(Object(r)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(r,e))}))}return t}function ni(t,e,r){return e in t?Object.defineProperty(t,e,{value:r,enumerable:!0,configurable:!0,writable:!0}):t[e]=r,t}function ai(t,e,r,n,a,i,o){try{var s=t[i](o),c=s.value}catch(u){return void r(u)}s.done?e(c):Promise.resolve(c).then(n,a)}function ii(t){return function(){var e=this,r=arguments;return new Promise((function(n,a){var i=t.apply(e,r);function o(t){ai(i,n,a,o,s,"next",t)}function s(t){ai(i,n,a,o,s,"throw",t)}o(void 0)}))}}function oi(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}function si(t,e){return(si=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t})(t,e)}function ci(t){var e=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(t){return!1}}();return function(){var r,n=fi(t);if(e){var a=fi(this).constructor;r=Reflect.construct(n,arguments,a)}else r=n.apply(this,arguments);return ui(this,r)}}function ui(t,e){return!e||"object"!==typeof e&&"function"!==typeof e?function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t):e}function fi(t){return(fi=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}var li=function(t){!function(t,e){if("function"!==typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&si(t,e)}(u,t);var e,r,n,a,o,s,c=ci(u);function u(t){return function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,u),c.call(this,t,"trackProduct")}return e=u,(r=[{key:"getData",value:(s=ii(i.a.mark((function t(){var e,r;return i.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(!GRANIFY_CONFIG.customInstall.trackProduct&&"product"===Granify.pageType){t.next=2;break}return t.abrupt("return");case 2:if(e=Va.getProductHandle()){t.next=6;break}return Granify.logCriticalOnce("Could not determine the product handle from a product page."),t.abrupt("return");case 6:return t.next=8,this.platform.graphql.query(xa(e));case 8:if(r=t.sent){t.next=11;break}return t.abrupt("return");case 11:return t.next=13,this.processProducts(r.data.productByHandle);case 13:return t.abrupt("return",t.sent);case 14:case"end":return t.stop()}}),t,this)}))),function(){return s.apply(this,arguments)})},{key:"processProducts",value:(o=ii(i.a.mark((function t(e){var r,n,a,o,s,c;return i.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.prev=0,t.t0=ri,t.t1={product_id:this.platform.graphql.convertId(e.id),shopify_product_id:e.handle,title:e.title,category:e.vendor||"unknown",sub_category:e.productType||"unknown"},t.next=5,Va.processBaseProduct();case 5:t.t2=t.sent,r=(0,t.t0)(t.t1,t.t2),n=[],a=Za(e.variants.edges),t.prev=9,a.s();case 11:if((o=a.n()).done){t.next=19;break}return s=o.value,t.next=15,this.processVariant(s.node,r);case 15:c=t.sent,n.push(c);case 17:t.next=11;break;case 19:t.next=24;break;case 21:t.prev=21,t.t3=t.catch(9),a.e(t.t3);case 24:return t.prev=24,a.f(),t.finish(24);case 27:return t.abrupt("return",n);case 30:return t.prev=30,t.t4=t.catch(0),this.log("Error formatting products for trackProduct.",t.t4.stack),t.abrupt("return");case 34:case"end":return t.stop()}}),t,this,[[0,30],[9,21,24,27]])}))),function(t){return o.apply(this,arguments)})},{key:"processVariant",value:(a=ii(i.a.mark((function t(e,r){var n,a,o,s,c,u,f;return i.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:n=e.compareAtPriceV2||e.priceV2,a=GRANIFY_CONFIG.customValues.PRODUCT_OPTIONS,o={},s=Za(e.selectedOptions);try{for(s.s();!(c=s.n()).done;)u=c.value,a[u.name]&&(o[a[u.name]]=u.value)}catch(i){s.e(i)}finally{s.f()}return t.t0=ri,t.t1=ri(ri({},r),{},{sku:this.platform.graphql.convertId(e.id),shopify_variant_id:e.sku,sub_title:e.title,in_stock:e.quantityAvailable,price:Number(e.priceV2.amount),regular_price:Number(n.amount),currency:e.priceV2.currencyCode,image:e.image.transformedSrc},o),t.next=9,Va.processProductVariant();case 9:return t.t2=t.sent,f=(0,t.t0)(t.t1,t.t2),t.abrupt("return",f);case 12:case"end":return t.stop()}}),t,this)}))),function(t,e){return a.apply(this,arguments)})}])&&oi(e.prototype,r),n&&oi(e,n),u}(ln);function yi(t,e,r,n,a,i,o){try{var s=t[i](o),c=s.value}catch(u){return void r(u)}s.done?e(c):Promise.resolve(c).then(n,a)}function di(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}function pi(t,e){return(pi=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t})(t,e)}function gi(t){var e=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(t){return!1}}();return function(){var r,n=mi(t);if(e){var a=mi(this).constructor;r=Reflect.construct(n,arguments,a)}else r=n.apply(this,arguments);return hi(this,r)}}function hi(t,e){return!e||"object"!==typeof e&&"function"!==typeof e?function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t):e}function mi(t){return(mi=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}var Gi=function(t){!function(t,e){if("function"!==typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&pi(t,e)}(c,t);var e,r,n,a,o,s=gi(c);function c(t){return function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,c),s.call(this,t,"setCurrentProduct")}return e=c,(r=[{key:"getData",value:(a=i.a.mark((function t(){var e,r,n,a,o;return i.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(!GRANIFY_CONFIG.customInstall.setCurrentProduct&&"product"===Granify.pageType){t.next=2;break}return t.abrupt("return");case 2:if(e=Va.getUseFirstProductToggle(),r=Va.getCurrentVariant()){t.next=19;break}if(e){t.next=8;break}return Granify.logCriticalOnce("Could not determine the variant ID from a product page."),t.abrupt("return");case 8:Granify.log("USE_FIRST_PRODUCT enabled. Setting to first product..."),t.prev=9,n=Granify.apiHistory.getLatestTrackProductCall(),a=n.apiCallContents[0],r=a.sku,t.next=19;break;case 15:return t.prev=15,t.t0=t.catch(9),Granify.logCriticalOnce("Failed to get the first product of the latest trackProduct call."),t.abrupt("return");case 19:if(!(o=Granify.getProduct(r,"product_id"))){t.next=24;break}return t.abrupt("return",{product_id:o,sku:r});case 24:Granify.logWarningOnce("Could not find a currently selected product.",{variantId:r});case 25:case"end":return t.stop()}}),t,null,[[9,15]])})),o=function(){var t=this,e=arguments;return new Promise((function(r,n){var i=a.apply(t,e);function o(t){yi(i,r,n,o,s,"next",t)}function s(t){yi(i,r,n,o,s,"throw",t)}o(void 0)}))},function(){return o.apply(this,arguments)})}])&&di(e.prototype,r),n&&di(e,n),c}(ln);function _i(t,e){var r=Object.keys(t);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(t);e&&(n=n.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),r.push.apply(r,n)}return r}function vi(t){for(var e=1;e<arguments.length;e++){var r=null!=arguments[e]?arguments[e]:{};e%2?_i(Object(r),!0).forEach((function(e){bi(t,e,r[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(r)):_i(Object(r)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(r,e))}))}return t}function bi(t,e,r){return e in t?Object.defineProperty(t,e,{value:r,enumerable:!0,configurable:!0,writable:!0}):t[e]=r,t}function Ei(t,e,r,n,a,i,o){try{var s=t[i](o),c=s.value}catch(u){return void r(u)}s.done?e(c):Promise.resolve(c).then(n,a)}function wi(t){return function(){var e=this,r=arguments;return new Promise((function(n,a){var i=t.apply(e,r);function o(t){Ei(i,n,a,o,s,"next",t)}function s(t){Ei(i,n,a,o,s,"throw",t)}o(void 0)}))}}function Si(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}var Ai=function(){function t(e,r){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this.endpoint=e,this.headers=r}var e,r,n,a,o;return e=t,(r=[{key:"query",value:(o=wi(i.a.mark((function t(e){return i.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return"string"===typeof e&&(e={query:e}),t.next=3,this.request(e);case 3:return t.abrupt("return",t.sent);case 4:case"end":return t.stop()}}),t,this)}))),function(t){return o.apply(this,arguments)})},{key:"request",value:(a=wi(i.a.mark((function t(e){var r;return i.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,fetch(this.endpoint,{method:"POST",headers:vi(vi({},this.headers),{},{"content-type":"application/json"}),body:JSON.stringify(e)});case 2:if(!(r=t.sent).ok){t.next=9;break}return t.next=6,r.json();case 6:return t.abrupt("return",t.sent);case 9:return t.t0=Granify,t.next=12,r.json();case 12:return t.t1=t.sent,t.t0.logWarning.call(t.t0,"Could not resolve GraphQL request.",t.t1),t.abrupt("return",null);case 15:case"end":return t.stop()}}),t,this)}))),function(t){return a.apply(this,arguments)})},{key:"convertId",value:function(t){var e=atob(t).match(/.*\/(.*)$/);return e?e[1]:null}}])&&Si(e.prototype,r),n&&Si(e,n),t}();function ki(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}function Oi(t,e){return(Oi=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t})(t,e)}function Ti(t){var e=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(t){return!1}}();return function(){var r,n=Ii(t);if(e){var a=Ii(this).constructor;r=Reflect.construct(n,arguments,a)}else r=n.apply(this,arguments);return Ci(this,r)}}function Ci(t,e){return!e||"object"!==typeof e&&"function"!==typeof e?function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t):e}function Ii(t){return(Ii=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}var Di=function(t){!function(t,e){if("function"!==typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&Oi(t,e)}(i,t);var e,r,n,a=Ti(i);function i(){var t;return function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,i),(t=a.call(this,"ShopifyStorefront")).graphql=new Ai(Va.getAPIEndpoint(),{"x-shopify-storefront-access-token":Va.getAccessToken()}),t}return e=i,(r=[{key:"registerEvents",value:function(){}},{key:"registerActions",value:function(){this.registerAction(Granify.constants.PAGE_TYPE_CHANGE,Ta),this.registerAction(Granify.constants.PAGE_TYPE_CHANGE,Yn),this.registerAction(Granify.constants.PAGE_TYPE_CHANGE,$a),this.registerCustomAction("cartUpdated",$a),this.registerAction(Granify.constants.PAGE_TYPE_CHANGE,li),this.registerAction(Granify.constants.PAGE_TYPE_CHANGE,Gi),this.registerCustomAction("skuChange",Gi)}}])&&ki(e.prototype,r),n&&ki(e,n),i}(un);if(Granify.enabled){!function(){if(GRANIFY_CONFIG.shopType){var t=n[GRANIFY_CONFIG.shopType];t&&(Granify.litePlatform=new t)}}(),Granify.on("granify:init",(function(){return dr.createVendorApis()})),Object.entries(Yr).forEach((function(t){var e=qr(t,2),r=e[0],n=e[1];Zr.register(r,n)})),Granify.offerController=new en,Granify.offerController.createOfferRoutes(),Granify.updateWidget=function(t){var e=Granify.deepClone(t),r=Granify.campaigns[t.offer_id];return r&&r.loadSharedData&&!Granify.itExists(r.widgetRequested)?r.loadSharedData(e):Granify.current_coupon&&Granify.current_coupon.loadSharedData(e),!0},Granify.loadWidget=function(t){var e=t.offer_id||"missing campaign id";Granify.campaigns=Granify.campaigns||{},Granify.itExists(Granify.campaigns[e])||(Granify.campaigns[e]={widgetRequested:!0,state:Granify.deepClone(t)},Granify.forceMatchingStatusBar&&t.force_matching==t.id&&Granify.forceMatchingStatusBar.updateCampaign(t),Granify.initCoupon((function(){try{var e=Granify.deepClone(t);Granify.insertScript(t.url,(function(){return Granify.assets&&Granify.assets.campaign&&(e.campaign=Granify.deepExtend({},Granify.assets.campaign,e.campaign)),new(0,Granify.widget_class)(e).initialize(),Granify.latency.offer_shown=Date.now()}))}catch(r){return Granify.error(r,"loadWidget"),!1}})))};var Pi=GRANIFY_CONFIG.custom_script?", custom_script: "+GRANIFY_CONFIG.custom_script:"",Ni="Granify Loaded v"+GRANIFY_CONFIG.version+Pi;Granify.log(Ni),Granify.apiHistory.trackScriptLoad(Ni)}}]);

  (function(){if(Granify.enabled){function e(){if(Granify.enabled){function e(e,t,n){try{t.forEach(function(t){if(t.type!=="attributes"||t.attributeName!=="class")return;var n=t.target.className.indexOf(e)!==-1;Granify.trackGranifyData(Granify.constants.RESTRICTED_STATE,n)})}catch(r){Granify.logErrorOnce("Failed handleClassMutation with error:"+r.message)}}function t(t){Granify.constants.RESTRICTED_STATE="restricted_state",Granify.trackGranifyData(Granify.constants.RESTRICTED_STATE,!1);for(var n=0;n<t.length;n++){var r=t[n],i=document.querySelector(r.selector);if(!i)continue;var s={attributes:!0,subtree:!1};mutationObserver=new MutationObserver(e.bind(this,r.className)),mutationObserver.observe(i,s)}}function n(){var e=[{selector:"#cart-recommendations-overlay .wt-overlay__modal",className:"wt-overlay--animation-done"},{selector:"#wt-locale-picker-overlay .wt-overlay__modal",className:"wt-overlay--animation-done"}];t(e)}n()}}function t(){function e(e){if(!e||!Granify.isString(e)){Granify.log("GRANIFY - directInstallTestTag: received invalid tag. Expected type String, received:",e);return}Granify.log('GRANIFY - directInstallTestTag: received tag "'+e+'".'),Granify.enableMessages(e)}Granify.group_table={GtmGroup:"2,1",InlineGroup:"15,16"},Granify.enableMessages=function(e){if(window.GRANIFY_CONFIG&&window.GRANIFY_CONFIG.external_groups===!1)return Granify.logWarningOnce("Site attempting to assign groups, when not configured for group assignment");Granify.itExists(Granify.metrics)&&Granify.itExists(Granify.metrics.countOnce)&&Granify.metrics.countOnce("clientcalls.enableMessages."+e.replace(/[^a-z0-9]/gi,""));var t;switch(e){case"GTM":t="GtmGroup";break;case"Direct":t="InlineGroup";break;default:return Granify.log("GRANIFY: invalid external group: "+e)}Granify.trigger("externalGroupReceived",t)},Granify.addSessionTag=function(t,n){if(t!="directInstallTest"){Granify.log('GRANIFY - addSessionTag: "'+t+'" is not a supported tagType!');return}e(n)}}function n(){Granify.setSiteStateDataProperty("currently_showing_nudges",null),Granify.onEvery("pagetype:change",function(){Granify.setSiteStateDataProperty("currently_showing_nudges",null)});if(typeof Granify!="undefined"&&Granify!==null){var e=30;Granify.trackUserData.displayLogs=!1;var t=Granify.getUserData("current_nudge_cache")||null,n=Granify.trackUserData;n({current_nudge:null}),n({current_nudge:undefined});if(Granify.itExists(t)){for(var r=0;r<t.length;r++){var i=t[r];n({previously_seen_nudges:i},!0,e)}n({current_nudge_cache:undefined})}function s(e){return Granify.isArray(e)?e:[e]}function o(e){var t=[];Granify.trackUserData.displayLogs=!1;if(e!=null){var r=Granify.getUserData("current_nudge_cache");Granify.itExists(r)&&(t=s(r));for(var i=0;i<e.length;i++){var o=e[i];t.push(o)}n({current_nudge_cache:t}),Granify.setSiteStateDataProperty("currently_showing_nudges",JSON.stringify(Granify.getUserData("current_nudge_cache")))}Granify.trackUserData.displayLogs=!0}Granify.trackUserData=function(e,t,r){try{if(e.current_nudge){var i=s(e.current_nudge);o(i)}}catch(u){n(e,t,r);return}n(e,t,r)},Granify.clearEtsyNudgeCache=function(){Granify.trackUserData.displayLogs=!1,n({previously_seen_nudges:null}),n({previously_seen_nudges:undefined}),n({current_nudge:null}),n({current_nudge:undefined}),n({current_nudge_cache:null}),n({current_nudge_cache:undefined}),Granify.trackUserData.displayLogs=!0,Granify.log("Nudge caches cleared!")}}}function r(){if(typeof Granify!="undefined"&&Granify!==null){var e="GTM-KWW5SS",t=function(t){try{return window.google_tag_manager[e].dataLayer.get(t)}catch(n){return Granify.logErrorOnce("getGtmInfo - Failed to get "+t+":",n),!1}},n=function(e){try{return document.body.getAttribute(e)}catch(t){return Granify.logWarningOnce("getBodyInfo - Failed to get "+e+":",t),!1}},r=function(){var e=n("data-currency");return e?e:t("Currency")},i=Granify.internalTrackProduct,s={free_shipping_start:"1970-01-01T00:00:00.000Z",free_shipping_end:"1970-01-01T00:00:00.000Z",free_shipping_minimum_type:"none",free_shipping_min_total_money:0,free_shipping_min_total_currency_code:r(),promotion_minimum_type:"none",promotion_percentage_discount:0,promotion_start_timestamp:"1970-01-01T00:00:00.000Z",promotion_end_timestamp:"1970-01-01T00:00:00.000Z",promotion_min_quantity:0,promotion_min_total:0};Granify.internalTrackProduct=function(e){for(var t=0;t<e.length;t++){var n=e[t];try{var r=Object.keys(s);for(var o=0;o<r.length;o++){var u=r[o];Granify.itExists(n[u])||(n[u]=s[u])}}catch(a){Granify.log("Granify - WARNING: could not set default value for ETSY Product",a)}}i(e)}}}function s(){if(typeof Granify!="undefined"&&Granify!==null){var e={},t=["promotion","free_shipping"];function n(e,t){var n={},r=Object.keys(e);for(i=0;i<r.length;i++){var s=r[i];n[t+"_"+s]=e[s]}return n}function r(e,i){for(var s in i){if(!i.hasOwnProperty(s))continue;if(Granify.isObject(i[s]))for(var o=0;o<t.length;o++){var u=t[o];if(s==u){Granify.log('GRANIFY: trackProduct: Moving data from "'+s+'" Object to top level of item "'+i.title+'". Contents of "'+s+'":',i[s]);var a=n(i[s],s);i[s]=undefined,i[s]=a,r(e,i[s])}}else e[s]=i[s]}}Granify.trackProduct=function(t){var n=[];for(var i=0;i<t.length;i++)e={},r(e,t[i]),n.push(e);Granify.internalTrackProduct(n)}}}function o(){if(typeof Granify!="undefined"&&Granify!==null){var e=!1,t=Granify.trackOrder;Granify.trackOrder=function(n,r){e=n.line_items||n.items,t(n,r)};function n(){var t=[];for(i=0;i<e.length;i++){var n=e[i],r={product_id:n.product_id,quantity:n.quantity};t.push(r)}Granify.internalDeleteFromCart(t)}Granify.trackCart=function(t){e&&t==0?(n(),e=!1):Granify.internalTrackCart(t)}}}function u(){if(typeof Granify!="undefined"&&Granify!==null){var e=Granify.trackProduct;function t(e){var t=e,n=e;try{n=(new Date(e*1e3)).toISOString()}catch(r){return t}return n}Granify.trackProduct=function(n){var r=!1;for(var i=0;i<n.length;i++){var s=n[i];try{Granify.itExists(s.promotion)&&Granify.itExists(s.promotion.end_timestamp)&&(s.promotion.end_timestamp=t(s.promotion.end_timestamp),r=!0),Granify.itExists(s.free_shipping)&&Granify.itExists(s.free_shipping.end)&&(s.free_shipping.end=t(s.free_shipping.end),r=!0),Granify.itExists(s.promotion_end_timestamp)&&(s.promotion_end_timestamp=t(s.promotion_end_timestamp),r=!0),Granify.itExists(s.free_shipping_end)&&(s.free_shipping_end=t(s.free_shipping_end),r=!0)}catch(o){Granify.log("Granify - WARNING: could not convert timestamp from UNIX to ISO 8601 format.",o)}}r&&Granify.log("Granify - trackProduct: promotion and free shipping end timestamps have been converted from unix to ISO 8601 formats."),e(n)}}}var a=function(){var e="form.add-to-cart-form[data-buy-box-add-to-cart-form]",t=".wt-alert",n=".wt-alert > .wt-text-body-01 > a";Granify.on("pagetype:change",function(){var r=!1;if(Granify.pageType=="product"){var i=document.querySelectorAll(e),s=!1,o=document.querySelector(t);if(o&&document.querySelector(n)){var u=o.currentStyle?element.currentStyle.display:getComputedStyle(o,null).display;s=u!=="none"}i.length==1?(r=!0,Granify.Etsy.addToCartElement=i[0]):i.length>1?Granify.logCriticalOnce("More than one Add to Cart page element exists on product page.",{page:window.location.pathname}):i.length==0&&!h()?Granify.log("Add to Cart element not found, but the product is sold out and/or unavailable"):i.length==0&&s?Granify.log("Add to Cart element not found, but this is a vacation mode listing."):Granify.logCriticalOnce("GRANIFY: Expected Add to Cart page element not found on product page, but product does not appear to be unavailable.",{page:window.location.pathname})}Granify.trackGranifyData("client_add_to_cart_exists",r)})},f=function(){var e=Etsy.Context.data;return e.is_sold_out_listing?!0:!1},l=function(){if(typeof __init_perf_data=="undefined"&&typeof __etsy_logging=="undefined")return!0;var e=typeof __init_perf_data!="undefined"?__init_perf_data.events:__etsy_logging.perf.events,t="view_unavailable_listing",n="view_sold_listing";if(!Granify.itExists(e))return!1;for(var r=0;r<e.length;r++){var i=e[r].attributes.page_type;if(i==n||i==t)return!0}return!1},c=function(){var e=Granify.trackProduct;Granify.trackProduct=function(t){if(f()){Granify.log("Sold out listing detected, skipping trackProduct call.");return}e(t)}},h=function(){try{return f()||l()?!1:!0}catch(e){return Granify.logCriticalOnce("Failed to detect product availability, error: ",e),!1}};function p(){if(typeof Granify!="undefined"&&Granify!==null){var e=Granify.trackCart,t=100,n="prices_cached_from_trackCart",r="inventory_cached_from_trackCart",i={prices:"prices_cached_from_trackCart"};function s(e){Granify.isObject(e)&&validateProductObject(e)==null&&(e=[e]);if(!Granify.isArray(e)||e.length==0)return;var t=Granify.getProductStorage();e.forEach(function(e){Granify._trackOneProduct(e,t)}),Granify.saveProductStorage(t)}Granify.writePropertyToItem=function(e,t,n){if(Granify.itExists(Granify.synchronousGetSharedData(Granify.storage.TRACK_PRODUCT))&&Granify.itExists(Granify.synchronousGetSharedData(Granify.storage.TRACK_PRODUCT)[e])){var r=Granify.synchronousGetSharedData(Granify.storage.TRACK_PRODUCT)[e];r[t]=n,s([r])}},Granify.getEtsyCartedRegularPrice=function(e){var t="",r=Granify.synchronousGetSharedData(n)||[];if(Granify.itExists(r))for(var i=0;i<r.length;i++){var s=r[i][0];s==e&&(t=r[i][1][0])}return t},Granify.getEtsyCartedSalePrice=function(e){var t="",r=Granify.synchronousGetSharedData(n)||[];if(Granify.itExists(r))for(var i=0;i<r.length;i++){var s=r[i][0];s==e&&(t=r[i][1][1])}return t};function o(e,n,r){if(r!="prices"){Granify.writePropertyToItem(n,r,e);return}var s=[],o=!0,u=Granify.synchronousGetSharedData(i[r])||[];if(Granify.itExists(u))for(var a=0;a<u.length;a++){var f=u[a][0],l=u[a][1];f==n&&(l=e,o=!1),s.unshift([f,l]);if(s.length==t)break}o&&s.unshift([n,e]),Granify.setSharedData(i[r],s)}Granify.trackCart=function(t){if(t&&Granify.itExists(t.items))for(var n=0;n<t.items.length;n++){var r=t.items[n];Granify.itExists(r.product_id)&&(Granify.itExists(r.regular_price)&&Granify.itExists(r.price)&&r.price!=r.regular_price&&o([r.regular_price,r.price],r.product_id,"prices"),Granify.itExists(r.carters)&&o(r.carters,r.product_id,"carters"),Granify.itExists(r.in_stock)&&o(r.in_stock,r.product_id,"in_stock"))}e(t)}}}function d(){if(typeof Granify!="undefined"&&Granify!==null){var e=Granify.trackProduct;Granify.trackProduct=function(t){var n=[];for(var r=0;r<t.length;r++)window.location.href.split("?")[0].toLowerCase().indexOf("etsy.com/cart")==-1&&(t[r].url=window.location.href.split("?")[0]),n.push(t[r]);e(n)}}}function v(){function e(e){(e.id||e.sku)&&!e.product_id&&(e.product_id=(e.id||e.sku).toString()),delete e.id,delete e.sku}var t=Granify.trackProduct;Granify.trackProduct=function(n){for(var r=0;r<n.length;r++){var i=n[r];e(i)}t(n)};var n=Granify.setCurrentProduct;Granify.setCurrentProduct=function(e){Granify.isString(e)&&(e={product_id:e}),Granify.log("GRANIFY - Client called setCurrentProduct"),n(e)};var r=Granify.trackCart;Granify.trackCart=function(t){if(t==0){r(t);return}var n=t.items||[];for(var i=0;i<n.length;i++){var s=n[i];e(s)}t.items=n,r(t)};var i=Granify.internalDeleteFromCart;Granify.internalDeleteFromCart=function(t){for(var n=0;n<t.length;n++){var r=t[n];e(r)}i(t)};var s=Granify.trackOrder;Granify.trackOrder=function(t,n){var r=t.line_items||t.items||[];for(var i=0;i<r.length;i++){var o=r[i];e(o)}s(t,n)}}function m(){if(typeof Granify!="undefined"&&Granify!==null){var e=Granify.trackProduct;Granify.trackProduct=function(t){var n=[];for(var r=0;r<t.length;r++){try{t[r].shop_name=window.Etsy.Context.data.shop_name,t[r].savings=Number((t[r].regular_price-t[r].price).toFixed(2))}catch(i){Granify.log("Failed to append shop name and product savings, error: ",i)}n.push(t[r])}e(n)}}}function g(){if(typeof Granify!="undefined"&&Granify!==null){var e="GTM-KWW5SS",t=function(t){try{return window.google_tag_manager[e].dataLayer.get(t)}catch(n){return Granify.logErrorOnce("getGtmInfo - Failed to get "+t+":",n),!1}},n=function(e){try{return document.body.getAttribute(e)}catch(t){return Granify.logWarningOnce("getBodyInfo - Failed to get "+e+":",t),!1}},r=function(){var e=n("data-currency");return e?e:t("Currency")},i=function(){var e=n("data-language");return e?e:t("Language")},s=function(e){var t=Granify.getProductStorage();e.forEach(function(e){delete t.all_tracked_products[e]}),Granify.saveProductStorage(t)},o=Granify.trackProduct;Granify.trackProduct=function(e){var t=[],n=[];for(var u=0;u<e.length;u++){try{e[u].currency_code||(e[u].currency_code=r()),e[u].language_code||(e[u].language_code=i())}catch(a){Granify.log("Failed to append currency code or language code, error: ",a)}if(e[u].valid===!1){n.push(e[u].product_id);continue}t.push(e[u])}s(n),t.length>0&&o(t),Granify.setCartSSDProperty(Granify.getCartContents())},Granify.trackGranifyData("currency_code",r());var u=i();Granify.trackGranifyData("language_code",u),u&&(Granify.setLocale(u),Granify.setSiteStateDataProperty("language_code",u)),Granify.getProductLanguageAndCurrencyChanges=function(){var e=[];try{var t=Granify.getProductStorage().all_tracked_products,n=r(),s=i();Object.keys(t).forEach(function(r){var i=t[r];i.language_code!==s&&e.push(r),i.currency_code!==n&&e.push(r)})}catch(o){Granify.logErrorOnce("Could not get list of tracked products for language and currency check",o)}return e.filter(function(e,t,n){return n.indexOf(e)==t})}}}function y(){var e=Granify.trackOrder;Granify.trackOrder=function(t,n){Granify.log("trackOrderFilterArrays - overriding trackOrder call to filter arrays",t),Granify.isArray(t.subtotal_price)?t.subtotal_price=b(t.subtotal_price):null,Granify.isArray(t.order_number)?t.order_number=b(t.order_number):null,Granify.isArray(t.total_tax)?t.total_tax=b(t.total_tax):null,Granify.isArray(t.total_shipping)?t.total_shipping=b(t.total_shipping):null,Granify.isArray(t.total_price)?t.total_price=b(t.total_price):null,Granify.isArray(t.total_line_items_price)?t.total_line_items_price=b(t.total_line_items_price):null,Granify.logDebug("trackOrderFilterArrays - data after array filtering:",t),e(t,n)}}function b(e){var t=e[0];return e.forEach(function(n){if(n!=t)return Granify.logError("trackOrder called with invalid array",e),null}),t}function w(){if(Granify.enabled){Granify.initialMatchInterval=1e3,Granify.initialMatchPeriod=Infinity,Granify.resultingMatchInterval=1e3,Granify.idleTimeoutThreshold=5e3,Granify.pageTimeStart=Date.now();function e(){return Date.now()>Granify.pageTimeStart+Granify.initialMatchPeriod}Granify.scheduleNextMatch=function(){var t=Granify.itExists(GRANIFY_CONFIG.external_groups)&&GRANIFY_CONFIG.external_groups===!0;if(t&&Granify.externalGroupReady===!1)return;if(Granify.unitTestsDisableNextMatch)return;e()?Granify.tracking_wait_interval=Granify.resultingMatchInterval:Granify.tracking_wait_interval=Granify.initialMatchInterval,Granify.itExists(window.showMatchingInterval)&&Granify.log("Match request interval: "+Granify.tracking_wait_interval/1e3+" seconds");if(!Granify.tracking_stopped)return setTimeout(function(){return Granify.track()},Granify.tracking_wait_interval)},Granify.idle_tracking=Granify.throttle(function(){Granify.idle_time+=1;if(Granify.stopped)return;Granify.idle_time>Granify.idleTimeoutThreshold/1e3&&!Granify.tracking_stopped?(Granify.tracking_stopped=!0,Granify.cumulated_active_time+=Granify.time_since(Granify.mouse_activity_resumed_date)):Granify.tracking_stopped&&Granify.idle_time<=Granify.idleTimeoutThreshold/1e3&&(Granify.tracking_stopped=!1,Granify.mouse_activity_resumed_date=+(new Date),Granify.scheduleNextMatch());if(!Granify.tracking_stopped)return Granify.mouse_active_time_total=Granify.cumulated_active_time+Granify.time_since(Granify.mouse_activity_resumed_date)},100);function t(e){var t=["initialMatchInterval","initialMatchPeriod","resultingMatchInterval","idleTimeout"];if(!Granify.isObject(e))return Granify.log("GRANIFY: warning - configureMatchBehavior() function expected type Object, instead received: ",e),!1;var n=Object.keys(e);if(!Granify.itExists(n)||n.length<1)return Granify.log("GRANIFY: warning - configureMatchBehaviour() function called without any settings in passed parameter."),!1;for(var r=0,i=n.length;r<i;r++){var s=n[r];if(t.indexOf(s)==-1)return Granify.log("GRANIFY: warning - configureMatchBehaviour() function does not recognize key: "+s),!1;if(!Granify.isNumber(e[s]))return Granify.log("GRANIFY: warning - configureMatchBehaviour() expects "+s+" to be of type Number. Instead received: "+e[s]),!1}return!0}Granify.configureMatchBehavior=function(e){if(!t(e))return;Granify.itExists(e.initialMatchInterval)&&(Granify.initialMatchInterval=e.initialMatchInterval),Granify.itExists(e.initialMatchPeriod)&&(Granify.initialMatchPeriod=e.initialMatchPeriod),Granify.itExists(e.resultingMatchInterval)&&(Granify.resultingMatchInterval=e.resultingMatchInterval),Granify.itExists(e.idleTimeout)&&(Granify.idleTimeoutThreshold=e.idleTimeout)}}}function E(){if(Granify.enabled){var e={initialMatchInterval:1e3,initialMatchPeriod:3e3,resultingMatchInterval:2e3,idleTimeout:2e3};Granify.configureMatchBehavior(e)}}Granify.Etsy={};var S=!0;t(),n(),r(),s(),o(),u(),p(),d(),w(),m(),e(),v(),E(),g(),y(),a(),c(),Granify.initializeCurrentProductSSDwhitelist(["free_shipping_start","free_shipping_end","free_shipping_minimum_type","free_shipping_min_total_money","free_shipping_min_total_currency_code","promotion_start_timestamp","promotion_end_timestamp","promotion_minimum_type","promotion_min_quantity","promotion_percentage_discount","promotion_min_total","carters","shop_name","savings","currency_code","language_code"])}}).call(this);

  
}
